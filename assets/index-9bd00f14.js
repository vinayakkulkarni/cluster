function lE(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in i)){const u=Object.getOwnPropertyDescriptor(r,a);u&&Object.defineProperty(i,a,u.get?u:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function t(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=t(a);fetch(a.href,u)}})();function sg(i,e){const t=Object.create(null),r=i.split(",");for(let a=0;a<r.length;a++)t[r[a]]=!0;return e?a=>!!t[a.toLowerCase()]:a=>!!t[a]}function og(i){if(ri(i)){const e={};for(let t=0;t<i.length;t++){const r=i[t],a=Bn(r)?dE(r):og(r);if(a)for(const u in a)e[u]=a[u]}return e}else{if(Bn(i))return i;if(dn(i))return i}}const cE=/;(?![^(]*\))/g,uE=/:([^]+)/,hE=/\/\*.*?\*\//gs;function dE(i){const e={};return i.replace(hE,"").split(cE).forEach(t=>{if(t){const r=t.split(uE);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function ag(i){let e="";if(Bn(i))e=i;else if(ri(i))for(let t=0;t<i.length;t++){const r=ag(i[t]);r&&(e+=r+" ")}else if(dn(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const fE="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",pE=sg(fE);function Av(i){return!!i||i===""}const qi={},Ll=[],ps=()=>{},mE=()=>!1,gE=/^on[^a-z]/,Qd=i=>gE.test(i),lg=i=>i.startsWith("onUpdate:"),pr=Object.assign,cg=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},_E=Object.prototype.hasOwnProperty,gi=(i,e)=>_E.call(i,e),ri=Array.isArray,au=i=>ef(i)==="[object Map]",yE=i=>ef(i)==="[object Set]",ni=i=>typeof i=="function",Bn=i=>typeof i=="string",ug=i=>typeof i=="symbol",dn=i=>i!==null&&typeof i=="object",Pv=i=>dn(i)&&ni(i.then)&&ni(i.catch),xE=Object.prototype.toString,ef=i=>xE.call(i),vE=i=>ef(i).slice(8,-1),bE=i=>ef(i)==="[object Object]",hg=i=>Bn(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,md=sg(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),tf=i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},wE=/-(\w)/g,Vs=tf(i=>i.replace(wE,(e,t)=>t?t.toUpperCase():"")),TE=/\B([A-Z])/g,Zl=tf(i=>i.replace(TE,"-$1").toLowerCase()),nf=tf(i=>i.charAt(0).toUpperCase()+i.slice(1)),Sp=tf(i=>i?`on${nf(i)}`:""),_u=(i,e)=>!Object.is(i,e),Ap=(i,e)=>{for(let t=0;t<i.length;t++)i[t](e)},Cd=(i,e,t)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value:t})},EE=i=>{const e=parseFloat(i);return isNaN(e)?i:e};let Dy;const SE=()=>Dy||(Dy=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let cs;class AE{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=cs,!e&&cs&&(this.index=(cs.scopes||(cs.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=cs;try{return cs=this,e()}finally{cs=t}}}on(){cs=this}off(){cs=this.parent}stop(e){if(this._active){let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.scopes)for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const a=this.parent.scopes.pop();a&&a!==this&&(this.parent.scopes[this.index]=a,a.index=this.index)}this.parent=void 0,this._active=!1}}}function PE(i,e=cs){e&&e.active&&e.effects.push(i)}function IE(){return cs}const dg=i=>{const e=new Set(i);return e.w=0,e.n=0,e},Iv=i=>(i.w&Ko)>0,Cv=i=>(i.n&Ko)>0,CE=({deps:i})=>{if(i.length)for(let e=0;e<i.length;e++)i[e].w|=Ko},ME=i=>{const{deps:e}=i;if(e.length){let t=0;for(let r=0;r<e.length;r++){const a=e[r];Iv(a)&&!Cv(a)?a.delete(i):e[t++]=a,a.w&=~Ko,a.n&=~Ko}e.length=t}},mm=new WeakMap;let nu=0,Ko=1;const gm=30;let us;const Ba=Symbol(""),_m=Symbol("");class fg{constructor(e,t=null,r){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,PE(this,r)}run(){if(!this.active)return this.fn();let e=us,t=$o;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=us,us=this,$o=!0,Ko=1<<++nu,nu<=gm?CE(this):zy(this),this.fn()}finally{nu<=gm&&ME(this),Ko=1<<--nu,us=this.parent,$o=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){us===this?this.deferStop=!0:this.active&&(zy(this),this.onStop&&this.onStop(),this.active=!1)}}function zy(i){const{deps:e}=i;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(i);e.length=0}}let $o=!0;const Mv=[];function Xl(){Mv.push($o),$o=!1}function Yl(){const i=Mv.pop();$o=i===void 0?!0:i}function Er(i,e,t){if($o&&us){let r=mm.get(i);r||mm.set(i,r=new Map);let a=r.get(t);a||r.set(t,a=dg()),Lv(a)}}function Lv(i,e){let t=!1;nu<=gm?Cv(i)||(i.n|=Ko,t=!Iv(i)):t=!i.has(us),t&&(i.add(us),us.deps.push(i))}function lo(i,e,t,r,a,u){const f=mm.get(i);if(!f)return;let l=[];if(e==="clear")l=[...f.values()];else if(t==="length"&&ri(i)){const x=Number(r);f.forEach((w,P)=>{(P==="length"||P>=x)&&l.push(w)})}else switch(t!==void 0&&l.push(f.get(t)),e){case"add":ri(i)?hg(t)&&l.push(f.get("length")):(l.push(f.get(Ba)),au(i)&&l.push(f.get(_m)));break;case"delete":ri(i)||(l.push(f.get(Ba)),au(i)&&l.push(f.get(_m)));break;case"set":au(i)&&l.push(f.get(Ba));break}if(l.length===1)l[0]&&ym(l[0]);else{const x=[];for(const w of l)w&&x.push(...w);ym(dg(x))}}function ym(i,e){const t=ri(i)?i:[...i];for(const r of t)r.computed&&Oy(r);for(const r of t)r.computed||Oy(r)}function Oy(i,e){(i!==us||i.allowRecurse)&&(i.scheduler?i.scheduler():i.run())}const LE=sg("__proto__,__v_isRef,__isVue"),Rv=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(ug)),RE=pg(),kE=pg(!1,!0),DE=pg(!0),Fy=zE();function zE(){const i={};return["includes","indexOf","lastIndexOf"].forEach(e=>{i[e]=function(...t){const r=wi(this);for(let u=0,f=this.length;u<f;u++)Er(r,"get",u+"");const a=r[e](...t);return a===-1||a===!1?r[e](...t.map(wi)):a}}),["push","pop","shift","unshift","splice"].forEach(e=>{i[e]=function(...t){Xl();const r=wi(this)[e].apply(this,t);return Yl(),r}}),i}function OE(i){const e=wi(this);return Er(e,"has",i),e.hasOwnProperty(i)}function pg(i=!1,e=!1){return function(r,a,u){if(a==="__v_isReactive")return!i;if(a==="__v_isReadonly")return i;if(a==="__v_isShallow")return e;if(a==="__v_raw"&&u===(i?e?JE:Fv:e?Ov:zv).get(r))return r;const f=ri(r);if(!i){if(f&&gi(Fy,a))return Reflect.get(Fy,a,u);if(a==="hasOwnProperty")return OE}const l=Reflect.get(r,a,u);return(ug(a)?Rv.has(a):LE(a))||(i||Er(r,"get",a),e)?l:Jn(l)?f&&hg(a)?l:l.value:dn(l)?i?Bv(l):sf(l):l}}const FE=kv(),BE=kv(!0);function kv(i=!1){return function(t,r,a,u){let f=t[r];if(Fl(f)&&Jn(f)&&!Jn(a))return!1;if(!i&&(!Md(a)&&!Fl(a)&&(f=wi(f),a=wi(a)),!ri(t)&&Jn(f)&&!Jn(a)))return f.value=a,!0;const l=ri(t)&&hg(r)?Number(r)<t.length:gi(t,r),x=Reflect.set(t,r,a,u);return t===wi(u)&&(l?_u(a,f)&&lo(t,"set",r,a):lo(t,"add",r,a)),x}}function NE(i,e){const t=gi(i,e);i[e];const r=Reflect.deleteProperty(i,e);return r&&t&&lo(i,"delete",e,void 0),r}function UE(i,e){const t=Reflect.has(i,e);return(!ug(e)||!Rv.has(e))&&Er(i,"has",e),t}function VE(i){return Er(i,"iterate",ri(i)?"length":Ba),Reflect.ownKeys(i)}const Dv={get:RE,set:FE,deleteProperty:NE,has:UE,ownKeys:VE},jE={get:DE,set(i,e){return!0},deleteProperty(i,e){return!0}},GE=pr({},Dv,{get:kE,set:BE}),mg=i=>i,rf=i=>Reflect.getPrototypeOf(i);function Hh(i,e,t=!1,r=!1){i=i.__v_raw;const a=wi(i),u=wi(e);t||(e!==u&&Er(a,"get",e),Er(a,"get",u));const{has:f}=rf(a),l=r?mg:t?yg:yu;if(f.call(a,e))return l(i.get(e));if(f.call(a,u))return l(i.get(u));i!==a&&i.get(e)}function qh(i,e=!1){const t=this.__v_raw,r=wi(t),a=wi(i);return e||(i!==a&&Er(r,"has",i),Er(r,"has",a)),i===a?t.has(i):t.has(i)||t.has(a)}function $h(i,e=!1){return i=i.__v_raw,!e&&Er(wi(i),"iterate",Ba),Reflect.get(i,"size",i)}function By(i){i=wi(i);const e=wi(this);return rf(e).has.call(e,i)||(e.add(i),lo(e,"add",i,i)),this}function Ny(i,e){e=wi(e);const t=wi(this),{has:r,get:a}=rf(t);let u=r.call(t,i);u||(i=wi(i),u=r.call(t,i));const f=a.call(t,i);return t.set(i,e),u?_u(e,f)&&lo(t,"set",i,e):lo(t,"add",i,e),this}function Uy(i){const e=wi(this),{has:t,get:r}=rf(e);let a=t.call(e,i);a||(i=wi(i),a=t.call(e,i)),r&&r.call(e,i);const u=e.delete(i);return a&&lo(e,"delete",i,void 0),u}function Vy(){const i=wi(this),e=i.size!==0,t=i.clear();return e&&lo(i,"clear",void 0,void 0),t}function Zh(i,e){return function(r,a){const u=this,f=u.__v_raw,l=wi(f),x=e?mg:i?yg:yu;return!i&&Er(l,"iterate",Ba),f.forEach((w,P)=>r.call(a,x(w),x(P),u))}}function Xh(i,e,t){return function(...r){const a=this.__v_raw,u=wi(a),f=au(u),l=i==="entries"||i===Symbol.iterator&&f,x=i==="keys"&&f,w=a[i](...r),P=t?mg:e?yg:yu;return!e&&Er(u,"iterate",x?_m:Ba),{next(){const{value:M,done:C}=w.next();return C?{value:M,done:C}:{value:l?[P(M[0]),P(M[1])]:P(M),done:C}},[Symbol.iterator](){return this}}}}function Fo(i){return function(...e){return i==="delete"?!1:this}}function WE(){const i={get(u){return Hh(this,u)},get size(){return $h(this)},has:qh,add:By,set:Ny,delete:Uy,clear:Vy,forEach:Zh(!1,!1)},e={get(u){return Hh(this,u,!1,!0)},get size(){return $h(this)},has:qh,add:By,set:Ny,delete:Uy,clear:Vy,forEach:Zh(!1,!0)},t={get(u){return Hh(this,u,!0)},get size(){return $h(this,!0)},has(u){return qh.call(this,u,!0)},add:Fo("add"),set:Fo("set"),delete:Fo("delete"),clear:Fo("clear"),forEach:Zh(!0,!1)},r={get(u){return Hh(this,u,!0,!0)},get size(){return $h(this,!0)},has(u){return qh.call(this,u,!0)},add:Fo("add"),set:Fo("set"),delete:Fo("delete"),clear:Fo("clear"),forEach:Zh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(u=>{i[u]=Xh(u,!1,!1),t[u]=Xh(u,!0,!1),e[u]=Xh(u,!1,!0),r[u]=Xh(u,!0,!0)}),[i,t,e,r]}const[HE,qE,$E,ZE]=WE();function gg(i,e){const t=e?i?ZE:$E:i?qE:HE;return(r,a,u)=>a==="__v_isReactive"?!i:a==="__v_isReadonly"?i:a==="__v_raw"?r:Reflect.get(gi(t,a)&&a in r?t:r,a,u)}const XE={get:gg(!1,!1)},YE={get:gg(!1,!0)},KE={get:gg(!0,!1)},zv=new WeakMap,Ov=new WeakMap,Fv=new WeakMap,JE=new WeakMap;function QE(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function e2(i){return i.__v_skip||!Object.isExtensible(i)?0:QE(vE(i))}function sf(i){return Fl(i)?i:_g(i,!1,Dv,XE,zv)}function t2(i){return _g(i,!1,GE,YE,Ov)}function Bv(i){return _g(i,!0,jE,KE,Fv)}function _g(i,e,t,r,a){if(!dn(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const u=a.get(i);if(u)return u;const f=e2(i);if(f===0)return i;const l=new Proxy(i,f===2?r:t);return a.set(i,l),l}function Rl(i){return Fl(i)?Rl(i.__v_raw):!!(i&&i.__v_isReactive)}function Fl(i){return!!(i&&i.__v_isReadonly)}function Md(i){return!!(i&&i.__v_isShallow)}function Nv(i){return Rl(i)||Fl(i)}function wi(i){const e=i&&i.__v_raw;return e?wi(e):i}function Uv(i){return Cd(i,"__v_skip",!0),i}const yu=i=>dn(i)?sf(i):i,yg=i=>dn(i)?Bv(i):i;function Vv(i){$o&&us&&(i=wi(i),Lv(i.dep||(i.dep=dg())))}function jv(i,e){i=wi(i);const t=i.dep;t&&ym(t)}function Jn(i){return!!(i&&i.__v_isRef===!0)}function Fn(i){return Gv(i,!1)}function i2(i){return Gv(i,!0)}function Gv(i,e){return Jn(i)?i:new n2(i,e)}class n2{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:wi(e),this._value=t?e:yu(e)}get value(){return Vv(this),this._value}set value(e){const t=this.__v_isShallow||Md(e)||Fl(e);e=t?e:wi(e),_u(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:yu(e),jv(this))}}function r2(i){return Jn(i)?i.value:i}const s2={get:(i,e,t)=>r2(Reflect.get(i,e,t)),set:(i,e,t,r)=>{const a=i[e];return Jn(a)&&!Jn(t)?(a.value=t,!0):Reflect.set(i,e,t,r)}};function Wv(i){return Rl(i)?i:new Proxy(i,s2)}var Hv;class o2{constructor(e,t,r,a){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[Hv]=!1,this._dirty=!0,this.effect=new fg(e,()=>{this._dirty||(this._dirty=!0,jv(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!a,this.__v_isReadonly=r}get value(){const e=wi(this);return Vv(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}Hv="__v_isReadonly";function a2(i,e,t=!1){let r,a;const u=ni(i);return u?(r=i,a=ps):(r=i.get,a=i.set),new o2(r,a,u||!a,t)}function Zo(i,e,t,r){let a;try{a=r?i(...r):i()}catch(u){of(u,e,t)}return a}function ms(i,e,t,r){if(ni(i)){const u=Zo(i,e,t,r);return u&&Pv(u)&&u.catch(f=>{of(f,e,t)}),u}const a=[];for(let u=0;u<i.length;u++)a.push(ms(i[u],e,t,r));return a}function of(i,e,t,r=!0){const a=e?e.vnode:null;if(e){let u=e.parent;const f=e.proxy,l=t;for(;u;){const w=u.ec;if(w){for(let P=0;P<w.length;P++)if(w[P](i,f,l)===!1)return}u=u.parent}const x=e.appContext.config.errorHandler;if(x){Zo(x,null,10,[i,f,l]);return}}l2(i,t,a,r)}function l2(i,e,t,r=!0){console.error(i)}let xu=!1,xm=!1;const Yn=[];let Os=0;const kl=[];let oo=null,za=0;const qv=Promise.resolve();let xg=null;function c2(i){const e=xg||qv;return i?e.then(this?i.bind(this):i):e}function u2(i){let e=Os+1,t=Yn.length;for(;e<t;){const r=e+t>>>1;vu(Yn[r])<i?e=r+1:t=r}return e}function vg(i){(!Yn.length||!Yn.includes(i,xu&&i.allowRecurse?Os+1:Os))&&(i.id==null?Yn.push(i):Yn.splice(u2(i.id),0,i),$v())}function $v(){!xu&&!xm&&(xm=!0,xg=qv.then(Xv))}function h2(i){const e=Yn.indexOf(i);e>Os&&Yn.splice(e,1)}function d2(i){ri(i)?kl.push(...i):(!oo||!oo.includes(i,i.allowRecurse?za+1:za))&&kl.push(i),$v()}function jy(i,e=xu?Os+1:0){for(;e<Yn.length;e++){const t=Yn[e];t&&t.pre&&(Yn.splice(e,1),e--,t())}}function Zv(i){if(kl.length){const e=[...new Set(kl)];if(kl.length=0,oo){oo.push(...e);return}for(oo=e,oo.sort((t,r)=>vu(t)-vu(r)),za=0;za<oo.length;za++)oo[za]();oo=null,za=0}}const vu=i=>i.id==null?1/0:i.id,f2=(i,e)=>{const t=vu(i)-vu(e);if(t===0){if(i.pre&&!e.pre)return-1;if(e.pre&&!i.pre)return 1}return t};function Xv(i){xm=!1,xu=!0,Yn.sort(f2);const e=ps;try{for(Os=0;Os<Yn.length;Os++){const t=Yn[Os];t&&t.active!==!1&&Zo(t,null,14)}}finally{Os=0,Yn.length=0,Zv(),xu=!1,xg=null,(Yn.length||kl.length)&&Xv()}}function p2(i,e,...t){if(i.isUnmounted)return;const r=i.vnode.props||qi;let a=t;const u=e.startsWith("update:"),f=u&&e.slice(7);if(f&&f in r){const P=`${f==="modelValue"?"model":f}Modifiers`,{number:M,trim:C}=r[P]||qi;C&&(a=t.map(V=>Bn(V)?V.trim():V)),M&&(a=t.map(EE))}let l,x=r[l=Sp(e)]||r[l=Sp(Vs(e))];!x&&u&&(x=r[l=Sp(Zl(e))]),x&&ms(x,i,6,a);const w=r[l+"Once"];if(w){if(!i.emitted)i.emitted={};else if(i.emitted[l])return;i.emitted[l]=!0,ms(w,i,6,a)}}function Yv(i,e,t=!1){const r=e.emitsCache,a=r.get(i);if(a!==void 0)return a;const u=i.emits;let f={},l=!1;if(!ni(i)){const x=w=>{const P=Yv(w,e,!0);P&&(l=!0,pr(f,P))};!t&&e.mixins.length&&e.mixins.forEach(x),i.extends&&x(i.extends),i.mixins&&i.mixins.forEach(x)}return!u&&!l?(dn(i)&&r.set(i,null),null):(ri(u)?u.forEach(x=>f[x]=null):pr(f,u),dn(i)&&r.set(i,f),f)}function af(i,e){return!i||!Qd(e)?!1:(e=e.slice(2).replace(/Once$/,""),gi(i,e[0].toLowerCase()+e.slice(1))||gi(i,Zl(e))||gi(i,e))}let dr=null,Kv=null;function Ld(i){const e=dr;return dr=i,Kv=i&&i.type.__scopeId||null,e}function Jv(i,e=dr,t){if(!e||i._n)return i;const r=(...a)=>{r._d&&Jy(-1);const u=Ld(e);let f;try{f=i(...a)}finally{Ld(u),r._d&&Jy(1)}return f};return r._n=!0,r._c=!0,r._d=!0,r}function Pp(i){const{type:e,vnode:t,proxy:r,withProxy:a,props:u,propsOptions:[f],slots:l,attrs:x,emit:w,render:P,renderCache:M,data:C,setupState:V,ctx:Y,inheritAttrs:J}=i;let ce,pe;const ve=Ld(i);try{if(t.shapeFlag&4){const Ee=a||r;ce=zs(P.call(Ee,Ee,M,u,V,C,Y)),pe=x}else{const Ee=e;ce=zs(Ee.length>1?Ee(u,{attrs:x,slots:l,emit:w}):Ee(u,null)),pe=e.props?x:m2(x)}}catch(Ee){hu.length=0,of(Ee,i,1),ce=fr(Jo)}let he=ce;if(pe&&J!==!1){const Ee=Object.keys(pe),{shapeFlag:Fe}=he;Ee.length&&Fe&7&&(f&&Ee.some(lg)&&(pe=g2(pe,f)),he=Bl(he,pe))}return t.dirs&&(he=Bl(he),he.dirs=he.dirs?he.dirs.concat(t.dirs):t.dirs),t.transition&&(he.transition=t.transition),ce=he,Ld(ve),ce}const m2=i=>{let e;for(const t in i)(t==="class"||t==="style"||Qd(t))&&((e||(e={}))[t]=i[t]);return e},g2=(i,e)=>{const t={};for(const r in i)(!lg(r)||!(r.slice(9)in e))&&(t[r]=i[r]);return t};function _2(i,e,t){const{props:r,children:a,component:u}=i,{props:f,children:l,patchFlag:x}=e,w=u.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&x>=0){if(x&1024)return!0;if(x&16)return r?Gy(r,f,w):!!f;if(x&8){const P=e.dynamicProps;for(let M=0;M<P.length;M++){const C=P[M];if(f[C]!==r[C]&&!af(w,C))return!0}}}else return(a||l)&&(!l||!l.$stable)?!0:r===f?!1:r?f?Gy(r,f,w):!0:!!f;return!1}function Gy(i,e,t){const r=Object.keys(e);if(r.length!==Object.keys(i).length)return!0;for(let a=0;a<r.length;a++){const u=r[a];if(e[u]!==i[u]&&!af(t,u))return!0}return!1}function y2({vnode:i,parent:e},t){for(;e&&e.subTree===i;)(i=e.vnode).el=t,e=e.parent}const x2=i=>i.__isSuspense;function v2(i,e){e&&e.pendingBranch?ri(i)?e.effects.push(...i):e.effects.push(i):d2(i)}function Qv(i,e){if(bn){let t=bn.provides;const r=bn.parent&&bn.parent.provides;r===t&&(t=bn.provides=Object.create(r)),t[i]=e}}function lu(i,e,t=!1){const r=bn||dr;if(r){const a=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(a&&i in a)return a[i];if(arguments.length>1)return t&&ni(e)?e.call(r.proxy):e}}const Yh={};function Jr(i,e,t){return eb(i,e,t)}function eb(i,e,{immediate:t,deep:r,flush:a,onTrack:u,onTrigger:f}=qi){const l=IE()===(bn==null?void 0:bn.scope)?bn:null;let x,w=!1,P=!1;if(Jn(i)?(x=()=>i.value,w=Md(i)):Rl(i)?(x=()=>i,r=!0):ri(i)?(P=!0,w=i.some(he=>Rl(he)||Md(he)),x=()=>i.map(he=>{if(Jn(he))return he.value;if(Rl(he))return Pl(he);if(ni(he))return Zo(he,l,2)})):ni(i)?e?x=()=>Zo(i,l,2):x=()=>{if(!(l&&l.isUnmounted))return M&&M(),ms(i,l,3,[C])}:x=ps,e&&r){const he=x;x=()=>Pl(he())}let M,C=he=>{M=pe.onStop=()=>{Zo(he,l,4)}},V;if(Tu)if(C=ps,e?t&&ms(e,l,3,[x(),P?[]:void 0,C]):x(),a==="sync"){const he=fS();V=he.__watcherHandles||(he.__watcherHandles=[])}else return ps;let Y=P?new Array(i.length).fill(Yh):Yh;const J=()=>{if(pe.active)if(e){const he=pe.run();(r||w||(P?he.some((Ee,Fe)=>_u(Ee,Y[Fe])):_u(he,Y)))&&(M&&M(),ms(e,l,3,[he,Y===Yh?void 0:P&&Y[0]===Yh?[]:Y,C]),Y=he)}else pe.run()};J.allowRecurse=!!e;let ce;a==="sync"?ce=J:a==="post"?ce=()=>Tr(J,l&&l.suspense):(J.pre=!0,l&&(J.id=l.uid),ce=()=>vg(J));const pe=new fg(x,ce);e?t?J():Y=pe.run():a==="post"?Tr(pe.run.bind(pe),l&&l.suspense):pe.run();const ve=()=>{pe.stop(),l&&l.scope&&cg(l.scope.effects,pe)};return V&&V.push(ve),ve}function b2(i,e,t){const r=this.proxy,a=Bn(i)?i.includes(".")?tb(r,i):()=>r[i]:i.bind(r,r);let u;ni(e)?u=e:(u=e.handler,t=e);const f=bn;Nl(this);const l=eb(a,u.bind(r),t);return f?Nl(f):Na(),l}function tb(i,e){const t=e.split(".");return()=>{let r=i;for(let a=0;a<t.length&&r;a++)r=r[t[a]];return r}}function Pl(i,e){if(!dn(i)||i.__v_skip||(e=e||new Set,e.has(i)))return i;if(e.add(i),Jn(i))Pl(i.value,e);else if(ri(i))for(let t=0;t<i.length;t++)Pl(i[t],e);else if(yE(i)||au(i))i.forEach(t=>{Pl(t,e)});else if(bE(i))for(const t in i)Pl(i[t],e);return i}function Nn(i){return ni(i)?{setup:i,name:i.name}:i}const cu=i=>!!i.type.__asyncLoader,ib=i=>i.type.__isKeepAlive;function w2(i,e){nb(i,"a",e)}function T2(i,e){nb(i,"da",e)}function nb(i,e,t=bn){const r=i.__wdc||(i.__wdc=()=>{let a=t;for(;a;){if(a.isDeactivated)return;a=a.parent}return i()});if(lf(e,r,t),t){let a=t.parent;for(;a&&a.parent;)ib(a.parent.vnode)&&E2(r,e,t,a),a=a.parent}}function E2(i,e,t,r){const a=lf(e,i,r,!0);rb(()=>{cg(r[e],a)},t)}function lf(i,e,t=bn,r=!1){if(t){const a=t[i]||(t[i]=[]),u=e.__weh||(e.__weh=(...f)=>{if(t.isUnmounted)return;Xl(),Nl(t);const l=ms(e,t,i,f);return Na(),Yl(),l});return r?a.unshift(u):a.push(u),u}}const fo=i=>(e,t=bn)=>(!Tu||i==="sp")&&lf(i,(...r)=>e(...r),t),S2=fo("bm"),Un=fo("m"),A2=fo("bu"),P2=fo("u"),cf=fo("bum"),rb=fo("um"),I2=fo("sp"),C2=fo("rtg"),M2=fo("rtc");function L2(i,e=bn){lf("ec",i,e)}function Ia(i,e,t,r){const a=i.dirs,u=e&&e.dirs;for(let f=0;f<a.length;f++){const l=a[f];u&&(l.oldValue=u[f].value);let x=l.dir[r];x&&(Xl(),ms(x,t,8,[i.el,l,i,e]),Yl())}}const sb="components";function Wy(i,e){return k2(sb,i,!0,e)||i}const R2=Symbol();function k2(i,e,t=!0,r=!1){const a=dr||bn;if(a){const u=a.type;if(i===sb){const l=cS(u,!1);if(l&&(l===e||l===Vs(e)||l===nf(Vs(e))))return u}const f=Hy(a[i]||u[i],e)||Hy(a.appContext[i],e);return!f&&r?u:f}}function Hy(i,e){return i&&(i[e]||i[Vs(e)]||i[nf(Vs(e))])}function bg(i,e,t={},r,a){if(dr.isCE||dr.parent&&cu(dr.parent)&&dr.parent.isCE)return e!=="default"&&(t.name=e),fr("slot",t,r&&r());let u=i[e];u&&u._c&&(u._d=!1),Fs();const f=u&&ob(u(t)),l=du(Kr,{key:t.key||f&&f.key||`_${e}`},f||(r?r():[]),f&&i._===1?64:-2);return!a&&l.scopeId&&(l.slotScopeIds=[l.scopeId+"-s"]),u&&u._c&&(u._d=!0),l}function ob(i){return i.some(e=>kd(e)?!(e.type===Jo||e.type===Kr&&!ob(e.children)):!0)?i:null}const vm=i=>i?yb(i)?Sg(i)||i.proxy:vm(i.parent):null,uu=pr(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>vm(i.parent),$root:i=>vm(i.root),$emit:i=>i.emit,$options:i=>wg(i),$forceUpdate:i=>i.f||(i.f=()=>vg(i.update)),$nextTick:i=>i.n||(i.n=c2.bind(i.proxy)),$watch:i=>b2.bind(i)}),Ip=(i,e)=>i!==qi&&!i.__isScriptSetup&&gi(i,e),D2={get({_:i},e){const{ctx:t,setupState:r,data:a,props:u,accessCache:f,type:l,appContext:x}=i;let w;if(e[0]!=="$"){const V=f[e];if(V!==void 0)switch(V){case 1:return r[e];case 2:return a[e];case 4:return t[e];case 3:return u[e]}else{if(Ip(r,e))return f[e]=1,r[e];if(a!==qi&&gi(a,e))return f[e]=2,a[e];if((w=i.propsOptions[0])&&gi(w,e))return f[e]=3,u[e];if(t!==qi&&gi(t,e))return f[e]=4,t[e];bm&&(f[e]=0)}}const P=uu[e];let M,C;if(P)return e==="$attrs"&&Er(i,"get",e),P(i);if((M=l.__cssModules)&&(M=M[e]))return M;if(t!==qi&&gi(t,e))return f[e]=4,t[e];if(C=x.config.globalProperties,gi(C,e))return C[e]},set({_:i},e,t){const{data:r,setupState:a,ctx:u}=i;return Ip(a,e)?(a[e]=t,!0):r!==qi&&gi(r,e)?(r[e]=t,!0):gi(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(u[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:r,appContext:a,propsOptions:u}},f){let l;return!!t[f]||i!==qi&&gi(i,f)||Ip(e,f)||(l=u[0])&&gi(l,f)||gi(r,f)||gi(uu,f)||gi(a.config.globalProperties,f)},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:gi(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};let bm=!0;function z2(i){const e=wg(i),t=i.proxy,r=i.ctx;bm=!1,e.beforeCreate&&qy(e.beforeCreate,i,"bc");const{data:a,computed:u,methods:f,watch:l,provide:x,inject:w,created:P,beforeMount:M,mounted:C,beforeUpdate:V,updated:Y,activated:J,deactivated:ce,beforeDestroy:pe,beforeUnmount:ve,destroyed:he,unmounted:Ee,render:Fe,renderTracked:Ze,renderTriggered:ht,errorCaptured:_t,serverPrefetch:lt,expose:Et,inheritAttrs:It,components:Ot,directives:zt,filters:Ut}=e;if(w&&O2(w,r,null,i.appContext.config.unwrapInjectedRef),f)for(const oi in f){const ti=f[oi];ni(ti)&&(r[oi]=ti.bind(t))}if(a){const oi=a.call(t,t);dn(oi)&&(i.data=sf(oi))}if(bm=!0,u)for(const oi in u){const ti=u[oi],Vi=ni(ti)?ti.bind(t,t):ni(ti.get)?ti.get.bind(t,t):ps,fn=!ni(ti)&&ni(ti.set)?ti.set.bind(t):ps,wn=vb({get:Vi,set:fn});Object.defineProperty(r,oi,{enumerable:!0,configurable:!0,get:()=>wn.value,set:Fi=>wn.value=Fi})}if(l)for(const oi in l)ab(l[oi],r,t,oi);if(x){const oi=ni(x)?x.call(t):x;Reflect.ownKeys(oi).forEach(ti=>{Qv(ti,oi[ti])})}P&&qy(P,i,"c");function ft(oi,ti){ri(ti)?ti.forEach(Vi=>oi(Vi.bind(t))):ti&&oi(ti.bind(t))}if(ft(S2,M),ft(Un,C),ft(A2,V),ft(P2,Y),ft(w2,J),ft(T2,ce),ft(L2,_t),ft(M2,Ze),ft(C2,ht),ft(cf,ve),ft(rb,Ee),ft(I2,lt),ri(Et))if(Et.length){const oi=i.exposed||(i.exposed={});Et.forEach(ti=>{Object.defineProperty(oi,ti,{get:()=>t[ti],set:Vi=>t[ti]=Vi})})}else i.exposed||(i.exposed={});Fe&&i.render===ps&&(i.render=Fe),It!=null&&(i.inheritAttrs=It),Ot&&(i.components=Ot),zt&&(i.directives=zt)}function O2(i,e,t=ps,r=!1){ri(i)&&(i=wm(i));for(const a in i){const u=i[a];let f;dn(u)?"default"in u?f=lu(u.from||a,u.default,!0):f=lu(u.from||a):f=lu(u),Jn(f)&&r?Object.defineProperty(e,a,{enumerable:!0,configurable:!0,get:()=>f.value,set:l=>f.value=l}):e[a]=f}}function qy(i,e,t){ms(ri(i)?i.map(r=>r.bind(e.proxy)):i.bind(e.proxy),e,t)}function ab(i,e,t,r){const a=r.includes(".")?tb(t,r):()=>t[r];if(Bn(i)){const u=e[i];ni(u)&&Jr(a,u)}else if(ni(i))Jr(a,i.bind(t));else if(dn(i))if(ri(i))i.forEach(u=>ab(u,e,t,r));else{const u=ni(i.handler)?i.handler.bind(t):e[i.handler];ni(u)&&Jr(a,u,i)}}function wg(i){const e=i.type,{mixins:t,extends:r}=e,{mixins:a,optionsCache:u,config:{optionMergeStrategies:f}}=i.appContext,l=u.get(e);let x;return l?x=l:!a.length&&!t&&!r?x=e:(x={},a.length&&a.forEach(w=>Rd(x,w,f,!0)),Rd(x,e,f)),dn(e)&&u.set(e,x),x}function Rd(i,e,t,r=!1){const{mixins:a,extends:u}=e;u&&Rd(i,u,t,!0),a&&a.forEach(f=>Rd(i,f,t,!0));for(const f in e)if(!(r&&f==="expose")){const l=F2[f]||t&&t[f];i[f]=l?l(i[f],e[f]):e[f]}return i}const F2={data:$y,props:ka,emits:ka,methods:ka,computed:ka,beforeCreate:ur,created:ur,beforeMount:ur,mounted:ur,beforeUpdate:ur,updated:ur,beforeDestroy:ur,beforeUnmount:ur,destroyed:ur,unmounted:ur,activated:ur,deactivated:ur,errorCaptured:ur,serverPrefetch:ur,components:ka,directives:ka,watch:N2,provide:$y,inject:B2};function $y(i,e){return e?i?function(){return pr(ni(i)?i.call(this,this):i,ni(e)?e.call(this,this):e)}:e:i}function B2(i,e){return ka(wm(i),wm(e))}function wm(i){if(ri(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function ur(i,e){return i?[...new Set([].concat(i,e))]:e}function ka(i,e){return i?pr(pr(Object.create(null),i),e):e}function N2(i,e){if(!i)return e;if(!e)return i;const t=pr(Object.create(null),i);for(const r in e)t[r]=ur(i[r],e[r]);return t}function U2(i,e,t,r=!1){const a={},u={};Cd(u,hf,1),i.propsDefaults=Object.create(null),lb(i,e,a,u);for(const f in i.propsOptions[0])f in a||(a[f]=void 0);t?i.props=r?a:t2(a):i.type.props?i.props=a:i.props=u,i.attrs=u}function V2(i,e,t,r){const{props:a,attrs:u,vnode:{patchFlag:f}}=i,l=wi(a),[x]=i.propsOptions;let w=!1;if((r||f>0)&&!(f&16)){if(f&8){const P=i.vnode.dynamicProps;for(let M=0;M<P.length;M++){let C=P[M];if(af(i.emitsOptions,C))continue;const V=e[C];if(x)if(gi(u,C))V!==u[C]&&(u[C]=V,w=!0);else{const Y=Vs(C);a[Y]=Tm(x,l,Y,V,i,!1)}else V!==u[C]&&(u[C]=V,w=!0)}}}else{lb(i,e,a,u)&&(w=!0);let P;for(const M in l)(!e||!gi(e,M)&&((P=Zl(M))===M||!gi(e,P)))&&(x?t&&(t[M]!==void 0||t[P]!==void 0)&&(a[M]=Tm(x,l,M,void 0,i,!0)):delete a[M]);if(u!==l)for(const M in u)(!e||!gi(e,M))&&(delete u[M],w=!0)}w&&lo(i,"set","$attrs")}function lb(i,e,t,r){const[a,u]=i.propsOptions;let f=!1,l;if(e)for(let x in e){if(md(x))continue;const w=e[x];let P;a&&gi(a,P=Vs(x))?!u||!u.includes(P)?t[P]=w:(l||(l={}))[P]=w:af(i.emitsOptions,x)||(!(x in r)||w!==r[x])&&(r[x]=w,f=!0)}if(u){const x=wi(t),w=l||qi;for(let P=0;P<u.length;P++){const M=u[P];t[M]=Tm(a,x,M,w[M],i,!gi(w,M))}}return f}function Tm(i,e,t,r,a,u){const f=i[t];if(f!=null){const l=gi(f,"default");if(l&&r===void 0){const x=f.default;if(f.type!==Function&&ni(x)){const{propsDefaults:w}=a;t in w?r=w[t]:(Nl(a),r=w[t]=x.call(null,e),Na())}else r=x}f[0]&&(u&&!l?r=!1:f[1]&&(r===""||r===Zl(t))&&(r=!0))}return r}function cb(i,e,t=!1){const r=e.propsCache,a=r.get(i);if(a)return a;const u=i.props,f={},l=[];let x=!1;if(!ni(i)){const P=M=>{x=!0;const[C,V]=cb(M,e,!0);pr(f,C),V&&l.push(...V)};!t&&e.mixins.length&&e.mixins.forEach(P),i.extends&&P(i.extends),i.mixins&&i.mixins.forEach(P)}if(!u&&!x)return dn(i)&&r.set(i,Ll),Ll;if(ri(u))for(let P=0;P<u.length;P++){const M=Vs(u[P]);Zy(M)&&(f[M]=qi)}else if(u)for(const P in u){const M=Vs(P);if(Zy(M)){const C=u[P],V=f[M]=ri(C)||ni(C)?{type:C}:Object.assign({},C);if(V){const Y=Ky(Boolean,V.type),J=Ky(String,V.type);V[0]=Y>-1,V[1]=J<0||Y<J,(Y>-1||gi(V,"default"))&&l.push(M)}}}const w=[f,l];return dn(i)&&r.set(i,w),w}function Zy(i){return i[0]!=="$"}function Xy(i){const e=i&&i.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:i===null?"null":""}function Yy(i,e){return Xy(i)===Xy(e)}function Ky(i,e){return ri(e)?e.findIndex(t=>Yy(t,i)):ni(e)&&Yy(e,i)?0:-1}const ub=i=>i[0]==="_"||i==="$stable",Tg=i=>ri(i)?i.map(zs):[zs(i)],j2=(i,e,t)=>{if(e._n)return e;const r=Jv((...a)=>Tg(e(...a)),t);return r._c=!1,r},hb=(i,e,t)=>{const r=i._ctx;for(const a in i){if(ub(a))continue;const u=i[a];if(ni(u))e[a]=j2(a,u,r);else if(u!=null){const f=Tg(u);e[a]=()=>f}}},db=(i,e)=>{const t=Tg(e);i.slots.default=()=>t},G2=(i,e)=>{if(i.vnode.shapeFlag&32){const t=e._;t?(i.slots=wi(e),Cd(e,"_",t)):hb(e,i.slots={})}else i.slots={},e&&db(i,e);Cd(i.slots,hf,1)},W2=(i,e,t)=>{const{vnode:r,slots:a}=i;let u=!0,f=qi;if(r.shapeFlag&32){const l=e._;l?t&&l===1?u=!1:(pr(a,e),!t&&l===1&&delete a._):(u=!e.$stable,hb(e,a)),f=e}else e&&(db(i,e),f={default:1});if(u)for(const l in a)!ub(l)&&!(l in f)&&delete a[l]};function fb(){return{app:null,config:{isNativeTag:mE,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let H2=0;function q2(i,e){return function(r,a=null){ni(r)||(r=Object.assign({},r)),a!=null&&!dn(a)&&(a=null);const u=fb(),f=new Set;let l=!1;const x=u.app={_uid:H2++,_component:r,_props:a,_container:null,_context:u,_instance:null,version:pS,get config(){return u.config},set config(w){},use(w,...P){return f.has(w)||(w&&ni(w.install)?(f.add(w),w.install(x,...P)):ni(w)&&(f.add(w),w(x,...P))),x},mixin(w){return u.mixins.includes(w)||u.mixins.push(w),x},component(w,P){return P?(u.components[w]=P,x):u.components[w]},directive(w,P){return P?(u.directives[w]=P,x):u.directives[w]},mount(w,P,M){if(!l){const C=fr(r,a);return C.appContext=u,P&&e?e(C,w):i(C,w,M),l=!0,x._container=w,w.__vue_app__=x,Sg(C.component)||C.component.proxy}},unmount(){l&&(i(null,x._container),delete x._container.__vue_app__)},provide(w,P){return u.provides[w]=P,x}};return x}}function Em(i,e,t,r,a=!1){if(ri(i)){i.forEach((C,V)=>Em(C,e&&(ri(e)?e[V]:e),t,r,a));return}if(cu(r)&&!a)return;const u=r.shapeFlag&4?Sg(r.component)||r.component.proxy:r.el,f=a?null:u,{i:l,r:x}=i,w=e&&e.r,P=l.refs===qi?l.refs={}:l.refs,M=l.setupState;if(w!=null&&w!==x&&(Bn(w)?(P[w]=null,gi(M,w)&&(M[w]=null)):Jn(w)&&(w.value=null)),ni(x))Zo(x,l,12,[f,P]);else{const C=Bn(x),V=Jn(x);if(C||V){const Y=()=>{if(i.f){const J=C?gi(M,x)?M[x]:P[x]:x.value;a?ri(J)&&cg(J,u):ri(J)?J.includes(u)||J.push(u):C?(P[x]=[u],gi(M,x)&&(M[x]=P[x])):(x.value=[u],i.k&&(P[i.k]=x.value))}else C?(P[x]=f,gi(M,x)&&(M[x]=f)):V&&(x.value=f,i.k&&(P[i.k]=f))};f?(Y.id=-1,Tr(Y,t)):Y()}}}const Tr=v2;function $2(i){return Z2(i)}function Z2(i,e){const t=SE();t.__VUE__=!0;const{insert:r,remove:a,patchProp:u,createElement:f,createText:l,createComment:x,setText:w,setElementText:P,parentNode:M,nextSibling:C,setScopeId:V=ps,insertStaticContent:Y}=i,J=(oe,me,Re,Ve=null,Be=null,qe=null,rt=!1,ze=null,$e=!!me.dynamicChildren)=>{if(oe===me)return;oe&&!Xc(oe,me)&&(Ve=xi(oe),Fi(oe,Be,qe,!0),oe=null),me.patchFlag===-2&&($e=!1,me.dynamicChildren=null);const{type:Ue,ref:Tt,shapeFlag:yt}=me;switch(Ue){case uf:ce(oe,me,Re,Ve);break;case Jo:pe(oe,me,Re,Ve);break;case Cp:oe==null&&ve(me,Re,Ve,rt);break;case Kr:Ot(oe,me,Re,Ve,Be,qe,rt,ze,$e);break;default:yt&1?Fe(oe,me,Re,Ve,Be,qe,rt,ze,$e):yt&6?zt(oe,me,Re,Ve,Be,qe,rt,ze,$e):(yt&64||yt&128)&&Ue.process(oe,me,Re,Ve,Be,qe,rt,ze,$e,$t)}Tt!=null&&Be&&Em(Tt,oe&&oe.ref,qe,me||oe,!me)},ce=(oe,me,Re,Ve)=>{if(oe==null)r(me.el=l(me.children),Re,Ve);else{const Be=me.el=oe.el;me.children!==oe.children&&w(Be,me.children)}},pe=(oe,me,Re,Ve)=>{oe==null?r(me.el=x(me.children||""),Re,Ve):me.el=oe.el},ve=(oe,me,Re,Ve)=>{[oe.el,oe.anchor]=Y(oe.children,me,Re,Ve,oe.el,oe.anchor)},he=({el:oe,anchor:me},Re,Ve)=>{let Be;for(;oe&&oe!==me;)Be=C(oe),r(oe,Re,Ve),oe=Be;r(me,Re,Ve)},Ee=({el:oe,anchor:me})=>{let Re;for(;oe&&oe!==me;)Re=C(oe),a(oe),oe=Re;a(me)},Fe=(oe,me,Re,Ve,Be,qe,rt,ze,$e)=>{rt=rt||me.type==="svg",oe==null?Ze(me,Re,Ve,Be,qe,rt,ze,$e):lt(oe,me,Be,qe,rt,ze,$e)},Ze=(oe,me,Re,Ve,Be,qe,rt,ze)=>{let $e,Ue;const{type:Tt,props:yt,shapeFlag:wt,transition:Lt,dirs:Vt}=oe;if($e=oe.el=f(oe.type,qe,yt&&yt.is,yt),wt&8?P($e,oe.children):wt&16&&_t(oe.children,$e,null,Ve,Be,qe&&Tt!=="foreignObject",rt,ze),Vt&&Ia(oe,null,Ve,"created"),ht($e,oe,oe.scopeId,rt,Ve),yt){for(const we in yt)we!=="value"&&!md(we)&&u($e,we,null,yt[we],qe,oe.children,Ve,Be,Ji);"value"in yt&&u($e,"value",null,yt.value),(Ue=yt.onVnodeBeforeMount)&&Ls(Ue,Ve,oe)}Vt&&Ia(oe,null,Ve,"beforeMount");const Qt=(!Be||Be&&!Be.pendingBranch)&&Lt&&!Lt.persisted;Qt&&Lt.beforeEnter($e),r($e,me,Re),((Ue=yt&&yt.onVnodeMounted)||Qt||Vt)&&Tr(()=>{Ue&&Ls(Ue,Ve,oe),Qt&&Lt.enter($e),Vt&&Ia(oe,null,Ve,"mounted")},Be)},ht=(oe,me,Re,Ve,Be)=>{if(Re&&V(oe,Re),Ve)for(let qe=0;qe<Ve.length;qe++)V(oe,Ve[qe]);if(Be){let qe=Be.subTree;if(me===qe){const rt=Be.vnode;ht(oe,rt,rt.scopeId,rt.slotScopeIds,Be.parent)}}},_t=(oe,me,Re,Ve,Be,qe,rt,ze,$e=0)=>{for(let Ue=$e;Ue<oe.length;Ue++){const Tt=oe[Ue]=ze?Go(oe[Ue]):zs(oe[Ue]);J(null,Tt,me,Re,Ve,Be,qe,rt,ze)}},lt=(oe,me,Re,Ve,Be,qe,rt)=>{const ze=me.el=oe.el;let{patchFlag:$e,dynamicChildren:Ue,dirs:Tt}=me;$e|=oe.patchFlag&16;const yt=oe.props||qi,wt=me.props||qi;let Lt;Re&&Ca(Re,!1),(Lt=wt.onVnodeBeforeUpdate)&&Ls(Lt,Re,me,oe),Tt&&Ia(me,oe,Re,"beforeUpdate"),Re&&Ca(Re,!0);const Vt=Be&&me.type!=="foreignObject";if(Ue?Et(oe.dynamicChildren,Ue,ze,Re,Ve,Vt,qe):rt||ti(oe,me,ze,null,Re,Ve,Vt,qe,!1),$e>0){if($e&16)It(ze,me,yt,wt,Re,Ve,Be);else if($e&2&&yt.class!==wt.class&&u(ze,"class",null,wt.class,Be),$e&4&&u(ze,"style",yt.style,wt.style,Be),$e&8){const Qt=me.dynamicProps;for(let we=0;we<Qt.length;we++){const je=Qt[we],ji=yt[je],Bi=wt[je];(Bi!==ji||je==="value")&&u(ze,je,ji,Bi,Be,oe.children,Re,Ve,Ji)}}$e&1&&oe.children!==me.children&&P(ze,me.children)}else!rt&&Ue==null&&It(ze,me,yt,wt,Re,Ve,Be);((Lt=wt.onVnodeUpdated)||Tt)&&Tr(()=>{Lt&&Ls(Lt,Re,me,oe),Tt&&Ia(me,oe,Re,"updated")},Ve)},Et=(oe,me,Re,Ve,Be,qe,rt)=>{for(let ze=0;ze<me.length;ze++){const $e=oe[ze],Ue=me[ze],Tt=$e.el&&($e.type===Kr||!Xc($e,Ue)||$e.shapeFlag&70)?M($e.el):Re;J($e,Ue,Tt,null,Ve,Be,qe,rt,!0)}},It=(oe,me,Re,Ve,Be,qe,rt)=>{if(Re!==Ve){if(Re!==qi)for(const ze in Re)!md(ze)&&!(ze in Ve)&&u(oe,ze,Re[ze],null,rt,me.children,Be,qe,Ji);for(const ze in Ve){if(md(ze))continue;const $e=Ve[ze],Ue=Re[ze];$e!==Ue&&ze!=="value"&&u(oe,ze,Ue,$e,rt,me.children,Be,qe,Ji)}"value"in Ve&&u(oe,"value",Re.value,Ve.value)}},Ot=(oe,me,Re,Ve,Be,qe,rt,ze,$e)=>{const Ue=me.el=oe?oe.el:l(""),Tt=me.anchor=oe?oe.anchor:l("");let{patchFlag:yt,dynamicChildren:wt,slotScopeIds:Lt}=me;Lt&&(ze=ze?ze.concat(Lt):Lt),oe==null?(r(Ue,Re,Ve),r(Tt,Re,Ve),_t(me.children,Re,Tt,Be,qe,rt,ze,$e)):yt>0&&yt&64&&wt&&oe.dynamicChildren?(Et(oe.dynamicChildren,wt,Re,Be,qe,rt,ze),(me.key!=null||Be&&me===Be.subTree)&&pb(oe,me,!0)):ti(oe,me,Re,Tt,Be,qe,rt,ze,$e)},zt=(oe,me,Re,Ve,Be,qe,rt,ze,$e)=>{me.slotScopeIds=ze,oe==null?me.shapeFlag&512?Be.ctx.activate(me,Re,Ve,rt,$e):Ut(me,Re,Ve,Be,qe,rt,$e):$i(oe,me,$e)},Ut=(oe,me,Re,Ve,Be,qe,rt)=>{const ze=oe.component=rS(oe,Ve,Be);if(ib(oe)&&(ze.ctx.renderer=$t),sS(ze),ze.asyncDep){if(Be&&Be.registerDep(ze,ft),!oe.el){const $e=ze.subTree=fr(Jo);pe(null,$e,me,Re)}return}ft(ze,oe,me,Re,Be,qe,rt)},$i=(oe,me,Re)=>{const Ve=me.component=oe.component;if(_2(oe,me,Re))if(Ve.asyncDep&&!Ve.asyncResolved){oi(Ve,me,Re);return}else Ve.next=me,h2(Ve.update),Ve.update();else me.el=oe.el,Ve.vnode=me},ft=(oe,me,Re,Ve,Be,qe,rt)=>{const ze=()=>{if(oe.isMounted){let{next:Tt,bu:yt,u:wt,parent:Lt,vnode:Vt}=oe,Qt=Tt,we;Ca(oe,!1),Tt?(Tt.el=Vt.el,oi(oe,Tt,rt)):Tt=Vt,yt&&Ap(yt),(we=Tt.props&&Tt.props.onVnodeBeforeUpdate)&&Ls(we,Lt,Tt,Vt),Ca(oe,!0);const je=Pp(oe),ji=oe.subTree;oe.subTree=je,J(ji,je,M(ji.el),xi(ji),oe,Be,qe),Tt.el=je.el,Qt===null&&y2(oe,je.el),wt&&Tr(wt,Be),(we=Tt.props&&Tt.props.onVnodeUpdated)&&Tr(()=>Ls(we,Lt,Tt,Vt),Be)}else{let Tt;const{el:yt,props:wt}=me,{bm:Lt,m:Vt,parent:Qt}=oe,we=cu(me);if(Ca(oe,!1),Lt&&Ap(Lt),!we&&(Tt=wt&&wt.onVnodeBeforeMount)&&Ls(Tt,Qt,me),Ca(oe,!0),yt&&jn){const je=()=>{oe.subTree=Pp(oe),jn(yt,oe.subTree,oe,Be,null)};we?me.type.__asyncLoader().then(()=>!oe.isUnmounted&&je()):je()}else{const je=oe.subTree=Pp(oe);J(null,je,Re,Ve,oe,Be,qe),me.el=je.el}if(Vt&&Tr(Vt,Be),!we&&(Tt=wt&&wt.onVnodeMounted)){const je=me;Tr(()=>Ls(Tt,Qt,je),Be)}(me.shapeFlag&256||Qt&&cu(Qt.vnode)&&Qt.vnode.shapeFlag&256)&&oe.a&&Tr(oe.a,Be),oe.isMounted=!0,me=Re=Ve=null}},$e=oe.effect=new fg(ze,()=>vg(Ue),oe.scope),Ue=oe.update=()=>$e.run();Ue.id=oe.uid,Ca(oe,!0),Ue()},oi=(oe,me,Re)=>{me.component=oe;const Ve=oe.vnode.props;oe.vnode=me,oe.next=null,V2(oe,me.props,Ve,Re),W2(oe,me.children,Re),Xl(),jy(),Yl()},ti=(oe,me,Re,Ve,Be,qe,rt,ze,$e=!1)=>{const Ue=oe&&oe.children,Tt=oe?oe.shapeFlag:0,yt=me.children,{patchFlag:wt,shapeFlag:Lt}=me;if(wt>0){if(wt&128){fn(Ue,yt,Re,Ve,Be,qe,rt,ze,$e);return}else if(wt&256){Vi(Ue,yt,Re,Ve,Be,qe,rt,ze,$e);return}}Lt&8?(Tt&16&&Ji(Ue,Be,qe),yt!==Ue&&P(Re,yt)):Tt&16?Lt&16?fn(Ue,yt,Re,Ve,Be,qe,rt,ze,$e):Ji(Ue,Be,qe,!0):(Tt&8&&P(Re,""),Lt&16&&_t(yt,Re,Ve,Be,qe,rt,ze,$e))},Vi=(oe,me,Re,Ve,Be,qe,rt,ze,$e)=>{oe=oe||Ll,me=me||Ll;const Ue=oe.length,Tt=me.length,yt=Math.min(Ue,Tt);let wt;for(wt=0;wt<yt;wt++){const Lt=me[wt]=$e?Go(me[wt]):zs(me[wt]);J(oe[wt],Lt,Re,null,Be,qe,rt,ze,$e)}Ue>Tt?Ji(oe,Be,qe,!0,!1,yt):_t(me,Re,Ve,Be,qe,rt,ze,$e,yt)},fn=(oe,me,Re,Ve,Be,qe,rt,ze,$e)=>{let Ue=0;const Tt=me.length;let yt=oe.length-1,wt=Tt-1;for(;Ue<=yt&&Ue<=wt;){const Lt=oe[Ue],Vt=me[Ue]=$e?Go(me[Ue]):zs(me[Ue]);if(Xc(Lt,Vt))J(Lt,Vt,Re,null,Be,qe,rt,ze,$e);else break;Ue++}for(;Ue<=yt&&Ue<=wt;){const Lt=oe[yt],Vt=me[wt]=$e?Go(me[wt]):zs(me[wt]);if(Xc(Lt,Vt))J(Lt,Vt,Re,null,Be,qe,rt,ze,$e);else break;yt--,wt--}if(Ue>yt){if(Ue<=wt){const Lt=wt+1,Vt=Lt<Tt?me[Lt].el:Ve;for(;Ue<=wt;)J(null,me[Ue]=$e?Go(me[Ue]):zs(me[Ue]),Re,Vt,Be,qe,rt,ze,$e),Ue++}}else if(Ue>wt)for(;Ue<=yt;)Fi(oe[Ue],Be,qe,!0),Ue++;else{const Lt=Ue,Vt=Ue,Qt=new Map;for(Ue=Vt;Ue<=wt;Ue++){const vi=me[Ue]=$e?Go(me[Ue]):zs(me[Ue]);vi.key!=null&&Qt.set(vi.key,Ue)}let we,je=0;const ji=wt-Vt+1;let Bi=!1,jt=0;const Qi=new Array(ji);for(Ue=0;Ue<ji;Ue++)Qi[Ue]=0;for(Ue=Lt;Ue<=yt;Ue++){const vi=oe[Ue];if(je>=ji){Fi(vi,Be,qe,!0);continue}let Zi;if(vi.key!=null)Zi=Qt.get(vi.key);else for(we=Vt;we<=wt;we++)if(Qi[we-Vt]===0&&Xc(vi,me[we])){Zi=we;break}Zi===void 0?Fi(vi,Be,qe,!0):(Qi[Zi-Vt]=Ue+1,Zi>=jt?jt=Zi:Bi=!0,J(vi,me[Zi],Re,null,Be,qe,rt,ze,$e),je++)}const pn=Bi?X2(Qi):Ll;for(we=pn.length-1,Ue=ji-1;Ue>=0;Ue--){const vi=Vt+Ue,Zi=me[vi],Xe=vi+1<Tt?me[vi+1].el:Ve;Qi[Ue]===0?J(null,Zi,Re,Xe,Be,qe,rt,ze,$e):Bi&&(we<0||Ue!==pn[we]?wn(Zi,Re,Xe,2):we--)}}},wn=(oe,me,Re,Ve,Be=null)=>{const{el:qe,type:rt,transition:ze,children:$e,shapeFlag:Ue}=oe;if(Ue&6){wn(oe.component.subTree,me,Re,Ve);return}if(Ue&128){oe.suspense.move(me,Re,Ve);return}if(Ue&64){rt.move(oe,me,Re,$t);return}if(rt===Kr){r(qe,me,Re);for(let yt=0;yt<$e.length;yt++)wn($e[yt],me,Re,Ve);r(oe.anchor,me,Re);return}if(rt===Cp){he(oe,me,Re);return}if(Ve!==2&&Ue&1&&ze)if(Ve===0)ze.beforeEnter(qe),r(qe,me,Re),Tr(()=>ze.enter(qe),Be);else{const{leave:yt,delayLeave:wt,afterLeave:Lt}=ze,Vt=()=>r(qe,me,Re),Qt=()=>{yt(qe,()=>{Vt(),Lt&&Lt()})};wt?wt(qe,Vt,Qt):Qt()}else r(qe,me,Re)},Fi=(oe,me,Re,Ve=!1,Be=!1)=>{const{type:qe,props:rt,ref:ze,children:$e,dynamicChildren:Ue,shapeFlag:Tt,patchFlag:yt,dirs:wt}=oe;if(ze!=null&&Em(ze,null,Re,oe,!0),Tt&256){me.ctx.deactivate(oe);return}const Lt=Tt&1&&wt,Vt=!cu(oe);let Qt;if(Vt&&(Qt=rt&&rt.onVnodeBeforeUnmount)&&Ls(Qt,me,oe),Tt&6)Vn(oe.component,Re,Ve);else{if(Tt&128){oe.suspense.unmount(Re,Ve);return}Lt&&Ia(oe,null,me,"beforeUnmount"),Tt&64?oe.type.remove(oe,me,Re,Be,$t,Ve):Ue&&(qe!==Kr||yt>0&&yt&64)?Ji(Ue,me,Re,!1,!0):(qe===Kr&&yt&384||!Be&&Tt&16)&&Ji($e,me,Re),Ve&&Sr(oe)}(Vt&&(Qt=rt&&rt.onVnodeUnmounted)||Lt)&&Tr(()=>{Qt&&Ls(Qt,me,oe),Lt&&Ia(oe,null,me,"unmounted")},Re)},Sr=oe=>{const{type:me,el:Re,anchor:Ve,transition:Be}=oe;if(me===Kr){gr(Re,Ve);return}if(me===Cp){Ee(oe);return}const qe=()=>{a(Re),Be&&!Be.persisted&&Be.afterLeave&&Be.afterLeave()};if(oe.shapeFlag&1&&Be&&!Be.persisted){const{leave:rt,delayLeave:ze}=Be,$e=()=>rt(Re,qe);ze?ze(oe.el,qe,$e):$e()}else qe()},gr=(oe,me)=>{let Re;for(;oe!==me;)Re=C(oe),a(oe),oe=Re;a(me)},Vn=(oe,me,Re)=>{const{bum:Ve,scope:Be,update:qe,subTree:rt,um:ze}=oe;Ve&&Ap(Ve),Be.stop(),qe&&(qe.active=!1,Fi(rt,oe,me,Re)),ze&&Tr(ze,me),Tr(()=>{oe.isUnmounted=!0},me),me&&me.pendingBranch&&!me.isUnmounted&&oe.asyncDep&&!oe.asyncResolved&&oe.suspenseId===me.pendingId&&(me.deps--,me.deps===0&&me.resolve())},Ji=(oe,me,Re,Ve=!1,Be=!1,qe=0)=>{for(let rt=qe;rt<oe.length;rt++)Fi(oe[rt],me,Re,Ve,Be)},xi=oe=>oe.shapeFlag&6?xi(oe.component.subTree):oe.shapeFlag&128?oe.suspense.next():C(oe.anchor||oe.el),on=(oe,me,Re)=>{oe==null?me._vnode&&Fi(me._vnode,null,null,!0):J(me._vnode||null,oe,me,null,null,null,Re),jy(),Zv(),me._vnode=oe},$t={p:J,um:Fi,m:wn,r:Sr,mt:Ut,mc:_t,pc:ti,pbc:Et,n:xi,o:i};let Ci,jn;return e&&([Ci,jn]=e($t)),{render:on,hydrate:Ci,createApp:q2(on,Ci)}}function Ca({effect:i,update:e},t){i.allowRecurse=e.allowRecurse=t}function pb(i,e,t=!1){const r=i.children,a=e.children;if(ri(r)&&ri(a))for(let u=0;u<r.length;u++){const f=r[u];let l=a[u];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=a[u]=Go(a[u]),l.el=f.el),t||pb(f,l)),l.type===uf&&(l.el=f.el)}}function X2(i){const e=i.slice(),t=[0];let r,a,u,f,l;const x=i.length;for(r=0;r<x;r++){const w=i[r];if(w!==0){if(a=t[t.length-1],i[a]<w){e[r]=a,t.push(r);continue}for(u=0,f=t.length-1;u<f;)l=u+f>>1,i[t[l]]<w?u=l+1:f=l;w<i[t[u]]&&(u>0&&(e[r]=t[u-1]),t[u]=r)}}for(u=t.length,f=t[u-1];u-- >0;)t[u]=f,f=e[f];return t}const Y2=i=>i.__isTeleport,Kr=Symbol(void 0),uf=Symbol(void 0),Jo=Symbol(void 0),Cp=Symbol(void 0),hu=[];let hs=null;function Fs(i=!1){hu.push(hs=i?null:[])}function K2(){hu.pop(),hs=hu[hu.length-1]||null}let bu=1;function Jy(i){bu+=i}function mb(i){return i.dynamicChildren=bu>0?hs||Ll:null,K2(),bu>0&&hs&&hs.push(i),i}function wu(i,e,t,r,a,u){return mb(_b(i,e,t,r,a,u,!0))}function du(i,e,t,r,a){return mb(fr(i,e,t,r,a,!0))}function kd(i){return i?i.__v_isVNode===!0:!1}function Xc(i,e){return i.type===e.type&&i.key===e.key}const hf="__vInternal",gb=({key:i})=>i??null,gd=({ref:i,ref_key:e,ref_for:t})=>i!=null?Bn(i)||Jn(i)||ni(i)?{i:dr,r:i,k:e,f:!!t}:i:null;function _b(i,e=null,t=null,r=0,a=null,u=i===Kr?0:1,f=!1,l=!1){const x={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&gb(e),ref:e&&gd(e),scopeId:Kv,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:u,patchFlag:r,dynamicProps:a,dynamicChildren:null,appContext:null,ctx:dr};return l?(Eg(x,t),u&128&&i.normalize(x)):t&&(x.shapeFlag|=Bn(t)?8:16),bu>0&&!f&&hs&&(x.patchFlag>0||u&6)&&x.patchFlag!==32&&hs.push(x),x}const fr=J2;function J2(i,e=null,t=null,r=0,a=null,u=!1){if((!i||i===R2)&&(i=Jo),kd(i)){const l=Bl(i,e,!0);return t&&Eg(l,t),bu>0&&!u&&hs&&(l.shapeFlag&6?hs[hs.indexOf(i)]=l:hs.push(l)),l.patchFlag|=-2,l}if(uS(i)&&(i=i.__vccOpts),e){e=Q2(e);let{class:l,style:x}=e;l&&!Bn(l)&&(e.class=ag(l)),dn(x)&&(Nv(x)&&!ri(x)&&(x=pr({},x)),e.style=og(x))}const f=Bn(i)?1:x2(i)?128:Y2(i)?64:dn(i)?4:ni(i)?2:0;return _b(i,e,t,r,a,f,u,!0)}function Q2(i){return i?Nv(i)||hf in i?pr({},i):i:null}function Bl(i,e,t=!1){const{props:r,ref:a,patchFlag:u,children:f}=i,l=e?tS(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:i.type,props:l,key:l&&gb(l),ref:e&&e.ref?t&&a?ri(a)?a.concat(gd(e)):[a,gd(e)]:gd(e):a,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:f,target:i.target,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==Kr?u===-1?16:u|16:u,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:i.transition,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Bl(i.ssContent),ssFallback:i.ssFallback&&Bl(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce}}function eS(i=" ",e=0){return fr(uf,null,i,e)}function Kh(i="",e=!1){return e?(Fs(),du(Jo,null,i)):fr(Jo,null,i)}function zs(i){return i==null||typeof i=="boolean"?fr(Jo):ri(i)?fr(Kr,null,i.slice()):typeof i=="object"?Go(i):fr(uf,null,String(i))}function Go(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Bl(i)}function Eg(i,e){let t=0;const{shapeFlag:r}=i;if(e==null)e=null;else if(ri(e))t=16;else if(typeof e=="object")if(r&65){const a=e.default;a&&(a._c&&(a._d=!1),Eg(i,a()),a._c&&(a._d=!0));return}else{t=32;const a=e._;!a&&!(hf in e)?e._ctx=dr:a===3&&dr&&(dr.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else ni(e)?(e={default:e,_ctx:dr},t=32):(e=String(e),r&64?(t=16,e=[eS(e)]):t=8);i.children=e,i.shapeFlag|=t}function tS(...i){const e={};for(let t=0;t<i.length;t++){const r=i[t];for(const a in r)if(a==="class")e.class!==r.class&&(e.class=ag([e.class,r.class]));else if(a==="style")e.style=og([e.style,r.style]);else if(Qd(a)){const u=e[a],f=r[a];f&&u!==f&&!(ri(u)&&u.includes(f))&&(e[a]=u?[].concat(u,f):f)}else a!==""&&(e[a]=r[a])}return e}function Ls(i,e,t,r=null){ms(i,e,7,[t,r])}const iS=fb();let nS=0;function rS(i,e,t){const r=i.type,a=(e?e.appContext:i.appContext)||iS,u={uid:nS++,vnode:i,type:r,parent:e,appContext:a,root:null,next:null,subTree:null,effect:null,update:null,scope:new AE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(a.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:cb(r,a),emitsOptions:Yv(r,a),emit:null,emitted:null,propsDefaults:qi,inheritAttrs:r.inheritAttrs,ctx:qi,data:qi,props:qi,attrs:qi,slots:qi,refs:qi,setupState:qi,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return u.ctx={_:u},u.root=e?e.root:u,u.emit=p2.bind(null,u),i.ce&&i.ce(u),u}let bn=null;const Nl=i=>{bn=i,i.scope.on()},Na=()=>{bn&&bn.scope.off(),bn=null};function yb(i){return i.vnode.shapeFlag&4}let Tu=!1;function sS(i,e=!1){Tu=e;const{props:t,children:r}=i.vnode,a=yb(i);U2(i,t,a,e),G2(i,r);const u=a?oS(i,e):void 0;return Tu=!1,u}function oS(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=Uv(new Proxy(i.ctx,D2));const{setup:r}=t;if(r){const a=i.setupContext=r.length>1?lS(i):null;Nl(i),Xl();const u=Zo(r,i,0,[i.props,a]);if(Yl(),Na(),Pv(u)){if(u.then(Na,Na),e)return u.then(f=>{Qy(i,f,e)}).catch(f=>{of(f,i,0)});i.asyncDep=u}else Qy(i,u,e)}else xb(i,e)}function Qy(i,e,t){ni(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:dn(e)&&(i.setupState=Wv(e)),xb(i,t)}let e0;function xb(i,e,t){const r=i.type;if(!i.render){if(!e&&e0&&!r.render){const a=r.template||wg(i).template;if(a){const{isCustomElement:u,compilerOptions:f}=i.appContext.config,{delimiters:l,compilerOptions:x}=r,w=pr(pr({isCustomElement:u,delimiters:l},f),x);r.render=e0(a,w)}}i.render=r.render||ps}Nl(i),Xl(),z2(i),Yl(),Na()}function aS(i){return new Proxy(i.attrs,{get(e,t){return Er(i,"get","$attrs"),e[t]}})}function lS(i){const e=r=>{i.exposed=r||{}};let t;return{get attrs(){return t||(t=aS(i))},slots:i.slots,emit:i.emit,expose:e}}function Sg(i){if(i.exposed)return i.exposeProxy||(i.exposeProxy=new Proxy(Wv(Uv(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in uu)return uu[t](i)},has(e,t){return t in e||t in uu}}))}function cS(i,e=!0){return ni(i)?i.displayName||i.name:i.name||e&&i.__name}function uS(i){return ni(i)&&"__vccOpts"in i}const vb=(i,e)=>a2(i,e,Tu);function hS(i,e,t){const r=arguments.length;return r===2?dn(e)&&!ri(e)?kd(e)?fr(i,null,[e]):fr(i,e):fr(i,null,e):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&kd(t)&&(t=[t]),fr(i,e,t))}const dS=Symbol(""),fS=()=>lu(dS),pS="3.2.47",mS="http://www.w3.org/2000/svg",Oa=typeof document<"u"?document:null,t0=Oa&&Oa.createElement("template"),gS={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,r)=>{const a=e?Oa.createElementNS(mS,i):Oa.createElement(i,t?{is:t}:void 0);return i==="select"&&r&&r.multiple!=null&&a.setAttribute("multiple",r.multiple),a},createText:i=>Oa.createTextNode(i),createComment:i=>Oa.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>Oa.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,r,a,u){const f=t?t.previousSibling:e.lastChild;if(a&&(a===u||a.nextSibling))for(;e.insertBefore(a.cloneNode(!0),t),!(a===u||!(a=a.nextSibling)););else{t0.innerHTML=r?`<svg>${i}</svg>`:i;const l=t0.content;if(r){const x=l.firstChild;for(;x.firstChild;)l.appendChild(x.firstChild);l.removeChild(x)}e.insertBefore(l,t)}return[f?f.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function _S(i,e,t){const r=i._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}function yS(i,e,t){const r=i.style,a=Bn(t);if(t&&!a){if(e&&!Bn(e))for(const u in e)t[u]==null&&Sm(r,u,"");for(const u in t)Sm(r,u,t[u])}else{const u=r.display;a?e!==t&&(r.cssText=t):e&&i.removeAttribute("style"),"_vod"in i&&(r.display=u)}}const i0=/\s*!important$/;function Sm(i,e,t){if(ri(t))t.forEach(r=>Sm(i,e,r));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const r=xS(i,e);i0.test(t)?i.setProperty(Zl(r),t.replace(i0,""),"important"):i[r]=t}}const n0=["Webkit","Moz","ms"],Mp={};function xS(i,e){const t=Mp[e];if(t)return t;let r=Vs(e);if(r!=="filter"&&r in i)return Mp[e]=r;r=nf(r);for(let a=0;a<n0.length;a++){const u=n0[a]+r;if(u in i)return Mp[e]=u}return e}const r0="http://www.w3.org/1999/xlink";function vS(i,e,t,r,a){if(r&&e.startsWith("xlink:"))t==null?i.removeAttributeNS(r0,e.slice(6,e.length)):i.setAttributeNS(r0,e,t);else{const u=pE(e);t==null||u&&!Av(t)?i.removeAttribute(e):i.setAttribute(e,u?"":t)}}function bS(i,e,t,r,a,u,f){if(e==="innerHTML"||e==="textContent"){r&&f(r,a,u),i[e]=t??"";return}if(e==="value"&&i.tagName!=="PROGRESS"&&!i.tagName.includes("-")){i._value=t;const x=t??"";(i.value!==x||i.tagName==="OPTION")&&(i.value=x),t==null&&i.removeAttribute(e);return}let l=!1;if(t===""||t==null){const x=typeof i[e];x==="boolean"?t=Av(t):t==null&&x==="string"?(t="",l=!0):x==="number"&&(t=0,l=!0)}try{i[e]=t}catch{}l&&i.removeAttribute(e)}function wS(i,e,t,r){i.addEventListener(e,t,r)}function TS(i,e,t,r){i.removeEventListener(e,t,r)}function ES(i,e,t,r,a=null){const u=i._vei||(i._vei={}),f=u[e];if(r&&f)f.value=r;else{const[l,x]=SS(e);if(r){const w=u[e]=IS(r,a);wS(i,l,w,x)}else f&&(TS(i,l,f,x),u[e]=void 0)}}const s0=/(?:Once|Passive|Capture)$/;function SS(i){let e;if(s0.test(i)){e={};let r;for(;r=i.match(s0);)i=i.slice(0,i.length-r[0].length),e[r[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):Zl(i.slice(2)),e]}let Lp=0;const AS=Promise.resolve(),PS=()=>Lp||(AS.then(()=>Lp=0),Lp=Date.now());function IS(i,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ms(CS(r,t.value),e,5,[r])};return t.value=i,t.attached=PS(),t}function CS(i,e){if(ri(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(r=>a=>!a._stopped&&r&&r(a))}else return e}const o0=/^on[a-z]/,MS=(i,e,t,r,a=!1,u,f,l,x)=>{e==="class"?_S(i,r,a):e==="style"?yS(i,t,r):Qd(e)?lg(e)||ES(i,e,t,r,f):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):LS(i,e,r,a))?bS(i,e,r,u,f,l,x):(e==="true-value"?i._trueValue=r:e==="false-value"&&(i._falseValue=r),vS(i,e,r,a))};function LS(i,e,t,r){return r?!!(e==="innerHTML"||e==="textContent"||e in i&&o0.test(e)&&ni(t)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA"||o0.test(e)&&Bn(t)?!1:e in i}const RS=pr({patchProp:MS},gS);let a0;function kS(){return a0||(a0=$2(RS))}const DS=(...i)=>{const e=kS().createApp(...i),{mount:t}=e;return e.mount=r=>{const a=zS(r);if(!a)return;const u=e._component;!ni(u)&&!u.render&&!u.template&&(u.template=a.innerHTML),a.innerHTML="";const f=t(a,!1,a instanceof SVGElement);return a instanceof Element&&(a.removeAttribute("v-cloak"),a.setAttribute("data-v-app","")),f},e};function zS(i){return Bn(i)?document.querySelector(i):i}var OS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_s={},FS={get exports(){return _s},set exports(i){_s=i}};(function(i,e){(function(t,r){i.exports=r()})(OS,function(){var t,r,a;function u(l,x){if(!t)t=x;else if(!r)r=x;else{var w="var sharedChunk = {}; ("+t+")(sharedChunk); ("+r+")(sharedChunk);",P={};t(P),a=x(P),typeof window<"u"&&(a.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],function(l){var x=w;function w(o,n,c,d){this.cx=3*o,this.bx=3*(c-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=n,this.p2x=c,this.p2y=d}function P(o,n,c,d){const g=new x(o,n,c,d);return function(y){return g.solve(y)}}w.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,n){if(n===void 0&&(n=1e-6),o<0)return 0;if(o>1)return 1;for(var c=o,d=0;d<8;d++){var g=this.sampleCurveX(c)-o;if(Math.abs(g)<n)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=g/y}var b=0,E=1;for(c=o,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-o)<n));d++)o>g?b=c:E=c,c=.5*(E-b)+b;return c},solve:function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))}};const M=P(.25,.1,.25,1);function C(o,n,c){return Math.min(c,Math.max(n,o))}function V(o,n,c){const d=c-n,g=((o-n)%d+d)%d+n;return g===n?c:g}function Y(o,...n){for(const c of n)for(const d in c)o[d]=c[d];return o}let J=1;function ce(o,n){o.forEach(c=>{n[c]&&(n[c]=n[c].bind(n))})}function pe(o,n,c){const d={};for(const g in o)d[g]=n.call(c||this,o[g],g,o);return d}function ve(o,n,c){const d={};for(const g in o)n.call(c||this,o[g],g,o)&&(d[g]=o[g]);return d}function he(o){return Array.isArray(o)?o.map(he):typeof o=="object"&&o?pe(o,he):o}const Ee={};function Fe(o){Ee[o]||(typeof console<"u"&&console.warn(o),Ee[o]=!0)}function Ze(o,n,c){return(c.y-o.y)*(n.x-o.x)>(n.y-o.y)*(c.x-o.x)}function ht(o){let n=0;for(let c,d,g=0,y=o.length,b=y-1;g<y;b=g++)c=o[g],d=o[b],n+=(d.x-c.x)*(c.y+d.y);return n}function _t(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function lt(o){const n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,y)=>{const b=g||y;return n[d]=!b||b.toLowerCase(),""}),n["max-age"]){const c=parseInt(n["max-age"],10);isNaN(c)?delete n["max-age"]:n["max-age"]=c}return n}let Et,It,Ot=null;function zt(o){if(Ot==null){const n=o.navigator?o.navigator.userAgent:null;Ot=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Ot}function Ut(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const $i={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(o){const n=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(o,n=0){const c=window.document.createElement("canvas"),d=c.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return c.width=o.width,c.height=o.height,d.drawImage(o,0,0,o.width,o.height),d.getImageData(-n,-n,o.width+2*n,o.height+2*n)},resolveURL:o=>(Et||(Et=document.createElement("a")),Et.href=o,Et.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(It==null&&(It=matchMedia("(prefers-reduced-motion: reduce)")),It.matches)}};var ft=oi;function oi(o,n){this.x=o,this.y=n}oi.prototype={clone:function(){return new oi(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,n){return this.clone()._rotateAround(o,n)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var n=o.x-this.x,c=o.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,n){return Math.atan2(this.x*n-this.y*o,this.x*o+this.y*n)},_matMult:function(o){var n=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=n,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var n=Math.cos(o),c=Math.sin(o),d=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=d,this},_rotateAround:function(o,n){var c=Math.cos(o),d=Math.sin(o),g=n.y+d*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-d*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oi.convert=function(o){return o instanceof oi?o:Array.isArray(o)?new oi(o[0],o[1]):o};const ti={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Vi="mapbox-tiles";let fn,wn,Fi=500,Sr=50;function gr(){typeof caches>"u"||fn||(fn=caches.open(Vi))}let Vn=1/0;const Ji={supported:!1,testSupport:function(o){!$t&&on&&(Ci?jn(o):xi=o)}};let xi,on,$t=!1,Ci=!1;function jn(o){const n=o.createTexture();o.bindTexture(o.TEXTURE_2D,n);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,on),o.isContextLost())return;Ji.supported=!0}catch{}o.deleteTexture(n),$t=!0}typeof document<"u"&&(on=document.createElement("img"),on.onload=function(){xi&&jn(xi),xi=null,Ci=!0},on.onerror=function(){$t=!0,xi=null},on.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const oe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(oe);class me extends Error{constructor(n,c,d,g){super(`AJAXError: ${c} (${n}): ${d}`),this.status=n,this.statusText=c,this.url=d,this.body=g}}const Re=_t()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Ve(o,n){const c=new AbortController,d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Re(),signal:c.signal});let g=!1,y=!1;return o.type==="json"&&d.headers.set("Accept","application/json"),((b,E,S)=>{if(y)return;const L=Date.now();fetch(d).then(D=>D.ok?((O,U,W)=>{(o.type==="arrayBuffer"?O.arrayBuffer():o.type==="json"?O.json():O.text()).then(H=>{y||(U&&W&&function(ne,ie,ye){if(gr(),!fn)return;const Ae={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Te,Oe)=>Ae.headers.set(Oe,Te));const _e=lt(ie.headers.get("Cache-Control")||"");_e["no-store"]||(_e["max-age"]&&Ae.headers.set("Expires",new Date(ye+1e3*_e["max-age"]).toUTCString()),new Date(Ae.headers.get("Expires")).getTime()-ye<42e4||function(Te,Oe){if(wn===void 0)try{new Response(new ReadableStream),wn=!0}catch{wn=!1}wn?Oe(Te.body):Te.blob().then(Oe)}(ie,Te=>{const Oe=new Response(Te,Ae);gr(),fn&&fn.then(De=>De.put(function(at){const mt=at.indexOf("?");return mt<0?at:at.slice(0,mt)}(ne.url),Oe)).catch(De=>Fe(De.message))}))}(d,U,W),g=!0,n(null,H,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(H=>{y||n(new Error(H.message))})})(D,null,L):D.blob().then(O=>n(new me(D.status,D.statusText,o.url,O)))).catch(D=>{D.code!==20&&n(new Error(D.message))})})(),{cancel:()=>{y=!0,g||c.abort()}}}const Be=function(o,n){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){if(_t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n);if(!_t()){const d=o.url.substring(0,o.url.indexOf("://"));return(ti.REGISTERED_PROTOCOLS[d]||Ve)(o,n)}}if(!(/^file:/.test(c=o.url)||/^file:/.test(Re())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Ve(o,n);if(_t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n,void 0,!0)}var c;return function(d,g){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const b in d.headers)y.setRequestHeader(b,d.headers[b]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let b=y.response;if(d.type==="json")try{b=JSON.parse(y.response)}catch(E){return g(E)}g(null,b,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const b=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new me(y.status,y.statusText,d.url,b))}},y.send(d.body),{cancel:()=>y.abort()}}(o,n)},qe=function(o,n){return Be(Y(o,{type:"arrayBuffer"}),n)};function rt(o){const n=window.document.createElement("a");return n.href=o,n.protocol===window.document.location.protocol&&n.host===window.document.location.host}const ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let $e,Ue;$e=[],Ue=0;const Tt=function(o,n){if(Ji.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Ue>=ti.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:o,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return $e.push(y),y}Ue++;let c=!1;const d=()=>{if(!c)for(c=!0,Ue--;$e.length&&Ue<ti.MAX_PARALLEL_IMAGE_REQUESTS;){const y=$e.shift(),{requestParameters:b,callback:E,cancelled:S}=y;S||(y.cancel=Tt(b,E).cancel)}},g=qe(o,(y,b,E,S)=>{d(),y?n(y):b&&function(L,D){typeof createImageBitmap=="function"?function(O,U){const W=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(W).then(H=>{U(null,H)}).catch(H=>{U(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(L,D):function(O,U){const W=new Image;W.onload=()=>{U(null,W),URL.revokeObjectURL(W.src),W.onload=null,window.requestAnimationFrame(()=>{W.src=ze})},W.onerror=()=>U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array(O)],{type:"image/png"});W.src=O.byteLength?URL.createObjectURL(H):ze}(L,D)}(b,(L,D)=>{L!=null?n(L):D!=null&&n(null,D,{cacheControl:E,expires:S})})});return{cancel:()=>{g.cancel(),d()}}};function yt(o,n,c){c[o]&&c[o].indexOf(n)!==-1||(c[o]=c[o]||[],c[o].push(n))}function wt(o,n,c){if(c&&c[o]){const d=c[o].indexOf(n);d!==-1&&c[o].splice(d,1)}}class Lt{constructor(n,c={}){Y(this,c),this.type=n}}class Vt extends Lt{constructor(n,c={}){super("error",Y({error:n},c))}}class Qt{on(n,c){return this._listeners=this._listeners||{},yt(n,c,this._listeners),this}off(n,c){return wt(n,c,this._listeners),wt(n,c,this._oneTimeListeners),this}once(n,c){return this._oneTimeListeners=this._oneTimeListeners||{},yt(n,c,this._oneTimeListeners),this}fire(n,c){typeof n=="string"&&(n=new Lt(n,c||{}));const d=n.type;if(this.listens(d)){n.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const E of g)E.call(this,n);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const E of y)wt(d,E,this._oneTimeListeners),E.call(this,n);const b=this._eventedParent;b&&(Y(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(n))}else n instanceof Vt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,c){return this._eventedParent=n,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class je{constructor(n,c,d,g){this.message=(n?`${n}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function ji(o){const n=o.value;return n?[new je(o.key,n,"constants have been deprecated as of v8")]:[]}function Bi(o,...n){for(const c of n)for(const d in c)o[d]=c[d];return o}function jt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Qi(o){if(Array.isArray(o))return o.map(Qi);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const n={};for(const c in o)n[c]=Qi(o[c]);return n}return jt(o)}class pn extends Error{constructor(n,c){super(c),this.message=c,this.key=n}}class vi{constructor(n,c=[]){this.parent=n,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(n){return new vi(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Zi={kind:"null"},Xe={kind:"number"},Bt={kind:"string"},Ft={kind:"boolean"},an={kind:"color"},Ar={kind:"object"},Dt={kind:"value"},er={kind:"collator"},en={kind:"formatted"},ys={kind:"padding"},Gi={kind:"resolvedImage"};function mn(o,n){return{kind:"array",itemType:o,N:n}}function di(o){if(o.kind==="array"){const n=di(o.itemType);return typeof o.N=="number"?`array<${n}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${n}>`}return o.kind}const xs=[Zi,Xe,Bt,Ft,an,en,Ar,mn(Dt),ys,Gi];function _r(o,n){if(n.kind==="error")return null;if(o.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!_r(o.itemType,n.itemType))&&(typeof o.N!="number"||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if(o.kind==="value"){for(const c of xs)if(!_r(c,n))return null}}return`Expected ${di(o)} but found ${di(n)} instead.`}function yr(o,n){return n.some(c=>c.kind===o.kind)}function es(o,n){return n.some(c=>c==="null"?o===null:c==="array"?Array.isArray(o):c==="object"?o&&!Array.isArray(o)&&typeof o=="object":c===typeof o)}var vs,Gr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function X(o){return(o=Math.round(o))<0?0:o>255?255:o}function k(o){return X(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function F(o){return(n=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:n>1?1:n;var n}function q(o,n,c){return c<0?c+=1:c>1&&(c-=1),6*c<1?o+(n-o)*c*6:2*c<1?n:3*c<2?o+(n-o)*(2/3-c)*6:o}try{vs={}.parseCSSColor=function(o){var n,c=o.replace(/ /g,"").toLowerCase();if(c in Gr)return Gr[c].slice();if(c[0]==="#")return c.length===4?(n=parseInt(c.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:c.length===7&&(n=parseInt(c.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var d=c.indexOf("("),g=c.indexOf(")");if(d!==-1&&g+1===c.length){var y=c.substr(0,d),b=c.substr(d+1,g-(d+1)).split(","),E=1;switch(y){case"rgba":if(b.length!==4)return null;E=F(b.pop());case"rgb":return b.length!==3?null:[k(b[0]),k(b[1]),k(b[2]),E];case"hsla":if(b.length!==4)return null;E=F(b.pop());case"hsl":if(b.length!==3)return null;var S=(parseFloat(b[0])%360+360)%360/360,L=F(b[1]),D=F(b[2]),O=D<=.5?D*(L+1):D+L-D*L,U=2*D-O;return[X(255*q(U,O,S+1/3)),X(255*q(U,O,S)),X(255*q(U,O,S-1/3)),E];default:return null}}return null}}catch{}class ${constructor(n,c,d,g=1){this.r=n,this.g=c,this.b=d,this.a=g}static parse(n){if(!n)return;if(n instanceof $)return n;if(typeof n!="string")return;const c=vs(n);return c?new $(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[n,c,d,g]=this.toArray();return`rgba(${Math.round(n)},${Math.round(c)},${Math.round(d)},${g})`}toArray(){const{r:n,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*n/g,255*c/g,255*d/g,g]}}$.black=new $(0,0,0,1),$.white=new $(1,1,1,1),$.transparent=new $(0,0,0,0),$.red=new $(1,0,0,1);class se{constructor(n,c,d){this.sensitivity=n?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,c){return this.collator.compare(n,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(n,c,d,g,y){this.text=n,this.image=c,this.scale=d,this.fontStack=g,this.textColor=y}}class le{constructor(n){this.sections=n}static fromString(n){return new le([new de(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof le?n:le.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class re{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof re)return n;if(typeof n=="number")return new re([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const c of n)if(typeof c!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new re(n)}}toString(){return JSON.stringify(this.values)}}class fe{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new fe({name:n,available:!1}):null}}function Ce(o,n,c,d){return typeof o=="number"&&o>=0&&o<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[o,n,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[o,n,c,d]:[o,n,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ne(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof $||o instanceof se||o instanceof le||o instanceof re||o instanceof fe)return!0;if(Array.isArray(o)){for(const n of o)if(!Ne(n))return!1;return!0}if(typeof o=="object"){for(const n in o)if(!Ne(o[n]))return!1;return!0}return!1}function Ie(o){if(o===null)return Zi;if(typeof o=="string")return Bt;if(typeof o=="boolean")return Ft;if(typeof o=="number")return Xe;if(o instanceof $)return an;if(o instanceof se)return er;if(o instanceof le)return en;if(o instanceof re)return ys;if(o instanceof fe)return Gi;if(Array.isArray(o)){const n=o.length;let c;for(const d of o){const g=Ie(d);if(c){if(c===g)continue;c=Dt;break}c=g}return mn(c||Dt,n)}return Ar}function ct(o){const n=typeof o;return o===null?"":n==="string"||n==="number"||n==="boolean"?String(o):o instanceof $||o instanceof le||o instanceof re||o instanceof fe?o.toString():JSON.stringify(o)}class pt{constructor(n,c){this.type=n,this.value=c}static parse(n,c){if(n.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ne(n[1]))return c.error("invalid value");const d=n[1];let g=Ie(d);const y=c.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new pt(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class et{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const St={string:Bt,number:Xe,boolean:Ft,object:Ar};class vt{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");let d,g=1;const y=n[0];if(y==="array"){let E,S;if(n.length>2){const L=n[1];if(typeof L!="string"||!(L in St)||L==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);E=St[L],g++}else E=Dt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return c.error('The length argument to "array" must be a positive integer literal',2);S=n[2],g++}d=mn(E,S)}else{if(!St[y])throw new Error(`Types doesn't contain name = ${y}`);d=St[y]}const b=[];for(;g<n.length;g++){const E=c.parse(n[g],g,Dt);if(!E)return null;b.push(E)}return new vt(d,b)}evaluate(n){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(n);if(!_r(this.type,Ie(d)))return d;if(c===this.args.length-1)throw new et(`Expected value to be of type ${di(this.type)}, but found ${di(Ie(d))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Gt={"to-boolean":Ft,"to-color":an,"to-number":Xe,"to-string":Bt};class Ct{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const d=n[0];if(!Gt[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&n.length!==2)return c.error("Expected one argument.");const g=Gt[d],y=[];for(let b=1;b<n.length;b++){const E=c.parse(n[b],b,Dt);if(!E)return null;y.push(E)}return new Ct(g,y)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let c,d;for(const g of this.args){if(c=g.evaluate(n),d=null,c instanceof $)return c;if(typeof c=="string"){const y=n.parseColor(c);if(y)return y}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Ce(c[0],c[1],c[2],c[3]),!d))return new $(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new et(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}if(this.type.kind==="padding"){let c;for(const d of this.args){c=d.evaluate(n);const g=re.parse(c);if(g)return g}throw new et(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}if(this.type.kind==="number"){let c=null;for(const d of this.args){if(c=d.evaluate(n),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new et(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?le.fromString(ct(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?fe.fromString(ct(this.args[0].evaluate(n))):ct(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const kt=["Unknown","Point","LineString","Polygon"];class Zt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let c=this._parseColorCache[n];return c||(c=this._parseColorCache[n]=$.parse(n)),c}}class Kt{constructor(n,c,d,g){this.name=n,this.type=c,this._evaluate=d,this.args=g}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,c){const d=n[0],g=Kt.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=b.filter(([L])=>!Array.isArray(L)||L.length===n.length-1);let S=null;for(const[L,D]of E){S=new We(c.registry,c.path,null,c.scope);const O=[];let U=!1;for(let W=1;W<n.length;W++){const H=n[W],ne=Array.isArray(L)?L[W-1]:L.type,ie=S.parse(H,1+O.length,ne);if(!ie){U=!0;break}O.push(ie)}if(!U)if(Array.isArray(L)&&L.length!==O.length)S.error(`Expected ${L.length} arguments, but found ${O.length} instead.`);else{for(let W=0;W<O.length;W++){const H=Array.isArray(L)?L[W]:L.type,ne=O[W];S.concat(W+1).checkSubtype(H,ne.type)}if(S.errors.length===0)return new Kt(d,y,D,O)}}if(E.length===1)c.errors.push(...S.errors);else{const L=(E.length?E:b).map(([O])=>{return U=O,Array.isArray(U)?`(${U.map(di).join(", ")})`:`(${di(U.type)}...)`;var U}).join(" | "),D=[];for(let O=1;O<n.length;O++){const U=c.parse(n[O],1+D.length);if(!U)return null;D.push(di(U.type))}c.error(`Expected arguments of type ${L}, but found (${D.join(", ")}) instead.`)}return null}static register(n,c){Kt.definitions=c;for(const d in c)n[d]=Kt}}class Ti{constructor(n,c,d){this.type=er,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=c}static parse(n,c){if(n.length!==2)return c.error("Expected one argument.");const d=n[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Ft);if(!g)return null;const y=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Ft);if(!y)return null;let b=null;return d.locale&&(b=c.parse(d.locale,1,Bt),!b)?null:new Ti(g,y,b)}evaluate(n){return new se(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const Ei=8192;function ln(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function Pr(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function Tn(o,n){const c=(180+o[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(c*g*Ei),Math.round(d*g*Ei)]}function li(o,n,c){const d=o[0]-n[0],g=o[1]-n[1],y=o[0]-c[0],b=o[1]-c[1];return d*b-y*g==0&&d*y<=0&&g*b<=0}function Ws(o,n){let c=!1;for(let b=0,E=n.length;b<E;b++){const S=n[b];for(let L=0,D=S.length;L<D-1;L++){if(li(o,S[L],S[L+1]))return!1;(g=S[L])[1]>(d=o)[1]!=(y=S[L+1])[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(c=!c)}}var d,g,y;return c}function Hs(o,n){for(let c=0;c<n.length;c++)if(Ws(o,n[c]))return!0;return!1}function _o(o,n,c,d){const g=d[0]-c[0],y=d[1]-c[1],b=(o[0]-c[0])*y-g*(o[1]-c[1]),E=(n[0]-c[0])*y-g*(n[1]-c[1]);return b>0&&E<0||b<0&&E>0}function yo(o,n,c){for(const L of c)for(let D=0;D<L.length-1;++D)if((E=[(b=L[D+1])[0]-(y=L[D])[0],b[1]-y[1]])[0]*(S=[(g=n)[0]-(d=o)[0],g[1]-d[1]])[1]-E[1]*S[0]!=0&&_o(d,g,y,b)&&_o(y,b,d,g))return!0;var d,g,y,b,E,S;return!1}function bs(o,n){for(let c=0;c<o.length;++c)if(!Ws(o[c],n))return!1;for(let c=0;c<o.length-1;++c)if(yo(o[c],o[c+1],n))return!1;return!0}function Ir(o,n){for(let c=0;c<n.length;c++)if(bs(o,n[c]))return!0;return!1}function xo(o,n,c){const d=[];for(let g=0;g<o.length;g++){const y=[];for(let b=0;b<o[g].length;b++){const E=Tn(o[g][b],c);ln(n,E),y.push(E)}d.push(y)}return d}function vo(o,n,c){const d=[];for(let g=0;g<o.length;g++){const y=xo(o[g],n,c);d.push(y)}return d}function bo(o,n,c,d){if(o[0]<c[0]||o[0]>c[2]){const g=.5*d;let y=o[0]-c[0]>g?-d:c[0]-o[0]>g?d:0;y===0&&(y=o[0]-c[2]>g?-d:c[2]-o[0]>g?d:0),o[0]+=y}ln(n,o)}function ia(o,n,c,d){const g=Math.pow(2,d.z)*Ei,y=[d.x*Ei,d.y*Ei],b=[];for(const E of o)for(const S of E){const L=[S.x+y[0],S.y+y[1]];bo(L,n,c,g),b.push(L)}return b}function $a(o,n,c,d){const g=Math.pow(2,d.z)*Ei,y=[d.x*Ei,d.y*Ei],b=[];for(const S of o){const L=[];for(const D of S){const O=[D.x+y[0],D.y+y[1]];ln(n,O),L.push(O)}b.push(L)}if(n[2]-n[0]<=g/2){(E=n)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const S of b)for(const L of S)bo(L,n,c,g)}var E;return b}class ts{constructor(n,c){this.type=Ft,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ne(n[1])){const d=n[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const y=d.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ts(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ts(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new ts(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(d.type==="Polygon"){const E=xo(d.coordinates,y,b),S=ia(c.geometry(),g,y,b);if(!Pr(g,y))return!1;for(const L of S)if(!Ws(L,E))return!1}if(d.type==="MultiPolygon"){const E=vo(d.coordinates,y,b),S=ia(c.geometry(),g,y,b);if(!Pr(g,y))return!1;for(const L of S)if(!Hs(L,E))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(d.type==="Polygon"){const E=xo(d.coordinates,y,b),S=$a(c.geometry(),g,y,b);if(!Pr(g,y))return!1;for(const L of S)if(!bs(L,E))return!1}if(d.type==="MultiPolygon"){const E=vo(d.coordinates,y,b),S=$a(c.geometry(),g,y,b);if(!Pr(g,y))return!1;for(const L of S)if(!Ir(L,E))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function G(o){if(o instanceof Kt&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ts)return!1;let n=!0;return o.eachChild(c=>{n&&!G(c)&&(n=!1)}),n}function Z(o){if(o instanceof Kt&&o.name==="feature-state")return!1;let n=!0;return o.eachChild(c=>{n&&!Z(c)&&(n=!1)}),n}function ae(o,n){if(o instanceof Kt&&n.indexOf(o.name)>=0)return!1;let c=!0;return o.eachChild(d=>{c&&!ae(d,n)&&(c=!1)}),c}class Pe{constructor(n,c){this.type=c.type,this.name=n,this.boundExpression=c}static parse(n,c){if(n.length!==2||typeof n[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=n[1];return c.scope.has(d)?new Pe(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class We{constructor(n,c=[],d,g=new vi,y=[]){this.registry=n,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=g,this.errors=y,this.expectedType=d}parse(n,c,d,g,y={}){return c?this.concat(c,d,g)._parse(n,y):this._parse(n,y)}_parse(n,c){function d(g,y,b){return b==="assert"?new vt(y,[g]):b==="coerce"?new Ct(y,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=n[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let b=y.parse(n,this);if(!b)return null;if(this.expectedType){const E=this.expectedType,S=b.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||S.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(E.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array"){if(this.checkSubtype(E,S))return null}else b=d(b,E,c.typeAnnotation||"coerce");else b=d(b,E,c.typeAnnotation||"coerce");else b=d(b,E,c.typeAnnotation||"assert")}if(!(b instanceof pt)&&b.type.kind!=="resolvedImage"&&dt(b)){const E=new Zt;try{b=new pt(b.type,b.evaluate(E))}catch(S){return this.error(S.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,c,d){const g=typeof n=="number"?this.path.concat(n):this.path,y=d?this.scope.concat(d):this.scope;return new We(this.registry,g,c||null,y,this.errors)}error(n,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new pn(d,n))}checkSubtype(n,c){const d=_r(n,c);return d&&this.error(d),d}}function dt(o){if(o instanceof Pe)return dt(o.boundExpression);if(o instanceof Kt&&o.name==="error"||o instanceof Ti||o instanceof ts)return!1;const n=o instanceof Ct||o instanceof vt;let c=!0;return o.eachChild(d=>{c=n?c&&dt(d):c&&d instanceof pt}),!!c&&G(o)&&ae(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xt(o,n){const c=o.length-1;let d,g,y=0,b=c,E=0;for(;y<=b;)if(E=Math.floor((y+b)/2),d=o[E],g=o[E+1],d<=n){if(E===c||n<g)return E;y=E+1}else{if(!(d>n))throw new et("Input is not a number.");b=E-1}return 0}class Di{constructor(n,c,d){this.type=n,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static parse(n,c){if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(n[1],1,Xe);if(!d)return null;const g=[];let y=null;c.expectedType&&c.expectedType.kind!=="value"&&(y=c.expectedType);for(let b=1;b<n.length;b+=2){const E=b===1?-1/0:n[b],S=n[b+1],L=b,D=b+1;if(typeof E!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=E)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const O=c.parse(S,D,y);if(!O)return null;y=y||O.type,g.push([E,O])}return new Di(y,d,g)}evaluate(n){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return d[0].evaluate(n);const y=c.length;return g>=c[y-1]?d[y-1].evaluate(n):d[Xt(c,g)].evaluate(n)}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Wt(o,n,c){return o*(1-c)+n*c}var Xi=Object.freeze({__proto__:null,number:Wt,color:function(o,n,c){return new $(Wt(o.r,n.r,c),Wt(o.g,n.g,c),Wt(o.b,n.b,c),Wt(o.a,n.a,c))},array:function(o,n,c){return o.map((d,g)=>Wt(d,n[g],c))},padding:function(o,n,c){const d=o.values,g=n.values;return new re([Wt(d[0],g[0],c),Wt(d[1],g[1],c),Wt(d[2],g[2],c),Wt(d[3],g[3],c)])}});const tr=.95047,Wu=1.08883,nc=4/29,Za=6/29,Hu=3*Za*Za,wf=Math.PI/180,Tf=180/Math.PI;function rc(o){return o>.008856451679035631?Math.pow(o,1/3):o/Hu+nc}function sc(o){return o>Za?o*o*o:Hu*(o-nc)}function oc(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function ac(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function ui(o){const n=ac(o.r),c=ac(o.g),d=ac(o.b),g=rc((.4124564*n+.3575761*c+.1804375*d)/tr),y=rc((.2126729*n+.7151522*c+.072175*d)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-rc((.0193339*n+.119192*c+.9503041*d)/Wu)),alpha:o.a}}function qu(o){let n=(o.l+16)/116,c=isNaN(o.a)?n:n+o.a/500,d=isNaN(o.b)?n:n-o.b/200;return n=1*sc(n),c=tr*sc(c),d=Wu*sc(d),new $(oc(3.2404542*c-1.5371385*n-.4985314*d),oc(-.969266*c+1.8760108*n+.041556*d),oc(.0556434*c-.2040259*n+1.0572252*d),o.alpha)}function Ef(o,n,c){const d=n-o;return o+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const na={forward:ui,reverse:qu,interpolate:function(o,n,c){return{l:Wt(o.l,n.l,c),a:Wt(o.a,n.a,c),b:Wt(o.b,n.b,c),alpha:Wt(o.alpha,n.alpha,c)}}},ra={forward:function(o){const{l:n,a:c,b:d}=ui(o),g=Math.atan2(d,c)*Tf;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:n,alpha:o.a}},reverse:function(o){const n=o.h*wf,c=o.c;return qu({l:o.l,a:Math.cos(n)*c,b:Math.sin(n)*c,alpha:o.alpha})},interpolate:function(o,n,c){return{h:Ef(o.h,n.h,c),c:Wt(o.c,n.c,c),l:Wt(o.l,n.l,c),alpha:Wt(o.alpha,n.alpha,c)}}};var $u=Object.freeze({__proto__:null,lab:na,hcl:ra});class ir{constructor(n,c,d,g,y){this.type=n,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[b,E]of y)this.labels.push(b),this.outputs.push(E)}static interpolationFactor(n,c,d,g){let y=0;if(n.name==="exponential")y=lc(c,n.base,d,g);else if(n.name==="linear")y=lc(c,1,d,g);else if(n.name==="cubic-bezier"){const b=n.controlPoints;y=new x(b[0],b[1],b[2],b[3]).solve(lc(c,1,d,g))}return y}static parse(n,c){let[d,g,y,...b]=n;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(D=>typeof D!="number"||D<0||D>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(y=c.parse(y,2,Xe),!y)return null;const E=[];let S=null;d==="interpolate-hcl"||d==="interpolate-lab"?S=an:c.expectedType&&c.expectedType.kind!=="value"&&(S=c.expectedType);for(let L=0;L<b.length;L+=2){const D=b[L],O=b[L+1],U=L+3,W=L+4;if(typeof D!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(E.length&&E[E.length-1][0]>=D)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const H=c.parse(O,W,S);if(!H)return null;S=S||H.type,E.push([D,H])}return S.kind==="number"||S.kind==="color"||S.kind==="padding"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new ir(S,d,g,y,E):c.error(`Type ${di(S)} is not interpolatable.`)}evaluate(n){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return d[0].evaluate(n);const y=c.length;if(g>=c[y-1])return d[y-1].evaluate(n);const b=Xt(c,g),E=ir.interpolationFactor(this.interpolation,g,c[b],c[b+1]),S=d[b].evaluate(n),L=d[b+1].evaluate(n);return this.operator==="interpolate"?Xi[this.type.kind.toLowerCase()](S,L,E):this.operator==="interpolate-hcl"?ra.reverse(ra.interpolate(ra.forward(S),ra.forward(L),E)):na.reverse(na.interpolate(na.forward(S),na.forward(L),E))}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function lc(o,n,c,d){const g=d-c,y=o-c;return g===0?0:n===1?y/g:(Math.pow(n,y)-1)/(Math.pow(n,g)-1)}class Xa{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const y=[];for(const E of n.slice(1)){const S=c.parse(E,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!S)return null;d=d||S.type,y.push(S)}if(!d)throw new Error("No output type");const b=g&&y.some(E=>_r(g,E.type));return new Xa(b?Dt:d,y)}evaluate(n){let c,d=null,g=0;for(const y of this.args)if(g++,d=y.evaluate(n),d&&d instanceof fe&&!d.available&&(c||(c=d.name),d=null,g===this.args.length&&(d=c)),d!==null)break;return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class Ya{constructor(n,c){this.type=c.type,this.bindings=[].concat(n),this.result=c}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const c of this.bindings)n(c[1]);n(this.result)}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const d=[];for(let y=1;y<n.length-1;y+=2){const b=n[y];if(typeof b!="string")return c.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",y);const E=c.parse(n[y+1],y+1);if(!E)return null;d.push([b,E])}const g=c.parse(n[n.length-1],n.length-1,c.expectedType,d);return g?new Ya(d,g):null}outputDefined(){return this.result.outputDefined()}}class cc{constructor(n,c,d){this.type=n,this.index=c,this.input=d}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=c.parse(n[1],1,Xe),g=c.parse(n[2],2,mn(c.expectedType||Dt));return d&&g?new cc(g.type.itemType,d,g):null}evaluate(n){const c=this.index.evaluate(n),d=this.input.evaluate(n);if(c<0)throw new et(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new et(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new et(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class uc{constructor(n,c){this.type=Ft,this.needle=n,this.haystack=c}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=c.parse(n[1],1,Dt),g=c.parse(n[2],2,Dt);return d&&g?yr(d.type,[Ft,Bt,Xe,Zi,Dt])?new uc(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(d.type)} instead`):null}evaluate(n){const c=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!d)return!1;if(!es(c,["boolean","string","number","null"]))throw new et(`Expected first argument to be of type boolean, string, number or null, but found ${di(Ie(c))} instead.`);if(!es(d,["string","array"]))throw new et(`Expected second argument to be of type array or string, but found ${di(Ie(d))} instead.`);return d.indexOf(c)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Ka{constructor(n,c,d){this.type=Xe,this.needle=n,this.haystack=c,this.fromIndex=d}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=c.parse(n[1],1,Dt),g=c.parse(n[2],2,Dt);if(!d||!g)return null;if(!yr(d.type,[Ft,Bt,Xe,Zi,Dt]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(d.type)} instead`);if(n.length===4){const y=c.parse(n[3],3,Xe);return y?new Ka(d,g,y):null}return new Ka(d,g)}evaluate(n){const c=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!es(c,["boolean","string","number","null"]))throw new et(`Expected first argument to be of type boolean, string, number or null, but found ${di(Ie(c))} instead.`);if(!es(d,["string","array"]))throw new et(`Expected second argument to be of type array or string, but found ${di(Ie(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class hc{constructor(n,c,d,g,y,b){this.inputType=n,this.type=c,this.input=d,this.cases=g,this.outputs=y,this.otherwise=b}static parse(n,c){if(n.length<5)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const y={},b=[];for(let L=2;L<n.length-1;L+=2){let D=n[L];const O=n[L+1];Array.isArray(D)||(D=[D]);const U=c.concat(L);if(D.length===0)return U.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return U.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return U.error("Numeric branch labels must be integer values.");if(d){if(U.checkSubtype(d,Ie(H)))return null}else d=Ie(H);if(y[String(H)]!==void 0)return U.error("Branch labels must be unique.");y[String(H)]=b.length}const W=c.parse(O,L,g);if(!W)return null;g=g||W.type,b.push(W)}const E=c.parse(n[1],1,Dt);if(!E)return null;const S=c.parse(n[n.length-1],n.length-1,g);return S?E.type.kind!=="value"&&c.concat(1).checkSubtype(d,E.type)?null:new hc(d,g,E,y,b,S):null}evaluate(n){const c=this.input.evaluate(n);return(Ie(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class dc{constructor(n,c,d){this.type=n,this.branches=c,this.otherwise=d}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let b=1;b<n.length-1;b+=2){const E=c.parse(n[b],b,Ft);if(!E)return null;const S=c.parse(n[b+1],b+1,d);if(!S)return null;g.push([E,S]),d=d||S.type}const y=c.parse(n[n.length-1],n.length-1,d);if(!y)return null;if(!d)throw new Error("Can't infer output type");return new dc(d,g,y)}evaluate(n){for(const[c,d]of this.branches)if(c.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[c,d]of this.branches)n(c),n(d);n(this.otherwise)}outputDefined(){return this.branches.every(([n,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Ja{constructor(n,c,d,g){this.type=n,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=c.parse(n[1],1,Dt),g=c.parse(n[2],2,Xe);if(!d||!g)return null;if(!yr(d.type,[mn(Dt),Bt,Dt]))return c.error(`Expected first argument to be of type array or string, but found ${di(d.type)} instead`);if(n.length===4){const y=c.parse(n[3],3,Xe);return y?new Ja(d.type,d,g,y):null}return new Ja(d.type,d,g)}evaluate(n){const c=this.input.evaluate(n),d=this.beginIndex.evaluate(n);if(!es(c,["string","array"]))throw new et(`Expected first argument to be of type array or string, but found ${di(Ie(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return c.slice(d,g)}return c.slice(d)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function Zu(o,n){return o==="=="||o==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Xu(o,n,c,d){return d.compare(n,c)===0}function wo(o,n,c){const d=o!=="=="&&o!=="!=";return class bb{constructor(y,b,E){this.type=Ft,this.lhs=y,this.rhs=b,this.collator=E,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}static parse(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");const E=y[0];let S=b.parse(y[1],1,Dt);if(!S)return null;if(!Zu(E,S.type))return b.concat(1).error(`"${E}" comparisons are not supported for type '${di(S.type)}'.`);let L=b.parse(y[2],2,Dt);if(!L)return null;if(!Zu(E,L.type))return b.concat(2).error(`"${E}" comparisons are not supported for type '${di(L.type)}'.`);if(S.type.kind!==L.type.kind&&S.type.kind!=="value"&&L.type.kind!=="value")return b.error(`Cannot compare types '${di(S.type)}' and '${di(L.type)}'.`);d&&(S.type.kind==="value"&&L.type.kind!=="value"?S=new vt(L.type,[S]):S.type.kind!=="value"&&L.type.kind==="value"&&(L=new vt(S.type,[L])));let D=null;if(y.length===4){if(S.type.kind!=="string"&&L.type.kind!=="string"&&S.type.kind!=="value"&&L.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(D=b.parse(y[3],3,er),!D)return null}return new bb(S,L,D)}evaluate(y){const b=this.lhs.evaluate(y),E=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const S=Ie(b),L=Ie(E);if(S.kind!==L.kind||S.kind!=="string"&&S.kind!=="number")throw new et(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${S.kind}, ${L.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const S=Ie(b),L=Ie(E);if(S.kind!=="string"||L.kind!=="string")return n(y,b,E)}return this.collator?c(y,b,E,this.collator.evaluate(y)):n(y,b,E)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Sf=wo("==",function(o,n,c){return n===c},Xu),Af=wo("!=",function(o,n,c){return n!==c},function(o,n,c,d){return!Xu(0,n,c,d)}),Pf=wo("<",function(o,n,c){return n<c},function(o,n,c,d){return d.compare(n,c)<0}),If=wo(">",function(o,n,c){return n>c},function(o,n,c,d){return d.compare(n,c)>0}),Cf=wo("<=",function(o,n,c){return n<=c},function(o,n,c,d){return d.compare(n,c)<=0}),Mf=wo(">=",function(o,n,c){return n>=c},function(o,n,c,d){return d.compare(n,c)>=0});class fc{constructor(n,c,d,g,y){this.type=Bt,this.number=n,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(n,c){if(n.length!==3)return c.error("Expected two arguments.");const d=c.parse(n[1],1,Xe);if(!d)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=c.parse(g.locale,1,Bt),!y))return null;let b=null;if(g.currency&&(b=c.parse(g.currency,1,Bt),!b))return null;let E=null;if(g["min-fraction-digits"]&&(E=c.parse(g["min-fraction-digits"],1,Xe),!E))return null;let S=null;return g["max-fraction-digits"]&&(S=c.parse(g["max-fraction-digits"],1,Xe),!S)?null:new fc(d,y,b,E,S)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class Qa{constructor(n){this.type=en,this.sections=n}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const d=n[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let y=!1;for(let b=1;b<=n.length-1;++b){const E=n[b];if(y&&typeof E=="object"&&!Array.isArray(E)){y=!1;let S=null;if(E["font-scale"]&&(S=c.parse(E["font-scale"],1,Xe),!S))return null;let L=null;if(E["text-font"]&&(L=c.parse(E["text-font"],1,mn(Bt)),!L))return null;let D=null;if(E["text-color"]&&(D=c.parse(E["text-color"],1,an),!D))return null;const O=g[g.length-1];O.scale=S,O.font=L,O.textColor=D}else{const S=c.parse(n[b],1,Dt);if(!S)return null;const L=S.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:S,scale:null,font:null,textColor:null})}}return new Qa(g)}evaluate(n){return new le(this.sections.map(c=>{const d=c.content.evaluate(n);return Ie(d)===Gi?new de("",d,null,null,null):new de(ct(d),null,c.scale?c.scale.evaluate(n):null,c.font?c.font.evaluate(n).join(","):null,c.textColor?c.textColor.evaluate(n):null)}))}eachChild(n){for(const c of this.sections)n(c.content),c.scale&&n(c.scale),c.font&&n(c.font),c.textColor&&n(c.textColor)}outputDefined(){return!1}}class pc{constructor(n){this.type=Gi,this.input=n}static parse(n,c){if(n.length!==2)return c.error("Expected two arguments.");const d=c.parse(n[1],1,Bt);return d?new pc(d):c.error("No image name provided.")}evaluate(n){const c=this.input.evaluate(n),d=fe.fromString(c);return d&&n.availableImages&&(d.available=n.availableImages.indexOf(c)>-1),d}eachChild(n){n(this.input)}outputDefined(){return!1}}class mc{constructor(n){this.type=Xe,this.input=n}static parse(n,c){if(n.length!==2)return c.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=c.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${di(d.type)} instead.`):new mc(d):null}evaluate(n){const c=this.input.evaluate(n);if(typeof c=="string"||Array.isArray(c))return c.length;throw new et(`Expected value to be of type string or array, but found ${di(Ie(c))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const To={"==":Sf,"!=":Af,">":If,"<":Pf,">=":Mf,"<=":Cf,array:vt,at:cc,boolean:vt,case:dc,coalesce:Xa,collator:Ti,format:Qa,image:pc,in:uc,"index-of":Ka,interpolate:ir,"interpolate-hcl":ir,"interpolate-lab":ir,length:mc,let:Ya,literal:pt,match:hc,number:vt,"number-format":fc,object:vt,slice:Ja,step:Di,string:vt,"to-boolean":Ct,"to-color":Ct,"to-number":Ct,"to-string":Ct,var:Pe,within:ts};function Yu(o,[n,c,d,g]){n=n.evaluate(o),c=c.evaluate(o),d=d.evaluate(o);const y=g?g.evaluate(o):1,b=Ce(n,c,d,y);if(b)throw new et(b);return new $(n/255*y,c/255*y,d/255*y,y)}function Ku(o,n){return o in n}function el(o,n){const c=n[o];return c===void 0?null:c}function qs(o){return{type:o}}function Ju(o){return{result:"success",value:o}}function Eo(o){return{result:"error",value:o}}function Ai(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Qu(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function ei(o){return!!o.expression&&o.expression.interpolated}function hi(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Si(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Mi(o){return o}function sa(o,n){const c=n.type==="color",d=o.stops&&typeof o.stops[0][0]=="object",g=d||!(d||o.property!==void 0),y=o.type||(ei(n)?"exponential":"interval");if(c||n.type==="padding"){const L=c?$.parse:re.parse;(o=Bi({},o)).stops&&(o.stops=o.stops.map(D=>[D[0],L(D[1])])),o.default=L(o.default?o.default:n.default)}if(o.colorSpace&&o.colorSpace!=="rgb"&&!$u[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let b,E,S;if(y==="exponential")b=eh;else if(y==="interval")b=Rf;else if(y==="categorical"){b=Lf,E=Object.create(null);for(const L of o.stops)E[L[0]]=L[1];S=typeof o.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=kf}if(d){const L={},D=[];for(let W=0;W<o.stops.length;W++){const H=o.stops[W],ne=H[0].zoom;L[ne]===void 0&&(L[ne]={zoom:ne,type:o.type,property:o.property,default:o.default,stops:[]},D.push(ne)),L[ne].stops.push([H[0].value,H[1]])}const O=[];for(const W of D)O.push([L[W].zoom,sa(L[W],n)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:ir.interpolationFactor.bind(void 0,U),zoomStops:O.map(W=>W[0]),evaluate:({zoom:W},H)=>eh({stops:O,base:o.base},n,W).evaluate(W,H)}}if(g){const L=y==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:ir.interpolationFactor.bind(void 0,L),zoomStops:o.stops.map(D=>D[0]),evaluate:({zoom:D})=>b(o,n,D,E,S)}}return{kind:"source",evaluate(L,D){const O=D&&D.properties?D.properties[o.property]:void 0;return O===void 0?So(o.default,n.default):b(o,n,O,E,S)}}}function So(o,n,c){return o!==void 0?o:n!==void 0?n:c!==void 0?c:void 0}function Lf(o,n,c,d,g){return So(typeof c===g?d[c]:void 0,o.default,n.default)}function Rf(o,n,c){if(hi(c)!=="number")return So(o.default,n.default);const d=o.stops.length;if(d===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[d-1][0])return o.stops[d-1][1];const g=Xt(o.stops.map(y=>y[0]),c);return o.stops[g][1]}function eh(o,n,c){const d=o.base!==void 0?o.base:1;if(hi(c)!=="number")return So(o.default,n.default);const g=o.stops.length;if(g===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[g-1][0])return o.stops[g-1][1];const y=Xt(o.stops.map(D=>D[0]),c),b=function(D,O,U,W){const H=W-U,ne=D-U;return H===0?0:O===1?ne/H:(Math.pow(O,ne)-1)/(Math.pow(O,H)-1)}(c,d,o.stops[y][0],o.stops[y+1][0]),E=o.stops[y][1],S=o.stops[y+1][1];let L=Xi[n.type]||Mi;if(o.colorSpace&&o.colorSpace!=="rgb"){const D=$u[o.colorSpace];L=(O,U)=>D.reverse(D.interpolate(D.forward(O),D.forward(U),b))}return typeof E.evaluate=="function"?{evaluate(...D){const O=E.evaluate.apply(void 0,D),U=S.evaluate.apply(void 0,D);if(O!==void 0&&U!==void 0)return L(O,U,b)}}:L(E,S,b)}function kf(o,n,c){switch(n.type){case"color":c=$.parse(c);break;case"formatted":c=le.fromString(c.toString());break;case"resolvedImage":c=fe.fromString(c.toString());break;case"padding":c=re.parse(c);break;default:hi(c)===n.type||n.type==="enum"&&n.values[c]||(c=void 0)}return So(c,o.default,n.default)}Kt.register(To,{error:[{kind:"error"},[Bt],(o,[n])=>{throw new et(n.evaluate(o))}],typeof:[Bt,[Dt],(o,[n])=>di(Ie(n.evaluate(o)))],"to-rgba":[mn(Xe,4),[an],(o,[n])=>n.evaluate(o).toArray()],rgb:[an,[Xe,Xe,Xe],Yu],rgba:[an,[Xe,Xe,Xe,Xe],Yu],has:{type:Ft,overloads:[[[Bt],(o,[n])=>Ku(n.evaluate(o),o.properties())],[[Bt,Ar],(o,[n,c])=>Ku(n.evaluate(o),c.evaluate(o))]]},get:{type:Dt,overloads:[[[Bt],(o,[n])=>el(n.evaluate(o),o.properties())],[[Bt,Ar],(o,[n,c])=>el(n.evaluate(o),c.evaluate(o))]]},"feature-state":[Dt,[Bt],(o,[n])=>el(n.evaluate(o),o.featureState||{})],properties:[Ar,[],o=>o.properties()],"geometry-type":[Bt,[],o=>o.geometryType()],id:[Dt,[],o=>o.id()],zoom:[Xe,[],o=>o.globals.zoom],"heatmap-density":[Xe,[],o=>o.globals.heatmapDensity||0],"line-progress":[Xe,[],o=>o.globals.lineProgress||0],accumulated:[Dt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Xe,qs(Xe),(o,n)=>{let c=0;for(const d of n)c+=d.evaluate(o);return c}],"*":[Xe,qs(Xe),(o,n)=>{let c=1;for(const d of n)c*=d.evaluate(o);return c}],"-":{type:Xe,overloads:[[[Xe,Xe],(o,[n,c])=>n.evaluate(o)-c.evaluate(o)],[[Xe],(o,[n])=>-n.evaluate(o)]]},"/":[Xe,[Xe,Xe],(o,[n,c])=>n.evaluate(o)/c.evaluate(o)],"%":[Xe,[Xe,Xe],(o,[n,c])=>n.evaluate(o)%c.evaluate(o)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(o,[n,c])=>Math.pow(n.evaluate(o),c.evaluate(o))],sqrt:[Xe,[Xe],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[Xe,[Xe],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[Xe,[Xe],(o,[n])=>Math.log(n.evaluate(o))],log2:[Xe,[Xe],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[Xe,[Xe],(o,[n])=>Math.sin(n.evaluate(o))],cos:[Xe,[Xe],(o,[n])=>Math.cos(n.evaluate(o))],tan:[Xe,[Xe],(o,[n])=>Math.tan(n.evaluate(o))],asin:[Xe,[Xe],(o,[n])=>Math.asin(n.evaluate(o))],acos:[Xe,[Xe],(o,[n])=>Math.acos(n.evaluate(o))],atan:[Xe,[Xe],(o,[n])=>Math.atan(n.evaluate(o))],min:[Xe,qs(Xe),(o,n)=>Math.min(...n.map(c=>c.evaluate(o)))],max:[Xe,qs(Xe),(o,n)=>Math.max(...n.map(c=>c.evaluate(o)))],abs:[Xe,[Xe],(o,[n])=>Math.abs(n.evaluate(o))],round:[Xe,[Xe],(o,[n])=>{const c=n.evaluate(o);return c<0?-Math.round(-c):Math.round(c)}],floor:[Xe,[Xe],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[Xe,[Xe],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[Ft,[Bt,Dt],(o,[n,c])=>o.properties()[n.value]===c.value],"filter-id-==":[Ft,[Dt],(o,[n])=>o.id()===n.value],"filter-type-==":[Ft,[Bt],(o,[n])=>o.geometryType()===n.value],"filter-<":[Ft,[Bt,Dt],(o,[n,c])=>{const d=o.properties()[n.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Ft,[Dt],(o,[n])=>{const c=o.id(),d=n.value;return typeof c==typeof d&&c<d}],"filter->":[Ft,[Bt,Dt],(o,[n,c])=>{const d=o.properties()[n.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[Ft,[Dt],(o,[n])=>{const c=o.id(),d=n.value;return typeof c==typeof d&&c>d}],"filter-<=":[Ft,[Bt,Dt],(o,[n,c])=>{const d=o.properties()[n.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Ft,[Dt],(o,[n])=>{const c=o.id(),d=n.value;return typeof c==typeof d&&c<=d}],"filter->=":[Ft,[Bt,Dt],(o,[n,c])=>{const d=o.properties()[n.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Ft,[Dt],(o,[n])=>{const c=o.id(),d=n.value;return typeof c==typeof d&&c>=d}],"filter-has":[Ft,[Dt],(o,[n])=>n.value in o.properties()],"filter-has-id":[Ft,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Ft,[mn(Bt)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ft,[mn(Dt)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[Ft,[Bt,mn(Dt)],(o,[n,c])=>c.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[Ft,[Bt,mn(Dt)],(o,[n,c])=>function(d,g,y,b){for(;y<=b;){const E=y+b>>1;if(g[E]===d)return!0;g[E]>d?b=E-1:y=E+1}return!1}(o.properties()[n.value],c.value,0,c.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(o,[n,c])=>n.evaluate(o)&&c.evaluate(o)],[qs(Ft),(o,n)=>{for(const c of n)if(!c.evaluate(o))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(o,[n,c])=>n.evaluate(o)||c.evaluate(o)],[qs(Ft),(o,n)=>{for(const c of n)if(c.evaluate(o))return!0;return!1}]]},"!":[Ft,[Ft],(o,[n])=>!n.evaluate(o)],"is-supported-script":[Ft,[Bt],(o,[n])=>{const c=o.globals&&o.globals.isSupportedScript;return!c||c(n.evaluate(o))}],upcase:[Bt,[Bt],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[Bt,[Bt],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[Bt,qs(Dt),(o,n)=>n.map(c=>ct(c.evaluate(o))).join("")],"resolved-locale":[Bt,[er],(o,[n])=>n.evaluate(o).resolvedLocale()]});class tl{constructor(n,c){this.expression=n,this._warningHistory={},this._evaluator=new Zt,this._defaultValue=c?function(d){return d.type==="color"&&Si(d.default)?new $(0,0,0,0):d.type==="color"?$.parse(d.default)||null:d.type==="padding"?re.parse(d.default)||null:d.default===void 0?null:d.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(n,c,d,g,y,b){return this._evaluator.globals=n,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(n,c,d,g,y,b){this._evaluator.globals=n,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new et(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function oa(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in To}function aa(o,n){const c=new We(To,[],n?function(g){const y={color:an,string:Bt,number:Xe,enum:Bt,boolean:Ft,formatted:en,padding:ys,resolvedImage:Gi};return g.type==="array"?mn(y[g.value]||Dt,g.length):y[g.type]}(n):void 0),d=c.parse(o,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Ju(new tl(d,n)):Eo(c.errors)}class la{constructor(n,c){this.kind=n,this._styleExpression=c,this.isStateDependent=n!=="constant"&&!Z(c.expression)}evaluateWithoutErrorHandling(n,c,d,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(n,c,d,g,y,b)}evaluate(n,c,d,g,y,b){return this._styleExpression.evaluate(n,c,d,g,y,b)}}class gc{constructor(n,c,d,g){this.kind=n,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=n!=="camera"&&!Z(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,c,d,g,y,b){return this._styleExpression.evaluateWithoutErrorHandling(n,c,d,g,y,b)}evaluate(n,c,d,g,y,b){return this._styleExpression.evaluate(n,c,d,g,y,b)}interpolationFactor(n,c,d){return this.interpolationType?ir.interpolationFactor(this.interpolationType,n,c,d):0}}function th(o,n){const c=aa(o,n);if(c.result==="error")return c;const d=c.value.expression,g=G(d);if(!g&&!Ai(n))return Eo([new pn("","data expressions not supported")]);const y=ae(d,["zoom"]);if(!y&&!Qu(n))return Eo([new pn("","zoom expressions not supported")]);const b=nl(d);return b||y?b instanceof pn?Eo([b]):b instanceof ir&&!ei(n)?Eo([new pn("",'"interpolate" expressions cannot be used with this property')]):Ju(b?new gc(g?"camera":"composite",c.value,b.labels,b instanceof ir?b.interpolation:void 0):new la(g?"constant":"source",c.value)):Eo([new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class il{constructor(n,c){this._parameters=n,this._specification=c,Bi(this,sa(this._parameters,this._specification))}static deserialize(n){return new il(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function nl(o){let n=null;if(o instanceof Ya)n=nl(o.result);else if(o instanceof Xa){for(const c of o.args)if(n=nl(c),n)break}else(o instanceof Di||o instanceof ir)&&o.input instanceof Kt&&o.input.name==="zoom"&&(n=o);return n instanceof pn||o.eachChild(c=>{const d=nl(c);d instanceof pn?n=d:!n&&d?n=new pn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&d&&n!==d&&(n=new pn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Cr(o){const n=o.key,c=o.value,d=o.valueSpec||{},g=o.objectElementValidators||{},y=o.style,b=o.styleSpec;let E=[];const S=hi(c);if(S!=="object")return[new je(n,c,`object expected, ${S} found`)];for(const L in c){const D=L.split(".")[0],O=d[D]||d["*"];let U;if(g[D])U=g[D];else if(d[D])U=rr;else if(g["*"])U=g["*"];else{if(!d["*"]){E.push(new je(n,c[L],`unknown property "${L}"`));continue}U=rr}E=E.concat(U({key:(n&&`${n}.`)+L,value:c[L],valueSpec:O,style:y,styleSpec:b,object:c,objectKey:L},c))}for(const L in d)g[L]||d[L].required&&d[L].default===void 0&&c[L]===void 0&&E.push(new je(n,c,`missing required property "${L}"`));return E}function ih(o){const n=o.value,c=o.valueSpec,d=o.style,g=o.styleSpec,y=o.key,b=o.arrayElementValidator||rr;if(hi(n)!=="array")return[new je(y,n,`array expected, ${hi(n)} found`)];if(c.length&&n.length!==c.length)return[new je(y,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new je(y,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let E={type:c.value,values:c.values};g.$version<7&&(E.function=c.function),hi(c.value)==="object"&&(E=c.value);let S=[];for(let L=0;L<n.length;L++)S=S.concat(b({array:n,arrayIndex:L,value:n[L],valueSpec:E,style:d,styleSpec:g,key:`${y}[${L}]`}));return S}function _c(o){const n=o.key,c=o.value,d=o.valueSpec;let g=hi(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new je(n,c,`number expected, ${g} found`)]:"minimum"in d&&c<d.minimum?[new je(n,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new je(n,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function nh(o){const n=o.valueSpec,c=jt(o.value.type);let d,g,y,b={};const E=c!=="categorical"&&o.value.property===void 0,S=!E,L=hi(o.value.stops)==="array"&&hi(o.value.stops[0])==="array"&&hi(o.value.stops[0][0])==="object",D=Cr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(W){if(c==="identity")return[new je(W.key,W.value,'identity function may not have a "stops" property')];let H=[];const ne=W.value;return H=H.concat(ih({key:W.key,value:ne,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:O})),hi(ne)==="array"&&ne.length===0&&H.push(new je(W.key,ne,"array must have at least one stop")),H},default:function(W){return rr({key:W.key,value:W.value,valueSpec:n,style:W.style,styleSpec:W.styleSpec})}}});return c==="identity"&&E&&D.push(new je(o.key,o.value,'missing required property "property"')),c==="identity"||o.value.stops||D.push(new je(o.key,o.value,'missing required property "stops"')),c==="exponential"&&o.valueSpec.expression&&!ei(o.valueSpec)&&D.push(new je(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(S&&!Ai(o.valueSpec)?D.push(new je(o.key,o.value,"property functions not supported")):E&&!Qu(o.valueSpec)&&D.push(new je(o.key,o.value,"zoom functions not supported"))),c!=="categorical"&&!L||o.value.property!==void 0||D.push(new je(o.key,o.value,'"property" property is required')),D;function O(W){let H=[];const ne=W.value,ie=W.key;if(hi(ne)!=="array")return[new je(ie,ne,`array expected, ${hi(ne)} found`)];if(ne.length!==2)return[new je(ie,ne,`array length 2 expected, length ${ne.length} found`)];if(L){if(hi(ne[0])!=="object")return[new je(ie,ne,`object expected, ${hi(ne[0])} found`)];if(ne[0].zoom===void 0)return[new je(ie,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new je(ie,ne,"object stop key must have value")];if(y&&y>jt(ne[0].zoom))return[new je(ie,ne[0].zoom,"stop zoom values must appear in ascending order")];jt(ne[0].zoom)!==y&&(y=jt(ne[0].zoom),g=void 0,b={}),H=H.concat(Cr({key:`${ie}[0]`,value:ne[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:_c,value:U}}))}else H=H.concat(U({key:`${ie}[0]`,value:ne[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},ne));return oa(Qi(ne[1]))?H.concat([new je(`${ie}[1]`,ne[1],"expressions are not allowed in function stops.")]):H.concat(rr({key:`${ie}[1]`,value:ne[1],valueSpec:n,style:W.style,styleSpec:W.styleSpec}))}function U(W,H){const ne=hi(W.value),ie=jt(W.value),ye=W.value!==null?W.value:H;if(d){if(ne!==d)return[new je(W.key,ye,`${ne} stop domain type must match previous stop domain type ${d}`)]}else d=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new je(W.key,ye,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&c!=="categorical"){let Ae=`number expected, ${ne} found`;return Ai(n)&&c===void 0&&(Ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(W.key,ye,Ae)]}return c!=="categorical"||ne!=="number"||isFinite(ie)&&Math.floor(ie)===ie?c!=="categorical"&&ne==="number"&&g!==void 0&&ie<g?[new je(W.key,ye,"stop domain values must appear in ascending order")]:(g=ie,c==="categorical"&&ie in b?[new je(W.key,ye,"stop domain values must be unique")]:(b[ie]=!0,[])):[new je(W.key,ye,`integer expected, found ${ie}`)]}}function $s(o){const n=(o.expressionContext==="property"?th:aa)(Qi(o.value),o.valueSpec);if(n.result==="error")return n.value.map(d=>new je(`${o.key}${d.key}`,o.value,d.message));const c=n.value.expression||n.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!c.outputDefined())return[new je(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Z(c))return[new je(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Z(c))return[new je(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!ae(c,["zoom","feature-state"]))return[new je(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!G(c))return[new je(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ca(o){const n=o.key,c=o.value,d=o.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(jt(c))===-1&&g.push(new je(n,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(jt(c))===-1&&g.push(new je(n,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Ao(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const n of o.slice(1))if(!Ao(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Df={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function rl(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Ao(o)||(o=ua(o));const n=aa(o,Df);if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,g)=>n.value.evaluate(c,d,{},g),needGeometry:sh(o)}}function rh(o,n){return o<n?-1:o>n?1:0}function sh(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let n=1;n<o.length;n++)if(sh(o[n]))return!0;return!1}function ua(o){if(!o)return!0;const n=o[0];return o.length<=1?n!=="any":n==="=="?yc(o[1],o[2],"=="):n==="!="?Po(yc(o[1],o[2],"==")):n==="<"||n===">"||n==="<="||n===">="?yc(o[1],o[2],n):n==="any"?(c=o.slice(1),["any"].concat(c.map(ua))):n==="all"?["all"].concat(o.slice(1).map(ua)):n==="none"?["all"].concat(o.slice(1).map(ua).map(Po)):n==="in"?sl(o[1],o.slice(2)):n==="!in"?Po(sl(o[1],o.slice(2))):n==="has"?ha(o[1]):n==="!has"?Po(ha(o[1])):n!=="within"||o;var c}function yc(o,n,c){switch(o){case"$type":return[`filter-type-${c}`,n];case"$id":return[`filter-id-${c}`,n];default:return[`filter-${c}`,o,n]}}function sl(o,n){if(n.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(c=>typeof c!=typeof n[0])?["filter-in-large",o,["literal",n.sort(rh)]]:["filter-in-small",o,["literal",n]]}}function ha(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Po(o){return["!",o]}function da(o){return Ao(Qi(o.value))?$s(Bi({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):oh(o)}function oh(o){const n=o.value,c=o.key;if(hi(n)!=="array")return[new je(c,n,`array expected, ${hi(n)} found`)];const d=o.styleSpec;let g,y=[];if(n.length<1)return[new je(c,n,"filter array must have at least 1 element")];switch(y=y.concat(ca({key:`${c}[0]`,value:n[0],valueSpec:d.filter_operator,style:o.style,styleSpec:o.styleSpec})),jt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&jt(n[1])==="$type"&&y.push(new je(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new je(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=hi(n[1]),g!=="string"&&y.push(new je(`${c}[1]`,n[1],`string expected, ${g} found`)));for(let b=2;b<n.length;b++)g=hi(n[b]),jt(n[1])==="$type"?y=y.concat(ca({key:`${c}[${b}]`,value:n[b],valueSpec:d.geometry_type,style:o.style,styleSpec:o.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new je(`${c}[${b}]`,n[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<n.length;b++)y=y.concat(oh({key:`${c}[${b}]`,value:n[b],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":g=hi(n[1]),n.length!==2?y.push(new je(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new je(`${c}[1]`,n[1],`string expected, ${g} found`));break;case"within":g=hi(n[1]),n.length!==2?y.push(new je(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new je(`${c}[1]`,n[1],`object expected, ${g} found`))}return y}function fa(o,n){const c=o.key,d=o.style,g=o.styleSpec,y=o.value,b=o.objectKey,E=g[`${n}_${o.layerType}`];if(!E)return[];const S=b.match(/^(.*)-transition$/);if(n==="paint"&&S&&E[S[1]]&&E[S[1]].transition)return rr({key:c,value:y,valueSpec:g.transition,style:d,styleSpec:g});const L=o.valueSpec||E[b];if(!L)return[new je(c,y,`unknown property "${b}"`)];let D;if(hi(y)==="string"&&Ai(L)&&!L.tokens&&(D=/^{([^}]+)}$/.exec(y)))return[new je(c,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return o.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&O.push(new je(c,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Si(Qi(y))&&jt(y.type)==="identity"&&O.push(new je(c,y,'"text-font" does not support identity functions'))),O.concat(rr({key:o.key,value:y,valueSpec:L,style:d,styleSpec:g,expressionContext:"property",propertyType:n,propertyKey:b}))}function ah(o){return fa(o,"paint")}function lh(o){return fa(o,"layout")}function ch(o){let n=[];const c=o.value,d=o.key,g=o.style,y=o.styleSpec;c.type||c.ref||n.push(new je(d,c,'either "type" or "ref" is required'));let b=jt(c.type);const E=jt(c.ref);if(c.id){const S=jt(c.id);for(let L=0;L<o.arrayIndex;L++){const D=g.layers[L];jt(D.id)===S&&n.push(new je(d,c.id,`duplicate layer id "${c.id}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(L=>{L in c&&n.push(new je(d,c[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{jt(L.id)===E&&(S=L)}),S?S.ref?n.push(new je(d,c.ref,"ref cannot reference another ref layer")):b=jt(S.type):n.push(new je(d,c.ref,`ref layer "${E}" not found`))}else if(b!=="background")if(c.source){const S=g.sources&&g.sources[c.source],L=S&&jt(S.type);S?L==="vector"&&b==="raster"?n.push(new je(d,c.source,`layer "${c.id}" requires a raster source`)):L==="raster"&&b!=="raster"?n.push(new je(d,c.source,`layer "${c.id}" requires a vector source`)):L!=="vector"||c["source-layer"]?L==="raster-dem"&&b!=="hillshade"?n.push(new je(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!c.paint||!c.paint["line-gradient"]||L==="geojson"&&S.lineMetrics||n.push(new je(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new je(d,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new je(d,c.source,`source "${c.source}" not found`))}else n.push(new je(d,c,'missing required property "source"'));return n=n.concat(Cr({key:d,value:c,valueSpec:y.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>rr({key:`${d}.type`,value:c.type,valueSpec:y.layer.type,style:o.style,styleSpec:o.styleSpec,object:c,objectKey:"type"}),filter:da,layout:S=>Cr({layer:c,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":L=>lh(Bi({layerType:b},L))}}),paint:S=>Cr({layer:c,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":L=>ah(Bi({layerType:b},L))}})}})),n}function Io(o){const n=o.value,c=o.key,d=hi(n);return d!=="string"?[new je(c,n,`string expected, ${d} found`)]:[]}const uh={promoteId:function({key:o,value:n}){if(hi(n)==="string")return Io({key:o,value:n});{const c=[];for(const d in n)c.push(...Io({key:`${o}.${d}`,value:n[d]}));return c}}};function pa(o){const n=o.value,c=o.key,d=o.styleSpec,g=o.style;if(!n.type)return[new je(c,n,'"type" is required')];const y=jt(n.type);let b;switch(y){case"vector":case"raster":case"raster-dem":return b=Cr({key:c,value:n,valueSpec:d[`source_${y.replace("-","_")}`],style:o.style,styleSpec:d,objectElementValidators:uh}),b;case"geojson":if(b=Cr({key:c,value:n,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:uh}),n.cluster)for(const E in n.clusterProperties){const[S,L]=n.clusterProperties[E],D=typeof S=="string"?[S,["accumulated"],["get",E]]:S;b.push(...$s({key:`${c}.${E}.map`,value:L,expressionContext:"cluster-map"})),b.push(...$s({key:`${c}.${E}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return b;case"video":return Cr({key:c,value:n,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return Cr({key:c,value:n,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new je(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ca({key:`${c}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function ma(o){const n=o.value,c=o.styleSpec,d=c.light,g=o.style;let y=[];const b=hi(n);if(n===void 0)return y;if(b!=="object")return y=y.concat([new je("light",n,`object expected, ${b} found`)]),y;for(const E in n){const S=E.match(/^(.*)-transition$/);y=y.concat(S&&d[S[1]]&&d[S[1]].transition?rr({key:E,value:n[E],valueSpec:c.transition,style:g,styleSpec:c}):d[E]?rr({key:E,value:n[E],valueSpec:d[E],style:g,styleSpec:c}):[new je(E,n[E],`unknown property "${E}"`)])}return y}function nr(o){const n=o.value,c=o.styleSpec,d=c.terrain,g=o.style;let y=[];const b=hi(n);if(n===void 0)return y;if(b!=="object")return y=y.concat([new je("terrain",n,`object expected, ${b} found`)]),y;for(const E in n)y=y.concat(d[E]?rr({key:E,value:n[E],valueSpec:d[E],style:g,styleSpec:c}):[new je(E,n[E],`unknown property "${E}"`)]);return y}const ga={"*":()=>[],array:ih,boolean:function(o){const n=o.value,c=o.key,d=hi(n);return d!=="boolean"?[new je(c,n,`boolean expected, ${d} found`)]:[]},number:_c,color:function(o){const n=o.key,c=o.value,d=hi(c);return d!=="string"?[new je(n,c,`color expected, ${d} found`)]:vs(c)===null?[new je(n,c,`color expected, "${c}" found`)]:[]},constants:ji,enum:ca,filter:da,function:nh,layer:ch,object:Cr,source:pa,light:ma,terrain:nr,string:Io,formatted:function(o){return Io(o).length===0?[]:$s(o)},resolvedImage:function(o){return Io(o).length===0?[]:$s(o)},padding:function(o){const n=o.key,c=o.value;if(hi(c)==="array"){if(c.length<1||c.length>4)return[new je(n,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let g=[];for(let y=0;y<c.length;y++)g=g.concat(rr({key:`${n}[${y}]`,value:c[y],valueSpec:d}));return g}return _c({key:n,value:c,valueSpec:{}})}};function rr(o){const n=o.value,c=o.valueSpec,d=o.styleSpec;return c.expression&&Si(jt(n))?nh(o):c.expression&&oa(Qi(n))?$s(o):c.type&&ga[c.type]?ga[c.type](o):Cr(Bi({},o,{valueSpec:c.type?d[c.type]:c}))}function zf(o){const n=o.value,c=o.key,d=Io(o);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new je(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new je(c,n,'"glyphs" url must include a "{range}" token'))),d}function ws(o,n=we){let c=[];return c=c.concat(rr({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,objectElementValidators:{glyphs:zf,"*":()=>[]}})),o.constants&&(c=c.concat(ji({key:"constants",value:o.constants,style:o,styleSpec:n}))),hh(c)}function hh(o){return[].concat(o).sort((n,c)=>n.line-c.line)}function is(o){return function(...n){return hh(o.apply(this,n))}}ws.source=is(pa),ws.light=is(ma),ws.terrain=is(nr),ws.layer=is(ch),ws.filter=is(da),ws.paintProperty=is(ah),ws.layoutProperty=is(lh);const _a=ws,xc=_a.light,Of=_a.paintProperty,Ff=_a.layoutProperty;function ol(o,n){let c=!1;if(n&&n.length)for(const d of n)o.fire(new Vt(new Error(d.message))),c=!0;return c}class ya{constructor(n,c,d){const g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const b=new Int32Array(this.arrayBuffer);n=b[0],this.d=(c=b[1])+2*(d=b[2]);for(let S=0;S<this.d*this.d;S++){const L=b[3+S],D=b[3+S+1];g.push(L===D?null:b.subarray(L,D))}const E=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],E),this.bboxes=b.subarray(E),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=d,this.scale=c/n,this.uid=0;const y=d/c*n;this.min=-y,this.max=n+y}insert(n,c,d,g,y){this._forEachCell(c,d,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,c,d,g,y,b){this.cells[y].push(b)}query(n,c,d,g,y){const b=this.min,E=this.max;if(n<=b&&c<=b&&E<=d&&E<=g&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(n,c,d,g,this._queryCell,S,{},y),S}}_queryCell(n,c,d,g,y,b,E,S){const L=this.cells[y];if(L!==null){const D=this.keys,O=this.bboxes;for(let U=0;U<L.length;U++){const W=L[U];if(E[W]===void 0){const H=4*W;(S?S(O[H+0],O[H+1],O[H+2],O[H+3]):n<=O[H+2]&&c<=O[H+3]&&d>=O[H+0]&&g>=O[H+1])?(E[W]=!0,b.push(D[W])):E[W]=!1}}}}_forEachCell(n,c,d,g,y,b,E,S){const L=this._convertToCellCoord(n),D=this._convertToCellCoord(c),O=this._convertToCellCoord(d),U=this._convertToCellCoord(g);for(let W=L;W<=O;W++)for(let H=D;H<=U;H++){const ne=this.d*H+W;if((!S||S(this._convertFromCellCoord(W),this._convertFromCellCoord(H),this._convertFromCellCoord(W+1),this._convertFromCellCoord(H+1)))&&y.call(this,n,c,d,g,ne,b,E,S))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,c=3+this.cells.length+1+1;let d=0;for(let b=0;b<this.cells.length;b++)d+=this.cells[b].length;const g=new Int32Array(c+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=c;for(let b=0;b<n.length;b++){const E=n[b];g[3+b]=y,g.set(E,y),y+=E.length}return g[3+n.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+n.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(n,c){const d=n.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(n){return new ya(n.buffer)}}const ns={};function ut(o,n,c={}){if(ns[o])throw new Error(`${o} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:o,writeable:!1}),ns[o]={klass:n,omit:c.omit||[],shallow:c.shallow||[]}}ut("Object",Object),ut("TransferableGridIndex",ya),ut("Color",$),ut("Error",Error),ut("AJAXError",me),ut("ResolvedImage",fe),ut("StylePropertyFunction",il),ut("StyleExpression",tl,{omit:["_evaluator"]}),ut("ZoomDependentExpression",gc),ut("ZoomConstantExpression",la),ut("CompoundExpression",Kt,{omit:["_evaluate"]});for(const o in To)To[o]._classRegistryKey||ut(`Expression_${o}`,To[o]);function dh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Zs(o,n){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob)return o;if(dh(o)||Ut(o))return n&&n.push(o),o;if(ArrayBuffer.isView(o)){const c=o;return n&&n.push(c.buffer),c}if(o instanceof ImageData)return n&&n.push(o.data.buffer),o;if(Array.isArray(o)){const c=[];for(const d of o)c.push(Zs(d,n));return c}if(typeof o=="object"){const c=o.constructor,d=c._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!ns[d])throw new Error(`${d} is not registered.`);const g=c.serialize?c.serialize(o,n):{};if(c.serialize){if(n&&g===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in o){if(!o.hasOwnProperty(y)||ns[d].omit.indexOf(y)>=0)continue;const b=o[y];g[y]=ns[d].shallow.indexOf(y)>=0?b:Zs(b,n)}o instanceof Error&&(g.message=o.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof o)}function Ts(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||dh(o)||Ut(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Ts);if(typeof o=="object"){const n=o.$name||"Object";if(!ns[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:c}=ns[n];if(!c)throw new Error(`can't deserialize unregistered class ${n}`);if(c.deserialize)return c.deserialize(o);const d=Object.create(c.prototype);for(const g of Object.keys(o)){if(g==="$name")continue;const y=o[g];d[g]=ns[n].shallow.indexOf(g)>=0?y:Ts(y)}return d}throw new Error("can't deserialize object of type "+typeof o)}class vc{constructor(){this.first=!0}update(n,c){const d=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=d,!0))}}const tt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function al(o){for(const n of o)if(wc(n.charCodeAt(0)))return!0;return!1}function Bf(o){for(const n of o)if(!bc(n.charCodeAt(0)))return!1;return!0}function bc(o){return!(tt.Arabic(o)||tt["Arabic Supplement"](o)||tt["Arabic Extended-A"](o)||tt["Arabic Presentation Forms-A"](o)||tt["Arabic Presentation Forms-B"](o))}function wc(o){return!(o!==746&&o!==747&&(o<4352||!(tt["Bopomofo Extended"](o)||tt.Bopomofo(o)||tt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||tt["CJK Compatibility Ideographs"](o)||tt["CJK Compatibility"](o)||tt["CJK Radicals Supplement"](o)||tt["CJK Strokes"](o)||!(!tt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||tt["CJK Unified Ideographs Extension A"](o)||tt["CJK Unified Ideographs"](o)||tt["Enclosed CJK Letters and Months"](o)||tt["Hangul Compatibility Jamo"](o)||tt["Hangul Jamo Extended-A"](o)||tt["Hangul Jamo Extended-B"](o)||tt["Hangul Jamo"](o)||tt["Hangul Syllables"](o)||tt.Hiragana(o)||tt["Ideographic Description Characters"](o)||tt.Kanbun(o)||tt["Kangxi Radicals"](o)||tt["Katakana Phonetic Extensions"](o)||tt.Katakana(o)&&o!==12540||!(!tt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!tt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||tt["Unified Canadian Aboriginal Syllabics"](o)||tt["Unified Canadian Aboriginal Syllabics Extended"](o)||tt["Vertical Forms"](o)||tt["Yijing Hexagram Symbols"](o)||tt["Yi Syllables"](o)||tt["Yi Radicals"](o))))}function fh(o){return!(wc(o)||function(n){return!!(tt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||tt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||tt["Letterlike Symbols"](n)||tt["Number Forms"](n)||tt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||tt["Control Pictures"](n)&&n!==9251||tt["Optical Character Recognition"](n)||tt["Enclosed Alphanumerics"](n)||tt["Geometric Shapes"](n)||tt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||tt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||tt["CJK Symbols and Punctuation"](n)||tt.Katakana(n)||tt["Private Use Area"](n)||tt["CJK Compatibility Forms"](n)||tt["Small Form Variants"](n)||tt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(o))}function ph(o){return o>=1424&&o<=2303||tt["Arabic Presentation Forms-A"](o)||tt["Arabic Presentation Forms-B"](o)}function Nf(o,n){return!(!n&&ph(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||tt.Khmer(o))}function mh(o){for(const n of o)if(ph(n.charCodeAt(0)))return!0;return!1}const Tc="deferred",Ec="loading",Sc="loaded";let Ac=null,Gn="unavailable",Es=null;const gh=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(Gn="error"),Ac&&Ac(o)};function Co(){Pc.fire(new Lt("pluginStateChange",{pluginStatus:Gn,pluginURL:Es}))}const Pc=new Qt,xa=function(){return Gn},_h=function(){if(Gn!==Tc||!Es)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gn=Ec,Co(),Es&&qe({url:Es},o=>{o?gh(o):(Gn=Sc,Co())})},xr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Gn===Sc||xr.applyArabicShaping!=null,isLoading:()=>Gn===Ec,setState(o){if(!_t())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Gn=o.pluginStatus,Es=o.pluginURL},isParsed(){if(!_t())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return xr.applyArabicShaping!=null&&xr.processBidirectionalText!=null&&xr.processStyledBidirectionalText!=null},getPluginURL(){if(!_t())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Es}};class Li{constructor(n,c){this.zoom=n,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vc,this.transition={})}isSupportedScript(n){return function(c,d){for(const g of c)if(!Nf(g.charCodeAt(0),d))return!1;return!0}(n,xr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,c=n-Math.floor(n),d=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class va{constructor(n,c){this.property=n,this.value=c,this.expression=function(d,g){if(Si(d))return new il(d,g);if(oa(d)){const y=th(d,g);if(y.result==="error")throw new Error(y.value.map(b=>`${b.key}: ${b.message}`).join(", "));return y.value}{let y=d;return g.type==="color"&&typeof d=="string"?y=$.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)||(y=re.parse(d)),{kind:"constant",evaluate:()=>y}}}(c===void 0?n.specification.default:c,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,c,d){return this.property.possiblyEvaluate(this,n,c,d)}}class ll{constructor(n){this.property=n,this.value=new va(n,void 0)}transitioned(n,c){return new xh(this.property,this.value,c,Y({},n.transition,this.transition),n.now)}untransitioned(){return new xh(this.property,this.value,null,{},0)}}class yh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return he(this._values[n].value.value)}setValue(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new ll(this._values[n].property)),this._values[n].value=new va(this._values[n].property,c===null?void 0:he(c))}getTransition(n){return he(this._values[n].transition)}setTransition(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new ll(this._values[n].property)),this._values[n].transition=he(c)||void 0}serialize(){const n={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(n[c]=d);const g=this.getTransition(c);g!==void 0&&(n[`${c}-transition`]=g)}return n}transitioned(n,c){const d=new vh(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(n,c._values[g]);return d}untransitioned(){const n=new vh(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].untransitioned();return n}}class xh{constructor(n,c,d,g,y){this.property=n,this.value=c,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,n.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(n,c,d){const g=n.now||0,y=this.value.possiblyEvaluate(n,c,d),b=this.prior;if(b){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return b.possiblyEvaluate(n,c,d);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(n,c,d),y,function(S){if(S<=0)return 0;if(S>=1)return 1;const L=S*S,D=L*S;return 4*(S<.5?D:3*(S-L)+D-.75)}(E))}}return y}}class vh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,c,d){const g=new ba(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(n,c,d);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Uf{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return he(this._values[n].value)}setValue(n,c){this._values[n]=new va(this._values[n].property,c===null?void 0:he(c))}serialize(){const n={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(n[c]=d)}return n}possiblyEvaluate(n,c,d){const g=new ba(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(n,c,d);return g}}class Wr{constructor(n,c,d){this.property=n,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,c,d,g){return this.property.evaluate(this.value,this.parameters,n,c,d,g)}}class ba{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class xt{constructor(n){this.specification=n}possiblyEvaluate(n,c){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(c)}interpolate(n,c,d){const g=Xi[this.specification.type];return g?g(n,c,d):n}}class Mt{constructor(n,c){this.specification=n,this.overrides=c}possiblyEvaluate(n,c,d,g){return new Wr(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(c,null,{},d,g)}:n.expression,c)}interpolate(n,c,d){if(n.value.kind!=="constant"||c.value.kind!=="constant")return n;if(n.value.value===void 0||c.value.value===void 0)return new Wr(this,{kind:"constant",value:void 0},n.parameters);const g=Xi[this.specification.type];return g?new Wr(this,{kind:"constant",value:g(n.value.value,c.value.value,d)},n.parameters):n}evaluate(n,c,d,g,y,b){return n.kind==="constant"?n.value:n.evaluate(c,d,g,y,b)}}class Mo extends Mt{possiblyEvaluate(n,c,d,g){if(n.value===void 0)return new Wr(this,{kind:"constant",value:void 0},c);if(n.expression.kind==="constant"){const y=n.expression.evaluate(c,null,{},d,g),b=n.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,E=this._calculate(b,b,b,c);return new Wr(this,{kind:"constant",value:E},c)}if(n.expression.kind==="camera"){const y=this._calculate(n.expression.evaluate({zoom:c.zoom-1}),n.expression.evaluate({zoom:c.zoom}),n.expression.evaluate({zoom:c.zoom+1}),c);return new Wr(this,{kind:"constant",value:y},c)}return new Wr(this,n.expression,c)}evaluate(n,c,d,g,y,b){if(n.kind==="source"){const E=n.evaluate(c,d,g,y,b);return this._calculate(E,E,E,c)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(c.zoom)-1},d,g),n.evaluate({zoom:Math.floor(c.zoom)},d,g),n.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):n.value}_calculate(n,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:d,to:c}}interpolate(n){return n}}class Ic{constructor(n){this.specification=n}possiblyEvaluate(n,c,d,g){if(n.value!==void 0){if(n.expression.kind==="constant"){const y=n.expression.evaluate(c,null,{},d,g);return this._calculate(y,y,y,c)}return this._calculate(n.expression.evaluate(new Li(Math.floor(c.zoom-1),c)),n.expression.evaluate(new Li(Math.floor(c.zoom),c)),n.expression.evaluate(new Li(Math.floor(c.zoom+1),c)),c)}}_calculate(n,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:d,to:c}}interpolate(n){return n}}class Ss{constructor(n){this.specification=n}possiblyEvaluate(n,c,d,g){return!!n.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class En{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in n){const d=n[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new va(d,void 0),y=this.defaultTransitionablePropertyValues[c]=new ll(d);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}ut("DataDrivenProperty",Mt),ut("DataConstantProperty",xt),ut("CrossFadedDataDrivenProperty",Mo),ut("CrossFadedProperty",Ic),ut("ColorRampProperty",Ss);const As="-transition";class Hr extends Qt{constructor(n,c){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),c.layout&&(this._unevaluatedLayout=new Uf(c.layout)),c.paint)){this._transitionablePaint=new yh(c.paint);for(const d in n.paint)this.setPaintProperty(d,n.paint[d],{validate:!1});for(const d in n.layout)this.setLayoutProperty(d,n.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ba(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,c,d={}){c!=null&&this._validate(Ff,`layers.${this.id}.layout.${n}`,n,c,d)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,c):this.visibility=c)}getPaintProperty(n){return n.endsWith(As)?this._transitionablePaint.getTransition(n.slice(0,-As.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,c,d={}){if(c!=null&&this._validate(Of,`layers.${this.id}.paint.${n}`,n,c,d))return!1;if(n.endsWith(As))return this._transitionablePaint.setTransition(n.slice(0,-As.length),c||void 0),!1;{const g=this._transitionablePaint._values[n],y=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(n,c),this._handleSpecialPaintPropertyUpdate(n);const S=this._transitionablePaint._values[n].value;return S.isDataDriven()||b||y||this._handleOverridablePaintPropertyUpdate(n,E,S)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,c,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,c){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,c)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),ve(n,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(n,c,d,g,y={}){return(!y||y.validate!==!1)&&ol(this,n.call(_a,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const c=this.paint.get(n);if(c instanceof Wr&&Ai(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const bh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ps{constructor(n,c){this._structArray=n,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,c){return n._trim(),c&&(n.isTransferred=!0,c.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const c=Object.create(this.prototype);return c.arrayBuffer=n.arrayBuffer,c.length=n.length,c.capacity=n.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function tn(o,n=1){let c=0,d=0;return{members:o.map(g=>{const y=bh[g.type].BYTES_PER_ELEMENT,b=c=Cc(c,Math.max(n,y)),E=g.components||1;return d=Math.max(d,y),c+=y*E,{name:g.name,type:g.type,components:E,offset:b}}),size:Cc(c,Math.max(d,n)),alignment:n}}function Cc(o,n){return Math.ceil(o/n)*n}class Xs extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c){const d=this.length;return this.resize(d+1),this.emplace(d,n,c)}emplace(n,c,d){const g=2*n;return this.int16[g+0]=c,this.int16[g+1]=d,n}}Xs.prototype.bytesPerElement=4,ut("StructArrayLayout2i4",Xs);class m extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,n,c,d,g)}emplace(n,c,d,g,y){const b=4*n;return this.int16[b+0]=c,this.int16[b+1]=d,this.int16[b+2]=g,this.int16[b+3]=y,n}}m.prototype.bytesPerElement=8,ut("StructArrayLayout4i8",m);class s extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,c,d,g,y,b)}emplace(n,c,d,g,y,b,E){const S=6*n;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=b,this.int16[S+5]=E,n}}s.prototype.bytesPerElement=12,ut("StructArrayLayout2i4i12",s);class h extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,c,d,g,y,b)}emplace(n,c,d,g,y,b,E){const S=4*n,L=8*n;return this.int16[S+0]=c,this.int16[S+1]=d,this.uint8[L+4]=g,this.uint8[L+5]=y,this.uint8[L+6]=b,this.uint8[L+7]=E,n}}h.prototype.bytesPerElement=8,ut("StructArrayLayout2i4ub8",h);class p extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c){const d=this.length;return this.resize(d+1),this.emplace(d,n,c)}emplace(n,c,d){const g=2*n;return this.float32[g+0]=c,this.float32[g+1]=d,n}}p.prototype.bytesPerElement=8,ut("StructArrayLayout2f8",p);class _ extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b,E,S,L,D){const O=this.length;return this.resize(O+1),this.emplace(O,n,c,d,g,y,b,E,S,L,D)}emplace(n,c,d,g,y,b,E,S,L,D,O){const U=10*n;return this.uint16[U+0]=c,this.uint16[U+1]=d,this.uint16[U+2]=g,this.uint16[U+3]=y,this.uint16[U+4]=b,this.uint16[U+5]=E,this.uint16[U+6]=S,this.uint16[U+7]=L,this.uint16[U+8]=D,this.uint16[U+9]=O,n}}_.prototype.bytesPerElement=20,ut("StructArrayLayout10ui20",_);class v extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b,E,S,L,D,O,U){const W=this.length;return this.resize(W+1),this.emplace(W,n,c,d,g,y,b,E,S,L,D,O,U)}emplace(n,c,d,g,y,b,E,S,L,D,O,U,W){const H=12*n;return this.int16[H+0]=c,this.int16[H+1]=d,this.int16[H+2]=g,this.int16[H+3]=y,this.uint16[H+4]=b,this.uint16[H+5]=E,this.uint16[H+6]=S,this.uint16[H+7]=L,this.int16[H+8]=D,this.int16[H+9]=O,this.int16[H+10]=U,this.int16[H+11]=W,n}}v.prototype.bytesPerElement=24,ut("StructArrayLayout4i4ui4i24",v);class T extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,d)}emplace(n,c,d,g){const y=3*n;return this.float32[y+0]=c,this.float32[y+1]=d,this.float32[y+2]=g,n}}T.prototype.bytesPerElement=12,ut("StructArrayLayout3f12",T);class A extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint32[1*n+0]=c,n}}A.prototype.bytesPerElement=4,ut("StructArrayLayout1ul4",A);class I extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b,E,S,L){const D=this.length;return this.resize(D+1),this.emplace(D,n,c,d,g,y,b,E,S,L)}emplace(n,c,d,g,y,b,E,S,L,D){const O=10*n,U=5*n;return this.int16[O+0]=c,this.int16[O+1]=d,this.int16[O+2]=g,this.int16[O+3]=y,this.int16[O+4]=b,this.int16[O+5]=E,this.uint32[U+3]=S,this.uint16[O+8]=L,this.uint16[O+9]=D,n}}I.prototype.bytesPerElement=20,ut("StructArrayLayout6i1ul2ui20",I);class R extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,c,d,g,y,b)}emplace(n,c,d,g,y,b,E){const S=6*n;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=b,this.int16[S+5]=E,n}}R.prototype.bytesPerElement=12,ut("StructArrayLayout2i2i2i12",R);class z extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,n,c,d,g,y)}emplace(n,c,d,g,y,b){const E=4*n,S=8*n;return this.float32[E+0]=c,this.float32[E+1]=d,this.float32[E+2]=g,this.int16[S+6]=y,this.int16[S+7]=b,n}}z.prototype.bytesPerElement=16,ut("StructArrayLayout2f1f2i16",z);class N extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,n,c,d,g)}emplace(n,c,d,g,y){const b=12*n,E=3*n;return this.uint8[b+0]=c,this.uint8[b+1]=d,this.float32[E+1]=g,this.float32[E+2]=y,n}}N.prototype.bytesPerElement=12,ut("StructArrayLayout2ub2f12",N);class j extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,d)}emplace(n,c,d,g){const y=3*n;return this.uint16[y+0]=c,this.uint16[y+1]=d,this.uint16[y+2]=g,n}}j.prototype.bytesPerElement=6,ut("StructArrayLayout3ui6",j);class ee extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne,ie,ye){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne,ie,ye)}emplace(n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne,ie,ye,Ae){const _e=24*n,Te=12*n,Oe=48*n;return this.int16[_e+0]=c,this.int16[_e+1]=d,this.uint16[_e+2]=g,this.uint16[_e+3]=y,this.uint32[Te+2]=b,this.uint32[Te+3]=E,this.uint32[Te+4]=S,this.uint16[_e+10]=L,this.uint16[_e+11]=D,this.uint16[_e+12]=O,this.float32[Te+7]=U,this.float32[Te+8]=W,this.uint8[Oe+36]=H,this.uint8[Oe+37]=ne,this.uint8[Oe+38]=ie,this.uint32[Te+10]=ye,this.int16[_e+22]=Ae,n}}ee.prototype.bytesPerElement=48,ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ee);class K extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne,ie,ye,Ae,_e,Te,Oe,De,at,mt,it,Je,Ye,nt){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne,ie,ye,Ae,_e,Te,Oe,De,at,mt,it,Je,Ye,nt)}emplace(n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne,ie,ye,Ae,_e,Te,Oe,De,at,mt,it,Je,Ye,nt,Qe){const He=34*n,Pt=17*n;return this.int16[He+0]=c,this.int16[He+1]=d,this.int16[He+2]=g,this.int16[He+3]=y,this.int16[He+4]=b,this.int16[He+5]=E,this.int16[He+6]=S,this.int16[He+7]=L,this.uint16[He+8]=D,this.uint16[He+9]=O,this.uint16[He+10]=U,this.uint16[He+11]=W,this.uint16[He+12]=H,this.uint16[He+13]=ne,this.uint16[He+14]=ie,this.uint16[He+15]=ye,this.uint16[He+16]=Ae,this.uint16[He+17]=_e,this.uint16[He+18]=Te,this.uint16[He+19]=Oe,this.uint16[He+20]=De,this.uint16[He+21]=at,this.uint16[He+22]=mt,this.uint32[Pt+12]=it,this.float32[Pt+13]=Je,this.float32[Pt+14]=Ye,this.float32[Pt+15]=nt,this.float32[Pt+16]=Qe,n}}K.prototype.bytesPerElement=68,ut("StructArrayLayout8i15ui1ul4f68",K);class Q extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.float32[1*n+0]=c,n}}Q.prototype.bytesPerElement=4,ut("StructArrayLayout1f4",Q);class ue extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,d)}emplace(n,c,d,g){const y=3*n;return this.int16[y+0]=c,this.int16[y+1]=d,this.int16[y+2]=g,n}}ue.prototype.bytesPerElement=6,ut("StructArrayLayout3i6",ue);class ge extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,d)}emplace(n,c,d,g){const y=4*n;return this.uint32[2*n+0]=c,this.uint16[y+2]=d,this.uint16[y+3]=g,n}}ge.prototype.bytesPerElement=8,ut("StructArrayLayout1ul2ui8",ge);class xe extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c){const d=this.length;return this.resize(d+1),this.emplace(d,n,c)}emplace(n,c,d){const g=2*n;return this.uint16[g+0]=c,this.uint16[g+1]=d,n}}xe.prototype.bytesPerElement=4,ut("StructArrayLayout2ui4",xe);class te extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint16[1*n+0]=c,n}}te.prototype.bytesPerElement=2,ut("StructArrayLayout1ui2",te);class Se extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,n,c,d,g)}emplace(n,c,d,g,y){const b=4*n;return this.float32[b+0]=c,this.float32[b+1]=d,this.float32[b+2]=g,this.float32[b+3]=y,n}}Se.prototype.bytesPerElement=16,ut("StructArrayLayout4f16",Se);class be extends Ps{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ft(this.anchorPointX,this.anchorPointY)}}be.prototype.size=20;class Le extends I{get(n){return new be(this,n)}}ut("CollisionBoxArray",Le);class ke extends Ps{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ke.prototype.size=48;class Ge extends ee{get(n){return new ke(this,n)}}ut("PlacedSymbolArray",Ge);class Me extends Ps{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Me.prototype.size=68;class st extends K{get(n){return new Me(this,n)}}ut("SymbolInstanceArray",st);class Ke extends Q{getoffsetX(n){return this.float32[1*n+0]}}ut("GlyphOffsetArray",Ke);class ot extends ue{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}ut("SymbolLineVertexArray",ot);class Nt extends Ps{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Nt.prototype.size=8;class Ht extends ge{get(n){return new Nt(this,n)}}ut("FeatureIndexArray",Ht);class At extends Xs{}class pi extends Xs{}class mi extends Xs{}class ii extends s{}class si extends h{}class _i extends p{}class gn extends _{}class qr extends v{}class Mr extends T{}class $r extends A{}class Is extends R{}class vr extends N{}class Wn extends j{}class rs extends xe{}const cl=tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:cn}=cl;class Yt{constructor(n=[]){this.segments=n}prepareSegment(n,c,d,g){let y=this.segments[this.segments.length-1];return n>Yt.MAX_VERTEX_ARRAY_LENGTH&&Fe(`Max vertices per segment is ${Yt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!y||y.vertexLength+n>Yt.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const n of this.segments)for(const c in n.vaos)n.vaos[c].destroy()}static simpleSegment(n,c,d,g){return new Yt([{vertexOffset:n,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function fi(o,n){return 256*(o=C(Math.floor(o),0,255))+C(Math.floor(n),0,255)}Yt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut("SegmentVector",Yt);const _n=tn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var yn={exports:{}},Ri={exports:{}};Ri.exports=function(o,n){var c,d,g,y,b,E,S,L;for(d=o.length-(c=3&o.length),g=n,b=3432918353,E=461845907,L=0;L<d;)S=255&o.charCodeAt(L)|(255&o.charCodeAt(++L))<<8|(255&o.charCodeAt(++L))<<16|(255&o.charCodeAt(++L))<<24,++L,g=27492+(65535&(y=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&o.charCodeAt(L+2))<<16;case 2:S^=(255&o.charCodeAt(L+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&o.charCodeAt(L)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var br={exports:{}};br.exports=function(o,n){for(var c,d=o.length,g=n^d,y=0;d>=4;)c=1540483477*(65535&(c=255&o.charCodeAt(y)|(255&o.charCodeAt(++y))<<8|(255&o.charCodeAt(++y))<<16|(255&o.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:g^=(255&o.charCodeAt(y+2))<<16;case 2:g^=(255&o.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Ys=Ri.exports,Mc=br.exports;yn.exports=Ys,yn.exports.murmur3=Ys,yn.exports.murmur2=Mc;class Lo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,c,d,g){this.ids.push(wh(n)),this.positions.push(c,d,g)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=wh(n);let d=0,g=this.ids.length-1;for(;d<g;){const b=d+g>>1;this.ids[b]>=c?g=b:d=b+1}const y=[];for(;this.ids[d]===c;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(n,c){const d=new Float64Array(n.ids),g=new Uint32Array(n.positions);return Lc(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(n){const c=new Lo;return c.ids=n.ids,c.positions=n.positions,c.indexed=!0,c}}function wh(o){const n=+o;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:yn.exports(String(o))}function Lc(o,n,c,d){for(;c<d;){const g=o[c+d>>1];let y=c-1,b=d+1;for(;;){do y++;while(o[y]<g);do b--;while(o[b]>g);if(y>=b)break;Cs(o,y,b),Cs(n,3*y,3*b),Cs(n,3*y+1,3*b+1),Cs(n,3*y+2,3*b+2)}b-c<d-b?(Lc(o,n,c,b),c=b+1):(Lc(o,n,b+1,d),d=b)}}function Cs(o,n,c){const d=o[n];o[n]=o[c],o[c]=d}ut("FeaturePositionMap",Lo);class Ks{constructor(n,c){this.gl=n.gl,this.location=c}}class Js extends Ks{constructor(n,c){super(n,c),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class ul extends Ks{constructor(n,c){super(n,c),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class d_ extends Ks{constructor(n,c){super(n,c),this.current=$.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const vw=new Float32Array(16);function Vf(o){return[fi(255*o.r,255*o.g),fi(255*o.b,255*o.a)]}class Rc{constructor(n,c,d){this.value=n,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(n,c,d){n.set(d.constantOr(this.value))}getBinding(n,c,d){return this.type==="color"?new d_(n,c):new Js(n,c)}}class hl{constructor(n,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=n.tlbr}setUniform(n,c,d,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&n.set(y)}getBinding(n,c,d){return d.substr(0,9)==="u_pattern"?new ul(n,c):new Js(n,c)}}class Qs{constructor(n,c,d,g){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,c,d,g,y){const b=this.paintVertexArray.length,E=this.expression.evaluate(new Li(0),c,{},g,[],y);this.paintVertexArray.resize(n),this._setPaintValue(b,n,E)}updatePaintArray(n,c,d,g){const y=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(n,c,y)}_setPaintValue(n,c,d){if(this.type==="color"){const g=Vf(d);for(let y=n;y<c;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=n;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ss{constructor(n,c,d,g,y,b){this.expression=n,this.uniformNames=c.map(E=>`u_${E}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=c.map(E=>({name:`a_${E}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(n,c,d,g,y){const b=this.expression.evaluate(new Li(this.zoom),c,{},g,[],y),E=this.expression.evaluate(new Li(this.zoom+1),c,{},g,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(S,n,b,E)}updatePaintArray(n,c,d,g){const y=this.expression.evaluate({zoom:this.zoom},d,g),b=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(n,c,y,b)}_setPaintValue(n,c,d,g){if(this.type==="color"){const y=Vf(d),b=Vf(g);for(let E=n;E<c;E++)this.paintVertexArray.emplace(E,y[0],y[1],b[0],b[1])}else{for(let y=n;y<c;y++)this.paintVertexArray.emplace(y,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=C(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);n.set(g)}getBinding(n,c,d){return new Js(n,c)}}class Ro{constructor(n,c,d,g,y,b){this.expression=n,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(n,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(g,n,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(n,c,d,g,y){this._setPaintValues(n,c,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(n,c,d,g){if(!g||!d)return;const{min:y,mid:b,max:E}=d,S=g[y],L=g[b],D=g[E];if(S&&L&&D)for(let O=n;O<c;O++)this.zoomInPaintVertexArray.emplace(O,L.tl[0],L.tl[1],L.br[0],L.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],L.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,L.tl[0],L.tl[1],L.br[0],L.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],L.pixelRatio,D.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,_n.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,_n.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class f_{constructor(n,c,d){this.binders={},this._buffers=[];const g=[];for(const y in n.paint._values){if(!d(y))continue;const b=n.paint.get(y);if(!(b instanceof Wr&&Ai(b.property.specification)))continue;const E=bw(y,n.type),S=b.value,L=b.property.specification.type,D=b.property.useIntegerZoom,O=b.property.specification["property-type"],U=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=U?new hl(S.value,E):new Rc(S.value,E,L),g.push(`/u_${y}`);else if(S.kind==="source"||U){const W=p_(y,L,"source");this.binders[y]=U?new Ro(S,L,D,c,W,n.id):new Qs(S,E,L,W),g.push(`/a_${y}`)}else{const W=p_(y,L,"composite");this.binders[y]=new ss(S,E,L,D,c,W),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(n){const c=this.binders[n];return c instanceof Qs||c instanceof ss?c.maxValue:0}populatePaintArrays(n,c,d,g,y){for(const b in this.binders){const E=this.binders[b];(E instanceof Qs||E instanceof ss||E instanceof Ro)&&E.populatePaintArray(n,c,d,g,y)}}setConstantPatternPositions(n,c){for(const d in this.binders){const g=this.binders[d];g instanceof hl&&g.setConstantPatternPositions(n,c)}}updatePaintArrays(n,c,d,g,y){let b=!1;for(const E in n){const S=c.getPositions(E);for(const L of S){const D=d.feature(L.index);for(const O in this.binders){const U=this.binders[O];if((U instanceof Qs||U instanceof ss||U instanceof Ro)&&U.expression.isStateDependent===!0){const W=g.paint.get(O);U.expression=W.value,U.updatePaintArray(L.start,L.end,D,n[E],y),b=!0}}}}return b}defines(){const n=[];for(const c in this.binders){const d=this.binders[c];(d instanceof Rc||d instanceof hl)&&n.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Qs||d instanceof ss)for(let g=0;g<d.paintVertexAttributes.length;g++)n.push(d.paintVertexAttributes[g].name);else if(d instanceof Ro)for(let g=0;g<_n.members.length;g++)n.push(_n.members[g].name)}return n}getBinderUniforms(){const n=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Rc||d instanceof hl||d instanceof ss)for(const g of d.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,c){const d=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof Rc||y instanceof hl||y instanceof ss){for(const b of y.uniformNames)if(c[b]){const E=y.getBinding(n,c[b],b);d.push({name:b,property:g,binding:E})}}}return d}setUniforms(n,c,d,g){for(const{name:y,property:b,binding:E}of c)this.binders[b].setUniform(E,g,d.get(b),y)}updatePaintBuffers(n){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(n&&d instanceof Ro){const g=n.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof Qs||d instanceof ss)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(n){for(const c in this.binders){const d=this.binders[c];(d instanceof Qs||d instanceof ss||d instanceof Ro)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const c=this.binders[n];(c instanceof Qs||c instanceof ss||c instanceof Ro)&&c.destroy()}}}class wa{constructor(n,c,d=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new f_(g,c,d);this.needsUpload=!1,this._featureMap=new Lo,this._bufferOffset=0}populatePaintArrays(n,c,d,g,y,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,c,g,y,b);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,c,d,g){for(const y of d)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(n,this._featureMap,c,y,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function bw(o,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}function p_(o,n,c){const d={color:{source:p,composite:Se},number:{source:Q,composite:p}},g=function(y){return{"line-pattern":{source:gn,composite:gn},"fill-pattern":{source:gn,composite:gn},"fill-extrusion-pattern":{source:gn,composite:gn}}[y]}(o);return g&&g[c]||d[n][c]}ut("ConstantBinder",Rc),ut("CrossFadedConstantBinder",hl),ut("SourceExpressionBinder",Qs),ut("CrossFadedCompositeBinder",Ro),ut("CompositeExpressionBinder",ss),ut("ProgramConfiguration",f_,{omit:["_buffers"]}),ut("ProgramConfigurationSet",wa);var un=8192;const jf=Math.pow(2,14)-1,m_=-jf-1;function Ta(o){const n=un/o.extent,c=o.loadGeometry();for(let d=0;d<c.length;d++){const g=c[d];for(let y=0;y<g.length;y++){const b=g[y],E=Math.round(b.x*n),S=Math.round(b.y*n);b.x=C(E,m_,jf),b.y=C(S,m_,jf),(E<b.x||E>b.x+1||S<b.y||S>b.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function Ea(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?Ta(o):[]}}function Th(o,n,c,d,g){o.emplaceBack(2*n+(d+1)/2,2*c+(g+1)/2)}class Gf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new pi,this.indexArray=new Wn,this.segments=new Yt,this.programConfigurations=new wa(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,d){const g=this.layers[0],y=[];let b=null,E=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),E=!b.isConstant());for(const{feature:S,id:L,index:D,sourceLayerIndex:O}of n){const U=this.layers[0]._featureFilter.needGeometry,W=Ea(S,U);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),W,d))continue;const H=E?b.evaluate(W,{},d):void 0,ne={id:L,properties:S.properties,type:S.type,sourceLayerIndex:O,index:D,geometry:U?W.geometry:Ta(S),patterns:{},sortKey:H};y.push(ne)}E&&y.sort((S,L)=>S.sortKey-L.sortKey);for(const S of y){const{geometry:L,index:D,sourceLayerIndex:O}=S,U=n[D].feature;this.addFeature(S,L,D,d),c.featureIndex.insert(U,L,D,O,this.index)}}update(n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,cn),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,c,d,g){for(const y of c)for(const b of y){const E=b.x,S=b.y;if(E<0||E>=un||S<0||S>=un)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),D=L.vertexLength;Th(this.layoutVertexArray,E,S,-1,-1),Th(this.layoutVertexArray,E,S,1,-1),Th(this.layoutVertexArray,E,S,1,1),Th(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},g)}}function g_(o,n){for(let c=0;c<o.length;c++)if(dl(n,o[c]))return!0;for(let c=0;c<n.length;c++)if(dl(o,n[c]))return!0;return!!Wf(o,n)}function ww(o,n,c){return!!dl(o,n)||!!Hf(n,o,c)}function __(o,n){if(o.length===1)return x_(n,o[0]);for(let c=0;c<n.length;c++){const d=n[c];for(let g=0;g<d.length;g++)if(dl(o,d[g]))return!0}for(let c=0;c<o.length;c++)if(x_(n,o[c]))return!0;for(let c=0;c<n.length;c++)if(Wf(o,n[c]))return!0;return!1}function Tw(o,n,c){if(o.length>1){if(Wf(o,n))return!0;for(let d=0;d<n.length;d++)if(Hf(n[d],o,c))return!0}for(let d=0;d<o.length;d++)if(Hf(o[d],n,c))return!0;return!1}function Wf(o,n){if(o.length===0||n.length===0)return!1;for(let c=0;c<o.length-1;c++){const d=o[c],g=o[c+1];for(let y=0;y<n.length-1;y++)if(Ew(d,g,n[y],n[y+1]))return!0}return!1}function Ew(o,n,c,d){return Ze(o,c,d)!==Ze(n,c,d)&&Ze(o,n,c)!==Ze(o,n,d)}function Hf(o,n,c){const d=c*c;if(n.length===1)return o.distSqr(n[0])<d;for(let g=1;g<n.length;g++)if(y_(o,n[g-1],n[g])<d)return!0;return!1}function y_(o,n,c){const d=n.distSqr(c);if(d===0)return o.distSqr(n);const g=((o.x-n.x)*(c.x-n.x)+(o.y-n.y)*(c.y-n.y))/d;return o.distSqr(g<0?n:g>1?c:c.sub(n)._mult(g)._add(n))}function x_(o,n){let c,d,g,y=!1;for(let b=0;b<o.length;b++){c=o[b];for(let E=0,S=c.length-1;E<c.length;S=E++)d=c[E],g=c[S],d.y>n.y!=g.y>n.y&&n.x<(g.x-d.x)*(n.y-d.y)/(g.y-d.y)+d.x&&(y=!y)}return y}function dl(o,n){let c=!1;for(let d=0,g=o.length-1;d<o.length;g=d++){const y=o[d],b=o[g];y.y>n.y!=b.y>n.y&&n.x<(b.x-y.x)*(n.y-y.y)/(b.y-y.y)+y.x&&(c=!c)}return c}function Sw(o,n,c){const d=c[0],g=c[2];if(o.x<d.x&&n.x<d.x||o.x>g.x&&n.x>g.x||o.y<d.y&&n.y<d.y||o.y>g.y&&n.y>g.y)return!1;const y=Ze(o,n,c[0]);return y!==Ze(o,n,c[1])||y!==Ze(o,n,c[2])||y!==Ze(o,n,c[3])}function kc(o,n,c){const d=n.paint.get(o).value;return d.kind==="constant"?d.value:c.programConfigurations.get(n.id).getMaxValue(o)}function Eh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Sh(o,n,c,d,g){if(!n[0]&&!n[1])return o;const y=ft.convert(n)._mult(g);c==="viewport"&&y._rotate(-d);const b=[];for(let E=0;E<o.length;E++)b.push(o[E].sub(y));return b}ut("CircleBucket",Gf,{omit:["layers"]});const Aw=new En({"circle-sort-key":new Mt(we.layout_circle["circle-sort-key"])});var Pw={paint:new En({"circle-radius":new Mt(we.paint_circle["circle-radius"]),"circle-color":new Mt(we.paint_circle["circle-color"]),"circle-blur":new Mt(we.paint_circle["circle-blur"]),"circle-opacity":new Mt(we.paint_circle["circle-opacity"]),"circle-translate":new xt(we.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mt(we.paint_circle["circle-stroke-opacity"])}),layout:Aw},Hn=1e-6,qn=typeof Float32Array<"u"?Float32Array:Array;function v_(){var o=new qn(9);return qn!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function qf(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function b_(o,n,c){var d=n[0],g=n[1],y=n[2],b=n[3],E=n[4],S=n[5],L=n[6],D=n[7],O=n[8],U=n[9],W=n[10],H=n[11],ne=n[12],ie=n[13],ye=n[14],Ae=n[15],_e=c[0],Te=c[1],Oe=c[2],De=c[3];return o[0]=_e*d+Te*E+Oe*O+De*ne,o[1]=_e*g+Te*S+Oe*U+De*ie,o[2]=_e*y+Te*L+Oe*W+De*ye,o[3]=_e*b+Te*D+Oe*H+De*Ae,o[4]=(_e=c[4])*d+(Te=c[5])*E+(Oe=c[6])*O+(De=c[7])*ne,o[5]=_e*g+Te*S+Oe*U+De*ie,o[6]=_e*y+Te*L+Oe*W+De*ye,o[7]=_e*b+Te*D+Oe*H+De*Ae,o[8]=(_e=c[8])*d+(Te=c[9])*E+(Oe=c[10])*O+(De=c[11])*ne,o[9]=_e*g+Te*S+Oe*U+De*ie,o[10]=_e*y+Te*L+Oe*W+De*ye,o[11]=_e*b+Te*D+Oe*H+De*Ae,o[12]=(_e=c[12])*d+(Te=c[13])*E+(Oe=c[14])*O+(De=c[15])*ne,o[13]=_e*g+Te*S+Oe*U+De*ie,o[14]=_e*y+Te*L+Oe*W+De*ye,o[15]=_e*b+Te*D+Oe*H+De*Ae,o}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)});var Dc,Iw=b_;function w_(){var o=new qn(3);return qn!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function T_(o,n,c){var d=new qn(3);return d[0]=o,d[1]=n,d[2]=c,d}function Ah(o,n,c){var d=n[0],g=n[1],y=n[2],b=n[3];return o[0]=c[0]*d+c[4]*g+c[8]*y+c[12]*b,o[1]=c[1]*d+c[5]*g+c[9]*y+c[13]*b,o[2]=c[2]*d+c[6]*g+c[10]*y+c[14]*b,o[3]=c[3]*d+c[7]*g+c[11]*y+c[15]*b,o}function E_(){var o=new qn(4);return qn!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function S_(o,n){const c=Ah([],[o.x,o.y,0,1],n);return new ft(c[0]/c[3],c[1]/c[3])}w_(),Dc=new qn(4),qn!=Float32Array&&(Dc[0]=0,Dc[1]=0,Dc[2]=0,Dc[3]=0),w_(),T_(1,0,0),T_(0,1,0),E_(),E_(),v_(),function(){var o;o=new qn(2),qn!=Float32Array&&(o[0]=0,o[1]=0)}();class A_ extends Gf{}ut("HeatmapBucket",A_,{omit:["layers"]});var Cw={paint:new En({"heatmap-radius":new Mt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ss(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(we.paint_heatmap["heatmap-opacity"])})};function $f(o,{width:n,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*c*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${n*c*d}`)}else g=new Uint8Array(n*c*d);return o.width=n,o.height=c,o.data=g,o}function P_(o,{width:n,height:c},d){if(n===o.width&&c===o.height)return;const g=$f({},{width:n,height:c},d);Zf(o,g,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,n),height:Math.min(o.height,c)},d),o.width=n,o.height=c,o.data=g.data}function Zf(o,n,c,d,g,y){if(g.width===0||g.height===0)return n;if(g.width>o.width||g.height>o.height||c.x>o.width-g.width||c.y>o.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||d.x>n.width-g.width||d.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=o.data,E=n.data;if(b===E)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<g.height;S++){const L=((c.y+S)*o.width+c.x)*y,D=((d.y+S)*n.width+d.x)*y;for(let O=0;O<g.width*y;O++)E[D+O]=b[L+O]}return n}class zc{constructor(n,c){$f(this,n,1,c)}resize(n){P_(this,n,1)}clone(){return new zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,d,g,y){Zf(n,c,d,g,y,1)}}class Lr{constructor(n,c){$f(this,n,4,c)}resize(n){P_(this,n,4)}replace(n,c){c?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Lr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,d,g,y){Zf(n,c,d,g,y,4)}}function I_(o){const n={},c=o.resolution||256,d=o.clips?o.clips.length:1,g=o.image||new Lr({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const y=(b,E,S)=>{n[o.evaluationKey]=S;const L=o.expression.evaluate(n);g.data[b+E+0]=Math.floor(255*L.r/L.a),g.data[b+E+1]=Math.floor(255*L.g/L.a),g.data[b+E+2]=Math.floor(255*L.b/L.a),g.data[b+E+3]=Math.floor(255*L.a)};if(o.clips)for(let b=0,E=0;b<d;++b,E+=4*c)for(let S=0,L=0;S<c;S++,L+=4){const D=S/(c-1),{start:O,end:U}=o.clips[b];y(E,L,O*(1-D)+U*D)}else for(let b=0,E=0;b<c;b++,E+=4)y(0,E,b/(c-1));return g}ut("AlphaImage",zc),ut("RGBAImage",Lr);var Mw={paint:new En({"hillshade-illumination-direction":new xt(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xt(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(we.paint_hillshade["hillshade-accent-color"])})};const Lw=tn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rw}=Lw;var Ph={exports:{}};function Ih(o,n,c){c=c||2;var d,g,y,b,E,S,L,D=n&&n.length,O=D?n[0]*c:o.length,U=C_(o,0,O,c,!0),W=[];if(!U||U.next===U.prev)return W;if(D&&(U=function(ne,ie,ye,Ae){var _e,Te,Oe,De=[];for(_e=0,Te=ie.length;_e<Te;_e++)(Oe=C_(ne,ie[_e]*Ae,_e<Te-1?ie[_e+1]*Ae:ne.length,Ae,!1))===Oe.next&&(Oe.steiner=!0),De.push(Uw(Oe));for(De.sort(Fw),_e=0;_e<De.length;_e++)ye=Bw(De[_e],ye);return ye}(o,n,U,c)),o.length>80*c){d=y=o[0],g=b=o[1];for(var H=c;H<O;H+=c)(E=o[H])<d&&(d=E),(S=o[H+1])<g&&(g=S),E>y&&(y=E),S>b&&(b=S);L=(L=Math.max(y-d,b-g))!==0?32767/L:0}return Oc(U,W,c,d,g,L,0),W}function C_(o,n,c,d,g){var y,b;if(g===Kf(o,n,c,d)>0)for(y=n;y<c;y+=d)b=R_(y,o[y],o[y+1],b);else for(y=c-d;y>=n;y-=d)b=R_(y,o[y],o[y+1],b);return b&&Ch(b,b.next)&&(Bc(b),b=b.next),b}function Sa(o,n){if(!o)return o;n||(n=o);var c,d=o;do if(c=!1,d.steiner||!Ch(d,d.next)&&Yi(d.prev,d,d.next)!==0)d=d.next;else{if(Bc(d),(d=n=d.prev)===d.next)break;c=!0}while(c||d!==n);return n}function Oc(o,n,c,d,g,y,b){if(o){!b&&y&&function(D,O,U,W){var H=D;do H.z===0&&(H.z=Xf(H.x,H.y,O,U,W)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==D);H.prevZ.nextZ=null,H.prevZ=null,function(ne){var ie,ye,Ae,_e,Te,Oe,De,at,mt=1;do{for(ye=ne,ne=null,Te=null,Oe=0;ye;){for(Oe++,Ae=ye,De=0,ie=0;ie<mt&&(De++,Ae=Ae.nextZ);ie++);for(at=mt;De>0||at>0&&Ae;)De!==0&&(at===0||!Ae||ye.z<=Ae.z)?(_e=ye,ye=ye.nextZ,De--):(_e=Ae,Ae=Ae.nextZ,at--),Te?Te.nextZ=_e:ne=_e,_e.prevZ=Te,Te=_e;ye=Ae}Te.nextZ=null,mt*=2}while(Oe>1)}(H)}(o,d,g,y);for(var E,S,L=o;o.prev!==o.next;)if(E=o.prev,S=o.next,y?Dw(o,d,g,y):kw(o))n.push(E.i/c|0),n.push(o.i/c|0),n.push(S.i/c|0),Bc(o),o=S.next,L=S.next;else if((o=S)===L){b?b===1?Oc(o=zw(Sa(o),n,c),n,c,d,g,y,2):b===2&&Ow(o,n,c,d,g,y):Oc(Sa(o),n,c,d,g,y,1);break}}}function kw(o){var n=o.prev,c=o,d=o.next;if(Yi(n,c,d)>=0)return!1;for(var g=n.x,y=c.x,b=d.x,E=n.y,S=c.y,L=d.y,D=g<y?g<b?g:b:y<b?y:b,O=E<S?E<L?E:L:S<L?S:L,U=g>y?g>b?g:b:y>b?y:b,W=E>S?E>L?E:L:S>L?S:L,H=d.next;H!==n;){if(H.x>=D&&H.x<=U&&H.y>=O&&H.y<=W&&fl(g,E,y,S,b,L,H.x,H.y)&&Yi(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Dw(o,n,c,d){var g=o.prev,y=o,b=o.next;if(Yi(g,y,b)>=0)return!1;for(var E=g.x,S=y.x,L=b.x,D=g.y,O=y.y,U=b.y,W=E<S?E<L?E:L:S<L?S:L,H=D<O?D<U?D:U:O<U?O:U,ne=E>S?E>L?E:L:S>L?S:L,ie=D>O?D>U?D:U:O>U?O:U,ye=Xf(W,H,n,c,d),Ae=Xf(ne,ie,n,c,d),_e=o.prevZ,Te=o.nextZ;_e&&_e.z>=ye&&Te&&Te.z<=Ae;){if(_e.x>=W&&_e.x<=ne&&_e.y>=H&&_e.y<=ie&&_e!==g&&_e!==b&&fl(E,D,S,O,L,U,_e.x,_e.y)&&Yi(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Te.x>=W&&Te.x<=ne&&Te.y>=H&&Te.y<=ie&&Te!==g&&Te!==b&&fl(E,D,S,O,L,U,Te.x,Te.y)&&Yi(Te.prev,Te,Te.next)>=0))return!1;Te=Te.nextZ}for(;_e&&_e.z>=ye;){if(_e.x>=W&&_e.x<=ne&&_e.y>=H&&_e.y<=ie&&_e!==g&&_e!==b&&fl(E,D,S,O,L,U,_e.x,_e.y)&&Yi(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Te&&Te.z<=Ae;){if(Te.x>=W&&Te.x<=ne&&Te.y>=H&&Te.y<=ie&&Te!==g&&Te!==b&&fl(E,D,S,O,L,U,Te.x,Te.y)&&Yi(Te.prev,Te,Te.next)>=0)return!1;Te=Te.nextZ}return!0}function zw(o,n,c){var d=o;do{var g=d.prev,y=d.next.next;!Ch(g,y)&&M_(g,d,d.next,y)&&Fc(g,y)&&Fc(y,g)&&(n.push(g.i/c|0),n.push(d.i/c|0),n.push(y.i/c|0),Bc(d),Bc(d.next),d=o=y),d=d.next}while(d!==o);return Sa(d)}function Ow(o,n,c,d,g,y){var b=o;do{for(var E=b.next.next;E!==b.prev;){if(b.i!==E.i&&Vw(b,E)){var S=L_(b,E);return b=Sa(b,b.next),S=Sa(S,S.next),Oc(b,n,c,d,g,y,0),void Oc(S,n,c,d,g,y,0)}E=E.next}b=b.next}while(b!==o)}function Fw(o,n){return o.x-n.x}function Bw(o,n){var c=function(g,y){var b,E=y,S=g.x,L=g.y,D=-1/0;do{if(L<=E.y&&L>=E.next.y&&E.next.y!==E.y){var O=E.x+(L-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(O<=S&&O>D&&(D=O,b=E.x<E.next.x?E:E.next,O===S))return b}E=E.next}while(E!==y);if(!b)return null;var U,W=b,H=b.x,ne=b.y,ie=1/0;E=b;do S>=E.x&&E.x>=H&&S!==E.x&&fl(L<ne?S:D,L,H,ne,L<ne?D:S,L,E.x,E.y)&&(U=Math.abs(L-E.y)/(S-E.x),Fc(E,g)&&(U<ie||U===ie&&(E.x>b.x||E.x===b.x&&Nw(b,E)))&&(b=E,ie=U)),E=E.next;while(E!==W);return b}(o,n);if(!c)return n;var d=L_(c,o);return Sa(d,d.next),Sa(c,c.next)}function Nw(o,n){return Yi(o.prev,o,n.prev)<0&&Yi(n.next,o,o.next)<0}function Xf(o,n,c,d,g){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-c)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Uw(o){var n=o,c=o;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==o);return c}function fl(o,n,c,d,g,y,b,E){return(g-b)*(n-E)>=(o-b)*(y-E)&&(o-b)*(d-E)>=(c-b)*(n-E)&&(c-b)*(y-E)>=(g-b)*(d-E)}function Vw(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&M_(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(o,n)&&(Fc(o,n)&&Fc(n,o)&&function(c,d){var g=c,y=!1,b=(c.x+d.x)/2,E=(c.y+d.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&b<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==c);return y}(o,n)&&(Yi(o.prev,o,n.prev)||Yi(o,n.prev,n))||Ch(o,n)&&Yi(o.prev,o,o.next)>0&&Yi(n.prev,n,n.next)>0)}function Yi(o,n,c){return(n.y-o.y)*(c.x-n.x)-(n.x-o.x)*(c.y-n.y)}function Ch(o,n){return o.x===n.x&&o.y===n.y}function M_(o,n,c,d){var g=Lh(Yi(o,n,c)),y=Lh(Yi(o,n,d)),b=Lh(Yi(c,d,o)),E=Lh(Yi(c,d,n));return g!==y&&b!==E||!(g!==0||!Mh(o,c,n))||!(y!==0||!Mh(o,d,n))||!(b!==0||!Mh(c,o,d))||!(E!==0||!Mh(c,n,d))}function Mh(o,n,c){return n.x<=Math.max(o.x,c.x)&&n.x>=Math.min(o.x,c.x)&&n.y<=Math.max(o.y,c.y)&&n.y>=Math.min(o.y,c.y)}function Lh(o){return o>0?1:o<0?-1:0}function Fc(o,n){return Yi(o.prev,o,o.next)<0?Yi(o,n,o.next)>=0&&Yi(o,o.prev,n)>=0:Yi(o,n,o.prev)<0||Yi(o,o.next,n)<0}function L_(o,n){var c=new Yf(o.i,o.x,o.y),d=new Yf(n.i,n.x,n.y),g=o.next,y=n.prev;return o.next=n,n.prev=o,c.next=g,g.prev=c,d.next=c,c.prev=d,y.next=d,d.prev=y,d}function R_(o,n,c,d){var g=new Yf(o,n,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Bc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Yf(o,n,c){this.i=o,this.x=n,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kf(o,n,c,d){for(var g=0,y=n,b=c-d;y<c;y+=d)g+=(o[b]-o[y])*(o[y+1]+o[b+1]),b=y;return g}function jw(o,n,c,d,g){k_(o,n,c||0,d||o.length-1,g||Gw)}function k_(o,n,c,d,g){for(;d>c;){if(d-c>600){var y=d-c+1,b=n-c+1,E=Math.log(y),S=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*S*(y-S)/y)*(b-y/2<0?-1:1);k_(o,n,Math.max(c,Math.floor(n-b*S/y+L)),Math.min(d,Math.floor(n+(y-b)*S/y+L)),g)}var D=o[n],O=c,U=d;for(Nc(o,c,n),g(o[d],D)>0&&Nc(o,c,d);O<U;){for(Nc(o,O,U),O++,U--;g(o[O],D)<0;)O++;for(;g(o[U],D)>0;)U--}g(o[c],D)===0?Nc(o,c,U):Nc(o,++U,d),U<=n&&(c=U+1),n<=U&&(d=U-1)}}function Nc(o,n,c){var d=o[n];o[n]=o[c],o[c]=d}function Gw(o,n){return o<n?-1:o>n?1:0}function Jf(o,n){const c=o.length;if(c<=1)return[o];const d=[];let g,y;for(let b=0;b<c;b++){const E=ht(o[b]);E!==0&&(o[b].area=Math.abs(E),y===void 0&&(y=E<0),y===E<0?(g&&d.push(g),g=[o[b]]):g.push(o[b]))}if(g&&d.push(g),n>1)for(let b=0;b<d.length;b++)d[b].length<=n||(jw(d[b],n,1,d[b].length-1,Ww),d[b]=d[b].slice(0,n));return d}function Ww(o,n){return n.area-o.area}function Qf(o,n,c){const d=c.patternDependencies;let g=!1;for(const y of n){const b=y.paint.get(`${o}-pattern`);b.isConstant()||(g=!0);const E=b.constantOr(null);E&&(g=!0,d[E.to]=!0,d[E.from]=!0)}return g}function ep(o,n,c,d,g){const y=g.patternDependencies;for(const b of n){const E=b.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let S=E.evaluate({zoom:d-1},c,{},g.availableImages),L=E.evaluate({zoom:d},c,{},g.availableImages),D=E.evaluate({zoom:d+1},c,{},g.availableImages);S=S&&S.name?S.name:S,L=L&&L.name?L.name:L,D=D&&D.name?D.name:D,y[S]=!0,y[L]=!0,y[D]=!0,c.patterns[b.id]={min:S,mid:L,max:D}}}return c}Ph.exports=Ih,Ph.exports.default=Ih,Ih.deviation=function(o,n,c,d){var g=n&&n.length,y=Math.abs(Kf(o,0,g?n[0]*c:o.length,c));if(g)for(var b=0,E=n.length;b<E;b++)y-=Math.abs(Kf(o,n[b]*c,b<E-1?n[b+1]*c:o.length,c));var S=0;for(b=0;b<d.length;b+=3){var L=d[b]*c,D=d[b+1]*c,O=d[b+2]*c;S+=Math.abs((o[L]-o[O])*(o[D+1]-o[L+1])-(o[L]-o[D])*(o[O+1]-o[L+1]))}return y===0&&S===0?0:Math.abs((S-y)/y)},Ih.flatten=function(o){for(var n=o[0][0].length,c={vertices:[],holes:[],dimensions:n},d=0,g=0;g<o.length;g++){for(var y=0;y<o[g].length;y++)for(var b=0;b<n;b++)c.vertices.push(o[g][y][b]);g>0&&c.holes.push(d+=o[g-1].length)}return c};class tp{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mi,this.indexArray=new Wn,this.indexArray2=new rs,this.programConfigurations=new wa(n.layers,n.zoom),this.segments=new Yt,this.segments2=new Yt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,d){this.hasPattern=Qf("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),b=[];for(const{feature:E,id:S,index:L,sourceLayerIndex:D}of n){const O=this.layers[0]._featureFilter.needGeometry,U=Ea(E,O);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),U,d))continue;const W=y?g.evaluate(U,{},d,c.availableImages):void 0,H={id:S,properties:E.properties,type:E.type,sourceLayerIndex:D,index:L,geometry:O?U.geometry:Ta(E),patterns:{},sortKey:W};b.push(H)}y&&b.sort((E,S)=>E.sortKey-S.sortKey);for(const E of b){const{geometry:S,index:L,sourceLayerIndex:D}=E;if(this.hasPattern){const O=ep("fill",this.layers,E,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(E,S,L,d,{});c.featureIndex.insert(n[L].feature,S,L,D,this.index)}}update(n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,d)}addFeatures(n,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Rw),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,c,d,g,y){for(const b of Jf(c,500)){let E=0;for(const W of b)E+=W.length;const S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),L=S.vertexLength,D=[],O=[];for(const W of b){if(W.length===0)continue;W!==b[0]&&O.push(D.length/2);const H=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),ne=H.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(ne+W.length-1,ne),D.push(W[0].x),D.push(W[0].y);for(let ie=1;ie<W.length;ie++)this.layoutVertexArray.emplaceBack(W[ie].x,W[ie].y),this.indexArray2.emplaceBack(ne+ie-1,ne+ie),D.push(W[ie].x),D.push(W[ie].y);H.vertexLength+=W.length,H.primitiveLength+=W.length}const U=Ph.exports(D,O);for(let W=0;W<U.length;W+=3)this.indexArray.emplaceBack(L+U[W],L+U[W+1],L+U[W+2]);S.vertexLength+=E,S.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,g)}}ut("FillBucket",tp,{omit:["layers","patternFeatures"]});const Hw=new En({"fill-sort-key":new Mt(we.layout_fill["fill-sort-key"])});var qw={paint:new En({"fill-antialias":new xt(we.paint_fill["fill-antialias"]),"fill-opacity":new Mt(we.paint_fill["fill-opacity"]),"fill-color":new Mt(we.paint_fill["fill-color"]),"fill-outline-color":new Mt(we.paint_fill["fill-outline-color"]),"fill-translate":new xt(we.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mo(we.paint_fill["fill-pattern"])}),layout:Hw};const $w=tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Zw=tn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Xw}=$w;var ko={},Yw=ft,D_=pl;function pl(o,n,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=o,this._geometry=-1,this._keys=d,this._values=g,o.readFields(Kw,this,n)}function Kw(o,n,c){o==1?n.id=c.readVarint():o==2?function(d,g){for(var y=d.readVarint()+d.pos;d.pos<y;){var b=g._keys[d.readVarint()],E=g._values[d.readVarint()];g.properties[b]=E}}(c,n):o==3?n.type=c.readVarint():o==4&&(n._geometry=c.pos)}function Jw(o){for(var n,c,d=0,g=0,y=o.length,b=y-1;g<y;b=g++)d+=((c=o[b]).x-(n=o[g]).x)*(n.y+c.y);return d}pl.types=["Unknown","Point","LineString","Polygon"],pl.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var n,c=o.readVarint()+o.pos,d=1,g=0,y=0,b=0,E=[];o.pos<c;){if(g<=0){var S=o.readVarint();d=7&S,g=S>>3}if(g--,d===1||d===2)y+=o.readSVarint(),b+=o.readSVarint(),d===1&&(n&&E.push(n),n=[]),n.push(new Yw(y,b));else{if(d!==7)throw new Error("unknown command "+d);n&&n.push(n[0].clone())}}return n&&E.push(n),E},pl.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var n=o.readVarint()+o.pos,c=1,d=0,g=0,y=0,b=1/0,E=-1/0,S=1/0,L=-1/0;o.pos<n;){if(d<=0){var D=o.readVarint();c=7&D,d=D>>3}if(d--,c===1||c===2)(g+=o.readSVarint())<b&&(b=g),g>E&&(E=g),(y+=o.readSVarint())<S&&(S=y),y>L&&(L=y);else if(c!==7)throw new Error("unknown command "+c)}return[b,S,E,L]},pl.prototype.toGeoJSON=function(o,n,c){var d,g,y=this.extent*Math.pow(2,c),b=this.extent*o,E=this.extent*n,S=this.loadGeometry(),L=pl.types[this.type];function D(W){for(var H=0;H<W.length;H++){var ne=W[H];W[H]=[360*(ne.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+E)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(d=0;d<S.length;d++)O[d]=S[d][0];D(S=O);break;case 2:for(d=0;d<S.length;d++)D(S[d]);break;case 3:for(S=function(W){var H=W.length;if(H<=1)return[W];for(var ne,ie,ye=[],Ae=0;Ae<H;Ae++){var _e=Jw(W[Ae]);_e!==0&&(ie===void 0&&(ie=_e<0),ie===_e<0?(ne&&ye.push(ne),ne=[W[Ae]]):ne.push(W[Ae]))}return ne&&ye.push(ne),ye}(S),d=0;d<S.length;d++)for(g=0;g<S[d].length;g++)D(S[d][g])}S.length===1?S=S[0]:L="Multi"+L;var U={type:"Feature",geometry:{type:L,coordinates:S},properties:this.properties};return"id"in this&&(U.id=this.id),U};var Qw=D_,z_=O_;function O_(o,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(eT,this,n),this.length=this._features.length}function eT(o,n,c){o===15?n.version=c.readVarint():o===1?n.name=c.readString():o===5?n.extent=c.readVarint():o===2?n._features.push(c.pos):o===3?n._keys.push(c.readString()):o===4&&n._values.push(function(d){for(var g=null,y=d.readVarint()+d.pos;d.pos<y;){var b=d.readVarint()>>3;g=b===1?d.readString():b===2?d.readFloat():b===3?d.readDouble():b===4?d.readVarint64():b===5?d.readVarint():b===6?d.readSVarint():b===7?d.readBoolean():null}return g}(c))}O_.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var n=this._pbf.readVarint()+this._pbf.pos;return new Qw(this._pbf,n,this.extent,this._keys,this._values)};var tT=z_;function iT(o,n,c){if(o===3){var d=new tT(c,c.readVarint()+c.pos);d.length&&(n[d.name]=d)}}ko.VectorTile=function(o,n){this.layers=o.readFields(iT,{},n)},ko.VectorTileFeature=D_,ko.VectorTileLayer=z_;const nT=ko.VectorTileFeature.types,ip=Math.pow(2,13);function Uc(o,n,c,d,g,y,b,E){o.emplaceBack(n,c,2*Math.floor(d*ip)+b,g*ip*2,y*ip*2,Math.round(E))}class np{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ii,this.centroidVertexArray=new At,this.indexArray=new Wn,this.programConfigurations=new wa(n.layers,n.zoom),this.segments=new Yt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,d){this.features=[],this.hasPattern=Qf("fill-extrusion",this.layers,c);for(const{feature:g,id:y,index:b,sourceLayerIndex:E}of n){const S=this.layers[0]._featureFilter.needGeometry,L=Ea(g,S);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),L,d))continue;const D={id:y,sourceLayerIndex:E,index:b,geometry:S?L.geometry:Ta(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(ep("fill-extrusion",this.layers,D,this.zoom,c)):this.addFeature(D,D.geometry,b,d,{}),c.featureIndex.insert(g,D.geometry,b,E,this.index,!0)}}addFeatures(n,c,d){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,c,d)}}update(n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Xw),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,Zw.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,c,d,g,y){const b={x:0,y:0,vertexCount:0};for(const E of Jf(c,500)){let S=0;for(const H of E)S+=H.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of E){if(H.length===0||sT(H))continue;let ne=0;for(let ie=0;ie<H.length;ie++){const ye=H[ie];if(ie>=1){const Ae=H[ie-1];if(!rT(ye,Ae)){L.vertexLength+4>Yt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _e=ye.sub(Ae)._perp()._unit(),Te=Ae.dist(ye);ne+Te>32768&&(ne=0),Uc(this.layoutVertexArray,ye.x,ye.y,_e.x,_e.y,0,0,ne),Uc(this.layoutVertexArray,ye.x,ye.y,_e.x,_e.y,0,1,ne),b.x+=2*ye.x,b.y+=2*ye.y,b.vertexCount+=2,ne+=Te,Uc(this.layoutVertexArray,Ae.x,Ae.y,_e.x,_e.y,0,0,ne),Uc(this.layoutVertexArray,Ae.x,Ae.y,_e.x,_e.y,0,1,ne),b.x+=2*Ae.x,b.y+=2*Ae.y,b.vertexCount+=2;const Oe=L.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+S>Yt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),nT[n.type]!=="Polygon")continue;const D=[],O=[],U=L.vertexLength;for(const H of E)if(H.length!==0){H!==E[0]&&O.push(D.length/2);for(let ne=0;ne<H.length;ne++){const ie=H[ne];Uc(this.layoutVertexArray,ie.x,ie.y,0,0,1,1,0),b.x+=ie.x,b.y+=ie.y,b.vertexCount+=1,D.push(ie.x),D.push(ie.y)}}const W=Ph.exports(D,O);for(let H=0;H<W.length;H+=3)this.indexArray.emplaceBack(U+W[H],U+W[H+2],U+W[H+1]);L.primitiveLength+=W.length/3,L.vertexLength+=S}for(let E=0;E<b.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,g)}}function rT(o,n){return o.x===n.x&&(o.x<0||o.x>un)||o.y===n.y&&(o.y<0||o.y>un)}function sT(o){return o.every(n=>n.x<0)||o.every(n=>n.x>un)||o.every(n=>n.y<0)||o.every(n=>n.y>un)}ut("FillExtrusionBucket",np,{omit:["layers","features"]});var oT={paint:new En({"fill-extrusion-opacity":new xt(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mo(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xt(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Vc(o,n){return o.x*n.x+o.y*n.y}function F_(o,n){if(o.length===1){let c=0;const d=n[c++];let g;for(;!g||d.equals(g);)if(g=n[c++],!g)return 1/0;for(;c<n.length;c++){const y=n[c],b=o[0],E=g.sub(d),S=y.sub(d),L=b.sub(d),D=Vc(E,E),O=Vc(E,S),U=Vc(S,S),W=Vc(L,E),H=Vc(L,S),ne=D*U-O*O,ie=(U*W-O*H)/ne,ye=(D*H-O*W)/ne,Ae=d.z*(1-ie-ye)+g.z*ie+y.z*ye;if(isFinite(Ae))return Ae}return 1/0}{let c=1/0;for(const d of n)c=Math.min(c,d.z);return c}}const aT=tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:lT}=aT,cT=tn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:uT}=cT,hT=ko.VectorTileFeature.types,dT=Math.cos(Math.PI/180*37.5),B_=Math.pow(2,14)/.5;class rp{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new si,this.layoutVertexArray2=new _i,this.indexArray=new Wn,this.programConfigurations=new wa(n.layers,n.zoom),this.segments=new Yt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,d){this.hasPattern=Qf("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),b=[];for(const{feature:E,id:S,index:L,sourceLayerIndex:D}of n){const O=this.layers[0]._featureFilter.needGeometry,U=Ea(E,O);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),U,d))continue;const W=y?g.evaluate(U,{},d):void 0,H={id:S,properties:E.properties,type:E.type,sourceLayerIndex:D,index:L,geometry:O?U.geometry:Ta(E),patterns:{},sortKey:W};b.push(H)}y&&b.sort((E,S)=>E.sortKey-S.sortKey);for(const E of b){const{geometry:S,index:L,sourceLayerIndex:D}=E;if(this.hasPattern){const O=ep("line",this.layers,E,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(E,S,L,d,{});c.featureIndex.insert(n[L].feature,S,L,D,this.index)}}update(n,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,d)}addFeatures(n,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,uT)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,lT),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,c,d,g,y){const b=this.layers[0].layout,E=b.get("line-join").evaluate(n,{}),S=b.get("line-cap"),L=b.get("line-miter-limit"),D=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const O of c)this.addLine(O,n,E,S,L,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,g)}addLine(n,c,d,g,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<n.length-1;ye++)this.totalDistance+=n[ye].dist(n[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=hT[c.type]==="Polygon";let S=n.length;for(;S>=2&&n[S-1].equals(n[S-2]);)S--;let L=0;for(;L<S-1&&n[L].equals(n[L+1]);)L++;if(S<(E?3:2))return;d==="bevel"&&(y=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let U,W,H,ne,ie;this.e1=this.e2=-1,E&&(U=n[S-2],ie=n[L].sub(U)._unit()._perp());for(let ye=L;ye<S;ye++){if(H=ye===S-1?E?n[L+1]:void 0:n[ye+1],H&&n[ye].equals(H))continue;ie&&(ne=ie),U&&(W=U),U=n[ye],ie=H?H.sub(U)._unit()._perp():ne,ne=ne||ie;let Ae=ne.add(ie);Ae.x===0&&Ae.y===0||Ae._unit();const _e=ne.x*ie.x+ne.y*ie.y,Te=Ae.x*ie.x+Ae.y*ie.y,Oe=Te!==0?1/Te:1/0,De=2*Math.sqrt(2-2*Te),at=Te<dT&&W&&H,mt=ne.x*ie.y-ne.y*ie.x>0;if(at&&ye>L){const Ye=U.dist(W);if(Ye>2*D){const nt=U.sub(U.sub(W)._mult(D/Ye)._round());this.updateDistance(W,nt),this.addCurrentVertex(nt,ne,0,0,O),W=nt}}const it=W&&H;let Je=it?d:E?"butt":g;if(it&&Je==="round"&&(Oe<b?Je="miter":Oe<=2&&(Je="fakeround")),Je==="miter"&&Oe>y&&(Je="bevel"),Je==="bevel"&&(Oe>2&&(Je="flipbevel"),Oe<y&&(Je="miter")),W&&this.updateDistance(W,U),Je==="miter")Ae._mult(Oe),this.addCurrentVertex(U,Ae,0,0,O);else if(Je==="flipbevel"){if(Oe>100)Ae=ie.mult(-1);else{const Ye=Oe*ne.add(ie).mag()/ne.sub(ie).mag();Ae._perp()._mult(Ye*(mt?-1:1))}this.addCurrentVertex(U,Ae,0,0,O),this.addCurrentVertex(U,Ae.mult(-1),0,0,O)}else if(Je==="bevel"||Je==="fakeround"){const Ye=-Math.sqrt(Oe*Oe-1),nt=mt?Ye:0,Qe=mt?0:Ye;if(W&&this.addCurrentVertex(U,ne,nt,Qe,O),Je==="fakeround"){const He=Math.round(180*De/Math.PI/20);for(let Pt=1;Pt<He;Pt++){let bt=Pt/He;if(bt!==.5){const Pi=bt-.5;bt+=bt*Pi*(bt-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*Pi*Pi+(.848013+_e*(.215638*_e-1.06021)))}const qt=ie.sub(ne)._mult(bt)._add(ne)._unit()._mult(mt?-1:1);this.addHalfVertex(U,qt.x,qt.y,!1,mt,0,O)}}H&&this.addCurrentVertex(U,ie,-nt,-Qe,O)}else if(Je==="butt")this.addCurrentVertex(U,Ae,0,0,O);else if(Je==="square"){const Ye=W?1:-1;this.addCurrentVertex(U,Ae,Ye,Ye,O)}else Je==="round"&&(W&&(this.addCurrentVertex(U,ne,0,0,O),this.addCurrentVertex(U,ne,1,1,O,!0)),H&&(this.addCurrentVertex(U,ie,-1,-1,O,!0),this.addCurrentVertex(U,ie,0,0,O)));if(at&&ye<S-1){const Ye=U.dist(H);if(Ye>2*D){const nt=U.add(H.sub(U)._mult(D/Ye)._round());this.updateDistance(U,nt),this.addCurrentVertex(nt,ie,0,0,O),U=nt}}}}addCurrentVertex(n,c,d,g,y,b=!1){const E=c.y*g-c.x,S=-c.y-c.x*g;this.addHalfVertex(n,c.x+c.y*d,c.y-c.x*d,b,!1,d,y),this.addHalfVertex(n,E,S,b,!0,-g,y),this.distance>B_/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,c,d,g,y,b))}addHalfVertex({x:n,y:c},d,g,y,b,E,S){const L=.5*(this.lineClips?this.scaledDistance*(B_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(y?1:0),(c<<1)+(b?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),b?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,c){this.distance+=n.dist(c),this.updateScaledDistance()}}ut("LineBucket",rp,{omit:["layers","patternFeatures"]});const fT=new En({"line-cap":new xt(we.layout_line["line-cap"]),"line-join":new Mt(we.layout_line["line-join"]),"line-miter-limit":new xt(we.layout_line["line-miter-limit"]),"line-round-limit":new xt(we.layout_line["line-round-limit"]),"line-sort-key":new Mt(we.layout_line["line-sort-key"])});var N_={paint:new En({"line-opacity":new Mt(we.paint_line["line-opacity"]),"line-color":new Mt(we.paint_line["line-color"]),"line-translate":new xt(we.paint_line["line-translate"]),"line-translate-anchor":new xt(we.paint_line["line-translate-anchor"]),"line-width":new Mt(we.paint_line["line-width"]),"line-gap-width":new Mt(we.paint_line["line-gap-width"]),"line-offset":new Mt(we.paint_line["line-offset"]),"line-blur":new Mt(we.paint_line["line-blur"]),"line-dasharray":new Ic(we.paint_line["line-dasharray"]),"line-pattern":new Mo(we.paint_line["line-pattern"]),"line-gradient":new Ss(we.paint_line["line-gradient"])}),layout:fT};const U_=new class extends Mt{possiblyEvaluate(o,n){return n=new Li(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(o,n)}evaluate(o,n,c,d){return n=Y({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(o,n,c,d)}}(N_.paint.properties["line-width"].specification);function V_(o,n){return n>0?n+2*o:o}U_.useIntegerZoom=!0;const pT=tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mT=tn([{name:"a_projected_pos",components:3,type:"Float32"}],4);tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gT=tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);tn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const j_=tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_T=tn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function yT(o,n,c){return o.sections.forEach(d=>{d.text=function(g,y,b){const E=y.layout.get("text-transform").evaluate(b,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),xr.applyArabicShaping&&(g=xr.applyArabicShaping(g)),g}(d.text,n,c)}),o}tn([{name:"triangle",components:3,type:"Uint16"}]),tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),tn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),tn([{type:"Float32",name:"offsetX"}]),tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const jc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Sn=24,sp=bi,G_=function(o,n,c,d,g){var y,b,E=8*g-d-1,S=(1<<E)-1,L=S>>1,D=-7,O=c?g-1:0,U=c?-1:1,W=o[n+O];for(O+=U,y=W&(1<<-D)-1,W>>=-D,D+=E;D>0;y=256*y+o[n+O],O+=U,D-=8);for(b=y&(1<<-D)-1,y>>=-D,D+=d;D>0;b=256*b+o[n+O],O+=U,D-=8);if(y===0)y=1-L;else{if(y===S)return b?NaN:1/0*(W?-1:1);b+=Math.pow(2,d),y-=L}return(W?-1:1)*b*Math.pow(2,y-d)},W_=function(o,n,c,d,g,y){var b,E,S,L=8*y-g-1,D=(1<<L)-1,O=D>>1,U=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=d?0:y-1,H=d?1:-1,ne=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(E=isNaN(n)?1:0,b=D):(b=Math.floor(Math.log(n)/Math.LN2),n*(S=Math.pow(2,-b))<1&&(b--,S*=2),(n+=b+O>=1?U/S:U*Math.pow(2,1-O))*S>=2&&(b++,S/=2),b+O>=D?(E=0,b=D):b+O>=1?(E=(n*S-1)*Math.pow(2,g),b+=O):(E=n*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;o[c+W]=255&E,W+=H,E/=256,g-=8);for(b=b<<g|E,L+=g;L>0;o[c+W]=255&b,W+=H,b/=256,L-=8);o[c+W-H]|=128*ne};function bi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}bi.Varint=0,bi.Fixed64=1,bi.Bytes=2,bi.Fixed32=5;var Do,op=4294967296,H_=1/op,q_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function eo(o){return o.type===bi.Bytes?o.readVarint()+o.pos:o.pos+1}function ml(o,n,c){return c?4294967296*n+(o>>>0):4294967296*(n>>>0)+(o>>>0)}function $_(o,n,c){var d=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=o;g--)c.buf[g+d]=c.buf[g]}function xT(o,n){for(var c=0;c<o.length;c++)n.writeVarint(o[c])}function vT(o,n){for(var c=0;c<o.length;c++)n.writeSVarint(o[c])}function bT(o,n){for(var c=0;c<o.length;c++)n.writeFloat(o[c])}function wT(o,n){for(var c=0;c<o.length;c++)n.writeDouble(o[c])}function TT(o,n){for(var c=0;c<o.length;c++)n.writeBoolean(o[c])}function ET(o,n){for(var c=0;c<o.length;c++)n.writeFixed32(o[c])}function ST(o,n){for(var c=0;c<o.length;c++)n.writeSFixed32(o[c])}function AT(o,n){for(var c=0;c<o.length;c++)n.writeFixed64(o[c])}function PT(o,n){for(var c=0;c<o.length;c++)n.writeSFixed64(o[c])}function Rh(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+16777216*o[n+3]}function gl(o,n,c){o[c]=n,o[c+1]=n>>>8,o[c+2]=n>>>16,o[c+3]=n>>>24}function Z_(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+(o[n+3]<<24)}function IT(o,n,c){o===1&&c.readMessage(CT,n)}function CT(o,n,c){if(o===3){const{id:d,bitmap:g,width:y,height:b,left:E,top:S,advance:L}=c.readMessage(MT,{});n.push({id:d,bitmap:new zc({width:y+6,height:b+6},g),metrics:{width:y,height:b,left:E,top:S,advance:L}})}}function MT(o,n,c){o===1?n.id=c.readVarint():o===2?n.bitmap=c.readBytes():o===3?n.width=c.readVarint():o===4?n.height=c.readVarint():o===5?n.left=c.readSVarint():o===6?n.top=c.readSVarint():o===7&&(n.advance=c.readVarint())}function X_(o){let n=0,c=0;for(const b of o)n+=b.w*b.h,c=Math.max(c,b.w);o.sort((b,E)=>E.h-b.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),c),h:1/0}];let g=0,y=0;for(const b of o)for(let E=d.length-1;E>=0;E--){const S=d[E];if(!(b.w>S.w||b.h>S.h)){if(b.x=S.x,b.y=S.y,y=Math.max(y,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===S.w&&b.h===S.h){const L=d.pop();E<d.length&&(d[E]=L)}else b.h===S.h?(S.x+=b.w,S.w-=b.w):b.w===S.w?(S.y+=b.h,S.h-=b.h):(d.push({x:S.x+b.w,y:S.y,w:S.w-b.w,h:b.h}),S.y+=b.h,S.h-=b.h);break}}return{w:g,h:y,fill:n/(g*y)||0}}bi.prototype={destroy:function(){this.buf=null},readFields:function(o,n,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,y=this.pos;this.type=7&d,o(g,n,this),this.pos===y&&this.skip(d)}return n},readMessage:function(o,n){return this.readFields(o,n,this.readVarint()+this.pos)},readFixed32:function(){var o=Rh(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Z_(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Rh(this.buf,this.pos)+Rh(this.buf,this.pos+4)*op;return this.pos+=8,o},readSFixed64:function(){var o=Rh(this.buf,this.pos)+Z_(this.buf,this.pos+4)*op;return this.pos+=8,o},readFloat:function(){var o=G_(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=G_(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var n,c,d=this.buf;return n=127&(c=d[this.pos++]),c<128?n:(n|=(127&(c=d[this.pos++]))<<7,c<128?n:(n|=(127&(c=d[this.pos++]))<<14,c<128?n:(n|=(127&(c=d[this.pos++]))<<21,c<128?n:function(g,y,b){var E,S,L=b.buf;if(E=(112&(S=L[b.pos++]))>>4,S<128||(E|=(127&(S=L[b.pos++]))<<3,S<128)||(E|=(127&(S=L[b.pos++]))<<10,S<128)||(E|=(127&(S=L[b.pos++]))<<17,S<128)||(E|=(127&(S=L[b.pos++]))<<24,S<128)||(E|=(1&(S=L[b.pos++]))<<31,S<128))return ml(g,E,y);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(c=d[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,n=this.pos;return this.pos=o,o-n>=12&&q_?function(c,d,g){return q_.decode(c.subarray(d,g))}(this.buf,n,o):function(c,d,g){for(var y="",b=d;b<g;){var E,S,L,D=c[b],O=null,U=D>239?4:D>223?3:D>191?2:1;if(b+U>g)break;U===1?D<128&&(O=D):U===2?(192&(E=c[b+1]))==128&&(O=(31&D)<<6|63&E)<=127&&(O=null):U===3?(S=c[b+2],(192&(E=c[b+1]))==128&&(192&S)==128&&((O=(15&D)<<12|(63&E)<<6|63&S)<=2047||O>=55296&&O<=57343)&&(O=null)):U===4&&(S=c[b+2],L=c[b+3],(192&(E=c[b+1]))==128&&(192&S)==128&&(192&L)==128&&((O=(15&D)<<18|(63&E)<<12|(63&S)<<6|63&L)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,U=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),b+=U}return y}(this.buf,n,o)},readBytes:function(){var o=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,o);return this.pos=o,n},readPackedVarint:function(o,n){if(this.type!==bi.Bytes)return o.push(this.readVarint(n));var c=eo(this);for(o=o||[];this.pos<c;)o.push(this.readVarint(n));return o},readPackedSVarint:function(o){if(this.type!==bi.Bytes)return o.push(this.readSVarint());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==bi.Bytes)return o.push(this.readBoolean());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==bi.Bytes)return o.push(this.readFloat());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==bi.Bytes)return o.push(this.readDouble());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==bi.Bytes)return o.push(this.readFixed32());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==bi.Bytes)return o.push(this.readSFixed32());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==bi.Bytes)return o.push(this.readFixed64());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==bi.Bytes)return o.push(this.readSFixed64());var n=eo(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed64());return o},skip:function(o){var n=7&o;if(n===bi.Varint)for(;this.buf[this.pos++]>127;);else if(n===bi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===bi.Fixed32)this.pos+=4;else{if(n!==bi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(o,n){this.writeVarint(o<<3|n)},realloc:function(o){for(var n=this.length||16;n<this.pos+o;)n*=2;if(n!==this.length){var c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),gl(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),gl(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),gl(this.buf,-1&o,this.pos),gl(this.buf,Math.floor(o*H_),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),gl(this.buf,-1&o,this.pos),gl(this.buf,Math.floor(o*H_),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(n,c){var d,g;if(n>=0?(d=n%4294967296|0,g=n/4294967296|0):(g=~(-n/4294967296),4294967295^(d=~(-n%4294967296))?d=d+1|0:(d=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(y,b,E){E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,E.buf[E.pos]=127&(y>>>=7)}(d,0,c),function(y,b){var E=(7&y)<<4;b.buf[b.pos++]|=E|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(g,c)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var n=this.pos;this.pos=function(d,g,y){for(var b,E,S=0;S<g.length;S++){if((b=g.charCodeAt(S))>55295&&b<57344){if(!E){b>56319||S+1===g.length?(d[y++]=239,d[y++]=191,d[y++]=189):E=b;continue}if(b<56320){d[y++]=239,d[y++]=191,d[y++]=189,E=b;continue}b=E-55296<<10|b-56320|65536,E=null}else E&&(d[y++]=239,d[y++]=191,d[y++]=189,E=null);b<128?d[y++]=b:(b<2048?d[y++]=b>>6|192:(b<65536?d[y++]=b>>12|224:(d[y++]=b>>18|240,d[y++]=b>>12&63|128),d[y++]=b>>6&63|128),d[y++]=63&b|128)}return y}(this.buf,o,this.pos);var c=this.pos-n;c>=128&&$_(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeFloat:function(o){this.realloc(4),W_(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),W_(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var n=o.length;this.writeVarint(n),this.realloc(n);for(var c=0;c<n;c++)this.buf[this.pos++]=o[c]},writeRawMessage:function(o,n){this.pos++;var c=this.pos;o(n,this);var d=this.pos-c;d>=128&&$_(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(o,n,c){this.writeTag(o,bi.Bytes),this.writeRawMessage(n,c)},writePackedVarint:function(o,n){n.length&&this.writeMessage(o,xT,n)},writePackedSVarint:function(o,n){n.length&&this.writeMessage(o,vT,n)},writePackedBoolean:function(o,n){n.length&&this.writeMessage(o,TT,n)},writePackedFloat:function(o,n){n.length&&this.writeMessage(o,bT,n)},writePackedDouble:function(o,n){n.length&&this.writeMessage(o,wT,n)},writePackedFixed32:function(o,n){n.length&&this.writeMessage(o,ET,n)},writePackedSFixed32:function(o,n){n.length&&this.writeMessage(o,ST,n)},writePackedFixed64:function(o,n){n.length&&this.writeMessage(o,AT,n)},writePackedSFixed64:function(o,n){n.length&&this.writeMessage(o,PT,n)},writeBytesField:function(o,n){this.writeTag(o,bi.Bytes),this.writeBytes(n)},writeFixed32Field:function(o,n){this.writeTag(o,bi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(o,n){this.writeTag(o,bi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(o,n){this.writeTag(o,bi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(o,n){this.writeTag(o,bi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(o,n){this.writeTag(o,bi.Varint),this.writeVarint(n)},writeSVarintField:function(o,n){this.writeTag(o,bi.Varint),this.writeSVarint(n)},writeStringField:function(o,n){this.writeTag(o,bi.Bytes),this.writeString(n)},writeFloatField:function(o,n){this.writeTag(o,bi.Fixed32),this.writeFloat(n)},writeDoubleField:function(o,n){this.writeTag(o,bi.Fixed64),this.writeDouble(n)},writeBooleanField:function(o,n){this.writeVarintField(o,Boolean(n))}};class ap{constructor(n,{pixelRatio:c,version:d,stretchX:g,stretchY:y,content:b}){this.paddedRect=n,this.pixelRatio=c,this.stretchX=g,this.stretchY=y,this.content=b,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Y_{constructor(n,c){const d={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(n,d,y),this.addImages(c,g,y);const{w:b,h:E}=X_(y),S=new Lr({width:b||1,height:E||1});for(const L in n){const D=n[L],O=d[L].paddedRect;Lr.copy(D.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const L in c){const D=c[L],O=g[L].paddedRect,U=O.x+1,W=O.y+1,H=D.data.width,ne=D.data.height;Lr.copy(D.data,S,{x:0,y:0},{x:U,y:W},D.data),Lr.copy(D.data,S,{x:0,y:ne-1},{x:U,y:W-1},{width:H,height:1}),Lr.copy(D.data,S,{x:0,y:0},{x:U,y:W+ne},{width:H,height:1}),Lr.copy(D.data,S,{x:H-1,y:0},{x:U-1,y:W},{width:1,height:ne}),Lr.copy(D.data,S,{x:0,y:0},{x:U+H,y:W},{width:1,height:ne})}this.image=S,this.iconPositions=d,this.patternPositions=g}addImages(n,c,d){for(const g in n){const y=n[g],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};d.push(b),c[g]=new ap(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(n,c){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in n.updatedImages)this.patchUpdatedImage(this.iconPositions[d],n.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],n.getImage(d),c)}patchUpdatedImage(n,c,d){if(!n||!c||n.version===c.version)return;n.version=c.version;const[g,y]=n.tl;d.update(c.data,void 0,{x:g,y})}}ut("ImagePosition",ap),ut("ImageAtlas",Y_),l.WritingMode=void 0,(Do=l.WritingMode||(l.WritingMode={}))[Do.none=0]="none",Do[Do.horizontal=1]="horizontal",Do[Do.vertical=2]="vertical",Do[Do.horizontalOnly=3]="horizontalOnly";const kh=-17;class Gc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,c){const d=new Gc;return d.scale=n||1,d.fontStack=c,d}static forImage(n){const c=new Gc;return c.imageName=n,c}}class _l{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,c){const d=new _l;for(let g=0;g<n.sections.length;g++){const y=n.sections[g];y.image?d.addImageSection(y):d.addTextSection(y,c)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let c="";for(let d=0;d<n.length;d++){const g=n.charCodeAt(d+1)||null,y=n.charCodeAt(d-1)||null;c+=g&&fh(g)&&!jc[n[d+1]]||y&&fh(y)&&!jc[n[d-1]]||!jc[n[d]]?n[d]:jc[n[d]]}return c}(this.text)}trim(){let n=0;for(let d=0;d<this.text.length&&zh[this.text.charCodeAt(d)];d++)n++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&zh[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(n,c),this.sectionIndex=this.sectionIndex.slice(n,c)}substring(n,c){const d=new _l;return d.text=this.text.substring(n,c),d.sectionIndex=this.sectionIndex.slice(n,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,c)=>Math.max(n,this.sections[c].scale),0)}addTextSection(n,c){this.text+=n.text,this.sections.push(Gc.forText(n.scale,n.fontStack||c));const d=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(d)}addImageSection(n){const c=n.image?n.image.name:"";if(c.length===0)return void Fe("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Gc.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dh(o,n,c,d,g,y,b,E,S,L,D,O,U,W,H,ne){const ie=_l.fromFeature(o,g);let ye;O===l.WritingMode.vertical&&ie.verticalizePunctuation();const{processBidirectionalText:Ae,processStyledBidirectionalText:_e}=xr;if(Ae&&ie.sections.length===1){ye=[];const De=Ae(ie.toString(),lp(ie,L,y,n,d,W,H));for(const at of De){const mt=new _l;mt.text=at,mt.sections=ie.sections;for(let it=0;it<at.length;it++)mt.sectionIndex.push(0);ye.push(mt)}}else if(_e){ye=[];const De=_e(ie.text,ie.sectionIndex,lp(ie,L,y,n,d,W,H));for(const at of De){const mt=new _l;mt.text=at[0],mt.sectionIndex=at[1],mt.sections=ie.sections,ye.push(mt)}}else ye=function(De,at){const mt=[],it=De.text;let Je=0;for(const Ye of at)mt.push(De.substring(Je,Ye)),Je=Ye;return Je<it.length&&mt.push(De.substring(Je,it.length)),mt}(ie,lp(ie,L,y,n,d,W,H));const Te=[],Oe={positionedLines:Te,text:ie.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(De,at,mt,it,Je,Ye,nt,Qe,He,Pt,bt,qt){let Pi=0,ki=kh,hn=0,kr=0;const In=Qe==="right"?1:Qe==="left"?0:.5;let nn=0;for(const rn of Je){rn.trim();const Mn=rn.getMaxScale(),Dn=(Mn-1)*Sn,$n={positionedGlyphs:[],lineOffset:0};De.positionedLines[nn]=$n;const or=$n.positionedGlyphs;let ar=0;if(!rn.length()){ki+=Ye,++nn;continue}for(let vn=0;vn<rn.length();vn++){const Jt=rn.getSection(vn),wr=rn.getSectionIndex(vn),Ln=rn.getCharCode(vn);let zn=0,Zr=null,os=null,as=null,io=Sn;const Xr=!(He===l.WritingMode.horizontal||!bt&&!wc(Ln)||bt&&(zh[Ln]||(xn=Ln,tt.Arabic(xn)||tt["Arabic Supplement"](xn)||tt["Arabic Extended-A"](xn)||tt["Arabic Presentation Forms-A"](xn)||tt["Arabic Presentation Forms-B"](xn))));if(Jt.imageName){const Dr=it[Jt.imageName];if(!Dr)continue;as=Jt.imageName,De.iconsInText=De.iconsInText||!0,os=Dr.paddedRect;const lr=Dr.displaySize;Jt.scale=Jt.scale*Sn/qt,Zr={width:lr[0],height:lr[1],left:1,top:-3,advance:Xr?lr[1]:lr[0]},zn=Dn+(Sn-lr[1]*Jt.scale),io=Zr.advance;const no=Xr?lr[0]*Jt.scale-Sn*Mn:lr[1]*Jt.scale-Sn*Mn;no>0&&no>ar&&(ar=no)}else{const Dr=mt[Jt.fontStack],lr=Dr&&Dr[Ln];if(lr&&lr.rect)os=lr.rect,Zr=lr.metrics;else{const no=at[Jt.fontStack],qc=no&&no[Ln];if(!qc)continue;Zr=qc.metrics}zn=(Mn-Jt.scale)*Sn}Xr?(De.verticalizable=!0,or.push({glyph:Ln,imageName:as,x:Pi,y:ki+zn,vertical:Xr,scale:Jt.scale,fontStack:Jt.fontStack,sectionIndex:wr,metrics:Zr,rect:os}),Pi+=io*Jt.scale+Pt):(or.push({glyph:Ln,imageName:as,x:Pi,y:ki+zn,vertical:Xr,scale:Jt.scale,fontStack:Jt.fontStack,sectionIndex:wr,metrics:Zr,rect:os}),Pi+=Zr.advance*Jt.scale+Pt)}or.length!==0&&(hn=Math.max(Pi-Pt,hn),kT(or,0,or.length-1,In,ar)),Pi=0;const zi=Ye*Mn+ar;$n.lineOffset=Math.max(ar,Dn),ki+=zi,kr=Math.max(zi,kr),++nn}var xn;const Cn=ki-kh,{horizontalAlign:kn,verticalAlign:sr}=cp(nt);(function(rn,Mn,Dn,$n,or,ar,zi,vn,Jt){const wr=(Mn-Dn)*or;let Ln=0;Ln=ar!==zi?-vn*$n-kh:(-$n*Jt+.5)*zi;for(const zn of rn)for(const Zr of zn.positionedGlyphs)Zr.x+=wr,Zr.y+=Ln})(De.positionedLines,In,kn,sr,hn,kr,Ye,Cn,Je.length),De.top+=-sr*Cn,De.bottom=De.top+Cn,De.left+=-kn*hn,De.right=De.left+hn}(Oe,n,c,d,ye,b,E,S,O,L,U,ne),!function(De){for(const at of De)if(at.positionedGlyphs.length!==0)return!1;return!0}(Te)&&Oe}const zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},LT={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function K_(o,n,c,d,g,y){if(n.imageName){const b=d[n.imageName];return b?b.displaySize[0]*n.scale*Sn/y+g:0}{const b=c[n.fontStack],E=b&&b[o];return E?E.metrics.advance*n.scale+g:0}}function J_(o,n,c,d){const g=Math.pow(o-n,2);return d?o<n?g/2:2*g:g+Math.abs(c)*c}function RT(o,n,c){let d=0;return o===10&&(d-=1e4),c&&(d+=150),o!==40&&o!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function Q_(o,n,c,d,g,y){let b=null,E=J_(n,c,g,y);for(const S of d){const L=J_(n-S.x,c,g,y)+S.badness;L<=E&&(b=S,E=L)}return{index:o,x:n,priorBreak:b,badness:E}}function ey(o){return o?ey(o.priorBreak).concat(o.index):[]}function lp(o,n,c,d,g,y,b){if(y!=="point")return[];if(!o)return[];const E=[],S=function(U,W,H,ne,ie,ye){let Ae=0;for(let _e=0;_e<U.length();_e++){const Te=U.getSection(_e);Ae+=K_(U.getCharCode(_e),Te,ne,ie,W,ye)}return Ae/Math.max(1,Math.ceil(Ae/H))}(o,n,c,d,g,b),L=o.text.indexOf("")>=0;let D=0;for(let U=0;U<o.length();U++){const W=o.getSection(U),H=o.getCharCode(U);if(zh[H]||(D+=K_(H,W,d,g,n,b)),U<o.length()-1){const ne=!((O=H)<11904||!(tt["Bopomofo Extended"](O)||tt.Bopomofo(O)||tt["CJK Compatibility Forms"](O)||tt["CJK Compatibility Ideographs"](O)||tt["CJK Compatibility"](O)||tt["CJK Radicals Supplement"](O)||tt["CJK Strokes"](O)||tt["CJK Symbols and Punctuation"](O)||tt["CJK Unified Ideographs Extension A"](O)||tt["CJK Unified Ideographs"](O)||tt["Enclosed CJK Letters and Months"](O)||tt["Halfwidth and Fullwidth Forms"](O)||tt.Hiragana(O)||tt["Ideographic Description Characters"](O)||tt["Kangxi Radicals"](O)||tt["Katakana Phonetic Extensions"](O)||tt.Katakana(O)||tt["Vertical Forms"](O)||tt["Yi Radicals"](O)||tt["Yi Syllables"](O)));(LT[H]||ne||W.imageName)&&E.push(Q_(U+1,D,S,E,RT(H,o.getCharCode(U+1),ne&&L),!1))}}var O;return ey(Q_(o.length(),D,S,E,0,!0))}function cp(o){let n=.5,c=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:n,verticalAlign:c}}function kT(o,n,c,d,g){if(!d&&!g)return;const y=o[c],b=(o[c].x+y.metrics.advance*y.scale)*d;for(let E=n;E<=c;E++)o[E].x-=b,o[E].y+=g}function DT(o,n,c){const{horizontalAlign:d,verticalAlign:g}=cp(c),y=n[0]-o.displaySize[0]*d,b=n[1]-o.displaySize[1]*g;return{image:o,top:b,bottom:b+o.displaySize[1],left:y,right:y+o.displaySize[0]}}function ty(o,n,c,d,g,y){const b=o.image;let E;if(b.content){const ie=b.content,ye=b.pixelRatio||1;E=[ie[0]/ye,ie[1]/ye,b.displaySize[0]-ie[2]/ye,b.displaySize[1]-ie[3]/ye]}const S=n.left*y,L=n.right*y;let D,O,U,W;c==="width"||c==="both"?(W=g[0]+S-d[3],O=g[0]+L+d[1]):(W=g[0]+(S+L-b.displaySize[0])/2,O=W+b.displaySize[0]);const H=n.top*y,ne=n.bottom*y;return c==="height"||c==="both"?(D=g[1]+H-d[0],U=g[1]+ne+d[2]):(D=g[1]+(H+ne-b.displaySize[1])/2,U=D+b.displaySize[1]),{image:b,top:D,right:O,bottom:U,left:W,collisionPadding:E}}const to=128;function iy(o,n){const{expression:c}=n;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Li(o+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let y=0;for(;y<d.length&&d[y]<=o;)y++;y=Math.max(0,y-1);let b=y;for(;b<d.length&&d[b]<o+1;)b++;b=Math.min(d.length-1,b);const E=d[y],S=d[b];return c.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:S,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:S,minSize:c.evaluate(new Li(E)),maxSize:c.evaluate(new Li(S)),interpolationType:g}}}class zo extends ft{constructor(n,c,d,g){super(n,c),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new zo(this.x,this.y,this.angle,this.segment)}}function ny(o,n,c,d,g){if(n.segment===void 0)return!0;let y=n,b=n.segment+1,E=0;for(;E>-c/2;){if(b--,b<0)return!1;E-=o[b].dist(y),y=o[b]}E+=o[b].dist(o[b+1]),b++;const S=[];let L=0;for(;E<c/2;){const D=o[b],O=o[b+1];if(!O)return!1;let U=o[b-1].angleTo(D)-D.angleTo(O);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:E,angleDelta:U}),L+=U;E-S[0].distance>d;)L-=S.shift().angleDelta;if(L>g)return!1;b++,E+=D.dist(O)}return!0}function ry(o){let n=0;for(let c=0;c<o.length-1;c++)n+=o[c].dist(o[c+1]);return n}function sy(o,n,c){return o?.6*n*c:0}function oy(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function zT(o,n,c,d,g,y){const b=sy(c,g,y),E=oy(c,d)*y;let S=0;const L=ry(o)/2;for(let D=0;D<o.length-1;D++){const O=o[D],U=o[D+1],W=O.dist(U);if(S+W>L){const H=(L-S)/W,ne=Wt(O.x,U.x,H),ie=Wt(O.y,U.y,H),ye=new zo(ne,ie,U.angleTo(O),D);return ye._round(),!b||ny(o,ye,E,b,n)?ye:void 0}S+=W}}function OT(o,n,c,d,g,y,b,E,S){const L=sy(d,y,b),D=oy(d,g),O=D*b,U=o[0].x===0||o[0].x===S||o[0].y===0||o[0].y===S;return n-O<n/4&&(n=O+n/4),ay(o,U?n/2*E%n:(D/2+2*y)*b*E%n,n,L,c,O,U,!1,S)}function ay(o,n,c,d,g,y,b,E,S){const L=y/2,D=ry(o);let O=0,U=n-c,W=[];for(let H=0;H<o.length-1;H++){const ne=o[H],ie=o[H+1],ye=ne.dist(ie),Ae=ie.angleTo(ne);for(;U+c<O+ye;){U+=c;const _e=(U-O)/ye,Te=Wt(ne.x,ie.x,_e),Oe=Wt(ne.y,ie.y,_e);if(Te>=0&&Te<S&&Oe>=0&&Oe<S&&U-L>=0&&U+L<=D){const De=new zo(Te,Oe,Ae,H);De._round(),d&&!ny(o,De,y,d,g)||W.push(De)}}O+=ye}return E||W.length||b||(W=ay(o,O/2,c,d,g,y,b,!0,S)),W}function ly(o,n,c,d,g){const y=[];for(let b=0;b<o.length;b++){const E=o[b];let S;for(let L=0;L<E.length-1;L++){let D=E[L],O=E[L+1];D.x<n&&O.x<n||(D.x<n?D=new ft(n,D.y+(n-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<n&&(O=new ft(n,D.y+(n-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<c&&O.y<c||(D.y<c?D=new ft(D.x+(c-D.y)/(O.y-D.y)*(O.x-D.x),c)._round():O.y<c&&(O=new ft(D.x+(c-D.y)/(O.y-D.y)*(O.x-D.x),c)._round()),D.x>=d&&O.x>=d||(D.x>=d?D=new ft(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=d&&(O=new ft(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=g&&O.y>=g||(D.y>=g?D=new ft(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round():O.y>=g&&(O=new ft(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round()),S&&D.equals(S[S.length-1])||(S=[D],y.push(S)),S.push(O)))))}}return y}function cy(o,n,c,d){const g=[],y=o.image,b=y.pixelRatio,E=y.paddedRect.w-2,S=y.paddedRect.h-2,L=o.right-o.left,D=o.bottom-o.top,O=y.stretchX||[[0,E]],U=y.stretchY||[[0,S]],W=(Ye,nt)=>Ye+nt[1]-nt[0],H=O.reduce(W,0),ne=U.reduce(W,0),ie=E-H,ye=S-ne;let Ae=0,_e=H,Te=0,Oe=ne,De=0,at=ie,mt=0,it=ye;if(y.content&&d){const Ye=y.content;Ae=Oh(O,0,Ye[0]),Te=Oh(U,0,Ye[1]),_e=Oh(O,Ye[0],Ye[2]),Oe=Oh(U,Ye[1],Ye[3]),De=Ye[0]-Ae,mt=Ye[1]-Te,at=Ye[2]-Ye[0]-_e,it=Ye[3]-Ye[1]-Oe}const Je=(Ye,nt,Qe,He)=>{const Pt=Fh(Ye.stretch-Ae,_e,L,o.left),bt=Bh(Ye.fixed-De,at,Ye.stretch,H),qt=Fh(nt.stretch-Te,Oe,D,o.top),Pi=Bh(nt.fixed-mt,it,nt.stretch,ne),ki=Fh(Qe.stretch-Ae,_e,L,o.left),hn=Bh(Qe.fixed-De,at,Qe.stretch,H),kr=Fh(He.stretch-Te,Oe,D,o.top),In=Bh(He.fixed-mt,it,He.stretch,ne),nn=new ft(Pt,qt),xn=new ft(ki,qt),Cn=new ft(ki,kr),kn=new ft(Pt,kr),sr=new ft(bt/b,Pi/b),rn=new ft(hn/b,In/b),Mn=n*Math.PI/180;if(Mn){const or=Math.sin(Mn),ar=Math.cos(Mn),zi=[ar,-or,or,ar];nn._matMult(zi),xn._matMult(zi),kn._matMult(zi),Cn._matMult(zi)}const Dn=Ye.stretch+Ye.fixed,$n=nt.stretch+nt.fixed;return{tl:nn,tr:xn,bl:kn,br:Cn,tex:{x:y.paddedRect.x+1+Dn,y:y.paddedRect.y+1+$n,w:Qe.stretch+Qe.fixed-Dn,h:He.stretch+He.fixed-$n},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sr,pixelOffsetBR:rn,minFontScaleX:at/b/L,minFontScaleY:it/b/D,isSDF:c}};if(d&&(y.stretchX||y.stretchY)){const Ye=uy(O,ie,H),nt=uy(U,ye,ne);for(let Qe=0;Qe<Ye.length-1;Qe++){const He=Ye[Qe],Pt=Ye[Qe+1];for(let bt=0;bt<nt.length-1;bt++)g.push(Je(He,nt[bt],Pt,nt[bt+1]))}}else g.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:S+1}));return g}function Oh(o,n,c){let d=0;for(const g of o)d+=Math.max(n,Math.min(c,g[1]))-Math.max(n,Math.min(c,g[0]));return d}function uy(o,n,c){const d=[{fixed:-1,stretch:0}];for(const[g,y]of o){const b=d[d.length-1];d.push({fixed:g-b.stretch,stretch:b.stretch}),d.push({fixed:g-b.stretch,stretch:b.stretch+(y-g)})}return d.push({fixed:n+1,stretch:c}),d}function Fh(o,n,c,d){return o/n*c+d}function Bh(o,n,c,d){return o-n*c/d}ut("Anchor",zo);class Nh{constructor(n,c,d,g,y,b,E,S,L,D){if(this.boxStartIndex=n.length,L){let O=b.top,U=b.bottom;const W=b.collisionPadding;W&&(O-=W[1],U+=W[3]);let H=U-O;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let O=b.top*E-S[0],U=b.bottom*E+S[2],W=b.left*E-S[3],H=b.right*E+S[1];const ne=b.collisionPadding;if(ne&&(W-=ne[0]*E,O-=ne[1]*E,H+=ne[2]*E,U+=ne[3]*E),D){const ie=new ft(W,O),ye=new ft(H,O),Ae=new ft(W,U),_e=new ft(H,U),Te=D*Math.PI/180;ie._rotate(Te),ye._rotate(Te),Ae._rotate(Te),_e._rotate(Te),W=Math.min(ie.x,ye.x,Ae.x,_e.x),H=Math.max(ie.x,ye.x,Ae.x,_e.x),O=Math.min(ie.y,ye.y,Ae.y,_e.y),U=Math.max(ie.y,ye.y,Ae.y,_e.y)}n.emplaceBack(c.x,c.y,W,O,H,U,d,g,y)}this.boxEndIndex=n.length}}class FT{constructor(n=[],c=BT){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:d}=this,g=c[n];for(;n>0;){const y=n-1>>1,b=c[y];if(d(g,b)>=0)break;c[n]=b,n=y}c[n]=g}_down(n){const{data:c,compare:d}=this,g=this.length>>1,y=c[n];for(;n<g;){let b=1+(n<<1),E=c[b];const S=b+1;if(S<this.length&&d(c[S],E)<0&&(b=S,E=c[S]),d(E,y)>=0)break;c[n]=E,n=b}c[n]=y}}function BT(o,n){return o<n?-1:o>n?1:0}function NT(o,n=1,c=!1){let d=1/0,g=1/0,y=-1/0,b=-1/0;const E=o[0];for(let W=0;W<E.length;W++){const H=E[W];(!W||H.x<d)&&(d=H.x),(!W||H.y<g)&&(g=H.y),(!W||H.x>y)&&(y=H.x),(!W||H.y>b)&&(b=H.y)}const S=Math.min(y-d,b-g);let L=S/2;const D=new FT([],UT);if(S===0)return new ft(d,g);for(let W=d;W<y;W+=S)for(let H=g;H<b;H+=S)D.push(new yl(W+L,H+L,L,o));let O=function(W){let H=0,ne=0,ie=0;const ye=W[0];for(let Ae=0,_e=ye.length,Te=_e-1;Ae<_e;Te=Ae++){const Oe=ye[Ae],De=ye[Te],at=Oe.x*De.y-De.x*Oe.y;ne+=(Oe.x+De.x)*at,ie+=(Oe.y+De.y)*at,H+=3*at}return new yl(ne/H,ie/H,0,W)}(o),U=D.length;for(;D.length;){const W=D.pop();(W.d>O.d||!O.d)&&(O=W,c&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,U)),W.max-O.d<=n||(L=W.h/2,D.push(new yl(W.p.x-L,W.p.y-L,L,o)),D.push(new yl(W.p.x+L,W.p.y-L,L,o)),D.push(new yl(W.p.x-L,W.p.y+L,L,o)),D.push(new yl(W.p.x+L,W.p.y+L,L,o)),U+=4)}return c&&(console.log(`num probes: ${U}`),console.log(`best distance: ${O.d}`)),O.p}function UT(o,n){return n.max-o.max}function yl(o,n,c,d){this.p=new ft(o,n),this.h=c,this.d=function(g,y){let b=!1,E=1/0;for(let S=0;S<y.length;S++){const L=y[S];for(let D=0,O=L.length,U=O-1;D<O;U=D++){const W=L[D],H=L[U];W.y>g.y!=H.y>g.y&&g.x<(H.x-W.x)*(g.y-W.y)/(H.y-W.y)+W.x&&(b=!b),E=Math.min(E,y_(g,W,H))}}return(b?1:-1)*Math.sqrt(E)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const up=Number.POSITIVE_INFINITY;function hy(o,n){return n[1]!==up?function(c,d,g){let y=0,b=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":b=g-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-g}switch(c){case"top-right":case"bottom-right":case"right":y=-d;break;case"top-left":case"bottom-left":case"left":y=d}return[y,b]}(o,n[0],n[1]):function(c,d){let g=0,y=0;d<0&&(d=0);const b=d/Math.sqrt(2);switch(c){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-d;break;case"top":y=d-7}switch(c){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=d;break;case"right":g=-d}return[g,y]}(o,n[0])}function hp(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function VT(o,n,c,d,g,y,b,E,S,L,D){let O=y.textMaxSize.evaluate(n,{});O===void 0&&(O=b);const U=o.layers[0].layout,W=U.get("icon-offset").evaluate(n,{},D),H=fy(c.horizontal),ne=b/24,ie=o.tilePixelRatio*ne,ye=o.tilePixelRatio*O/24,Ae=o.tilePixelRatio*E,_e=o.tilePixelRatio*U.get("symbol-spacing"),Te=U.get("text-padding")*o.tilePixelRatio,Oe=function(He,Pt,bt,qt=1){const Pi=He.get("icon-padding").evaluate(Pt,{},bt),ki=Pi&&Pi.values;return[ki[0]*qt,ki[1]*qt,ki[2]*qt,ki[3]*qt]}(U,n,D,o.tilePixelRatio),De=U.get("text-max-angle")/180*Math.PI,at=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",mt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",it=U.get("symbol-placement"),Je=_e/2,Ye=U.get("icon-text-fit");let nt;d&&Ye!=="none"&&(o.allowVerticalPlacement&&c.vertical&&(nt=ty(d,c.vertical,Ye,U.get("icon-text-fit-padding"),W,ne)),H&&(d=ty(d,H,Ye,U.get("icon-text-fit-padding"),W,ne)));const Qe=(He,Pt)=>{Pt.x<0||Pt.x>=un||Pt.y<0||Pt.y>=un||function(bt,qt,Pi,ki,hn,kr,In,nn,xn,Cn,kn,sr,rn,Mn,Dn,$n,or,ar,zi,vn,Jt,wr,Ln,zn,Zr){const os=bt.addToLineVertexArray(qt,Pi);let as,io,Xr,Dr,lr=0,no=0,qc=0,Cy=0,bp=-1,wp=-1;const ro={};let My=yn.exports(""),Tp=0,Ep=0;if(nn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Tp,Ep]=nn.layout.get("text-offset").evaluate(Jt,{},zn).map(cr=>cr*Sn):(Tp=nn.layout.get("text-radial-offset").evaluate(Jt,{},zn)*Sn,Ep=up),bt.allowVerticalPlacement&&ki.vertical){const cr=nn.layout.get("text-rotate").evaluate(Jt,{},zn)+90;Xr=new Nh(xn,qt,Cn,kn,sr,ki.vertical,rn,Mn,Dn,cr),In&&(Dr=new Nh(xn,qt,Cn,kn,sr,In,or,ar,Dn,cr))}if(hn){const cr=nn.layout.get("icon-rotate").evaluate(Jt,{}),Ms=nn.layout.get("icon-text-fit")!=="none",$c=cy(hn,cr,Ln,Ms),Zc=In?cy(In,cr,Ln,Ms):void 0;io=new Nh(xn,qt,Cn,kn,sr,hn,or,ar,!1,cr),lr=4*$c.length;const ky=bt.iconSizeData;let Pa=null;ky.kind==="source"?(Pa=[to*nn.layout.get("icon-size").evaluate(Jt,{})],Pa[0]>Oo&&Fe(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ky.kind==="composite"&&(Pa=[to*wr.compositeIconSizes[0].evaluate(Jt,{},zn),to*wr.compositeIconSizes[1].evaluate(Jt,{},zn)],(Pa[0]>Oo||Pa[1]>Oo)&&Fe(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,$c,Pa,vn,zi,Jt,l.WritingMode.none,qt,os.lineStartIndex,os.lineLength,-1,zn),bp=bt.icon.placedSymbolArray.length-1,Zc&&(no=4*Zc.length,bt.addSymbols(bt.icon,Zc,Pa,vn,zi,Jt,l.WritingMode.vertical,qt,os.lineStartIndex,os.lineLength,-1,zn),wp=bt.icon.placedSymbolArray.length-1)}const Ly=Object.keys(ki.horizontal);for(const cr of Ly){const Ms=ki.horizontal[cr];if(!as){My=yn.exports(Ms.text);const Zc=nn.layout.get("text-rotate").evaluate(Jt,{},zn);as=new Nh(xn,qt,Cn,kn,sr,Ms,rn,Mn,Dn,Zc)}const $c=Ms.positionedLines.length===1;if(qc+=dy(bt,qt,Ms,kr,nn,Dn,Jt,$n,os,ki.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,$c?Ly:[cr],ro,bp,wr,zn),$c)break}ki.vertical&&(Cy+=dy(bt,qt,ki.vertical,kr,nn,Dn,Jt,$n,os,l.WritingMode.vertical,["vertical"],ro,wp,wr,zn));const eE=as?as.boxStartIndex:bt.collisionBoxArray.length,tE=as?as.boxEndIndex:bt.collisionBoxArray.length,iE=Xr?Xr.boxStartIndex:bt.collisionBoxArray.length,nE=Xr?Xr.boxEndIndex:bt.collisionBoxArray.length,rE=io?io.boxStartIndex:bt.collisionBoxArray.length,sE=io?io.boxEndIndex:bt.collisionBoxArray.length,oE=Dr?Dr.boxStartIndex:bt.collisionBoxArray.length,aE=Dr?Dr.boxEndIndex:bt.collisionBoxArray.length;let ls=-1;const Wh=(cr,Ms)=>cr&&cr.circleDiameter?Math.max(cr.circleDiameter,Ms):Ms;ls=Wh(as,ls),ls=Wh(Xr,ls),ls=Wh(io,ls),ls=Wh(Dr,ls);const Ry=ls>-1?1:0;Ry&&(ls*=Zr/Sn),bt.glyphOffsetArray.length>=xl.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,Jt.sortKey),bt.symbolInstances.emplaceBack(qt.x,qt.y,ro.right>=0?ro.right:-1,ro.center>=0?ro.center:-1,ro.left>=0?ro.left:-1,ro.vertical||-1,bp,wp,My,eE,tE,iE,nE,rE,sE,oE,aE,Cn,qc,Cy,lr,no,Ry,0,rn,Tp,Ep,ls)}(o,Pt,He,c,d,g,nt,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,ie,[Te,Te,Te,Te],at,S,Ae,Oe,mt,W,n,y,L,D,b)};if(it==="line")for(const He of ly(n.geometry,0,0,un,un)){const Pt=OT(He,_e,De,c.vertical||H,d,24,ye,o.overscaling,un);for(const bt of Pt){const qt=H;qt&&jT(o,qt.text,Je,bt)||Qe(He,bt)}}else if(it==="line-center"){for(const He of n.geometry)if(He.length>1){const Pt=zT(He,De,c.vertical||H,d,24,ye);Pt&&Qe(He,Pt)}}else if(n.type==="Polygon")for(const He of Jf(n.geometry,0)){const Pt=NT(He,16);Qe(He[0],new zo(Pt.x,Pt.y,0))}else if(n.type==="LineString")for(const He of n.geometry)Qe(He,new zo(He[0].x,He[0].y,0));else if(n.type==="Point")for(const He of n.geometry)for(const Pt of He)Qe([Pt],new zo(Pt.x,Pt.y,0))}const Oo=32640;function dy(o,n,c,d,g,y,b,E,S,L,D,O,U,W,H){const ne=function(Ae,_e,Te,Oe,De,at,mt,it){const Je=Oe.layout.get("text-rotate").evaluate(at,{})*Math.PI/180,Ye=[];for(const nt of _e.positionedLines)for(const Qe of nt.positionedGlyphs){if(!Qe.rect)continue;const He=Qe.rect||{};let Pt=4,bt=!0,qt=1,Pi=0;const ki=(De||it)&&Qe.vertical,hn=Qe.metrics.advance*Qe.scale/2;if(it&&_e.verticalizable){const zi=(Qe.scale-1)*Sn,vn=(Sn-Qe.metrics.width*Qe.scale)/2;Pi=nt.lineOffset/2-(Qe.imageName?-vn:zi)}if(Qe.imageName){const zi=mt[Qe.imageName];bt=zi.sdf,qt=zi.pixelRatio,Pt=1/qt}const kr=De?[Qe.x+hn,Qe.y]:[0,0];let In=De?[0,0]:[Qe.x+hn+Te[0],Qe.y+Te[1]-Pi],nn=[0,0];ki&&(nn=In,In=[0,0]);const xn=(Qe.metrics.left-Pt)*Qe.scale-hn+In[0],Cn=(-Qe.metrics.top-Pt)*Qe.scale+In[1],kn=xn+He.w*Qe.scale/qt,sr=Cn+He.h*Qe.scale/qt,rn=new ft(xn,Cn),Mn=new ft(kn,Cn),Dn=new ft(xn,sr),$n=new ft(kn,sr);if(ki){const zi=new ft(-hn,hn-kh),vn=-Math.PI/2,Jt=12-hn,wr=new ft(22-Jt,-(Qe.imageName?Jt:0)),Ln=new ft(...nn);rn._rotateAround(vn,zi)._add(wr)._add(Ln),Mn._rotateAround(vn,zi)._add(wr)._add(Ln),Dn._rotateAround(vn,zi)._add(wr)._add(Ln),$n._rotateAround(vn,zi)._add(wr)._add(Ln)}if(Je){const zi=Math.sin(Je),vn=Math.cos(Je),Jt=[vn,-zi,zi,vn];rn._matMult(Jt),Mn._matMult(Jt),Dn._matMult(Jt),$n._matMult(Jt)}const or=new ft(0,0),ar=new ft(0,0);Ye.push({tl:rn,tr:Mn,bl:Dn,br:$n,tex:He,writingMode:_e.writingMode,glyphOffset:kr,sectionIndex:Qe.sectionIndex,isSDF:bt,pixelOffsetTL:or,pixelOffsetBR:ar,minFontScaleX:0,minFontScaleY:0})}return Ye}(0,c,E,g,y,b,d,o.allowVerticalPlacement),ie=o.textSizeData;let ye=null;ie.kind==="source"?(ye=[to*g.layout.get("text-size").evaluate(b,{})],ye[0]>Oo&&Fe(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ie.kind==="composite"&&(ye=[to*W.compositeTextSizes[0].evaluate(b,{},H),to*W.compositeTextSizes[1].evaluate(b,{},H)],(ye[0]>Oo||ye[1]>Oo)&&Fe(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,ne,ye,E,y,b,L,n,S.lineStartIndex,S.lineLength,U,H);for(const Ae of D)O[Ae]=o.text.placedSymbolArray.length-1;return 4*ne.length}function fy(o){for(const n in o)return o[n];return null}function jT(o,n,c,d){const g=o.compareText;if(n in g){const y=g[n];for(let b=y.length-1;b>=0;b--)if(d.dist(y[b])<c)return!0}else g[n]=[];return g[n].push(d),!1}const GT=ko.VectorTileFeature.types,WT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uh(o,n,c,d,g,y,b,E,S,L,D,O,U){const W=E?Math.min(Oo,Math.round(E[0])):0,H=E?Math.min(Oo,Math.round(E[1])):0;o.emplaceBack(n,c,Math.round(32*d),Math.round(32*g),y,b,(W<<1)+(S?1:0),H,16*L,16*D,256*O,256*U)}function dp(o,n,c){o.emplaceBack(n.x,n.y,c),o.emplaceBack(n.x,n.y,c),o.emplaceBack(n.x,n.y,c),o.emplaceBack(n.x,n.y,c)}function HT(o){for(const n of o.sections)if(mh(n.text))return!0;return!1}class fp{constructor(n){this.layoutVertexArray=new qr,this.indexArray=new Wn,this.programConfigurations=n,this.segments=new Yt,this.dynamicLayoutVertexArray=new Mr,this.opacityVertexArray=new $r,this.placedSymbolArray=new Ge}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,pT.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,mT.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,WT,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ut("SymbolBuffers",fp);class pp{constructor(n,c,d){this.layoutVertexArray=new n,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Yt,this.collisionVertexArray=new vr}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,gT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ut("CollisionBuffers",pp);class xl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(b=>b.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qf([]),this.placementViewportMatrix=qf([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=iy(this.zoom,c["text-size"]),this.iconSizeData=iy(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=gp(d,"text-overlap","text-allow-overlap")!=="never"||gp(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(b=>l.WritingMode[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=n.sourceID}createArrays(){this.text=new fp(new wa(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new fp(new wa(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Ke,this.lineVertexArray=new ot,this.symbolInstances=new st}calculateGlyphDependencies(n,c,d,g,y){for(let b=0;b<n.length;b++)if(c[n.charCodeAt(b)]=!0,(d||g)&&y){const E=jc[n.charAt(b)];E&&(c[E.charCodeAt(0)]=!0)}}populate(n,c,d){const g=this.layers[0],y=g.layout,b=y.get("text-font"),E=y.get("text-field"),S=y.get("icon-image"),L=(E.value.kind!=="constant"||E.value.value instanceof le&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=y.get("symbol-sort-key");if(this.features=[],!L&&!D)return;const U=c.iconDependencies,W=c.glyphDependencies,H=c.availableImages,ne=new Li(this.zoom);for(const{feature:ie,id:ye,index:Ae,sourceLayerIndex:_e}of n){const Te=g._featureFilter.needGeometry,Oe=Ea(ie,Te);if(!g._featureFilter.filter(ne,Oe,d))continue;let De,at;if(Te||(Oe.geometry=Ta(ie)),L){const it=g.getValueAndResolveTokens("text-field",Oe,d,H),Je=le.factory(it);HT(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||xa()==="unavailable"||this.hasRTLText&&xr.isParsed())&&(De=yT(Je,g,Oe))}if(D){const it=g.getValueAndResolveTokens("icon-image",Oe,d,H);at=it instanceof fe?it:fe.fromString(it)}if(!De&&!at)continue;const mt=this.sortFeaturesByKey?O.evaluate(Oe,{},d):void 0;if(this.features.push({id:ye,text:De,icon:at,index:Ae,sourceLayerIndex:_e,geometry:Oe.geometry,properties:ie.properties,type:GT[ie.type],sortKey:mt}),at&&(U[at.name]=!0),De){const it=b.evaluate(Oe,{},d).join(","),Je=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const Ye of De.sections)if(Ye.image)U[Ye.image.name]=!0;else{const nt=al(De.toString()),Qe=Ye.fontStack||it,He=W[Qe]=W[Qe]||{};this.calculateGlyphDependencies(Ye.text,He,Je,this.allowVerticalPlacement,nt)}}}y.get("symbol-placement")==="line"&&(this.features=function(ie){const ye={},Ae={},_e=[];let Te=0;function Oe(it){_e.push(ie[it]),Te++}function De(it,Je,Ye){const nt=Ae[it];return delete Ae[it],Ae[Je]=nt,_e[nt].geometry[0].pop(),_e[nt].geometry[0]=_e[nt].geometry[0].concat(Ye[0]),nt}function at(it,Je,Ye){const nt=ye[Je];return delete ye[Je],ye[it]=nt,_e[nt].geometry[0].shift(),_e[nt].geometry[0]=Ye[0].concat(_e[nt].geometry[0]),nt}function mt(it,Je,Ye){const nt=Ye?Je[0][Je[0].length-1]:Je[0][0];return`${it}:${nt.x}:${nt.y}`}for(let it=0;it<ie.length;it++){const Je=ie[it],Ye=Je.geometry,nt=Je.text?Je.text.toString():null;if(!nt){Oe(it);continue}const Qe=mt(nt,Ye),He=mt(nt,Ye,!0);if(Qe in Ae&&He in ye&&Ae[Qe]!==ye[He]){const Pt=at(Qe,He,Ye),bt=De(Qe,He,_e[Pt].geometry);delete ye[Qe],delete Ae[He],Ae[mt(nt,_e[bt].geometry,!0)]=bt,_e[Pt].geometry=null}else Qe in Ae?De(Qe,He,Ye):He in ye?at(Qe,He,Ye):(Oe(it),ye[Qe]=Te-1,Ae[He]=Te-1)}return _e.filter(it=>it.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ie,ye)=>ie.sortKey-ye.sortKey)}update(n,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(n,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,c){const d=this.lineVertexArray.length;if(n.segment!==void 0){let g=n.dist(c[n.segment+1]),y=n.dist(c[n.segment]);const b={};for(let E=n.segment+1;E<c.length;E++)b[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:g},E<c.length-1&&(g+=c[E+1].dist(c[E]));for(let E=n.segment||0;E>=0;E--)b[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=c[E-1].dist(c[E]));for(let E=0;E<c.length;E++){const S=b[E];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,c,d,g,y,b,E,S,L,D,O,U){const W=n.indexArray,H=n.layoutVertexArray,ne=n.segments.prepareSegment(4*c.length,H,W,this.canOverlap?b.sortKey:void 0),ie=this.glyphOffsetArray.length,ye=ne.vertexLength,Ae=this.allowVerticalPlacement&&E===l.WritingMode.vertical?Math.PI/2:0,_e=b.text&&b.text.sections;for(let Te=0;Te<c.length;Te++){const{tl:Oe,tr:De,bl:at,br:mt,tex:it,pixelOffsetTL:Je,pixelOffsetBR:Ye,minFontScaleX:nt,minFontScaleY:Qe,glyphOffset:He,isSDF:Pt,sectionIndex:bt}=c[Te],qt=ne.vertexLength,Pi=He[1];Uh(H,S.x,S.y,Oe.x,Pi+Oe.y,it.x,it.y,d,Pt,Je.x,Je.y,nt,Qe),Uh(H,S.x,S.y,De.x,Pi+De.y,it.x+it.w,it.y,d,Pt,Ye.x,Je.y,nt,Qe),Uh(H,S.x,S.y,at.x,Pi+at.y,it.x,it.y+it.h,d,Pt,Je.x,Ye.y,nt,Qe),Uh(H,S.x,S.y,mt.x,Pi+mt.y,it.x+it.w,it.y+it.h,d,Pt,Ye.x,Ye.y,nt,Qe),dp(n.dynamicLayoutVertexArray,S,Ae),W.emplaceBack(qt,qt+1,qt+2),W.emplaceBack(qt+1,qt+2,qt+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),Te!==c.length-1&&bt===c[Te+1].sectionIndex||n.programConfigurations.populatePaintArrays(H.length,b,b.index,{},U,_e&&_e[bt])}n.placedSymbolArray.emplaceBack(S.x,S.y,ie,this.glyphOffsetArray.length-ie,ye,L,D,S.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],E,0,!1,0,O)}_addCollisionDebugVertex(n,c,d,g,y,b){return c.emplaceBack(0,0),n.emplaceBack(d.x,d.y,g,y,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(n,c,d,g,y,b,E){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),L=S.vertexLength,D=y.layoutVertexArray,O=y.collisionVertexArray,U=E.anchorX,W=E.anchorY;this._addCollisionDebugVertex(D,O,b,U,W,new ft(n,c)),this._addCollisionDebugVertex(D,O,b,U,W,new ft(d,c)),this._addCollisionDebugVertex(D,O,b,U,W,new ft(d,g)),this._addCollisionDebugVertex(D,O,b,U,W,new ft(n,g)),S.vertexLength+=4;const H=y.indexArray;H.emplaceBack(L,L+1),H.emplaceBack(L+1,L+2),H.emplaceBack(L+2,L+3),H.emplaceBack(L+3,L),S.primitiveLength+=4}addDebugCollisionBoxes(n,c,d,g){for(let y=n;y<c;y++){const b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new pp(Is,j_.members,rs),this.iconCollisionBox=new pp(Is,j_.members,rs);for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(n,c,d,g,y,b,E,S,L){const D={};for(let O=c;O<d;O++){const U=n.get(O);D.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.textFeatureIndex=U.featureIndex;break}for(let O=g;O<y;O++){const U=n.get(O);D.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalTextFeatureIndex=U.featureIndex;break}for(let O=b;O<E;O++){const U=n.get(O);D.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.iconFeatureIndex=U.featureIndex;break}for(let O=S;O<L;O++){const U=n.get(O);D.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},D.verticalIconFeatureIndex=U.featureIndex;break}return D}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,c){const d=n.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<g;y+=4)n.indexArray.emplaceBack(y,y+1,y+2),n.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(n),d=Math.cos(n),g=[],y=[],b=[];for(let E=0;E<this.symbolInstances.length;++E){b.push(E);const S=this.symbolInstances.get(E);g.push(0|Math.round(c*S.anchorX+d*S.anchorY)),y.push(S.featureIndex)}return b.sort((E,S)=>g[E]-g[S]||y[S]-y[E]),b}addToSortKeyRanges(n,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,y,b)=>{g>=0&&b.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ut("SymbolBucket",xl,{omit:["layers","collisionBoxArray","features","compareText"]}),xl.MAX_GLYPHS=65535,xl.addDynamicAttributes=dp;const qT=new En({"symbol-placement":new xt(we.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xt(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new xt(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new xt(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mt(we.layout_symbol["icon-size"]),"icon-text-fit":new xt(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xt(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mt(we.layout_symbol["icon-image"]),"icon-rotate":new Mt(we.layout_symbol["icon-rotate"]),"icon-padding":new Mt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Mt(we.layout_symbol["icon-offset"]),"icon-anchor":new Mt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(we.layout_symbol["text-rotation-alignment"]),"text-field":new Mt(we.layout_symbol["text-field"]),"text-font":new Mt(we.layout_symbol["text-font"]),"text-size":new Mt(we.layout_symbol["text-size"]),"text-max-width":new Mt(we.layout_symbol["text-max-width"]),"text-line-height":new xt(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Mt(we.layout_symbol["text-letter-spacing"]),"text-justify":new Mt(we.layout_symbol["text-justify"]),"text-radial-offset":new Mt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(we.layout_symbol["text-variable-anchor"]),"text-anchor":new Mt(we.layout_symbol["text-anchor"]),"text-max-angle":new xt(we.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(we.layout_symbol["text-writing-mode"]),"text-rotate":new Mt(we.layout_symbol["text-rotate"]),"text-padding":new xt(we.layout_symbol["text-padding"]),"text-keep-upright":new xt(we.layout_symbol["text-keep-upright"]),"text-transform":new Mt(we.layout_symbol["text-transform"]),"text-offset":new Mt(we.layout_symbol["text-offset"]),"text-allow-overlap":new xt(we.layout_symbol["text-allow-overlap"]),"text-overlap":new xt(we.layout_symbol["text-overlap"]),"text-ignore-placement":new xt(we.layout_symbol["text-ignore-placement"]),"text-optional":new xt(we.layout_symbol["text-optional"])});var mp={paint:new En({"icon-opacity":new Mt(we.paint_symbol["icon-opacity"]),"icon-color":new Mt(we.paint_symbol["icon-color"]),"icon-halo-color":new Mt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mt(we.paint_symbol["text-opacity"]),"text-color":new Mt(we.paint_symbol["text-color"],{runtimeType:an,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Mt(we.paint_symbol["text-halo-color"]),"text-halo-width":new Mt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Mt(we.paint_symbol["text-halo-blur"]),"text-translate":new xt(we.paint_symbol["text-translate"]),"text-translate-anchor":new xt(we.paint_symbol["text-translate-anchor"])}),layout:qT};class py{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Zi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(n.formattedSection))return c.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut("FormatSectionOverride",py,{omit:["defaultValue"]});class Vh extends Hr{constructor(n){super(n,mp)}recalculate(n,c){if(super.recalculate(n,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const y of d)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,c,d,g){const y=this.layout.get(n).evaluate(c,{},d,g),b=this._unevaluatedLayout._values[n];return b.isDataDriven()||oa(b.value)||!y?y:function(E,S){return S.replace(/{([^{}]+)}/g,(L,D)=>D in E?String(E[D]):"")}(c.properties,y)}createBucket(n){return new xl(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of mp.paint.overridableProperties){if(!Vh.hasPaintOverride(this.layout,n))continue;const c=this.paint.get(n),d=new py(c),g=new tl(d,c.property.specification);let y=null;y=c.value.kind==="constant"||c.value.kind==="source"?new la("source",g):new gc("composite",g,c.value.zoomStops),this.paint._values[n]=new Wr(c.property,y,c.parameters)}}_handleOverridablePaintPropertyUpdate(n,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Vh.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,c){const d=n.get("text-field"),g=mp.paint.properties[c];let y=!1;const b=E=>{for(const S of E)if(g.overrides&&g.overrides.hasOverride(S))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof le)b(d.value.value.sections);else if(d.value.kind==="source"){const E=L=>{y||(L instanceof pt&&Ie(L.value)===en?b(L.value.sections):L instanceof Qa?b(L.sections):L.eachChild(E))},S=d.value;S._styleExpression&&E(S._styleExpression.expression)}return y}}function gp(o,n,c){let d="never";const g=o.get(n);return g?d=g:o.get(c)&&(d="always"),d}var $T={paint:new En({"background-color":new xt(we.paint_background["background-color"]),"background-pattern":new Ic(we.paint_background["background-pattern"]),"background-opacity":new xt(we.paint_background["background-opacity"])})},ZT={paint:new En({"raster-opacity":new xt(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new xt(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(we.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(we.paint_raster["raster-saturation"]),"raster-contrast":new xt(we.paint_raster["raster-contrast"]),"raster-resampling":new xt(we.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(we.paint_raster["raster-fade-duration"])})};class XT extends Hr{constructor(n){super(n,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const YT={circle:class extends Hr{constructor(o){super(o,Pw)}createBucket(o){return new Gf(o)}queryRadius(o){const n=o;return kc("circle-radius",this,n)+kc("circle-stroke-width",this,n)+Eh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,n,c,d,g,y,b,E){const S=Sh(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),L=this.paint.get("circle-radius").evaluate(n,c)+this.paint.get("circle-stroke-width").evaluate(n,c),D=this.paint.get("circle-pitch-alignment")==="map",O=D?S:function(W,H){return W.map(ne=>S_(ne,H))}(S,E),U=D?L*b:L;for(const W of d)for(const H of W){const ne=D?H:S_(H,E);let ie=U;const ye=Ah([],[H.x,H.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ye[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=y.cameraToCenterDistance/ye[3]),ww(O,ne,ie))return!0}return!1}},heatmap:class extends Hr{constructor(o){super(o,Cw),this._updateColorRamp()}createBucket(o){return new A_(o)}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=I_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Hr{constructor(o){super(o,Mw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Hr{constructor(o){super(o,qw)}recalculate(o,n){super.recalculate(o,n);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new tp(o)}queryRadius(){return Eh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,n,c,d,g,y,b){return __(Sh(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),d)}isTileClipped(){return!0}},"fill-extrusion":class extends Hr{constructor(o){super(o,oT)}createBucket(o){return new np(o)}queryRadius(){return Eh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,n,c,d,g,y,b,E){const S=Sh(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),L=this.paint.get("fill-extrusion-height").evaluate(n,c),D=this.paint.get("fill-extrusion-base").evaluate(n,c),O=function(W,H,ne,ie){const ye=[];for(const Ae of W){const _e=[Ae.x,Ae.y,0,1];Ah(_e,_e,H),ye.push(new ft(_e[0]/_e[3],_e[1]/_e[3]))}return ye}(S,E),U=function(W,H,ne,ie){const ye=[],Ae=[],_e=ie[8]*H,Te=ie[9]*H,Oe=ie[10]*H,De=ie[11]*H,at=ie[8]*ne,mt=ie[9]*ne,it=ie[10]*ne,Je=ie[11]*ne;for(const Ye of W){const nt=[],Qe=[];for(const He of Ye){const Pt=He.x,bt=He.y,qt=ie[0]*Pt+ie[4]*bt+ie[12],Pi=ie[1]*Pt+ie[5]*bt+ie[13],ki=ie[2]*Pt+ie[6]*bt+ie[14],hn=ie[3]*Pt+ie[7]*bt+ie[15],kr=ki+Oe,In=hn+De,nn=qt+at,xn=Pi+mt,Cn=ki+it,kn=hn+Je,sr=new ft((qt+_e)/In,(Pi+Te)/In);sr.z=kr/In,nt.push(sr);const rn=new ft(nn/kn,xn/kn);rn.z=Cn/kn,Qe.push(rn)}ye.push(nt),Ae.push(Qe)}return[ye,Ae]}(d,D,L,E);return function(W,H,ne){let ie=1/0;__(ne,H)&&(ie=F_(ne,H[0]));for(let ye=0;ye<H.length;ye++){const Ae=H[ye],_e=W[ye];for(let Te=0;Te<Ae.length-1;Te++){const Oe=Ae[Te],De=[Oe,Ae[Te+1],_e[Te+1],_e[Te],Oe];g_(ne,De)&&(ie=Math.min(ie,F_(ne,De)))}}return ie!==1/0&&ie}(U[0],U[1],O)}},line:class extends Hr{constructor(o){super(o,N_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){o==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Di,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,n){super.recalculate(o,n),this.paint._values["line-floorwidth"]=U_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new rp(o)}queryRadius(o){const n=o,c=V_(kc("line-width",this,n),kc("line-gap-width",this,n)),d=kc("line-offset",this,n);return c/2+Math.abs(d)+Eh(this.paint.get("line-translate"))}queryIntersectsFeature(o,n,c,d,g,y,b){const E=Sh(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),S=b/2*V_(this.paint.get("line-width").evaluate(n,c),this.paint.get("line-gap-width").evaluate(n,c)),L=this.paint.get("line-offset").evaluate(n,c);return L&&(d=function(D,O){const U=[];for(let W=0;W<D.length;W++){const H=D[W],ne=[];for(let ie=0;ie<H.length;ie++){const ye=H[ie-1],Ae=H[ie],_e=H[ie+1],Te=ie===0?new ft(0,0):Ae.sub(ye)._unit()._perp(),Oe=ie===H.length-1?new ft(0,0):_e.sub(Ae)._unit()._perp(),De=Te._add(Oe)._unit(),at=De.x*Oe.x+De.y*Oe.y;at!==0&&De._mult(1/at),ne.push(De._mult(O)._add(Ae))}U.push(ne)}return U}(d,L*b)),function(D,O,U){for(let W=0;W<O.length;W++){const H=O[W];if(D.length>=3){for(let ne=0;ne<H.length;ne++)if(dl(D,H[ne]))return!0}if(Tw(D,H,U))return!0}return!1}(E,d,S)}isTileClipped(){return!0}},symbol:Vh,background:class extends Hr{constructor(o){super(o,$T)}},raster:class extends Hr{constructor(o){super(o,ZT)}}};class KT{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const my=63710088e-1;class Hi{constructor(n,c){if(isNaN(n)||isNaN(c))throw new Error(`Invalid LngLat object: (${n}, ${c})`);if(this.lng=+n,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Hi(V(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const c=Math.PI/180,d=this.lat*c,g=n.lat*c,y=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((n.lng-this.lng)*c);return my*Math.acos(Math.min(y,1))}toBounds(n=0){const c=360*n/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new Aa(new Hi(this.lng-d,this.lat-c),new Hi(this.lng+d,this.lat+c))}static convert(n){if(n instanceof Hi)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Hi(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Hi(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Aa{constructor(n,c){n&&(c?this.setSouthWest(n).setNorthEast(c):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof Hi?new Hi(n.lng,n.lat):Hi.convert(n),this}setSouthWest(n){return this._sw=n instanceof Hi?new Hi(n.lng,n.lat):Hi.convert(n),this}extend(n){const c=this._sw,d=this._ne;let g,y;if(n instanceof Hi)g=n,y=n;else{if(!(n instanceof Aa))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Aa.convert(n)):this.extend(Hi.convert(n)):this;if(g=n._sw,y=n._ne,!g||!y)return this}return c||d?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new Hi(g.lng,g.lat),this._ne=new Hi(y.lng,y.lat)),this}getCenter(){return new Hi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Hi(this.getWest(),this.getNorth())}getSouthEast(){return new Hi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:c,lat:d}=Hi.convert(n);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(n){return n instanceof Aa?n:n&&new Aa(n)}}const gy=2*Math.PI*my;function _y(o){return gy*Math.cos(o*Math.PI/180)}function yy(o){return(180+o)/360}function xy(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function vy(o,n){return o/_y(n)}function _p(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class jh{constructor(n,c,d=0){this.x=+n,this.y=+c,this.z=+d}static fromLngLat(n,c=0){const d=Hi.convert(n);return new jh(yy(d.lng),xy(d.lat),vy(c,d.lat))}toLngLat(){return new Hi(360*this.x-180,_p(this.y))}toAltitude(){return this.z*_y(_p(this.y))}meterInMercatorCoordinateUnits(){return 1/gy*(n=_p(this.y),1/Math.cos(n*Math.PI/180));var n}}function by(o,n,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[o*d-2*Math.PI*6378137/2,n*d-2*Math.PI*6378137/2]}class yp{constructor(n,c,d){if(n<0||n>25||d<0||d>=Math.pow(2,n)||c<0||c>=Math.pow(2,n))throw new Error(`x=${c}, y=${d}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=c,this.y=d,this.key=Wc(0,n,n,c,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,c,d){const g=(b=this.y,E=this.z,S=by(256*(y=this.x),256*(b=Math.pow(2,E)-b-1),E),L=by(256*(y+1),256*(b+1),E),S[0]+","+S[1]+","+L[0]+","+L[1]);var y,b,E,S,L;const D=function(O,U,W){let H,ne="";for(let ie=O;ie>0;ie--)H=1<<ie-1,ne+=(U&H?1:0)+(W&H?2:0);return ne}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(n){const c=this.z-n.z;return c>0&&n.x===this.x>>c&&n.y===this.y>>c}getTilePoint(n){const c=Math.pow(2,this.z);return new ft((n.x*c-this.x)*un,(n.y*c-this.y)*un)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wy{constructor(n,c){this.wrap=n,this.canonical=c,this.key=Wc(n,c.z,c.z,c.x,c.y)}}class Rr{constructor(n,c,d,g,y){if(n<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${d}`);this.overscaledZ=n,this.wrap=c,this.canonical=new yp(d,+g,+y),this.key=Wc(c,n,d,g,y)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?new Rr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(n,this.wrap,n,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(n,c){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-n;return n>this.canonical.z?Wc(this.wrap*+c,n,this.canonical.z,this.canonical.x,this.canonical.y):Wc(this.wrap*+c,n,n,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const c=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>c&&n.canonical.y===this.canonical.y>>c}children(n){if(this.overscaledZ>=n)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new Rr(c,this.wrap,c,d,g),new Rr(c,this.wrap,c,d+1,g),new Rr(c,this.wrap,c,d,g+1),new Rr(c,this.wrap,c,d+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Rr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new jh(n.x-this.wrap,n.y))}}function Wc(o,n,c,d,g){(o*=2)<0&&(o=-1*o-1);const y=1<<c;return(y*y*o+y*g+d).toString(36)+c.toString(36)+n.toString(36)}ut("CanonicalTileID",yp),ut("OverscaledTileID",Rr,{omit:["posMatrix"]});class Ty{constructor(n,c,d){if(this.uid=n,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void Fe(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const g=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=d||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let b=0;b<g;b++){const E=this.get(y,b);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(n,c){const d=new Uint8Array(this.data.buffer),g=4*this._idx(n,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(d[g],d[g+1],d[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(n,c){if(n<-1||n>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(n+1)}_unpackMapbox(n,c,d){return(256*n*256+256*c+d)/10-1e4}_unpackTerrarium(n,c,d){return 256*n+c+d/256-32768}getPixels(){return new Lr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,c,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,y=c*this.dim+this.dim,b=d*this.dim,E=d*this.dim+this.dim;switch(c){case-1:g=y-1;break;case 1:y=g+1}switch(d){case-1:b=E-1;break;case 1:E=b+1}const S=-c*this.dim,L=-d*this.dim;for(let D=b;D<E;D++)for(let O=g;O<y;O++)this.data[this._idx(O,D)]=n.data[this._idx(O+S,D+L)]}}ut("DEMData",Ty);class Ey{constructor(n){this._stringToNumber={},this._numberToString=[];for(let c=0;c<n.length;c++){const d=n[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class Sy{constructor(n,c,d,g,y){this.type="Feature",this._vectorTileFeature=n,n._z=c,n._x=d,n._y=g,this.properties=n.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(n[c]=this[c]);return n}}class Ay{constructor(n,c){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ya(un,16,0),this.grid3D=new ya(un,16,0),this.featureIndexArray=new Ht,this.promoteId=c}insert(n,c,d,g,y,b){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,y);const S=b?this.grid3D:this.grid;for(let L=0;L<c.length;L++){const D=c[L],O=[1/0,1/0,-1/0,-1/0];for(let U=0;U<D.length;U++){const W=D[U];O[0]=Math.min(O[0],W.x),O[1]=Math.min(O[1],W.y),O[2]=Math.max(O[2],W.x),O[3]=Math.max(O[3],W.y)}O[0]<un&&O[1]<un&&O[2]>=0&&O[3]>=0&&S.insert(E,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ko.VectorTile(new sp(this.rawTileData)).layers,this.sourceLayerCoder=new Ey(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,c,d,g){this.loadVTLayers();const y=n.params||{},b=un/n.tileSize/n.scale,E=rl(y.filter),S=n.queryGeometry,L=n.queryPadding*b,D=Iy(S),O=this.grid.query(D.minX-L,D.minY-L,D.maxX+L,D.maxY+L),U=Iy(n.cameraQueryGeometry),W=this.grid3D.query(U.minX-L,U.minY-L,U.maxX+L,U.maxY+L,(ie,ye,Ae,_e)=>function(Te,Oe,De,at,mt){for(const Je of Te)if(Oe<=Je.x&&De<=Je.y&&at>=Je.x&&mt>=Je.y)return!0;const it=[new ft(Oe,De),new ft(Oe,mt),new ft(at,mt),new ft(at,De)];if(Te.length>2){for(const Je of it)if(dl(Te,Je))return!0}for(let Je=0;Je<Te.length-1;Je++)if(Sw(Te[Je],Te[Je+1],it))return!0;return!1}(n.cameraQueryGeometry,ie-L,ye-L,Ae+L,_e+L));for(const ie of W)O.push(ie);O.sort(JT);const H={};let ne;for(let ie=0;ie<O.length;ie++){const ye=O[ie];if(ye===ne)continue;ne=ye;const Ae=this.featureIndexArray.get(ye);let _e=null;this.loadMatchingFeature(H,Ae.bucketIndex,Ae.sourceLayerIndex,Ae.featureIndex,E,y.layers,y.availableImages,c,d,g,(Te,Oe,De)=>(_e||(_e=Ta(Te)),Oe.queryIntersectsFeature(S,Te,De,_e,this.z,n.transform,b,n.pixelPosMatrix)))}return H}loadMatchingFeature(n,c,d,g,y,b,E,S,L,D,O){const U=this.bucketLayerIDs[c];if(b&&!function(ie,ye){for(let Ae=0;Ae<ie.length;Ae++)if(ye.indexOf(ie[Ae])>=0)return!0;return!1}(b,U))return;const W=this.sourceLayerCoder.decode(d),H=this.vtLayers[W].feature(g);if(y.needGeometry){const ie=Ea(H,!0);if(!y.filter(new Li(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!y.filter(new Li(this.tileID.overscaledZ),H))return;const ne=this.getId(H,W);for(let ie=0;ie<U.length;ie++){const ye=U[ie];if(b&&b.indexOf(ye)<0)continue;const Ae=S[ye];if(!Ae)continue;let _e={};ne&&D&&(_e=D.getState(Ae.sourceLayer||"_geojsonTileLayer",ne));const Te=Y({},L[ye]);Te.paint=Py(Te.paint,Ae.paint,H,_e,E),Te.layout=Py(Te.layout,Ae.layout,H,_e,E);const Oe=!O||O(H,Ae,_e);if(!Oe)continue;const De=new Sy(H,this.z,this.x,this.y,ne);De.layer=Te;let at=n[ye];at===void 0&&(at=n[ye]=[]),at.push({featureIndex:g,feature:De,intersectionZ:Oe})}}lookupSymbolFeatures(n,c,d,g,y,b,E,S){const L={};this.loadVTLayers();const D=rl(y);for(const O of n)this.loadMatchingFeature(L,d,g,O,D,b,E,S,c);return L}hasLayer(n){for(const c of this.bucketLayerIDs)for(const d of c)if(n===d)return!0;return!1}getId(n,c){let d=n.id;return this.promoteId&&(d=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function Py(o,n,c,d,g){return pe(o,(y,b)=>{const E=n instanceof ba?n.get(b):null;return E&&E.evaluate?E.evaluate(c,d,g):E})}function Iy(o){let n=1/0,c=1/0,d=-1/0,g=-1/0;for(const y of o)n=Math.min(n,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),g=Math.max(g,y.y);return{minX:n,minY:c,maxX:d,maxY:g}}function JT(o,n){return n-o}var xp;ut("FeatureIndex",Ay,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(xp=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",xp.load="load",xp.fullLoad="fullLoad";let Gh=null,Hc=[];const vp=1e3/30,QT={mark(o){performance.mark(o)},frame(o){const n=o;Gh!=null&&Hc.push(n-Gh),Gh=n},clearMetrics(){Gh=null,Hc=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const o in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[o])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const o=performance.getEntriesByName("loadTime")[0].duration,n=performance.getEntriesByName("fullLoadTime")[0].duration,c=Hc.length,d=1/(Hc.reduce((y,b)=>y+b,0)/c/1e3),g=Hc.filter(y=>y>vp).reduce((y,b)=>y+(b-vp)/vp,0);return{loadTime:o,fullLoadTime:n,fps:d,percentDroppedFrames:g/(c+g)*100}}};l.AJAXError=me,l.ARRAY_TYPE=qn,l.Actor=class{constructor(o,n,c){this.target=o,this.parent=n,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ce(["receive","process"],this),this.invoker=new KT(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=_t()?o:window}send(o,n,c,d,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[y]=c);const b=zt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:Zs(n,b)},b),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(o){const n=o.data,c=n.id;if(c&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){delete this.tasks[c];const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d()}else _t()||n.mustQueue?(this.tasks[c]=n,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,n)}process(){if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),n=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),n&&this.processTask(o,n)}processTask(o,n){if(n.type==="<response>"){const c=this.callbacks[o];delete this.callbacks[o],c&&(n.error?c(Ts(n.error)):c(null,Ts(n.data)))}else{let c=!1;const d=zt(this.globalScope)?void 0:[],g=n.hasCallback?(E,S)=>{c=!0,delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:E?Zs(E):null,data:Zs(S,d)},d)}:E=>{c=!0};let y=null;const b=Ts(n.data);if(this.parent[n.type])y=this.parent[n.type](n.sourceMapId,b,g);else if(this.parent.getWorkerSource){const E=n.type.split(".");y=this.parent.getWorkerSource(n.sourceMapId,E[0],b.source)[E[1]](b,g)}else g(new Error(`Could not find function ${n.type}`));!c&&y&&y.cancel&&(this.cancelCallbacks[o]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=zc,l.CanonicalTileID=yp,l.CollisionBoxArray=Le,l.CollisionCircleLayoutArray=class extends z{},l.Color=$,l.DEMData=Ty,l.DataConstantProperty=xt,l.DictionaryCoder=Ey,l.EXTENT=un,l.ErrorEvent=Vt,l.EvaluationParameters=Li,l.Event=Lt,l.Evented=Qt,l.FeatureIndex=Ay,l.FillBucket=tp,l.FillExtrusionBucket=np,l.GeoJSONFeature=Sy,l.ImageAtlas=Y_,l.ImagePosition=ap,l.LineBucket=rp,l.LineStripIndexArray=class extends te{},l.LngLat=Hi,l.LngLatBounds=Aa,l.MercatorCoordinate=jh,l.ONE_EM=Sn,l.OverscaledTileID=Rr,l.PerformanceUtils=QT,l.PosArray=At,l.Properties=En,l.QuadTriangleArray=class extends j{},l.RGBAImage=Lr,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},l.ResourceType=oe,l.SegmentVector=Yt,l.SymbolBucket=xl,l.Transitionable=yh,l.TriangleIndexArray=Wn,l.Uniform1f=Js,l.Uniform1i=class extends Ks{constructor(o,n){super(o,n),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},l.Uniform2f=class extends Ks{constructor(o,n){super(o,n),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},l.Uniform3f=class extends Ks{constructor(o,n){super(o,n),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},l.Uniform4f=ul,l.UniformColor=d_,l.UniformMatrix4f=class extends Ks{constructor(o,n){super(o,n),this.current=vw}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let n=1;n<16;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},l.UnwrappedTileID=wy,l.ValidationError=je,l.ZoomHistory=vc,l.add=function(o,n,c){return o[0]=n[0]+c[0],o[1]=n[1]+c[1],o[2]=n[2]+c[2],o},l.addDynamicAttributes=dp,l.asyncAll=function(o,n,c){if(!o.length)return c(null,[]);let d=o.length;const g=new Array(o.length);let y=null;o.forEach((b,E)=>{n(b,(S,L)=>{S&&(y=S),g[E]=L,--d==0&&c(y,g)})})},l.bezier=P,l.bindAll=ce,l.cacheEntryPossiblyAdded=function(o){Vn++,Vn>Sr&&(o.getActor().send("enforceCacheSizeLimit",Fi),Vn=0)},l.clamp=C,l.clearTileCache=function(o){const n=caches.delete(Vi);o&&n.catch(o).then(()=>o())},l.clipLine=ly,l.clone=function(o){var n=new qn(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},l.clone$1=he,l.clone$2=function(o){var n=new qn(3);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n},l.collisionCircleLayout=_T,l.config=ti,l.copy=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},l.create=function(){var o=new qn(16);return qn!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},l.create$1=v_,l.createExpression=aa,l.createFilter=rl,l.createLayout=tn,l.createStyleLayer=function(o){return o.type==="custom"?new XT(o):new YT[o.type](o)},l.cross=function(o,n,c){var d=n[0],g=n[1],y=n[2],b=c[0],E=c[1],S=c[2];return o[0]=g*S-y*E,o[1]=y*b-d*S,o[2]=d*E-g*b,o},l.dot=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]},l.dot$1=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]+o[3]*n[3]},l.ease=M,l.emitValidationErrors=ol,l.enforceCacheSizeLimit=function(o){gr(),fn&&fn.then(n=>{n.keys().then(c=>{for(let d=0;d<c.length-o;d++)n.delete(c[d])})})},l.equals=function(o,n){var c=o[0],d=o[1],g=o[2],y=o[3],b=o[4],E=o[5],S=o[6],L=o[7],D=o[8],O=o[9],U=o[10],W=o[11],H=o[12],ne=o[13],ie=o[14],ye=o[15],Ae=n[0],_e=n[1],Te=n[2],Oe=n[3],De=n[4],at=n[5],mt=n[6],it=n[7],Je=n[8],Ye=n[9],nt=n[10],Qe=n[11],He=n[12],Pt=n[13],bt=n[14],qt=n[15];return Math.abs(c-Ae)<=Hn*Math.max(1,Math.abs(c),Math.abs(Ae))&&Math.abs(d-_e)<=Hn*Math.max(1,Math.abs(d),Math.abs(_e))&&Math.abs(g-Te)<=Hn*Math.max(1,Math.abs(g),Math.abs(Te))&&Math.abs(y-Oe)<=Hn*Math.max(1,Math.abs(y),Math.abs(Oe))&&Math.abs(b-De)<=Hn*Math.max(1,Math.abs(b),Math.abs(De))&&Math.abs(E-at)<=Hn*Math.max(1,Math.abs(E),Math.abs(at))&&Math.abs(S-mt)<=Hn*Math.max(1,Math.abs(S),Math.abs(mt))&&Math.abs(L-it)<=Hn*Math.max(1,Math.abs(L),Math.abs(it))&&Math.abs(D-Je)<=Hn*Math.max(1,Math.abs(D),Math.abs(Je))&&Math.abs(O-Ye)<=Hn*Math.max(1,Math.abs(O),Math.abs(Ye))&&Math.abs(U-nt)<=Hn*Math.max(1,Math.abs(U),Math.abs(nt))&&Math.abs(W-Qe)<=Hn*Math.max(1,Math.abs(W),Math.abs(Qe))&&Math.abs(H-He)<=Hn*Math.max(1,Math.abs(H),Math.abs(He))&&Math.abs(ne-Pt)<=Hn*Math.max(1,Math.abs(ne),Math.abs(Pt))&&Math.abs(ie-bt)<=Hn*Math.max(1,Math.abs(ie),Math.abs(bt))&&Math.abs(ye-qt)<=Hn*Math.max(1,Math.abs(ye),Math.abs(qt))},l.evaluateSizeForFeature=function(o,{uSize:n,uSizeT:c},{lowerSize:d,upperSize:g}){return o.kind==="source"?d/to:o.kind==="composite"?Wt(d/to,g/to,c):n},l.evaluateSizeForZoom=function(o,n){let c=0,d=0;if(o.kind==="constant")d=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:b}=o,E=g?C(ir.interpolationFactor(g,n,y,b),0,1):0;o.kind==="camera"?d=Wt(o.minSize,o.maxSize,E):c=E}return{uSizeT:c,uSize:d}},l.evaluateVariableOffset=hy,l.evented=Pc,l.exported=$i,l.exported$1=Ji,l.extend=Y,l.filterObject=ve,l.fromRotation=function(o,n){var c=Math.sin(n),d=Math.cos(n);return o[0]=d,o[1]=c,o[2]=0,o[3]=-c,o[4]=d,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},l.fromScaling=function(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},l.getAnchorAlignment=cp,l.getAnchorJustification=hp,l.getArrayBuffer=qe,l.getImage=Tt,l.getJSON=function(o,n){return Be(Y(o,{type:"json"}),n)},l.getOverlapMode=gp,l.getRTLTextPluginStatus=xa,l.getReferrer=Re,l.getVideo=function(o,n){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){n(null,c)};for(let d=0;d<o.length;d++){const g=window.document.createElement("source");rt(o[d])||(c.crossOrigin="Anonymous"),g.src=o[d],c.appendChild(g)}return{cancel:()=>{}}},l.identity=qf,l.invert=function(o,n){var c=n[0],d=n[1],g=n[2],y=n[3],b=n[4],E=n[5],S=n[6],L=n[7],D=n[8],O=n[9],U=n[10],W=n[11],H=n[12],ne=n[13],ie=n[14],ye=n[15],Ae=c*E-d*b,_e=c*S-g*b,Te=c*L-y*b,Oe=d*S-g*E,De=d*L-y*E,at=g*L-y*S,mt=D*ne-O*H,it=D*ie-U*H,Je=D*ye-W*H,Ye=O*ie-U*ne,nt=O*ye-W*ne,Qe=U*ye-W*ie,He=Ae*Qe-_e*nt+Te*Ye+Oe*Je-De*it+at*mt;return He?(o[0]=(E*Qe-S*nt+L*Ye)*(He=1/He),o[1]=(g*nt-d*Qe-y*Ye)*He,o[2]=(ne*at-ie*De+ye*Oe)*He,o[3]=(U*De-O*at-W*Oe)*He,o[4]=(S*Je-b*Qe-L*it)*He,o[5]=(c*Qe-g*Je+y*it)*He,o[6]=(ie*Te-H*at-ye*_e)*He,o[7]=(D*at-U*Te+W*_e)*He,o[8]=(b*nt-E*Je+L*mt)*He,o[9]=(d*Je-c*nt-y*mt)*He,o[10]=(H*De-ne*Te+ye*Ae)*He,o[11]=(O*Te-D*De-W*Ae)*He,o[12]=(E*it-b*Ye-S*mt)*He,o[13]=(c*Ye-d*it+g*mt)*He,o[14]=(ne*_e-H*Oe-ie*Ae)*He,o[15]=(D*Oe-O*_e+U*Ae)*He,o):null},l.isImageBitmap=Ut,l.isSafari=zt,l.isWorker=_t,l.keysDifference=function(o,n){const c=[];for(const d in o)d in n||c.push(d);return c},l.lazyLoadRTLTextPlugin=function(){xr.isLoading()||xr.isLoaded()||xa()!=="deferred"||_h()},l.makeRequest=Be,l.mapObject=pe,l.mercatorXfromLng=yy,l.mercatorYfromLat=xy,l.mercatorZfromAltitude=vy,l.mul=Iw,l.mul$1=function(o,n,c){return o[0]=n[0]*c[0],o[1]=n[1]*c[1],o[2]=n[2]*c[2],o[3]=n[3]*c[3],o},l.multiply=b_,l.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},l.normalize=function(o,n){var c=n[0],d=n[1],g=n[2],y=c*c+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=n[0]*y,o[1]=n[1]*y,o[2]=n[2]*y,o},l.number=Wt,l.ortho=function(o,n,c,d,g,y,b){var E=1/(n-c),S=1/(d-g),L=1/(y-b);return o[0]=-2*E,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*S,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*L,o[11]=0,o[12]=(n+c)*E,o[13]=(g+d)*S,o[14]=(b+y)*L,o[15]=1,o},l.parseCacheControl=lt,l.parseGlyphPbf=function(o){return new sp(o).readFields(IT,[])},l.pbf=sp,l.performSymbolLayout=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=un/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const n=o.bucket.layers[0].layout,c=o.bucket.layers[0]._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new Li(o.bucket.zoom+1),o.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new Li(o.bucket.zoom+1),o.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new Li(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:L}=o.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new Li(S),o.canonical),c["text-size"].possiblyEvaluate(new Li(L),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:L}=o.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new Li(S),o.canonical),c["icon-size"].possiblyEvaluate(new Li(L),o.canonical)]}const g=n.get("text-line-height")*Sn,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),E=n.get("text-size");for(const S of o.bucket.features){const L=n.get("text-font").evaluate(S,{},o.canonical).join(","),D=E.evaluate(S,{},o.canonical),O=d.layoutTextSize.evaluate(S,{},o.canonical),U=d.layoutIconSize.evaluate(S,{},o.canonical),W={horizontal:{},vertical:void 0},H=S.text;let ne,ie=[0,0];if(H){const _e=H.toString(),Te=n.get("text-letter-spacing").evaluate(S,{},o.canonical)*Sn,Oe=Bf(_e)?Te:0,De=n.get("text-anchor").evaluate(S,{},o.canonical),at=n.get("text-variable-anchor");if(!at){const nt=n.get("text-radial-offset").evaluate(S,{},o.canonical);ie=nt?hy(De,[nt*Sn,up]):n.get("text-offset").evaluate(S,{},o.canonical).map(Qe=>Qe*Sn)}let mt=y?"center":n.get("text-justify").evaluate(S,{},o.canonical);const it=n.get("symbol-placement"),Je=it==="point"?n.get("text-max-width").evaluate(S,{},o.canonical)*Sn:0,Ye=()=>{o.bucket.allowVerticalPlacement&&al(_e)&&(W.vertical=Dh(H,o.glyphMap,o.glyphPositions,o.imagePositions,L,Je,g,De,"left",Oe,ie,l.WritingMode.vertical,!0,it,O,D))};if(!y&&at){const nt=mt==="auto"?at.map(He=>hp(He)):[mt];let Qe=!1;for(let He=0;He<nt.length;He++){const Pt=nt[He];if(!W.horizontal[Pt])if(Qe)W.horizontal[Pt]=W.horizontal[0];else{const bt=Dh(H,o.glyphMap,o.glyphPositions,o.imagePositions,L,Je,g,"center",Pt,Oe,ie,l.WritingMode.horizontal,!1,it,O,D);bt&&(W.horizontal[Pt]=bt,Qe=bt.positionedLines.length===1)}}Ye()}else{mt==="auto"&&(mt=hp(De));const nt=Dh(H,o.glyphMap,o.glyphPositions,o.imagePositions,L,Je,g,De,mt,Oe,ie,l.WritingMode.horizontal,!1,it,O,D);nt&&(W.horizontal[mt]=nt),Ye(),al(_e)&&y&&b&&(W.vertical=Dh(H,o.glyphMap,o.glyphPositions,o.imagePositions,L,Je,g,De,mt,Oe,ie,l.WritingMode.vertical,!1,it,O,D))}}let ye=!1;if(S.icon&&S.icon.name){const _e=o.imageMap[S.icon.name];_e&&(ne=DT(o.imagePositions[S.icon.name],n.get("icon-offset").evaluate(S,{},o.canonical),n.get("icon-anchor").evaluate(S,{},o.canonical)),ye=!!_e.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=ye:o.bucket.sdfIcons!==ye&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==o.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Ae=fy(W.horizontal)||W.vertical;o.bucket.iconsInText=!!Ae&&Ae.iconsInText,(Ae||ne)&&VT(o.bucket,S,W,ne,o.imageMap,d,O,U,ie,ye,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},l.perspective=function(o,n,c,d,g){var y,b=1/Math.tan(n/2);return o[0]=b/c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=b,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,g!=null&&g!==1/0?(o[10]=(g+d)*(y=1/(d-g)),o[14]=2*g*d*y):(o[10]=-1,o[14]=-2*d),o},l.pick=function(o,n){const c={};for(let d=0;d<n.length;d++){const g=n[d];g in o&&(c[g]=o[g])}return c},l.plugin=xr,l.pointGeometry=ft,l.polygonIntersectsPolygon=g_,l.potpack=X_,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=ut,l.registerForPluginStateChange=function(o){return o({pluginStatus:Gn,pluginURL:Es}),Pc.on("pluginStateChange",o),o},l.renderColorRamp=I_,l.rotateX=function(o,n,c){var d=Math.sin(c),g=Math.cos(c),y=n[4],b=n[5],E=n[6],S=n[7],L=n[8],D=n[9],O=n[10],U=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=y*g+L*d,o[5]=b*g+D*d,o[6]=E*g+O*d,o[7]=S*g+U*d,o[8]=L*g-y*d,o[9]=D*g-b*d,o[10]=O*g-E*d,o[11]=U*g-S*d,o},l.rotateZ=function(o,n,c){var d=Math.sin(c),g=Math.cos(c),y=n[0],b=n[1],E=n[2],S=n[3],L=n[4],D=n[5],O=n[6],U=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=y*g+L*d,o[1]=b*g+D*d,o[2]=E*g+O*d,o[3]=S*g+U*d,o[4]=L*g-y*d,o[5]=D*g-b*d,o[6]=O*g-E*d,o[7]=U*g-S*d,o},l.scale=function(o,n,c){var d=c[0],g=c[1],y=c[2];return o[0]=n[0]*d,o[1]=n[1]*d,o[2]=n[2]*d,o[3]=n[3]*d,o[4]=n[4]*g,o[5]=n[5]*g,o[6]=n[6]*g,o[7]=n[7]*g,o[8]=n[8]*y,o[9]=n[9]*y,o[10]=n[10]*y,o[11]=n[11]*y,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},l.scale$1=function(o,n,c){return o[0]=n[0]*c,o[1]=n[1]*c,o[2]=n[2]*c,o},l.setCacheLimits=function(o,n){Fi=o,Sr=n},l.setRTLTextPlugin=function(o,n,c=!1){if(Gn===Tc||Gn===Ec||Gn===Sc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Es=$i.resolveURL(o),Gn=Tc,Ac=n,Co(),c||_h()},l.spec=we,l.sphericalToCartesian=function([o,n,c]){return n+=90,n*=Math.PI/180,c*=Math.PI/180,{x:o*Math.cos(n)*Math.sin(c),y:o*Math.sin(n)*Math.sin(c),z:o*Math.cos(c)}},l.sqrLen=function(o){var n=o[0],c=o[1];return n*n+c*c},l.sub=function(o,n,c){return o[0]=n[0]-c[0],o[1]=n[1]-c[1],o[2]=n[2]-c[2],o},l.toEvaluationFeature=Ea,l.transformMat3=function(o,n,c){var d=n[0],g=n[1],y=n[2];return o[0]=d*c[0]+g*c[3]+y*c[6],o[1]=d*c[1]+g*c[4]+y*c[7],o[2]=d*c[2]+g*c[5]+y*c[8],o},l.transformMat4=Ah,l.transformMat4$1=function(o,n,c){var d=n[0],g=n[1];return o[0]=c[0]*d+c[4]*g+c[12],o[1]=c[1]*d+c[5]*g+c[13],o},l.translate=function(o,n,c){var d,g,y,b,E,S,L,D,O,U,W,H,ne=c[0],ie=c[1],ye=c[2];return n===o?(o[12]=n[0]*ne+n[4]*ie+n[8]*ye+n[12],o[13]=n[1]*ne+n[5]*ie+n[9]*ye+n[13],o[14]=n[2]*ne+n[6]*ie+n[10]*ye+n[14],o[15]=n[3]*ne+n[7]*ie+n[11]*ye+n[15]):(g=n[1],y=n[2],b=n[3],E=n[4],S=n[5],L=n[6],D=n[7],O=n[8],U=n[9],W=n[10],H=n[11],o[0]=d=n[0],o[1]=g,o[2]=y,o[3]=b,o[4]=E,o[5]=S,o[6]=L,o[7]=D,o[8]=O,o[9]=U,o[10]=W,o[11]=H,o[12]=d*ne+E*ie+O*ye+n[12],o[13]=g*ne+S*ie+U*ye+n[13],o[14]=y*ne+L*ie+W*ye+n[14],o[15]=b*ne+D*ie+H*ye+n[15]),o},l.triggerPluginCompletionEvent=gh,l.unicodeBlockLookup=tt,l.uniqueId=function(){return J++},l.validateCustomStyleLayer=function(o){const n=[],c=o.id;return c===void 0&&n.push({message:`layers.${c}: missing required property "id"`}),o.render===void 0&&n.push({message:`layers.${c}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&n.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),n},l.validateLight=xc,l.validateStyle=_a,l.vectorTile=ko,l.warnOnce=Fe,l.wrap=V}),u(["./shared"],function(l){function x(X){const k=typeof X;if(k==="number"||k==="boolean"||k==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){let $="[";for(const se of X)$+=`${x(se)},`;return`${$}]`}const F=Object.keys(X).sort();let q="{";for(let $=0;$<F.length;$++)q+=`${JSON.stringify(F[$])}:${x(X[F[$]])},`;return`${q}}`}function w(X){let k="";for(const F of l.refProperties)k+=`/${x(X[F])}`;return k}class P{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,F){for(const $ of k){this._layerConfigs[$.id]=$;const se=this._layers[$.id]=l.createStyleLayer($);se._featureFilter=l.createFilter(se.filter),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(const $ of F)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};const q=function($,se){const de={};for(let re=0;re<$.length;re++){const fe=se&&se[$[re].id]||w($[re]);se&&(se[$[re].id]=fe);let Ce=de[fe];Ce||(Ce=de[fe]=[]),Ce.push($[re])}const le=[];for(const re in de)le.push(de[re]);return le}(Object.values(this._layerConfigs),this.keyCache);for(const $ of q){const se=$.map(Ne=>this._layers[Ne.id]),de=se[0];if(de.visibility==="none")continue;const le=de.source||"";let re=this.familiesBySource[le];re||(re=this.familiesBySource[le]={});const fe=de.sourceLayer||"_geojsonTileLayer";let Ce=re[fe];Ce||(Ce=re[fe]=[]),Ce.push(se)}}}class M{constructor(k){const F={},q=[];for(const le in k){const re=k[le],fe=F[le]={};for(const Ce in re){const Ne=re[+Ce];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Ie={x:0,y:0,w:Ne.bitmap.width+2,h:Ne.bitmap.height+2};q.push(Ie),fe[Ce]={rect:Ie,metrics:Ne.metrics}}}const{w:$,h:se}=l.potpack(q),de=new l.AlphaImage({width:$||1,height:se||1});for(const le in k){const re=k[le];for(const fe in re){const Ce=re[+fe];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const Ne=F[le][fe].rect;l.AlphaImage.copy(Ce.bitmap,de,{x:0,y:0},{x:Ne.x+1,y:Ne.y+1},Ce.bitmap)}}this.image=de,this.positions=F}}l.register("GlyphAtlas",M);class C{constructor(k){this.tileID=new l.OverscaledTileID(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId}parse(k,F,q,$,se){this.status="parsing",this.data=k,this.collisionBoxArray=new l.CollisionBoxArray;const de=new l.DictionaryCoder(Object.keys(k.layers).sort()),le=new l.FeatureIndex(this.tileID,this.promoteId);le.bucketLayerIDs=[];const re={},fe={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},Ce=F.familiesBySource[this.source];for(const Ct in Ce){const kt=k.layers[Ct];if(!kt)continue;kt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${Ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Zt=de.encode(Ct),Kt=[];for(let Ti=0;Ti<kt.length;Ti++){const Ei=kt.feature(Ti),ln=le.getId(Ei,Ct);Kt.push({feature:Ei,id:ln,index:Ti,sourceLayerIndex:Zt})}for(const Ti of Ce[Ct]){const Ei=Ti[0];Ei.source!==this.source&&l.warnOnce(`layer.source = ${Ei.source} does not equal this.source = ${this.source}`),Ei.minzoom&&this.zoom<Math.floor(Ei.minzoom)||Ei.maxzoom&&this.zoom>=Ei.maxzoom||Ei.visibility!=="none"&&(V(Ti,this.zoom,q),(re[Ei.id]=Ei.createBucket({index:le.bucketLayerIDs.length,layers:Ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Zt,sourceID:this.source})).populate(Kt,fe,this.tileID.canonical),le.bucketLayerIDs.push(Ti.map(ln=>ln.id)))}}let Ne,Ie,ct,pt;const et=l.mapObject(fe.glyphDependencies,Ct=>Object.keys(Ct).map(Number));Object.keys(et).length?$.send("getGlyphs",{uid:this.uid,stacks:et},(Ct,kt)=>{Ne||(Ne=Ct,Ie=kt,Gt.call(this))}):Ie={};const St=Object.keys(fe.iconDependencies);St.length?$.send("getImages",{icons:St,source:this.source,tileID:this.tileID,type:"icons"},(Ct,kt)=>{Ne||(Ne=Ct,ct=kt,Gt.call(this))}):ct={};const vt=Object.keys(fe.patternDependencies);function Gt(){if(Ne)return se(Ne);if(Ie&&ct&&pt){const Ct=new M(Ie),kt=new l.ImageAtlas(ct,pt);for(const Zt in re){const Kt=re[Zt];Kt instanceof l.SymbolBucket?(V(Kt.layers,this.zoom,q),l.performSymbolLayout({bucket:Kt,glyphMap:Ie,glyphPositions:Ct.positions,imageMap:ct,imagePositions:kt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Kt.hasPattern&&(Kt instanceof l.LineBucket||Kt instanceof l.FillBucket||Kt instanceof l.FillExtrusionBucket)&&(V(Kt.layers,this.zoom,q),Kt.addFeatures(fe,this.tileID.canonical,kt.patternPositions))}this.status="done",se(null,{buckets:Object.values(re).filter(Zt=>!Zt.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ct.image,imageAtlas:kt,glyphMap:this.returnDependencies?Ie:null,iconMap:this.returnDependencies?ct:null,glyphPositions:this.returnDependencies?Ct.positions:null})}}vt.length?$.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"patterns"},(Ct,kt)=>{Ne||(Ne=Ct,pt=kt,Gt.call(this))}):pt={},Gt.call(this)}}function V(X,k,F){const q=new l.EvaluationParameters(k);for(const $ of X)$.recalculate(q,F)}function Y(X,k){const F=l.getArrayBuffer(X.request,(q,$,se,de)=>{q?k(q):$&&k(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf($)),rawData:$,cacheControl:se,expires:de})});return()=>{F.cancel(),k()}}class J{constructor(k,F,q,$){this.actor=k,this.layerIndex=F,this.availableImages=q,this.loadVectorData=$||Y,this.loading={},this.loaded={}}loadTile(k,F){const q=k.uid;this.loading||(this.loading={});const $=!!(k&&k.request&&k.request.collectResourceTiming)&&new l.RequestPerformance(k.request),se=this.loading[q]=new C(k);se.abort=this.loadVectorData(k,(de,le)=>{if(delete this.loading[q],de||!le)return se.status="done",this.loaded[q]=se,F(de);const re=le.rawData,fe={};le.expires&&(fe.expires=le.expires),le.cacheControl&&(fe.cacheControl=le.cacheControl);const Ce={};if($){const Ne=$.finish();Ne&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Ne)))}se.vectorTile=le.vectorTile,se.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ne,Ie)=>{if(Ne||!Ie)return F(Ne);F(null,l.extend({rawTileData:re.slice(0)},Ie,fe,Ce))}),this.loaded=this.loaded||{},this.loaded[q]=se})}reloadTile(k,F){const q=this.loaded,$=k.uid,se=this;if(q&&q[$]){const de=q[$];de.showCollisionBoxes=k.showCollisionBoxes;const le=(re,fe)=>{const Ce=de.reloadCallback;Ce&&(delete de.reloadCallback,de.parse(de.vectorTile,se.layerIndex,this.availableImages,se.actor,Ce)),F(re,fe)};de.status==="parsing"?de.reloadCallback=le:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,le):le())}}abortTile(k,F){const q=this.loading,$=k.uid;q&&q[$]&&q[$].abort&&(q[$].abort(),delete q[$]),F()}removeTile(k,F){const q=this.loaded,$=k.uid;q&&q[$]&&delete q[$],F()}}class ce{constructor(){this.loaded={}}loadTile(k,F){const{uid:q,encoding:$,rawImageData:se}=k,de=l.isImageBitmap(se)?this.getImageData(se):se,le=new l.DEMData(q,de,$);this.loaded=this.loaded||{},this.loaded[q]=le,F(null,le)}getImageData(k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,k.width+2,k.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(k){const F=this.loaded,q=k.uid;F&&F[q]&&delete F[q]}}var pe=function X(k,F){var q,$=k&&k.type;if($==="FeatureCollection")for(q=0;q<k.features.length;q++)X(k.features[q],F);else if($==="GeometryCollection")for(q=0;q<k.geometries.length;q++)X(k.geometries[q],F);else if($==="Feature")X(k.geometry,F);else if($==="Polygon")ve(k.coordinates,F);else if($==="MultiPolygon")for(q=0;q<k.coordinates.length;q++)ve(k.coordinates[q],F);return k};function ve(X,k){if(X.length!==0){he(X[0],k);for(var F=1;F<X.length;F++)he(X[F],!k)}}function he(X,k){for(var F=0,q=0,$=0,se=X.length,de=se-1;$<se;de=$++){var le=(X[$][0]-X[de][0])*(X[de][1]+X[$][1]),re=F+le;q+=Math.abs(F)>=Math.abs(le)?F-re+le:le-re+F,F=re}F+q>=0!=!!k&&X.reverse()}const Ee=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Fe{constructor(k){this._feature=k,this.extent=l.EXTENT,this.type=k.type,this.properties=k.tags,"id"in k&&!isNaN(k.id)&&(this.id=parseInt(k.id,10))}loadGeometry(){if(this._feature.type===1){const k=[];for(const F of this._feature.geometry)k.push([new l.pointGeometry(F[0],F[1])]);return k}{const k=[];for(const F of this._feature.geometry){const q=[];for(const $ of F)q.push(new l.pointGeometry($[0],$[1]));k.push(q)}return k}}toGeoJSON(k,F,q){return Ee.call(this,k,F,q)}}class Ze{constructor(k){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=k.length,this._features=k}feature(k){return new Fe(this._features[k])}}var ht={exports:{}},_t=l.pointGeometry,lt=l.vectorTile.VectorTileFeature,Et=It;function It(X,k){this.options=k||{},this.features=X,this.length=X.length}function Ot(X,k){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=k||4096}It.prototype.feature=function(X){return new Ot(this.features[X],this.options.extent)},Ot.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var k=0;k<X.length;k++){for(var F=X[k],q=[],$=0;$<F.length;$++)q.push(new _t(F[$][0],F[$][1]));this.geometry.push(q)}return this.geometry},Ot.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,k=1/0,F=-1/0,q=1/0,$=-1/0,se=0;se<X.length;se++)for(var de=X[se],le=0;le<de.length;le++){var re=de[le];k=Math.min(k,re.x),F=Math.max(F,re.x),q=Math.min(q,re.y),$=Math.max($,re.y)}return[k,q,F,$]},Ot.prototype.toGeoJSON=lt.prototype.toGeoJSON;var zt=l.pbf,Ut=Et;function $i(X){var k=new zt;return function(F,q){for(var $ in F.layers)q.writeMessage(3,ft,F.layers[$])}(X,k),k.finish()}function ft(X,k){var F;k.writeVarintField(15,X.version||1),k.writeStringField(1,X.name||""),k.writeVarintField(5,X.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<X.length;F++)q.feature=X.feature(F),k.writeMessage(2,oi,q);var $=q.keys;for(F=0;F<$.length;F++)k.writeStringField(3,$[F]);var se=q.values;for(F=0;F<se.length;F++)k.writeMessage(4,Fi,se[F])}function oi(X,k){var F=X.feature;F.id!==void 0&&k.writeVarintField(1,F.id),k.writeMessage(2,ti,X),k.writeVarintField(3,F.type),k.writeMessage(4,wn,F)}function ti(X,k){var F=X.feature,q=X.keys,$=X.values,se=X.keycache,de=X.valuecache;for(var le in F.properties){var re=F.properties[le],fe=se[le];if(re!==null){fe===void 0&&(q.push(le),se[le]=fe=q.length-1),k.writeVarint(fe);var Ce=typeof re;Ce!=="string"&&Ce!=="boolean"&&Ce!=="number"&&(re=JSON.stringify(re));var Ne=Ce+":"+re,Ie=de[Ne];Ie===void 0&&($.push(re),de[Ne]=Ie=$.length-1),k.writeVarint(Ie)}}}function Vi(X,k){return(k<<3)+(7&X)}function fn(X){return X<<1^X>>31}function wn(X,k){for(var F=X.loadGeometry(),q=X.type,$=0,se=0,de=F.length,le=0;le<de;le++){var re=F[le],fe=1;q===1&&(fe=re.length),k.writeVarint(Vi(1,fe));for(var Ce=q===3?re.length-1:re.length,Ne=0;Ne<Ce;Ne++){Ne===1&&q!==1&&k.writeVarint(Vi(2,Ce-1));var Ie=re[Ne].x-$,ct=re[Ne].y-se;k.writeVarint(fn(Ie)),k.writeVarint(fn(ct)),$+=Ie,se+=ct}q===3&&k.writeVarint(Vi(7,1))}}function Fi(X,k){var F=typeof X;F==="string"?k.writeStringField(1,X):F==="boolean"?k.writeBooleanField(7,X):F==="number"&&(X%1!=0?k.writeDoubleField(3,X):X<0?k.writeSVarintField(6,X):k.writeVarintField(5,X))}function Sr(X,k,F,q,$,se){if($-q<=F)return;const de=q+$>>1;gr(X,k,de,q,$,se%2),Sr(X,k,F,q,de-1,se+1),Sr(X,k,F,de+1,$,se+1)}function gr(X,k,F,q,$,se){for(;$>q;){if($-q>600){const fe=$-q+1,Ce=F-q+1,Ne=Math.log(fe),Ie=.5*Math.exp(2*Ne/3),ct=.5*Math.sqrt(Ne*Ie*(fe-Ie)/fe)*(Ce-fe/2<0?-1:1);gr(X,k,F,Math.max(q,Math.floor(F-Ce*Ie/fe+ct)),Math.min($,Math.floor(F+(fe-Ce)*Ie/fe+ct)),se)}const de=k[2*F+se];let le=q,re=$;for(Vn(X,k,q,F),k[2*$+se]>de&&Vn(X,k,q,$);le<re;){for(Vn(X,k,le,re),le++,re--;k[2*le+se]<de;)le++;for(;k[2*re+se]>de;)re--}k[2*q+se]===de?Vn(X,k,q,re):(re++,Vn(X,k,re,$)),re<=F&&(q=re+1),F<=re&&($=re-1)}}function Vn(X,k,F,q){Ji(X,F,q),Ji(k,2*F,2*q),Ji(k,2*F+1,2*q+1)}function Ji(X,k,F){const q=X[k];X[k]=X[F],X[F]=q}function xi(X,k,F,q){const $=X-F,se=k-q;return $*$+se*se}ht.exports=$i,ht.exports.fromVectorTileJs=$i,ht.exports.fromGeojsonVt=function(X,k){k=k||{};var F={};for(var q in X)F[q]=new Ut(X[q].features,k),F[q].name=q,F[q].version=k.version,F[q].extent=k.extent;return $i({layers:F})},ht.exports.GeoJSONWrapper=Ut;const on=X=>X[0],$t=X=>X[1];class Ci{constructor(k,F=on,q=$t,$=64,se=Float64Array){this.nodeSize=$,this.points=k;const de=k.length<65536?Uint16Array:Uint32Array,le=this.ids=new de(k.length),re=this.coords=new se(2*k.length);for(let fe=0;fe<k.length;fe++)le[fe]=fe,re[2*fe]=F(k[fe]),re[2*fe+1]=q(k[fe]);Sr(le,re,$,0,le.length-1,0)}range(k,F,q,$){return function(se,de,le,re,fe,Ce,Ne){const Ie=[0,se.length-1,0],ct=[];let pt,et;for(;Ie.length;){const St=Ie.pop(),vt=Ie.pop(),Gt=Ie.pop();if(vt-Gt<=Ne){for(let Zt=Gt;Zt<=vt;Zt++)pt=de[2*Zt],et=de[2*Zt+1],pt>=le&&pt<=fe&&et>=re&&et<=Ce&&ct.push(se[Zt]);continue}const Ct=Math.floor((Gt+vt)/2);pt=de[2*Ct],et=de[2*Ct+1],pt>=le&&pt<=fe&&et>=re&&et<=Ce&&ct.push(se[Ct]);const kt=(St+1)%2;(St===0?le<=pt:re<=et)&&(Ie.push(Gt),Ie.push(Ct-1),Ie.push(kt)),(St===0?fe>=pt:Ce>=et)&&(Ie.push(Ct+1),Ie.push(vt),Ie.push(kt))}return ct}(this.ids,this.coords,k,F,q,$,this.nodeSize)}within(k,F,q){return function($,se,de,le,re,fe){const Ce=[0,$.length-1,0],Ne=[],Ie=re*re;for(;Ce.length;){const ct=Ce.pop(),pt=Ce.pop(),et=Ce.pop();if(pt-et<=fe){for(let kt=et;kt<=pt;kt++)xi(se[2*kt],se[2*kt+1],de,le)<=Ie&&Ne.push($[kt]);continue}const St=Math.floor((et+pt)/2),vt=se[2*St],Gt=se[2*St+1];xi(vt,Gt,de,le)<=Ie&&Ne.push($[St]);const Ct=(ct+1)%2;(ct===0?de-re<=vt:le-re<=Gt)&&(Ce.push(et),Ce.push(St-1),Ce.push(Ct)),(ct===0?de+re>=vt:le+re>=Gt)&&(Ce.push(St+1),Ce.push(pt),Ce.push(Ct))}return Ne}(this.ids,this.coords,k,F,q,this.nodeSize)}}const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},oe=Math.fround||(me=new Float32Array(1),X=>(me[0]=+X,me[0]));var me;class Re{constructor(k){this.options=Tt(Object.create(jn),k),this.trees=new Array(this.options.maxZoom+1)}load(k){const{log:F,minZoom:q,maxZoom:$,nodeSize:se}=this.options;F&&console.time("total time");const de=`prepare ${k.length} points`;F&&console.time(de),this.points=k;let le=[];for(let re=0;re<k.length;re++)k[re].geometry&&le.push(Be(k[re],re));this.trees[$+1]=new Ci(le,yt,wt,se,Float32Array),F&&console.timeEnd(de);for(let re=$;re>=q;re--){const fe=+Date.now();le=this._cluster(le,re),this.trees[re]=new Ci(le,yt,wt,se,Float32Array),F&&console.log("z%d: %d clusters in %dms",re,le.length,+Date.now()-fe)}return F&&console.timeEnd("total time"),this}getClusters(k,F){let q=((k[0]+180)%360+360)%360-180;const $=Math.max(-90,Math.min(90,k[1]));let se=k[2]===180?180:((k[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)q=-180,se=180;else if(q>se){const Ce=this.getClusters([q,$,180,de],F),Ne=this.getClusters([-180,$,se,de],F);return Ce.concat(Ne)}const le=this.trees[this._limitZoom(F)],re=le.range(ze(q),$e(de),ze(se),$e($)),fe=[];for(const Ce of re){const Ne=le.points[Ce];fe.push(Ne.numPoints?qe(Ne):this.points[Ne.index])}return fe}getChildren(k){const F=this._getOriginId(k),q=this._getOriginZoom(k),$="No cluster with the specified id.",se=this.trees[q];if(!se)throw new Error($);const de=se.points[F];if(!de)throw new Error($);const le=this.options.radius/(this.options.extent*Math.pow(2,q-1)),re=se.within(de.x,de.y,le),fe=[];for(const Ce of re){const Ne=se.points[Ce];Ne.parentId===k&&fe.push(Ne.numPoints?qe(Ne):this.points[Ne.index])}if(fe.length===0)throw new Error($);return fe}getLeaves(k,F,q){const $=[];return this._appendLeaves($,k,F=F||10,q=q||0,0),$}getTile(k,F,q){const $=this.trees[this._limitZoom(k)],se=Math.pow(2,k),{extent:de,radius:le}=this.options,re=le/de,fe=(q-re)/se,Ce=(q+1+re)/se,Ne={features:[]};return this._addTileFeatures($.range((F-re)/se,fe,(F+1+re)/se,Ce),$.points,F,q,se,Ne),F===0&&this._addTileFeatures($.range(1-re/se,fe,1,Ce),$.points,se,q,se,Ne),F===se-1&&this._addTileFeatures($.range(0,fe,re/se,Ce),$.points,-1,q,se,Ne),Ne.features.length?Ne:null}getClusterExpansionZoom(k){let F=this._getOriginZoom(k)-1;for(;F<=this.options.maxZoom;){const q=this.getChildren(k);if(F++,q.length!==1)break;k=q[0].properties.cluster_id}return F}_appendLeaves(k,F,q,$,se){const de=this.getChildren(F);for(const le of de){const re=le.properties;if(re&&re.cluster?se+re.point_count<=$?se+=re.point_count:se=this._appendLeaves(k,re.cluster_id,q,$,se):se<$?se++:k.push(le),k.length===q)break}return se}_addTileFeatures(k,F,q,$,se,de){for(const le of k){const re=F[le],fe=re.numPoints;let Ce,Ne,Ie;if(fe)Ce=rt(re),Ne=re.x,Ie=re.y;else{const et=this.points[re.index];Ce=et.properties,Ne=ze(et.geometry.coordinates[0]),Ie=$e(et.geometry.coordinates[1])}const ct={type:1,geometry:[[Math.round(this.options.extent*(Ne*se-q)),Math.round(this.options.extent*(Ie*se-$))]],tags:Ce};let pt;fe?pt=re.id:this.options.generateId?pt=re.index:this.points[re.index].id&&(pt=this.points[re.index].id),pt!==void 0&&(ct.id=pt),de.features.push(ct)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,F){const q=[],{radius:$,extent:se,reduce:de,minPoints:le}=this.options,re=$/(se*Math.pow(2,F));for(let fe=0;fe<k.length;fe++){const Ce=k[fe];if(Ce.zoom<=F)continue;Ce.zoom=F;const Ne=this.trees[F+1],Ie=Ne.within(Ce.x,Ce.y,re),ct=Ce.numPoints||1;let pt=ct;for(const et of Ie){const St=Ne.points[et];St.zoom>F&&(pt+=St.numPoints||1)}if(pt>ct&&pt>=le){let et=Ce.x*ct,St=Ce.y*ct,vt=de&&ct>1?this._map(Ce,!0):null;const Gt=(fe<<5)+(F+1)+this.points.length;for(const Ct of Ie){const kt=Ne.points[Ct];if(kt.zoom<=F)continue;kt.zoom=F;const Zt=kt.numPoints||1;et+=kt.x*Zt,St+=kt.y*Zt,kt.parentId=Gt,de&&(vt||(vt=this._map(Ce,!0)),de(vt,this._map(kt)))}Ce.parentId=Gt,q.push(Ve(et/pt,St/pt,Gt,pt,vt))}else if(q.push(Ce),pt>1)for(const et of Ie){const St=Ne.points[et];St.zoom<=F||(St.zoom=F,q.push(St))}}return q}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,F){if(k.numPoints)return F?Tt({},k.properties):k.properties;const q=this.points[k.index].properties,$=this.options.map(q);return F&&$===q?Tt({},$):$}}function Ve(X,k,F,q,$){return{x:oe(X),y:oe(k),zoom:1/0,id:F,parentId:-1,numPoints:q,properties:$}}function Be(X,k){const[F,q]=X.geometry.coordinates;return{x:oe(ze(F)),y:oe($e(q)),zoom:1/0,index:k,parentId:-1}}function qe(X){return{type:"Feature",id:X.id,properties:rt(X),geometry:{type:"Point",coordinates:[(k=X.x,360*(k-.5)),Ue(X.y)]}};var k}function rt(X){const k=X.numPoints,F=k>=1e4?`${Math.round(k/1e3)}k`:k>=1e3?Math.round(k/100)/10+"k":k;return Tt(Tt({},X.properties),{cluster:!0,cluster_id:X.id,point_count:k,point_count_abbreviated:F})}function ze(X){return X/360+.5}function $e(X){const k=Math.sin(X*Math.PI/180),F=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return F<0?0:F>1?1:F}function Ue(X){const k=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function Tt(X,k){for(const F in k)X[F]=k[F];return X}function yt(X){return X.x}function wt(X){return X.y}function Lt(X,k,F,q){for(var $,se=q,de=F-k>>1,le=F-k,re=X[k],fe=X[k+1],Ce=X[F],Ne=X[F+1],Ie=k+3;Ie<F;Ie+=3){var ct=Vt(X[Ie],X[Ie+1],re,fe,Ce,Ne);if(ct>se)$=Ie,se=ct;else if(ct===se){var pt=Math.abs(Ie-de);pt<le&&($=Ie,le=pt)}}se>q&&($-k>3&&Lt(X,k,$,q),X[$+2]=se,F-$>3&&Lt(X,$,F,q))}function Vt(X,k,F,q,$,se){var de=$-F,le=se-q;if(de!==0||le!==0){var re=((X-F)*de+(k-q)*le)/(de*de+le*le);re>1?(F=$,q=se):re>0&&(F+=de*re,q+=le*re)}return(de=X-F)*de+(le=k-q)*le}function Qt(X,k,F,q){var $={id:X===void 0?null:X,type:k,geometry:F,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var de=se.geometry,le=se.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")we(se,de);else if(le==="Polygon"||le==="MultiLineString")for(var re=0;re<de.length;re++)we(se,de[re]);else if(le==="MultiPolygon")for(re=0;re<de.length;re++)for(var fe=0;fe<de[re].length;fe++)we(se,de[re][fe])}($),$}function we(X,k){for(var F=0;F<k.length;F+=3)X.minX=Math.min(X.minX,k[F]),X.minY=Math.min(X.minY,k[F+1]),X.maxX=Math.max(X.maxX,k[F]),X.maxY=Math.max(X.maxY,k[F+1])}function je(X,k,F,q){if(k.geometry){var $=k.geometry.coordinates,se=k.geometry.type,de=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),le=[],re=k.id;if(F.promoteId?re=k.properties[F.promoteId]:F.generateId&&(re=q||0),se==="Point")ji($,le);else if(se==="MultiPoint")for(var fe=0;fe<$.length;fe++)ji($[fe],le);else if(se==="LineString")Bi($,le,de,!1);else if(se==="MultiLineString"){if(F.lineMetrics){for(fe=0;fe<$.length;fe++)Bi($[fe],le=[],de,!1),X.push(Qt(re,"LineString",le,k.properties));return}jt($,le,de,!1)}else if(se==="Polygon")jt($,le,de,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(fe=0;fe<k.geometry.geometries.length;fe++)je(X,{id:re,geometry:k.geometry.geometries[fe],properties:k.properties},F,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<$.length;fe++){var Ce=[];jt($[fe],Ce,de,!0),le.push(Ce)}}X.push(Qt(re,se,le,k.properties))}}function ji(X,k){k.push(Qi(X[0])),k.push(pn(X[1])),k.push(0)}function Bi(X,k,F,q){for(var $,se,de=0,le=0;le<X.length;le++){var re=Qi(X[le][0]),fe=pn(X[le][1]);k.push(re),k.push(fe),k.push(0),le>0&&(de+=q?($*fe-re*se)/2:Math.sqrt(Math.pow(re-$,2)+Math.pow(fe-se,2))),$=re,se=fe}var Ce=k.length-3;k[2]=1,Lt(k,0,Ce,F),k[Ce+2]=1,k.size=Math.abs(de),k.start=0,k.end=k.size}function jt(X,k,F,q){for(var $=0;$<X.length;$++){var se=[];Bi(X[$],se,F,q),k.push(se)}}function Qi(X){return X/360+.5}function pn(X){var k=Math.sin(X*Math.PI/180),F=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return F<0?0:F>1?1:F}function vi(X,k,F,q,$,se,de,le){if(q/=k,se>=(F/=k)&&de<q)return X;if(de<F||se>=q)return null;for(var re=[],fe=0;fe<X.length;fe++){var Ce=X[fe],Ne=Ce.geometry,Ie=Ce.type,ct=$===0?Ce.minX:Ce.minY,pt=$===0?Ce.maxX:Ce.maxY;if(ct>=F&&pt<q)re.push(Ce);else if(!(pt<F||ct>=q)){var et=[];if(Ie==="Point"||Ie==="MultiPoint")Zi(Ne,et,F,q,$);else if(Ie==="LineString")Xe(Ne,et,F,q,$,!1,le.lineMetrics);else if(Ie==="MultiLineString")Ft(Ne,et,F,q,$,!1);else if(Ie==="Polygon")Ft(Ne,et,F,q,$,!0);else if(Ie==="MultiPolygon")for(var St=0;St<Ne.length;St++){var vt=[];Ft(Ne[St],vt,F,q,$,!0),vt.length&&et.push(vt)}if(et.length){if(le.lineMetrics&&Ie==="LineString"){for(St=0;St<et.length;St++)re.push(Qt(Ce.id,Ie,et[St],Ce.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(et.length===1?(Ie="LineString",et=et[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=et.length===3?"Point":"MultiPoint"),re.push(Qt(Ce.id,Ie,et,Ce.tags))}}}return re.length?re:null}function Zi(X,k,F,q,$){for(var se=0;se<X.length;se+=3){var de=X[se+$];de>=F&&de<=q&&(k.push(X[se]),k.push(X[se+1]),k.push(X[se+2]))}}function Xe(X,k,F,q,$,se,de){for(var le,re,fe=Bt(X),Ce=$===0?Ar:Dt,Ne=X.start,Ie=0;Ie<X.length-3;Ie+=3){var ct=X[Ie],pt=X[Ie+1],et=X[Ie+2],St=X[Ie+3],vt=X[Ie+4],Gt=$===0?ct:pt,Ct=$===0?St:vt,kt=!1;de&&(le=Math.sqrt(Math.pow(ct-St,2)+Math.pow(pt-vt,2))),Gt<F?Ct>F&&(re=Ce(fe,ct,pt,St,vt,F),de&&(fe.start=Ne+le*re)):Gt>q?Ct<q&&(re=Ce(fe,ct,pt,St,vt,q),de&&(fe.start=Ne+le*re)):an(fe,ct,pt,et),Ct<F&&Gt>=F&&(re=Ce(fe,ct,pt,St,vt,F),kt=!0),Ct>q&&Gt<=q&&(re=Ce(fe,ct,pt,St,vt,q),kt=!0),!se&&kt&&(de&&(fe.end=Ne+le*re),k.push(fe),fe=Bt(X)),de&&(Ne+=le)}var Zt=X.length-3;ct=X[Zt],pt=X[Zt+1],et=X[Zt+2],(Gt=$===0?ct:pt)>=F&&Gt<=q&&an(fe,ct,pt,et),Zt=fe.length-3,se&&Zt>=3&&(fe[Zt]!==fe[0]||fe[Zt+1]!==fe[1])&&an(fe,fe[0],fe[1],fe[2]),fe.length&&k.push(fe)}function Bt(X){var k=[];return k.size=X.size,k.start=X.start,k.end=X.end,k}function Ft(X,k,F,q,$,se){for(var de=0;de<X.length;de++)Xe(X[de],k,F,q,$,se,!1)}function an(X,k,F,q){X.push(k),X.push(F),X.push(q)}function Ar(X,k,F,q,$,se){var de=(se-k)/(q-k);return X.push(se),X.push(F+($-F)*de),X.push(1),de}function Dt(X,k,F,q,$,se){var de=(se-F)/($-F);return X.push(k+(q-k)*de),X.push(se),X.push(1),de}function er(X,k){for(var F=[],q=0;q<X.length;q++){var $,se=X[q],de=se.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")$=en(se.geometry,k);else if(de==="MultiLineString"||de==="Polygon"){$=[];for(var le=0;le<se.geometry.length;le++)$.push(en(se.geometry[le],k))}else if(de==="MultiPolygon")for($=[],le=0;le<se.geometry.length;le++){for(var re=[],fe=0;fe<se.geometry[le].length;fe++)re.push(en(se.geometry[le][fe],k));$.push(re)}F.push(Qt(se.id,de,$,se.tags))}return F}function en(X,k){var F=[];F.size=X.size,X.start!==void 0&&(F.start=X.start,F.end=X.end);for(var q=0;q<X.length;q+=3)F.push(X[q]+k,X[q+1],X[q+2]);return F}function ys(X,k){if(X.transformed)return X;var F,q,$,se=1<<X.z,de=X.x,le=X.y;for(F=0;F<X.features.length;F++){var re=X.features[F],fe=re.geometry,Ce=re.type;if(re.geometry=[],Ce===1)for(q=0;q<fe.length;q+=2)re.geometry.push(Gi(fe[q],fe[q+1],k,se,de,le));else for(q=0;q<fe.length;q++){var Ne=[];for($=0;$<fe[q].length;$+=2)Ne.push(Gi(fe[q][$],fe[q][$+1],k,se,de,le));re.geometry.push(Ne)}}return X.transformed=!0,X}function Gi(X,k,F,q,$,se){return[Math.round(F*(X*q-$)),Math.round(F*(k*q-se))]}function mn(X,k,F,q,$){for(var se=k===$.maxZoom?0:$.tolerance/((1<<k)*$.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:q,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},le=0;le<X.length;le++){de.numFeatures++,di(de,X[le],se,$);var re=X[le].minX,fe=X[le].minY,Ce=X[le].maxX,Ne=X[le].maxY;re<de.minX&&(de.minX=re),fe<de.minY&&(de.minY=fe),Ce>de.maxX&&(de.maxX=Ce),Ne>de.maxY&&(de.maxY=Ne)}return de}function di(X,k,F,q){var $=k.geometry,se=k.type,de=[];if(se==="Point"||se==="MultiPoint")for(var le=0;le<$.length;le+=3)de.push($[le]),de.push($[le+1]),X.numPoints++,X.numSimplified++;else if(se==="LineString")xs(de,$,X,F,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(le=0;le<$.length;le++)xs(de,$[le],X,F,se==="Polygon",le===0);else if(se==="MultiPolygon")for(var re=0;re<$.length;re++){var fe=$[re];for(le=0;le<fe.length;le++)xs(de,fe[le],X,F,!0,le===0)}if(de.length){var Ce=k.tags||null;if(se==="LineString"&&q.lineMetrics){for(var Ne in Ce={},k.tags)Ce[Ne]=k.tags[Ne];Ce.mapbox_clip_start=$.start/$.size,Ce.mapbox_clip_end=$.end/$.size}var Ie={geometry:de,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:Ce};k.id!==null&&(Ie.id=k.id),X.features.push(Ie)}}function xs(X,k,F,q,$,se){var de=q*q;if(q>0&&k.size<($?de:q))F.numPoints+=k.length/3;else{for(var le=[],re=0;re<k.length;re+=3)(q===0||k[re+2]>de)&&(F.numSimplified++,le.push(k[re]),le.push(k[re+1])),F.numPoints++;$&&function(fe,Ce){for(var Ne=0,Ie=0,ct=fe.length,pt=ct-2;Ie<ct;pt=Ie,Ie+=2)Ne+=(fe[Ie]-fe[pt])*(fe[Ie+1]+fe[pt+1]);if(Ne>0===Ce)for(Ie=0,ct=fe.length;Ie<ct/2;Ie+=2){var et=fe[Ie],St=fe[Ie+1];fe[Ie]=fe[ct-2-Ie],fe[Ie+1]=fe[ct-1-Ie],fe[ct-2-Ie]=et,fe[ct-1-Ie]=St}}(le,se),X.push(le)}}function _r(X,k){var F=(k=this.options=function($,se){for(var de in se)$[de]=se[de];return $}(Object.create(this.options),k)).debug;if(F&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function($,se){var de=[];if($.type==="FeatureCollection")for(var le=0;le<$.features.length;le++)je(de,$.features[le],se,le);else je(de,$.type==="Feature"?$:{geometry:$},se);return de}(X,k);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function($,se){var de=se.buffer/se.extent,le=$,re=vi($,1,-1-de,de,0,-1,2,se),fe=vi($,1,1-de,2+de,0,-1,2,se);return(re||fe)&&(le=vi($,1,-de,1+de,0,-1,2,se)||[],re&&(le=er(re,1).concat(le)),fe&&(le=le.concat(er(fe,-1)))),le}(q,k),q.length&&this.splitTile(q,0,0,0),F&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yr(X,k,F){return 32*((1<<X)*F+k)+X}function es(X,k){const F=X.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);const q=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!q)return k(null,null);const $=new Ze(q.features);let se=ht.exports($);se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),k(null,{vectorTile:$,rawData:se.buffer})}_r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_r.prototype.splitTile=function(X,k,F,q,$,se,de){for(var le=[X,k,F,q],re=this.options,fe=re.debug;le.length;){q=le.pop(),F=le.pop(),k=le.pop(),X=le.pop();var Ce=1<<k,Ne=yr(k,F,q),Ie=this.tiles[Ne];if(!Ie&&(fe>1&&console.time("creation"),Ie=this.tiles[Ne]=mn(X,k,F,q,re),this.tileCoords.push({z:k,x:F,y:q}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,F,q,Ie.numFeatures,Ie.numPoints,Ie.numSimplified),console.timeEnd("creation"));var ct="z"+k;this.stats[ct]=(this.stats[ct]||0)+1,this.total++}if(Ie.source=X,$){if(k===re.maxZoom||k===$)continue;var pt=1<<$-k;if(F!==Math.floor(se/pt)||q!==Math.floor(de/pt))continue}else if(k===re.indexMaxZoom||Ie.numPoints<=re.indexMaxPoints)continue;if(Ie.source=null,X.length!==0){fe>1&&console.time("clipping");var et,St,vt,Gt,Ct,kt,Zt=.5*re.buffer/re.extent,Kt=.5-Zt,Ti=.5+Zt,Ei=1+Zt;et=St=vt=Gt=null,Ct=vi(X,Ce,F-Zt,F+Ti,0,Ie.minX,Ie.maxX,re),kt=vi(X,Ce,F+Kt,F+Ei,0,Ie.minX,Ie.maxX,re),X=null,Ct&&(et=vi(Ct,Ce,q-Zt,q+Ti,1,Ie.minY,Ie.maxY,re),St=vi(Ct,Ce,q+Kt,q+Ei,1,Ie.minY,Ie.maxY,re),Ct=null),kt&&(vt=vi(kt,Ce,q-Zt,q+Ti,1,Ie.minY,Ie.maxY,re),Gt=vi(kt,Ce,q+Kt,q+Ei,1,Ie.minY,Ie.maxY,re),kt=null),fe>1&&console.timeEnd("clipping"),le.push(et||[],k+1,2*F,2*q),le.push(St||[],k+1,2*F,2*q+1),le.push(vt||[],k+1,2*F+1,2*q),le.push(Gt||[],k+1,2*F+1,2*q+1)}}},_r.prototype.getTile=function(X,k,F){var q=this.options,$=q.extent,se=q.debug;if(X<0||X>24)return null;var de=1<<X,le=yr(X,k=(k%de+de)%de,F);if(this.tiles[le])return ys(this.tiles[le],$);se>1&&console.log("drilling down to z%d-%d-%d",X,k,F);for(var re,fe=X,Ce=k,Ne=F;!re&&fe>0;)fe--,Ce=Math.floor(Ce/2),Ne=Math.floor(Ne/2),re=this.tiles[yr(fe,Ce,Ne)];return re&&re.source?(se>1&&console.log("found parent tile z%d-%d-%d",fe,Ce,Ne),se>1&&console.time("drilling down"),this.splitTile(re.source,fe,Ce,Ne,X,k,F),se>1&&console.timeEnd("drilling down"),this.tiles[le]?ys(this.tiles[le],$):null):null};class vs extends J{constructor(k,F,q,$){super(k,F,q,es),$&&(this.loadGeoJSON=$)}loadData(k,F){var q;(q=this._pendingRequest)===null||q===void 0||q.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const $=!!(k&&k.request&&k.request.collectResourceTiming)&&new l.RequestPerformance(k.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(k,(se,de)=>{if(delete this._pendingCallback,delete this._pendingRequest,se||!de)return F(se);if(typeof de!="object")return F(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{pe(de,!0);try{if(k.filter){const re=l.createExpression(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(Ce=>`${Ce.key}: ${Ce.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(Ce=>re.value.evaluate({zoom:0},Ce))}}this._geoJSONIndex=k.cluster?new Re(function({superclusterOptions:re,clusterProperties:fe}){if(!fe||!re)return re;const Ce={},Ne={},Ie={accumulated:null,zoom:0},ct={properties:null},pt=Object.keys(fe);for(const et of pt){const[St,vt]=fe[et],Gt=l.createExpression(vt),Ct=l.createExpression(typeof St=="string"?[St,["accumulated"],["get",et]]:St);Ce[et]=Gt.value,Ne[et]=Ct.value}return re.map=et=>{ct.properties=et;const St={};for(const vt of pt)St[vt]=Ce[vt].evaluate(Ie,ct);return St},re.reduce=(et,St)=>{ct.properties=St;for(const vt of pt)Ie.accumulated=et[vt],et[vt]=Ne[vt].evaluate(Ie,ct)},re}(k)).load(de.features):function(re,fe){return new _r(re,fe)}(de,k.geojsonVtOptions)}catch(re){return F(re)}this.loaded={};const le={};if($){const re=$.finish();re&&(le.resourceTiming={},le.resourceTiming[k.source]=JSON.parse(JSON.stringify(re)))}F(null,le)}})}reloadTile(k,F){const q=this.loaded;return q&&q[k.uid]?super.reloadTile(k,F):this.loadTile(k,F)}loadGeoJSON(k,F){if(k.request)return l.getJSON(k.request,F);if(typeof k.data=="string")try{F(null,JSON.parse(k.data))}catch{F(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(k,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(k,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(q){F(q)}}getClusterChildren(k,F){try{F(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(q){F(q)}}getClusterLeaves(k,F){try{F(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(q){F(q)}}}class Gr{constructor(k){this.self=k,this.actor=new l.Actor(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:J,geojson:vs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,q)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=q},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(k,F){this.referrer=F}setImages(k,F,q){this.availableImages[k]=F;for(const $ in this.workerSources[k]){const se=this.workerSources[k][$];for(const de in se)se[de].availableImages=F}q()}setLayers(k,F,q){this.getLayerIndex(k).replace(F),q()}updateLayers(k,F,q){this.getLayerIndex(k).update(F.layers,F.removedIds),q()}loadTile(k,F,q){this.getWorkerSource(k,F.type,F.source).loadTile(F,q)}loadDEMTile(k,F,q){this.getDEMWorkerSource(k,F.source).loadTile(F,q)}reloadTile(k,F,q){this.getWorkerSource(k,F.type,F.source).reloadTile(F,q)}abortTile(k,F,q){this.getWorkerSource(k,F.type,F.source).abortTile(F,q)}removeTile(k,F,q){this.getWorkerSource(k,F.type,F.source).removeTile(F,q)}removeDEMTile(k,F){this.getDEMWorkerSource(k,F.source).removeTile(F)}removeSource(k,F,q){if(!this.workerSources[k]||!this.workerSources[k][F.type]||!this.workerSources[k][F.type][F.source])return;const $=this.workerSources[k][F.type][F.source];delete this.workerSources[k][F.type][F.source],$.removeSource!==void 0?$.removeSource(F,q):q()}loadWorkerSource(k,F,q){try{this.self.importScripts(F.url),q()}catch($){q($.toString())}}syncRTLPluginState(k,F,q){try{l.plugin.setState(F);const $=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&$!=null){this.self.importScripts($);const se=l.plugin.isParsed();q(se?void 0:new Error(`RTL Text Plugin failed to import scripts from ${$}`),se)}}catch($){q($.toString())}}getAvailableImages(k){let F=this.availableImages[k];return F||(F=[]),F}getLayerIndex(k){let F=this.layerIndexes[k];return F||(F=this.layerIndexes[k]=new P),F}getWorkerSource(k,F,q){if(this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][F]||(this.workerSources[k][F]={}),!this.workerSources[k][F][q]){const $={send:(se,de,le)=>{this.actor.send(se,de,le,k)}};this.workerSources[k][F][q]=new this.workerSourceTypes[F]($,this.getLayerIndex(k),this.getAvailableImages(k))}return this.workerSources[k][F][q]}getDEMWorkerSource(k,F){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][F]||(this.demWorkerSources[k][F]=new ce),this.demWorkerSources[k][F]}enforceCacheSizeLimit(k,F){l.enforceCacheSizeLimit(F)}}return l.isWorker()&&(self.worker=new Gr(self)),Gr}),u(["./shared"],function(l){var x=w;function w(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{_=new Worker(T),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(T),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(P[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(P[h]=function(p){var _,v=function(T){var A=document.createElement("canvas"),I=Object.create(w.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=T,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(h)),P[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var P={};function M(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!M(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(const h in m)if(!M(m[h],s[h]))return!1;return!0}return m===s}w.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class C{static testProp(s){if(!C.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in C.docStyle)return s[h];return s[0]}static create(s,h,p){const _=window.document.createElement(s);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(s,h){s.style[C.transformProp]=h}static addEventListener(s,h,p,_={}){s.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(s,h,p,_={}){s.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static mousePos(s,h){const p=s.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-s.clientLeft,h.clientY-p.top-s.clientTop)}static touchPos(s,h){const p=s.getBoundingClientRect(),_=[];for(let v=0;v<h.length;v++)_.push(new l.pointGeometry(h[v].clientX-p.left-s.clientLeft,h[v].clientY-p.top-s.clientTop));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);class V{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,p){const _=function(v){const T=v.match(Y);if(!T)throw new Error(`Unable to parse URL "${v}"`);return{protocol:T[1],authority:T[2],path:T[3]||"/",params:T[4]?T[4].split("&"):[]}}(s);return _.path+=`${h}${p}`,function(v){const T=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${T}`}(_)}setTransformRequest(s){this._transformRequestFn=s}}const Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class J{constructor(s,h,p,_){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(h,_)}update(s,h,p){const{width:_,height:v}=s,T=!(this.size&&this.size[0]===_&&this.size[1]===v||p),{context:A}=this,{gl:I}=A;if(this.useMipmap=Boolean(h&&h.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!h||h.premultiply!==!1)),T)this.size=[_,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,s):I.texImage2D(I.TEXTURE_2D,0,this.format,_,v,0,this.format,I.UNSIGNED_BYTE,s.data);else{const{x:R,y:z}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texSubImage2D(I.TEXTURE_2D,0,R,z,I.RGBA,I.UNSIGNED_BYTE,s):I.texSubImage2D(I.TEXTURE_2D,0,R,z,_,v,I.RGBA,I.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(s,h,p){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||s),this.filter=s),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function ce(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class pe extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,h){if(!s)return!0;let p=0;for(const _ of s){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){const p=this.images[s];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let p=!0;if(!this.isLoaded())for(const _ of s)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const p={};for(const _ of s){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],p=this.getImage(s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new l.ImagePosition(_,p);this.patterns[s]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new J(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:h,h:p}=l.potpack(s),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:T}=this.patterns[v],A=T.x+1,I=T.y+1,R=this.images[v].data,z=R.width,N=R.height;l.RGBAImage.copy(R,_,{x:0,y:0},{x:A,y:I},{width:z,height:N}),l.RGBAImage.copy(R,_,{x:0,y:N-1},{x:A,y:I-1},{width:z,height:1}),l.RGBAImage.copy(R,_,{x:0,y:0},{x:A,y:I+N},{width:z,height:1}),l.RGBAImage.copy(R,_,{x:z-1,y:0},{x:A-1,y:I},{width:1,height:N}),l.RGBAImage.copy(R,_,{x:0,y:0},{x:A+z,y:I},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),ce(p)&&this.updateImage(h,p)}}}const ve=1e20;function he(m,s,h,p,_,v,T,A,I){for(let R=s;R<s+p;R++)Ee(m,h*v+R,v,_,T,A,I);for(let R=h;R<h+_;R++)Ee(m,R*v+s,1,p,T,A,I)}function Ee(m,s,h,p,_,v,T){v[0]=0,T[0]=-ve,T[1]=ve,_[0]=m[s];for(let A=1,I=0,R=0;A<p;A++){_[A]=m[s+A*h];const z=A*A;do{const N=v[I];R=(_[A]-_[N]+z-N*N)/(A-N)/2}while(R<=T[I]&&--I>-1);I++,v[I]=A,T[I]=R,T[I+1]=ve}for(let A=0,I=0;A<p;A++){for(;T[I+1]<A;)I++;const R=v[I],z=A-R;m[s+A*h]=_[R]+z*z}}class Fe{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const p=[];for(const _ in s)for(const v of s[_])p.push({stack:_,id:v});l.asyncAll(p,({stack:_,id:v},T)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{}});let I=A.glyphs[v];if(I!==void 0)return void T(null,{stack:_,id:v,glyph:I});if(I=this._tinySDF(A,_,v),I)return A.glyphs[v]=I,void T(null,{stack:_,id:v,glyph:I});const R=Math.floor(v/256);if(256*R>65535)return void T(new Error("glyphs > 65535 not supported"));if(A.ranges[R])return void T(null,{stack:_,id:v,glyph:I});let z=A.requests[R];z||(z=A.requests[R]=[],Fe.loadGlyphRange(_,R,this.url,this.requestManager,(N,j)=>{if(j){for(const ee in j)this._doesCharSupportLocalGlyph(+ee)||(A.glyphs[+ee]=j[+ee]);A.ranges[R]=!0}for(const ee of z)ee(N,j);delete A.requests[R]})),z.push((N,j)=>{N?T(N):j&&T(null,{stack:_,id:v,glyph:j[v]||null})})},(_,v)=>{if(_)h(_);else if(v){const T={};for(const{stack:A,id:I,glyph:R}of v)(T[A]||(T[A]={}))[I]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};h(null,T)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](s)||l.unicodeBlockLookup["Hangul Syllables"](s)||l.unicodeBlockLookup.Hiragana(s)||l.unicodeBlockLookup.Katakana(s))}_tinySDF(s,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let v=s.tinySDF;if(!v){let A="400";/bold/i.test(h)?A="900":/medium/i.test(h)?A="500":/light/i.test(h)&&(A="200"),v=s.tinySDF=new Fe.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:A})}const T=v.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:T.width||30,height:T.height||30},T.data),metrics:{width:T.glyphWidth||24,height:T.glyphHeight||24,left:T.glyphLeft||0,top:T.glyphTop-27||-8,advance:T.glyphAdvance||24}}}}Fe.loadGlyphRange=function(m,s,h,p,_){const v=256*s,T=v+255,A=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${v}-${T}`),l.ResourceType.Glyphs);l.getArrayBuffer(A,(I,R)=>{if(I)_(I);else if(R){const z={};for(const N of l.parseGlyphPbf(R))z[N.id]=N;_(null,z)}})},Fe.TinySDF=class{constructor({fontSize:m=24,buffer:s=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:v="normal",fontStyle:T="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=h;const A=this.size=m+4*s,I=this._createCanvas(A),R=this.ctx=I.getContext("2d",{willReadFrequently:!0});R.font=`${T} ${v} ${m}px ${_}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:v}=this.ctx.measureText(m),T=Math.ceil(h),A=Math.min(this.size-this.buffer,Math.ceil(v-_)),I=Math.min(this.size-this.buffer,T+Math.ceil(p)),R=A+2*this.buffer,z=I+2*this.buffer,N=Math.max(R*z,0),j=new Uint8ClampedArray(N),ee={data:j,width:R,height:z,glyphWidth:A,glyphHeight:I,glyphTop:T,glyphLeft:0,glyphAdvance:s};if(A===0||I===0)return ee;const{ctx:K,buffer:Q,gridInner:ue,gridOuter:ge}=this;K.clearRect(Q,Q,A,I),K.fillText(m,Q,Q+T);const xe=K.getImageData(Q,Q,A,I);ge.fill(ve,0,N),ue.fill(0,0,N);for(let te=0;te<I;te++)for(let Se=0;Se<A;Se++){const be=xe.data[4*(te*A+Se)+3]/255;if(be===0)continue;const Le=(te+Q)*R+Se+Q;if(be===1)ge[Le]=0,ue[Le]=ve;else{const ke=.5-be;ge[Le]=ke>0?ke*ke:0,ue[Le]=ke<0?ke*ke:0}}he(ge,0,0,R,z,R,this.f,this.v,this.z),he(ue,Q,Q,A,I,R,this.f,this.v,this.z);for(let te=0;te<N;te++){const Se=Math.sqrt(ge[te])-Math.sqrt(ue[te]);j[te]=Math.round(255-255*(Se/this.radius+this.cutoff))}return ee}};const Ze=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,s){return l.sphericalToCartesian(m.expression.evaluate(s))}interpolate(m,s,h){return{x:l.number(m.x,s.x,h),y:l.number(m.y,s.y,h),z:l.number(m.z,s.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),ht="-transition";class _t extends l.Evented{constructor(s){super(),this._transitionable=new l.Transitionable(Ze),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.validateLight,s,h))for(const p in s){const _=s[p];p.endsWith(ht)?this._transitionable.setTransition(p.slice(0,-ht.length),_):this._transitionable.setValue(p,_)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class lt{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const p=s.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,h)),this.dashEntry[p]}getDashRanges(s,h,p){const _=[];let v=s.length%2==1?-s[s.length-1]*p:0,T=s[0]*p,A=!0;_.push({left:v,right:T,isDash:A,zeroLength:s[0]===0});let I=s[0];for(let R=1;R<s.length;R++){A=!A;const z=s[R];v=I*p,I+=z,T=I*p,_.push({left:v,right:T,isDash:A,zeroLength:z===0})}return _}addRoundDash(s,h,p){const _=h/2;for(let v=-p;v<=p;v++){const T=this.width*(this.nextRow+p+v);let A=0,I=s[A];for(let R=0;R<this.width;R++){R/I.right>1&&(I=s[++A]);const z=Math.abs(R-I.left),N=Math.abs(R-I.right),j=Math.min(z,N);let ee;const K=v/p*(_+1);if(I.isDash){const Q=_-Math.abs(K);ee=Math.sqrt(j*j+Q*Q)}else ee=_-Math.sqrt(j*j+K*K);this.data[T+R]=Math.max(0,Math.min(255,ee+128))}}}addRegularDash(s){for(let A=s.length-1;A>=0;--A){const I=s[A],R=s[A+1];I.zeroLength?s.splice(A,1):R&&R.isDash===I.isDash&&(R.left=I.left,s.splice(A,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let v=0,T=s[v];for(let A=0;A<this.width;A++){A/T.right>1&&(T=s[++v]);const I=Math.abs(A-T.left),R=Math.abs(A-T.right),z=Math.min(I,R);this.data[_+A]=Math.max(0,Math.min(255,(T.isDash?z:-z)+128))}}addDash(s,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let v=0;for(let A=0;A<s.length;A++)v+=s[A];if(v!==0){const A=this.width/v,I=this.getDashRanges(s,this.width,A);h?this.addRoundDash(I,A,p):this.addRegularDash(I)}const T={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=_,this.dirty=!0,T}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Et{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new Et.Actor(p[_],h,this.id);v.name=`Worker ${_}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,p){l.asyncAll(this.actors,(_,v)=>{_.send(s,h,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function It(m,s,h){const p=function(_,v){if(_)return h(_);if(v){const T=l.pick(l.extend(v,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(T.vectorLayers=v.vector_layers,T.vectorLayerIds=T.vectorLayers.map(A=>A.id)),h(null,T)}};return m.url?l.getJSON(s.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}Et.Actor=l.Actor;class Ot{constructor(s,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),v=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=p&&s.x<v&&s.y>=_&&s.y<T}}class zt extends l.Evented{constructor(s,h,p,_){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=It(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Ot(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(T,A){return delete s.request,s.aborted?h(null):T&&T.status!==404?h(T):(A&&A.resourceTiming&&(s.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&s.setExpiryData(A),s.loadVectorData(A,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",_,v.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",_,v.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ut extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=It(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new Ot(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,v,T)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(_)s.state="errored",h(_);else if(v){this.map._refreshExpiredTiles&&s.setExpiryData(T);const A=this.map.painter.context,I=A.gl;s.texture=this.map.painter.getTileTexture(v.width),s.texture?s.texture.update(v,{useMipmap:!0}):(s.texture=new J(A,v,I.RGBA,{useMipmap:!0}),s.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax)),s.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let $i;class ft extends Ut{constructor(s,h,p,_){super(s,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(v,T){v&&(s.state="errored",h(v)),T&&(s.dem=T,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),function(v,T){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(v)s.state="errored",h(v);else if(T){this.map._refreshExpiredTiles&&s.setExpiryData(T),delete T.cacheControl,delete T.expires;const A=l.isImageBitmap(T)&&($i==null&&($i=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$i)?T:l.exported.getImageData(T,1),I={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:A,encoding:this.encoding};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",I,_.bind(this)))}}.bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)}_getNeighboringTiles(s){const h=s.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,v=h.x===0?s.wrap-1:s.wrap,T=(h.x+1+p)%p,A=h.x+1===p?s.wrap+1:s.wrap,I={};return I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,T,h.y).key]={backfilled:!1},h.y>0&&(I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,T,h.y-1).key]={backfilled:!1}),h.y+1<p&&(I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,T,h.y+1).key]={backfilled:!1}),I}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class oi extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData("content"),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:p},_),this}_updateWorkerData(s){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:s}));let T=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(T=v.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const A={dataType:"source",sourceDataType:s};this._collectResourceTiming&&T&&T.length>0&&l.extend(A,{resourceTiming:T}),this.fire(new l.Event("data",A))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const p=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(p,_,(v,T)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):v?h(v):(s.loadVectorData(T,this.map.painter,p==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ti=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vi extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(s,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const h=s.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let v=1/0,T=1/0,A=-1/0,I=-1/0;for(const j of _)v=Math.min(v,j.x),T=Math.min(T,j.y),A=Math.max(A,j.x),I=Math.max(I,j.y);const R=Math.max(A-v,I-T),z=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),N=Math.pow(2,z);return new l.CanonicalTileID(z,Math.floor((v+A)/2*N),Math.floor((T+I)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ti.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new J(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class fn extends Vi{constructor(s,h,p,_){super(s,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ti.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new J(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wn extends Vi{constructor(s,h,p,_){super(s,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(T=>typeof T!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,ti.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new J(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Fi={vector:zt,raster:Ut,"raster-dem":ft,geojson:oi,video:fn,image:Vi,canvas:wn};function Sr(m,s){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(s.toUnwrapped()))}function gr(m,s,h,p,_,v){const T=function(N,j,ee){if(N)for(const K of N){const Q=j[K];if(Q&&Q.source===ee&&Q.type==="fill-extrusion")return!0}else for(const K in j){const Q=j[K];if(Q.source===ee&&Q.type==="fill-extrusion")return!0}return!1}(_&&_.layers,s,m.id),A=v.maxPitchScaleFactor(),I=m.tilesIn(p,A,T);I.sort(Vn);const R=[];for(const N of I)R.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,h,m._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,_,v,A,Sr(m.transform,N.tileID))});const z=function(N){const j={},ee={};for(const K of N){const Q=K.queryResults,ue=K.wrappedTileID,ge=ee[ue]=ee[ue]||{};for(const xe in Q){const te=Q[xe],Se=ge[xe]=ge[xe]||{},be=j[xe]=j[xe]||[];for(const Le of te)Se[Le.featureIndex]||(Se[Le.featureIndex]=!0,be.push(Le))}}return j}(R);for(const N in z)z[N].forEach(j=>{const ee=j.feature,K=m.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=K});return z}function Vn(m,s){const h=m.tileID,p=s.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class Ji{constructor(s,h){this.tileID=s,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.textures.forEach(h=>s.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(s,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(_,v){const T={};if(!v)return T;for(const A of _){const I=A.layerIds.map(R=>v.getLayer(R)).filter(Boolean);if(I.length!==0){A.layers=I,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(R=>I.filter(z=>z.id===R)[0]));for(const R of I)T[R.id]=A}}return T}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof l.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new J(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new J(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,p,_,v,T,A,I,R,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:v,scale:T,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:A,queryPadding:this.queryPadding*R},s,h,p):{}}querySourceFeatures(s,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),v=h?h.sourceLayer:"",T=_._geojsonTileLayer||_[v];if(!T)return;const A=l.createFilter(h&&h.filter),{z:I,x:R,y:z}=this.tileID.canonical,N={z:I,x:R,y:z};for(let j=0;j<T.length;j++){const ee=T.feature(j);if(A.needGeometry){const ue=l.toEvaluationFeature(ee,!0);if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ee))continue;const K=p.getId(ee,v),Q=new l.GeoJSONFeature(ee,I,R,z,K);Q.tile=N,s.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const p=l.parseCacheControl(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const v=this.buckets[_],T=v.layers[0].sourceLayer||"_geojsonTileLayer",A=p[T],I=s[T];if(!A||!I||Object.keys(I).length===0)continue;v.update(I,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=h&&h.style&&h.style.getLayer(_);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=l.exported.now()+s}setDependencies(s,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[s]=p}hasDependency(s,h){for(const p of s){const _=this.dependencies[p];if(_){for(const v of h)if(_[v])return!0}}return!1}}class xi{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,p){const _=s.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},p)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const p=s.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][_];return this.data[p].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const p in this.data)for(const _ of this.data[p])s(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class on{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,p){const _=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][_]=this.stateChanges[s][_]||{},l.extend(this.stateChanges[s][_],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==_&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][_]===null){this.deletedStates[s][_]={};for(const v in this.state[s][_])p[v]||(this.deletedStates[s][_][v]=null)}else for(const v in p)this.deletedStates[s]&&this.deletedStates[s][_]&&this.deletedStates[s][_][v]===null&&delete this.deletedStates[s][_][v]}removeFeatureState(s,h,p){if(this.deletedStates[s]===null)return;const _=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&h!==void 0)this.deletedStates[s][_]!==null&&(this.deletedStates[s][_]=this.deletedStates[s][_]||{},this.deletedStates[s][_][p]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][_])for(p in this.deletedStates[s][_]={},this.stateChanges[s][_])this.deletedStates[s][_][p]=null;else this.deletedStates[s][_]=null;else this.deletedStates[s]=null}getState(s,h){const p=String(h),_=l.extend({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][h];if(v===null)return{};for(const T in v)delete _[T]}return _}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const T in this.stateChanges[_])this.state[_][T]||(this.state[_][T]={}),l.extend(this.state[_][T],this.stateChanges[_][T]),v[T]=this.state[_][T];p[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const T in this.state[_])v[T]={},this.state[_][T]={};else for(const T in this.deletedStates[_]){if(this.deletedStates[_][T]===null)this.state[_][T]={};else for(const A of Object.keys(this.deletedStates[_][T]))delete this.state[_][T][A];v[T]=this.state[_][T]}p[_]=p[_]||{},l.extend(p[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in s)s[_].setFeatureState(p,h)}}class $t extends l.Evented{constructor(s,h,p){super(),this.id=s,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,v,T,A){const I=new Fi[v.type](_,v,T,A);if(I.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${I.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],I),I}(s,h,p,this),this._tiles={},this._cache=new xi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new on}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new l.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Ci).map(s=>s.key)}getRenderableIds(s){const h=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&h.push(this._tiles[p]);return s?h.sort((p,_)=>{const v=p.tileID,T=_.tileID,A=new l.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),I=new l.pointGeometry(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-T.overscaledZ||I.y-A.y||I.x-A.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(Ci).map(p=>p.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,s,h)))}_tileLoaded(s,h,p,_){if(_)return s.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=l.exported.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const v=h[_];if(s.neighboringTiles&&s.neighboringTiles[v]){const T=this.getTileByID(v);p(s,T),p(T,s)}}function p(_,v){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let T=v.tileID.canonical.x-_.tileID.canonical.x;const A=v.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),R=v.tileID.key;T===0&&A===0||Math.abs(A)>1||(Math.abs(T)>1&&(Math.abs(T+I)===1?T+=I:Math.abs(T-I)===1&&(T-=I)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,T,A),_.neighboringTiles&&_.neighboringTiles[R]&&(_.neighboringTiles[R].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,p,_){for(const v in this._tiles){let T=this._tiles[v];if(_[v]||!T.hasData()||T.tileID.overscaledZ<=h||T.tileID.overscaledZ>p)continue;let A=T.tileID;for(;T&&T.tileID.overscaledZ>h+1;){const R=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[R.key],T&&T.hasData()&&(A=R)}let I=A;for(;I.overscaledZ>h;)if(I=I.scaledTo(I.overscaledZ-1),s[I.key]){_[A.key]=A;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=s.overscaledZ-1;p>=h;p--){const _=s.scaledTo(p),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,_=Math.floor(h*p*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const p={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new l.OverscaledTileID(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(R=>this._source.hasTile(R)))):p=[];const _=s.coveringZoomLevel(this._source),v=Math.max(_-$t.maxOverzooming,this._source.minzoom),T=Math.max(_+$t.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const z of p)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);R[N.key]=N;const j=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));R[j.key]=j}p=p.concat(Object.values(R))}const A=this._updateRetainedTiles(p,_);if(jn(this._source.type)){const R={},z={},N=Object.keys(A);for(const j of N){const ee=A[j],K=this._tiles[j];if(!K||K.fadeEndTime&&K.fadeEndTime<=l.exported.now())continue;const Q=this.findLoadedParent(ee,v);Q&&(this._addTile(Q.tileID),R[Q.tileID.key]=Q.tileID),z[j]=ee}this._retainLoadedChildren(z,_,T,A);for(const j in R)A[j]||(this._coveredTiles[j]=!0,A[j]=R[j]);if(h){const j={},ee={};for(const K of p)this._tiles[K.key].hasData()?j[K.key]=K:ee[K.key]=K;for(const K in ee){const Q=ee[K].children(this._source.maxzoom);this._tiles[Q[0].key]&&this._tiles[Q[1].key]&&this._tiles[Q[2].key]&&this._tiles[Q[3].key]&&(j[Q[0].key]=A[Q[0].key]=Q[0],j[Q[1].key]=A[Q[1].key]=Q[1],j[Q[2].key]=A[Q[2].key]=Q[2],j[Q[3].key]=A[Q[3].key]=Q[3],delete ee[K])}for(const K in ee){const Q=this.findLoadedParent(ee[K],this._source.minzoom);if(Q){j[Q.tileID.key]=A[Q.tileID.key]=Q.tileID;for(const ue in j)j[ue].isChildOf(Q.tileID)&&delete j[ue]}}for(const K in this._tiles)j[K]||(this._coveredTiles[K]=!0)}}for(const R in A)this._tiles[R].clearFadeHold();const I=l.keysDifference(this._tiles,A);for(const R of I){const z=this._tiles[R];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const p={},_={},v=Math.max(h-$t.maxOverzooming,this._source.minzoom),T=Math.max(h+$t.maxUnderzooming,this._source.minzoom),A={};for(const I of s){const R=this._addTile(I);p[I.key]=I,R.hasData()||h<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,h,T,p);for(const I of s){let R=this._tiles[I.key];if(R.hasData())continue;if(h+1>this._source.maxzoom){const N=I.children(this._source.maxzoom)[0],j=this.getTile(N);if(j&&j.hasData()){p[N.key]=N;continue}}else{const N=I.children(this._source.maxzoom);if(p[N[0].key]&&p[N[1].key]&&p[N[2].key]&&p[N[3].key])continue}let z=R.wasRequested();for(let N=I.overscaledZ-1;N>=v;--N){const j=I.scaledTo(N);if(_[j.key]||(_[j.key]=!0,R=this.getTile(j),!R&&z&&(R=this._addTile(j)),R&&(p[j.key]=j,z=R.wasRequested(),R.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let p,_=this._tiles[s].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;_=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const p=h;return h||(h=new Ji(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=h.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,p){const _=[],v=this.transform;if(!v)return _;const T=p?v.getCameraQueryGeometry(s):s,A=s.map(K=>v.pointCoordinate(K,this.terrain)),I=T.map(K=>v.pointCoordinate(K,this.terrain)),R=this.getIds();let z=1/0,N=1/0,j=-1/0,ee=-1/0;for(const K of I)z=Math.min(z,K.x),N=Math.min(N,K.y),j=Math.max(j,K.x),ee=Math.max(ee,K.y);for(let K=0;K<R.length;K++){const Q=this._tiles[R[K]];if(Q.holdingForFade())continue;const ue=Q.tileID,ge=Math.pow(2,v.zoom-Q.tileID.overscaledZ),xe=h*Q.queryPadding*l.EXTENT/Q.tileSize/ge,te=[ue.getTilePoint(new l.MercatorCoordinate(z,N)),ue.getTilePoint(new l.MercatorCoordinate(j,ee))];if(te[0].x-xe<l.EXTENT&&te[0].y-xe<l.EXTENT&&te[1].x+xe>=0&&te[1].y+xe>=0){const Se=A.map(Le=>ue.getTilePoint(Le)),be=I.map(Le=>ue.getTilePoint(Le));_.push({tile:Q,tileID:ue,queryGeometry:Se,cameraQueryGeometry:be,scale:ge})}}return _}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(jn(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(s,h,p){this._state.updateState(s=s||"_geojsonTileLayer",h,p)}removeFeatureState(s,h,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,p)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,p){const _=this._tiles[s];_&&_.setDependencies(h,p)}reloadTilesForDependencies(s,h){for(const p in this._tiles)this._tiles[p].hasDependency(s,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,h))}}function Ci(m,s){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-h||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function jn(m){return m==="raster"||m==="image"||m==="video"}$t.maxOverzooming=10,$t.maxUnderzooming=3;const oe="mapboxgl_preloaded_worker_pool";class me{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<me.workerCount;)this.workers.push(new Worker(Xs.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oe]}numActive(){return Object.keys(this.active).length}}const Re=Math.floor(l.exported.hardwareConcurrency/2);let Ve;function Be(){return Ve||(Ve=new me),Ve}function qe(m,s){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in s&&(h[p]=s[p])}),h}function rt(m){m=m.slice();const s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=qe(m[h],s[m[h].ref]));return m}me.workerCount=Math.max(Math.min(Re,6),1);const ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $e(m,s,h){h.push({command:ze.addSource,args:[m,s[m]]})}function Ue(m,s,h){s.push({command:ze.removeSource,args:[m]}),h[m]=!0}function Tt(m,s,h,p){Ue(m,h,p),$e(m,s,h)}function yt(m,s,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!M(m[h][p],s[h][p]))return!1;for(p in s[h])if(Object.prototype.hasOwnProperty.call(s[h],p)&&p!=="data"&&!M(m[h][p],s[h][p]))return!1;return!0}function wt(m,s,h,p,_,v){let T;for(T in s=s||{},m=m||{})Object.prototype.hasOwnProperty.call(m,T)&&(M(m[T],s[T])||h.push({command:v,args:[p,T,s[T],_]}));for(T in s)Object.prototype.hasOwnProperty.call(s,T)&&!Object.prototype.hasOwnProperty.call(m,T)&&(M(m[T],s[T])||h.push({command:v,args:[p,T,s[T],_]}))}function Lt(m){return m.id}function Vt(m,s){return m[s.id]=s,m}class Qt{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.clamp(s,0,1);let h=1,p=this._distances[h];const _=s*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const v=h-1,T=this._distances[v],A=p-T,I=A>0?(_-T)/A:0;return this.points[v].mult(1-I).add(this.points[h].mult(I))}}function we(m,s){let h=!0;return m==="always"||m!=="never"&&s!=="never"||(h=!1),h}class je{constructor(s,h,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(h/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,p,_,v){this._forEachCell(h,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(s,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(s,h,p,_,v,T){this.boxCells[v].push(T)}_insertCircleCell(s,h,p,_,v,T){this.circleCells[v].push(T)}_query(s,h,p,_,v,T,A){if(p<0||s>this.width||_<0||h>this.height)return[];const I=[];if(s<=0&&h<=0&&this.width<=p&&this.height<=_){if(v)return[{key:null,x1:s,y1:h,x2:p,y2:_}];for(let R=0;R<this.boxKeys.length;R++)I.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],N=this.circles[3*R+1],j=this.circles[3*R+2];I.push({key:this.circleKeys[R],x1:z-j,y1:N-j,x2:z+j,y2:N+j})}}else this._forEachCell(s,h,p,_,this._queryCell,I,{hitTest:v,overlapMode:T,seenUids:{box:{},circle:{}}},A);return I}query(s,h,p,_){return this._query(s,h,p,_,!1,null)}hitTest(s,h,p,_,v,T){return this._query(s,h,p,_,!0,v,T).length>0}hitTestCircle(s,h,p,_,v){const T=s-p,A=s+p,I=h-p,R=h+p;if(A<0||T>this.width||R<0||I>this.height)return!1;const z=[];return this._forEachCell(T,I,A,R,this._queryCellCircle,z,{hitTest:!0,overlapMode:_,circle:{x:s,y:h,radius:p},seenUids:{box:{},circle:{}}},v),z.length>0}_queryCell(s,h,p,_,v,T,A,I){const{seenUids:R,hitTest:z,overlapMode:N}=A,j=this.boxCells[v];if(j!==null){const K=this.bboxes;for(const Q of j)if(!R.box[Q]){R.box[Q]=!0;const ue=4*Q,ge=this.boxKeys[Q];if(s<=K[ue+2]&&h<=K[ue+3]&&p>=K[ue+0]&&_>=K[ue+1]&&(!I||I(ge))&&(!z||!we(N,ge.overlapMode))&&(T.push({key:ge,x1:K[ue],y1:K[ue+1],x2:K[ue+2],y2:K[ue+3]}),z))return!0}}const ee=this.circleCells[v];if(ee!==null){const K=this.circles;for(const Q of ee)if(!R.circle[Q]){R.circle[Q]=!0;const ue=3*Q,ge=this.circleKeys[Q];if(this._circleAndRectCollide(K[ue],K[ue+1],K[ue+2],s,h,p,_)&&(!I||I(ge))&&(!z||!we(N,ge.overlapMode))){const xe=K[ue],te=K[ue+1],Se=K[ue+2];if(T.push({key:ge,x1:xe-Se,y1:te-Se,x2:xe+Se,y2:te+Se}),z)return!0}}}return!1}_queryCellCircle(s,h,p,_,v,T,A,I){const{circle:R,seenUids:z,overlapMode:N}=A,j=this.boxCells[v];if(j!==null){const K=this.bboxes;for(const Q of j)if(!z.box[Q]){z.box[Q]=!0;const ue=4*Q,ge=this.boxKeys[Q];if(this._circleAndRectCollide(R.x,R.y,R.radius,K[ue+0],K[ue+1],K[ue+2],K[ue+3])&&(!I||I(ge))&&!we(N,ge.overlapMode))return T.push(!0),!0}}const ee=this.circleCells[v];if(ee!==null){const K=this.circles;for(const Q of ee)if(!z.circle[Q]){z.circle[Q]=!0;const ue=3*Q,ge=this.circleKeys[Q];if(this._circlesCollide(K[ue],K[ue+1],K[ue+2],R.x,R.y,R.radius)&&(!I||I(ge))&&!we(N,ge.overlapMode))return T.push(!0),!0}}}_forEachCell(s,h,p,_,v,T,A,I){const R=this._convertToXCellCoord(s),z=this._convertToYCellCoord(h),N=this._convertToXCellCoord(p),j=this._convertToYCellCoord(_);for(let ee=R;ee<=N;ee++)for(let K=z;K<=j;K++)if(v.call(this,s,h,p,_,this.xCellCount*K+ee,T,A,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,p,_,v,T){const A=_-s,I=v-h,R=p+T;return R*R>A*A+I*I}_circleAndRectCollide(s,h,p,_,v,T,A){const I=(T-_)/2,R=Math.abs(s-(_+I));if(R>I+p)return!1;const z=(A-v)/2,N=Math.abs(h-(v+z));if(N>z+p)return!1;if(R<=I||N<=z)return!0;const j=R-I,ee=N-z;return j*j+ee*ee<=p*p}}function ji(m,s,h,p,_){const v=l.create();return s?(l.scale(v,v,[1/_,1/_,1]),h||l.rotateZ(v,v,p.angle)):l.multiply(v,p.labelPlaneMatrix,m),v}function Bi(m,s,h,p,_){if(s){const v=l.clone(m);return l.scale(v,v,[_,_,1]),h||l.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function jt(m,s,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,s)):(p=[m.x,m.y,0,1],er(p,p,s));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Qi(m,s){return .5+m/s*.5}function pn(m,s){const h=m[0]/m[3],p=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&p>=-s[1]&&p<=s[1]}function vi(m,s,h,p,_,v,T,A,I,R){const z=p?m.textSizeData:m.iconSizeData,N=l.evaluateSizeForZoom(z,h.transform.zoom),j=[256/h.width*2+1,256/h.height*2+1],ee=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ee.clear();const K=m.lineVertexArray,Q=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,ue=h.transform.width/h.transform.height;let ge=!1;for(let xe=0;xe<Q.length;xe++){const te=Q.get(xe);if(te.hidden||te.writingMode===l.WritingMode.vertical&&!ge){Dt(te.numGlyphs,ee);continue}let Se;if(ge=!1,R?(Se=[te.anchorX,te.anchorY,R(te.anchorX,te.anchorY),1],l.transformMat4(Se,Se,s)):(Se=[te.anchorX,te.anchorY,0,1],er(Se,Se,s)),!pn(Se,j)){Dt(te.numGlyphs,ee);continue}const be=Qi(h.transform.cameraToCenterDistance,Se[3]),Le=l.evaluateSizeForFeature(z,N,te),ke=T?Le/be:Le*be,Ge=new l.pointGeometry(te.anchorX,te.anchorY),Me=jt(Ge,_,R).point,st={},Ke=Bt(te,ke,!1,A,s,_,v,m.glyphOffsetArray,K,ee,Me,Ge,st,ue,I,R);ge=Ke.useVertical,(Ke.notEnoughRoom||ge||Ke.needsFlipping&&Bt(te,ke,!0,A,s,_,v,m.glyphOffsetArray,K,ee,Me,Ge,st,ue,I,R).notEnoughRoom)&&Dt(te.numGlyphs,ee)}p?m.text.dynamicLayoutVertexBuffer.updateData(ee):m.icon.dynamicLayoutVertexBuffer.updateData(ee)}function Zi(m,s,h,p,_,v,T,A,I,R,z,N,j){const ee=A.glyphStartIndex+A.numGlyphs,K=A.lineStartIndex,Q=A.lineStartIndex+A.lineLength,ue=s.getoffsetX(A.glyphStartIndex),ge=s.getoffsetX(ee-1),xe=an(m*ue,h,p,_,v,T,A.segment,K,Q,I,R,z,N,j);if(!xe)return null;const te=an(m*ge,h,p,_,v,T,A.segment,K,Q,I,R,z,N,j);return te?{first:xe,last:te}:null}function Xe(m,s,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function Bt(m,s,h,p,_,v,T,A,I,R,z,N,j,ee,K,Q){const ue=s/24,ge=m.lineOffsetX*ue,xe=m.lineOffsetY*ue;let te;if(m.numGlyphs>1){const Se=m.glyphStartIndex+m.numGlyphs,be=m.lineStartIndex,Le=m.lineStartIndex+m.lineLength,ke=Zi(ue,A,ge,xe,h,z,N,m,I,v,j,K,Q);if(!ke)return{notEnoughRoom:!0};const Ge=jt(ke.first.point,T,Q).point,Me=jt(ke.last.point,T,Q).point;if(p&&!h){const st=Xe(m.writingMode,Ge,Me,ee);if(st)return st}te=[ke.first];for(let st=m.glyphStartIndex+1;st<Se-1;st++)te.push(an(ue*A.getoffsetX(st),ge,xe,h,z,N,m.segment,be,Le,I,v,j,K,Q));te.push(ke.last)}else{if(p&&!h){const be=jt(N,_,Q).point,Le=m.lineStartIndex+m.segment+1,ke=new l.pointGeometry(I.getx(Le),I.gety(Le)),Ge=jt(ke,_,Q),Me=Ge.signedDistanceFromCamera>0?Ge.point:Ft(N,ke,be,1,_,Q),st=Xe(m.writingMode,be,Me,ee);if(st)return st}const Se=an(ue*A.getoffsetX(m.glyphStartIndex),ge,xe,h,z,N,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,I,v,j,K,Q);if(!Se)return{notEnoughRoom:!0};te=[Se]}for(const Se of te)l.addDynamicAttributes(R,Se.point,Se.angle);return{}}function Ft(m,s,h,p,_,v){const T=jt(m.add(m.sub(s)._unit()),_,v).point,A=h.sub(T);return h.add(A._mult(p/A.mag()))}function an(m,s,h,p,_,v,T,A,I,R,z,N,j,ee){const K=p?m-s:m+s;let Q=K>0?1:-1,ue=0;p&&(Q*=-1,ue=Math.PI),Q<0&&(ue+=Math.PI);let ge=Q>0?A+T:A+T+1,xe=_,te=_,Se=0,be=0;const Le=Math.abs(K),ke=[];for(;Se+be<=Le;){if(ge+=Q,ge<A||ge>=I)return null;if(te=xe,ke.push(xe),xe=N[ge],xe===void 0){const ot=new l.pointGeometry(R.getx(ge),R.gety(ge)),Nt=jt(ot,z,ee);if(Nt.signedDistanceFromCamera>0)xe=N[ge]=Nt.point;else{const Ht=ge-Q;xe=Ft(Se===0?v:new l.pointGeometry(R.getx(Ht),R.gety(Ht)),ot,te,Le-Se+1,z,ee)}}Se+=be,be=te.dist(xe)}const Ge=(Le-Se)/be,Me=xe.sub(te),st=Me.mult(Ge)._add(te);st._add(Me._unit()._perp()._mult(h*Q));const Ke=ue+Math.atan2(xe.y-te.y,xe.x-te.x);return ke.push(st),{point:st,angle:j?Ke:0,path:ke}}const Ar=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(m,s){for(let h=0;h<m;h++){const p=s.length;s.resize(p+4),s.float32.set(Ar,3*p)}}function er(m,s,h){const p=s[0],_=s[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const en=100;class ys{constructor(s,h=new je(s.width+200,s.height+200,25),p=new je(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+en,this.screenBottomBoundary=s.height+en,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,p,_,v,T){const A=this.projectAndGetPerspectiveRatio(_,s.anchorPointX,s.anchorPointY,T),I=p*A.perspectiveRatio,R=s.x1*I+A.point.x,z=s.y1*I+A.point.y,N=s.x2*I+A.point.x,j=s.y2*I+A.point.y;return!this.isInsideGrid(R,z,N,j)||h!=="always"&&this.grid.hitTest(R,z,N,j,h,v)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[R,z,N,j],offscreen:this.isOffscreen(R,z,N,j)}}placeCollisionCircles(s,h,p,_,v,T,A,I,R,z,N,j,ee,K){const Q=[],ue=new l.pointGeometry(h.anchorX,h.anchorY),ge=jt(ue,T,K),xe=Qi(this.transform.cameraToCenterDistance,ge.signedDistanceFromCamera),te=(z?v/xe:v*xe)/l.ONE_EM,Se=jt(ue,A,K).point,be=Zi(te,_,h.lineOffsetX*te,h.lineOffsetY*te,!1,Se,ue,h,p,A,{},!1,K);let Le=!1,ke=!1,Ge=!0;if(be){const Me=.5*j*xe+ee,st=new l.pointGeometry(-100,-100),Ke=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ot=new Qt,Nt=be.first,Ht=be.last;let At=[];for(let ii=Nt.path.length-1;ii>=1;ii--)At.push(Nt.path[ii]);for(let ii=1;ii<Ht.path.length;ii++)At.push(Ht.path[ii]);const pi=2.5*Me;if(I){const ii=At.map(si=>jt(si,I,K));At=ii.some(si=>si.signedDistanceFromCamera<=0)?[]:ii.map(si=>si.point)}let mi=[];if(At.length>0){const ii=At[0].clone(),si=At[0].clone();for(let _i=1;_i<At.length;_i++)ii.x=Math.min(ii.x,At[_i].x),ii.y=Math.min(ii.y,At[_i].y),si.x=Math.max(si.x,At[_i].x),si.y=Math.max(si.y,At[_i].y);mi=ii.x>=st.x&&si.x<=Ke.x&&ii.y>=st.y&&si.y<=Ke.y?[At]:si.x<st.x||ii.x>Ke.x||si.y<st.y||ii.y>Ke.y?[]:l.clipLine([At],st.x,st.y,Ke.x,Ke.y)}for(const ii of mi){ot.reset(ii,.25*Me);let si=0;si=ot.length<=.5*Me?1:Math.ceil(ot.paddedLength/pi)+1;for(let _i=0;_i<si;_i++){const gn=_i/Math.max(si-1,1),qr=ot.lerp(gn),Mr=qr.x+en,$r=qr.y+en;Q.push(Mr,$r,Me,0);const Is=Mr-Me,vr=$r-Me,Wn=Mr+Me,rs=$r+Me;if(Ge=Ge&&this.isOffscreen(Is,vr,Wn,rs),ke=ke||this.isInsideGrid(Is,vr,Wn,rs),s!=="always"&&this.grid.hitTestCircle(Mr,$r,Me,s,N)&&(Le=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!R&&Le||!ke||xe<this.perspectiveRatioCutoff?[]:Q,offscreen:Ge,collisionDetected:Le}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,v=-1/0,T=-1/0;for(const z of s){const N=new l.pointGeometry(z.x+en,z.y+en);p=Math.min(p,N.x),_=Math.min(_,N.y),v=Math.max(v,N.x),T=Math.max(T,N.y),h.push(N)}const A=this.grid.query(p,_,v,T).concat(this.ignoredGrid.query(p,_,v,T)),I={},R={};for(const z of A){const N=z.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const j=[new l.pointGeometry(z.x1,z.y1),new l.pointGeometry(z.x2,z.y1),new l.pointGeometry(z.x2,z.y2),new l.pointGeometry(z.x1,z.y2)];l.polygonIntersectsPolygon(h,j)&&(I[N.bucketInstanceId][N.featureIndex]=!0,R[N.bucketInstanceId]===void 0&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(s,h,p,_,v,T){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:T,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,p,_,v,T){const A=p?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:v,collisionGroupID:T,overlapMode:h};for(let R=0;R<s.length;R+=4)A.insertCircle(I,s[R],s[R+1],s[R+2])}projectAndGetPerspectiveRatio(s,h,p,_){let v;return _?(v=[h,p,_(h,p),1],l.transformMat4(v,v,s)):(v=[h,p,0,1],er(v,v,s)),{point:new l.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+en,(-v[1]/v[3]+1)/2*this.transform.height+en),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(s,h,p,_){return p<en||s>=this.screenRightBoundary||_<en||h>this.screenBottomBoundary}isInsideGrid(s,h,p,_){return p>=0&&s<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.identity([]);return l.translate(s,s,[-100,-100,0]),s}}function Gi(m,s,h){return s*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class mn{constructor(s,h,p,_){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class di{constructor(s,h,p,_,v){this.text=new mn(s?s.text:null,h,p,v),this.icon=new mn(s?s.icon:null,h,_,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xs{constructor(s,h,p){this.text=s,this.icon=h,this.skipFade=p}}class _r{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class yr{constructor(s,h,p,_,v){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class es{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[s]}}function vs(m,s,h,p,_){const{horizontalAlign:v,verticalAlign:T}=l.getAnchorAlignment(m),A=-(v-.5)*s,I=-(T-.5)*h,R=l.evaluateVariableOffset(m,p);return new l.pointGeometry(A+R[0]*_,I+R[1]*_)}function Gr(m,s,h,p,_,v){const{x1:T,x2:A,y1:I,y2:R,anchorPointX:z,anchorPointY:N}=m,j=new l.pointGeometry(s,h);return p&&j._rotate(_?v:-v),{x1:T+j.x,y1:I+j.y,x2:A+j.x,y2:R+j.y,anchorPointX:z,anchorPointY:N}}class X{constructor(s,h,p,_,v){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new ys(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new es(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,p,_){const v=p.getBucket(h),T=p.latestFeatureIndex;if(!v||!T||h.id!==v.layerIds[0])return;const A=p.collisionBoxArray,I=v.layers[0].layout,R=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/l.EXTENT,N=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),j=I.get("text-pitch-alignment")==="map",ee=I.get("text-rotation-alignment")==="map",K=Gi(p,1,this.transform.zoom),Q=ji(N,j,ee,this.transform,K);let ue=null;if(j){const xe=Bi(N,j,ee,this.transform,K);ue=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[v.bucketInstanceId]=new yr(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,p.tileID);const ge={bucket:v,layout:I,posMatrix:N,textLabelPlaneMatrix:Q,labelToScreenMatrix:ue,scale:R,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const xe of v.sortKeyRanges){const{sortKey:te,symbolInstanceStart:Se,symbolInstanceEnd:be}=xe;s.push({sortKey:te,symbolInstanceStart:Se,symbolInstanceEnd:be,parameters:ge})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(s,h,p,_,v,T,A,I,R,z,N,j,ee,K,Q,ue){const ge=[j.textOffset0,j.textOffset1],xe=vs(s,p,_,ge,v),te=this.collisionIndex.placeCollisionBox(Gr(h,xe.x,xe.y,T,A,this.transform.angle),N,I,R,z.predicate,ue);if((!Q||this.collisionIndex.placeCollisionBox(Gr(Q,xe.x,xe.y,T,A,this.transform.angle),N,I,R,z.predicate,ue).box.length!==0)&&te.box.length>0){let Se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Se=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ge,width:p,height:_,anchor:s,textBoxScale:v,prevAnchor:Se},this.markUsedJustification(ee,s,j,K),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,K,j),this.placedOrientations[j.crossTileID]=K),{shift:xe,placedGlyphBoxes:te}}}placeLayerBucketPart(s,h,p){const{bucket:_,layout:v,posMatrix:T,textLabelPlaneMatrix:A,labelToScreenMatrix:I,textPixelRatio:R,holdingForFade:z,collisionBoxArray:N,partiallyEvaluatedTextSize:j,collisionGroup:ee}=s.parameters,K=v.get("text-optional"),Q=v.get("icon-optional"),ue=l.getOverlapMode(v,"text-overlap","text-allow-overlap"),ge=ue==="always",xe=l.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),te=xe==="always",Se=v.get("text-rotation-alignment")==="map",be=v.get("text-pitch-alignment")==="map",Le=v.get("icon-text-fit")!=="none",ke=v.get("symbol-z-order")==="viewport-y",Ge=ge&&(te||!_.hasIconData()||Q),Me=te&&(ge||!_.hasTextData()||K);!_.collisionArrays&&N&&_.deserializeCollisionBoxes(N);const st=(Ke,ot)=>{if(h[Ke.crossTileID])return;if(z)return void(this.placements[Ke.crossTileID]=new xs(!1,!1,!1));let Nt=!1,Ht=!1,At=!0,pi=null,mi={box:null,offscreen:null},ii={box:null,offscreen:null},si=null,_i=null,gn=null,qr=0,Mr=0,$r=0;ot.textFeatureIndex?qr=ot.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(qr=Ke.featureIndex),ot.verticalTextFeatureIndex&&(Mr=ot.verticalTextFeatureIndex);const Is=this.retainedQueryData[_.bucketInstanceId].tileID,vr=this.terrain?(cn,Yt)=>this.terrain.getElevation(Is,cn,Yt):null;for(const cn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Yt=ot[cn];Yt&&(Yt.elevation=vr?vr(Yt.anchorPointX,Yt.anchorPointY):0)}const Wn=ot.textBox;if(Wn){const cn=fi=>{let _n=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!fi&&this.prevPlacement){const yn=this.prevPlacement.placedOrientations[Ke.crossTileID];yn&&(this.placedOrientations[Ke.crossTileID]=yn,_n=yn,this.markUsedOrientation(_,_n,Ke))}return _n},Yt=(fi,_n)=>{if(_.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const yn of _.writingModes)if(yn===l.WritingMode.vertical?(mi=_n(),ii=mi):mi=fi(),mi&&mi.box&&mi.box.length)break}else mi=fi()};if(v.get("text-variable-anchor")){let fi=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke.crossTileID]){const Ri=this.prevPlacement.variableOffsets[Ke.crossTileID];fi.indexOf(Ri.anchor)>0&&(fi=fi.filter(br=>br!==Ri.anchor),fi.unshift(Ri.anchor))}const _n=(Ri,br,Ys)=>{const Mc=Ri.x2-Ri.x1,Lo=Ri.y2-Ri.y1,wh=Ke.textBoxScale,Lc=Le&&xe==="never"?br:null;let Cs={box:[],offscreen:!1};const Ks=ue!=="never"?2*fi.length:fi.length;for(let Js=0;Js<Ks;++Js){const ul=this.attemptAnchorPlacement(fi[Js%fi.length],Ri,Mc,Lo,wh,Se,be,R,T,ee,Js>=fi.length?ue:"never",Ke,_,Ys,Lc,vr);if(ul&&(Cs=ul.placedGlyphBoxes,Cs&&Cs.box&&Cs.box.length)){Nt=!0,pi=ul.shift;break}}return Cs};Yt(()=>_n(Wn,ot.iconBox,l.WritingMode.horizontal),()=>{const Ri=ot.verticalTextBox;return _.allowVerticalPlacement&&!(mi&&mi.box&&mi.box.length)&&Ke.numVerticalGlyphVertices>0&&Ri?_n(Ri,ot.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),mi&&(Nt=mi.box,At=mi.offscreen);const yn=cn(mi&&mi.box);if(!Nt&&this.prevPlacement){const Ri=this.prevPlacement.variableOffsets[Ke.crossTileID];Ri&&(this.variableOffsets[Ke.crossTileID]=Ri,this.markUsedJustification(_,Ri.anchor,Ke,yn))}}else{const fi=(_n,yn)=>{const Ri=this.collisionIndex.placeCollisionBox(_n,ue,R,T,ee.predicate,vr);return Ri&&Ri.box&&Ri.box.length&&(this.markUsedOrientation(_,yn,Ke),this.placedOrientations[Ke.crossTileID]=yn),Ri};Yt(()=>fi(Wn,l.WritingMode.horizontal),()=>{const _n=ot.verticalTextBox;return _.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&_n?fi(_n,l.WritingMode.vertical):{box:null,offscreen:null}}),cn(mi&&mi.box&&mi.box.length)}}if(si=mi,Nt=si&&si.box&&si.box.length>0,At=si&&si.offscreen,Ke.useRuntimeCollisionCircles){const cn=_.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),Yt=l.evaluateSizeForFeature(_.textSizeData,j,cn),fi=v.get("text-padding");_i=this.collisionIndex.placeCollisionCircles(ue,cn,_.lineVertexArray,_.glyphOffsetArray,Yt,T,A,I,p,be,ee.predicate,Ke.collisionCircleDiameter,fi,vr),_i.circles.length&&_i.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Nt=ge||_i.circles.length>0&&!_i.collisionDetected,At=At&&_i.offscreen}if(ot.iconFeatureIndex&&($r=ot.iconFeatureIndex),ot.iconBox){const cn=Yt=>{const fi=Le&&pi?Gr(Yt,pi.x,pi.y,Se,be,this.transform.angle):Yt;return this.collisionIndex.placeCollisionBox(fi,xe,R,T,ee.predicate,vr)};ii&&ii.box&&ii.box.length&&ot.verticalIconBox?(gn=cn(ot.verticalIconBox),Ht=gn.box.length>0):(gn=cn(ot.iconBox),Ht=gn.box.length>0),At=At&&gn.offscreen}const rs=K||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,cl=Q||Ke.numIconVertices===0;if(rs||cl?cl?rs||(Ht=Ht&&Nt):Nt=Ht&&Nt:Ht=Nt=Ht&&Nt,Nt&&si&&si.box&&this.collisionIndex.insertCollisionBox(si.box,ue,v.get("text-ignore-placement"),_.bucketInstanceId,ii&&ii.box&&Mr?Mr:qr,ee.ID),Ht&&gn&&this.collisionIndex.insertCollisionBox(gn.box,xe,v.get("icon-ignore-placement"),_.bucketInstanceId,$r,ee.ID),_i&&(Nt&&this.collisionIndex.insertCollisionCircles(_i.circles,ue,v.get("text-ignore-placement"),_.bucketInstanceId,qr,ee.ID),p)){const cn=_.bucketInstanceId;let Yt=this.collisionCircleArrays[cn];Yt===void 0&&(Yt=this.collisionCircleArrays[cn]=new _r);for(let fi=0;fi<_i.circles.length;fi+=4)Yt.circles.push(_i.circles[fi+0]),Yt.circles.push(_i.circles[fi+1]),Yt.circles.push(_i.circles[fi+2]),Yt.circles.push(_i.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new xs(Nt||Ge,Ht||Me,At||_.justReloaded),h[Ke.crossTileID]=!0};if(ke){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=_.getSortedSymbolIndexes(this.transform.angle);for(let ot=Ke.length-1;ot>=0;--ot){const Nt=Ke[ot];st(_.symbolInstances.get(Nt),_.collisionArrays[Nt])}}else for(let Ke=s.symbolInstanceStart;Ke<s.symbolInstanceEnd;Ke++)st(_.symbolInstances.get(Ke),_.collisionArrays[Ke]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[_.bucketInstanceId];l.invert(Ke.invProjMatrix,T),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(s,h,p,_){let v;v=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of T)A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:p.crossTileID)}markUsedOrientation(s,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,v=h===l.WritingMode.vertical?h:0,T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const A of T)s.text.placedSymbolArray.get(A).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(s):1,v=h?h.opacities:{},T=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],z=v[I];z?(this.opacities[I]=new di(z,_,R.text,R.icon),p=p||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[I]=new di(null,_,R.text,R.icon,R.skipFade),p=p||R.text||R.icon)}for(const I in v){const R=v[I];if(!this.opacities[I]){const z=new di(R,_,!1,!1);z.isHidden()||(this.opacities[I]=z,p=p||R.text.placed||R.icon.placed)}}for(const I in T)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=T[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const p={};for(const _ of h){const v=_.getBucket(s);v&&_.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(s,h,p){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const _=s.layers[0].layout,v=new di(null,0,!1,!1,!0),T=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),I=_.get("text-variable-anchor"),R=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",N=_.get("icon-text-fit")!=="none",j=new di(null,0,T&&(A||!s.hasIconData()||_.get("icon-optional")),A&&(T||!s.hasTextData()||_.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const ee=(K,Q,ue)=>{for(let ge=0;ge<Q/4;ge++)K.opacityVertexArray.emplaceBack(ue)};for(let K=0;K<s.symbolInstances.length;K++){const Q=s.symbolInstances.get(K),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:ge,crossTileID:xe}=Q;let te=this.opacities[xe];h[xe]?te=v:te||(te=j,this.opacities[xe]=te),h[xe]=!0;const Se=Q.numIconVertices>0,be=this.placedOrientations[Q.crossTileID],Le=be===l.WritingMode.vertical,ke=be===l.WritingMode.horizontal||be===l.WritingMode.horizontalOnly;if(ue>0||ge>0){const Ge=fe(te.text);ee(s.text,ue,Le?Ce:Ge),ee(s.text,ge,ke?Ce:Ge);const Me=te.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(ot=>{ot>=0&&(s.text.placedSymbolArray.get(ot).hidden=Me||Le?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Me||ke?1:0);const st=this.variableOffsets[Q.crossTileID];st&&this.markUsedJustification(s,st.anchor,Q,be);const Ke=this.placedOrientations[Q.crossTileID];Ke&&(this.markUsedJustification(s,"left",Q,Ke),this.markUsedOrientation(s,Ke,Q))}if(Se){const Ge=fe(te.icon),Me=!(N&&Q.verticalPlacedIconSymbolIndex&&Le);Q.placedIconSymbolIndex>=0&&(ee(s.icon,Q.numIconVertices,Me?Ge:Ce),s.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=te.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(ee(s.icon,Q.numVerticalIconVertices,Me?Ce:Ge),s.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=te.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ge=s.collisionArrays[K];if(Ge){let Me=new l.pointGeometry(0,0);if(Ge.textBox||Ge.verticalTextBox){let Ke=!0;if(I){const ot=this.variableOffsets[xe];ot?(Me=vs(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),R&&Me._rotate(z?this.transform.angle:-this.transform.angle)):Ke=!1}Ge.textBox&&k(s.textCollisionBox.collisionVertexArray,te.text.placed,!Ke||Le,Me.x,Me.y),Ge.verticalTextBox&&k(s.textCollisionBox.collisionVertexArray,te.text.placed,!Ke||ke,Me.x,Me.y)}const st=Boolean(!ke&&Ge.verticalIconBox);Ge.iconBox&&k(s.iconCollisionBox.collisionVertexArray,te.icon.placed,st,N?Me.x:0,N?Me.y:0),Ge.verticalIconBox&&k(s.iconCollisionBox.collisionVertexArray,te.icon.placed,!st,N?Me.x:0,N?Me.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=K.invProjMatrix,s.placementViewportMatrix=K.viewportMatrix,s.collisionCircleArray=K.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function k(m,s,h,p,_){m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0)}const F=Math.pow(2,25),q=Math.pow(2,24),$=Math.pow(2,17),se=Math.pow(2,16),de=Math.pow(2,9),le=Math.pow(2,8),re=Math.pow(2,1);function fe(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*F+s*q+h*$+s*se+h*de+s*le+h*re+s}const Ce=0;class Ne{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,p,_,v){const T=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(T,_,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<T.length;)if(h.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Ie{constructor(s,h,p,_,v,T,A,I){this.placement=new X(s,h,T,A,I),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,p){const _=l.exported.now(),v=()=>{const T=l.exported.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=h[s[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=A)&&(!T.maxzoom||T.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Ne(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const ct=512/l.EXTENT/2;class pt{constructor(s,h,p){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const v=h.get(_),T=v.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,s)})}}getScaledCoordinates(s,h){const p=ct/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+s.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+s.anchorY)*p)}}findMatches(s,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<s.length;v++){const T=s.get(v);if(T.crossTileID)continue;const A=this.indexedSymbolInstances[T.key];if(!A)continue;const I=this.getScaledCoordinates(T,h);for(const R of A)if(Math.abs(R.coord.x-I.x)<=_&&Math.abs(R.coord.y-I.y)<=_&&!p[R.crossTileID]){p[R.crossTileID]=!0,T.crossTileID=R.crossTileID;break}}}}class et{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class St{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],v={};for(const T in _){const A=_[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),v[A.tileID.key]=A}this.indexes[p]=v}this.lng=s}addBucket(s,h,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const _=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const T=this.indexes[v];if(Number(v)>s.overscaledZ)for(const A in T){const I=T[A];I.tileID.isChildOf(s)&&I.findMatches(h.symbolInstances,s,_)}else{const A=T[s.scaledTo(Number(v)).key];A&&A.findMatches(h.symbolInstances,s,_)}}for(let v=0;v<h.symbolInstances.length;v++){const T=h.symbolInstances.get(v);T.crossTileID||(T.crossTileID=p.generate(),_[T.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new pt(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[s][_.crossTileID]}removeStaleBuckets(s){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)s[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],h=!0)}return h}}class vt{constructor(){this.layerIndexes={},this.crossTileIDs=new et,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,p){let _=this.layerIndexes[s.id];_===void 0&&(_=this.layerIndexes[s.id]=new St);let v=!1;const T={};_.handleWrapJump(p);for(const A of h){const I=A.getBucket(s);I&&s.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,I,this.crossTileIDs)&&(v=!0),T[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(T)&&(v=!0),v}pruneUnusedLayers(s){const h={};s.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Gt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class Ct extends l.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=s._cache.max,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const s in this._tiles){const h=this._tiles[s];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];for(const p of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new Ji(p,this.tileSize))}removeOutdated(s){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(s),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),l.ortho(v.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=v}else if(_.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const T=_.canonical.z-s.canonical.z,A=_.canonical.x-(_.canonical.x>>T<<T),I=_.canonical.y-(_.canonical.y>>T<<T),R=l.EXTENT>>T;l.ortho(v.posMatrix,0,R,0,R,0,1),l.translate(v.posMatrix,v.posMatrix,[-A*R,-I*R,0]),h[p]=v}else if(s.canonical.isChildOf(_.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const T=s.canonical.z-_.canonical.z,A=s.canonical.x-(s.canonical.x>>T<<T),I=s.canonical.y-(s.canonical.y>>T<<T),R=l.EXTENT>>T;l.ortho(v.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(v.posMatrix,v.posMatrix,[A*R,I*R,0]),l.scale(v.posMatrix,v.posMatrix,[1/2**T,1/2**T,0]),h[p]=v}}return h}getSourceTile(s,h){const p=this.sourceCache._source;let _=s.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(_).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&h)for(;_>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(_--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=s)}}class kt{constructor(s,h,p){this.style=s,this.sourceCache=new Ct(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(s,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let v=0;const T=this.getTerrainData(s);if(T.tile&&T.tile.dem){const A=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],T.u_terrain_matrix),I=[A[0]*T.tile.dem.dim,A[1]*T.tile.dem.dim],R=[Math.floor(I[0]),Math.floor(I[1])],z=T.tile.dem.get(R[0],R[1]),N=T.tile.dem.get(R[0],R[1]+1),j=T.tile.dem.get(R[0]+1,R[1]),ee=T.tile.dem.get(R[0]+1,R[1]+1);v=l.number(l.number(z,N,I[0]-R[0]),l.number(j,ee,I[0]-R[0]),I[1]-R[1])}return v}rememberForRerender(s,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(s===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[s]=this._rerender[s]||{},this._rerender[s][_.tileID.key]=!0)}}needsRerender(s,h){return this._rerender[s]&&this._rerender[s][h.key]}clearRerenderCache(){this._rerender={}}getElevation(s,h,p,_=l.EXTENT){return(this.getDEMElevation(s,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const _=this.style.map.painter.context,v=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new J(_,v,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new J(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new J(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=_?v=s.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=s.canonical.x-(s.canonical.x>>v<<v),A=s.canonical.y-(s.canonical.y>>v<<v),I=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<v),1/(l.EXTENT<<v),0]);l.translate(I,I,[T*l.EXTENT,A*l.EXTENT,0]),this._demMatrixCache[s.key]={matrix:I,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const s=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=s.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(s){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new J(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new J(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,T=0;v<this._coordsTextureSize;v++)for(let A=0;A<this._coordsTextureSize;A++,T+=4)h[T+0]=255&A,h[T+1]=255&v,h[T+2]=A>>8<<4|v>>8,h[T+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new J(s,p,s.gl.RGBA,{premultiply:!1});return _.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(s){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,v=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(s.x,p.height/devicePixelRatio-s.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const T=h[0]+(h[2]>>4<<8),A=h[1]+((15&h[2])<<8),I=this.coordsIndex[255-h[3]],R=I&&this.sourceCache.getTileByID(I);if(!R)return null;const z=this._coordsTextureSize,N=(1<<R.tileID.canonical.z)*z;return new l.MercatorCoordinate((R.tileID.canonical.x*z+T)/N,(R.tileID.canonical.y*z+A)/N,this.getElevation(R.tileID,T,A,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,v=l.EXTENT/_,T=_*_;for(let A=0;A<=_;A++)for(let I=0;I<=_;I++)h.emplaceBack(I*v,A*v);for(let A=0;A<T;A+=_+1)for(let I=0;I<_;I++)p.emplaceBack(I+A,_+I+A+1,_+I+A+2),p.emplaceBack(I+A,_+I+A+2,I+A+1);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(h,Gt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const Zt=(m,s)=>l.emitValidationErrors(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Kt=l.pick(ze,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ti=l.pick(ze,["setCenter","setZoom","setBearing","setPitch"]),Ei=function(){const m={},s=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?s:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class ln extends l.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Et(Be(),this),this.imageManager=new pe,this.imageManager.setEventedParent(this),this.glyphManager=new Fe(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new vt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=ln.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,T)=>{if(l.triggerPluginCompletionEvent(v),T&&T.every(A=>A))for(const A in p.sourceCaches)p.sourceCaches[A].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.sourceCaches[_.sourceId];if(!v)return;const T=v.getSource();if(T&&T.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===T.id&&this._validateLayer(I)}})}loadURL(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(s,l.ResourceType.Style);this._request=l.getJSON(_,(v,T)=>{this._request=null,v?this.fire(new l.ErrorEvent(v)):T&&this._load(T,p)})}loadJSON(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Ei,!1)}_load(s,h){if(h&&Zt(this,l.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const _ in s.sources)this.addSource(_,s.sources[_],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);const p=rt(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(h,p,_,v){let T,A,I;const R=_>1?"@2x":"";let z=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,R,".json"),l.ResourceType.SpriteJSON),(ee,K)=>{z=null,I||(I=ee,T=K,j())}),N=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,R,".png"),l.ResourceType.SpriteImage),(ee,K)=>{N=null,I||(I=ee,A=K,j())});function j(){if(I)v(I);else if(T&&A){const ee=l.exported.getImageData(A),K={};for(const Q in T){const{width:ue,height:ge,x:xe,y:te,sdf:Se,pixelRatio:be,stretchX:Le,stretchY:ke,content:Ge}=T[Q],Me=new l.RGBAImage({width:ue,height:ge});l.RGBAImage.copy(ee,Me,{x:xe,y:te},{x:0,y:0},{width:ue,height:ge}),K[Q]={data:Me,pixelRatio:be,sdf:Se,stretchX:Le,stretchY:ke,content:Ge}}v(null,K)}}return{cancel(){z&&(z.cancel(),z=null),N&&(N.cancel(),N=null)}}}(s,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const p=s.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const p of s){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const T in this._updatedSources){const A=this._updatedSources[T];if(A==="reload")this._reloadSource(T);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(T)}}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const v=this.sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const _ in p){const v=this.sourceCaches[_];p[_]!==v.used&&v.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(s){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),s){const h=this.sourceCaches[s.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${s.source}`);this.terrain=new kt(this,h,s),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===s.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:s}))}setState(s){if(this._checkLoaded(),Zt(this,l.validateStyle(s)))return!1;(s=l.clone$1(s)).layers=rt(s.layers);const h=function(_,v){if(!_)return[{command:ze.setStyle,args:[v]}];let T=[];try{if(!M(_.version,v.version))return[{command:ze.setStyle,args:[v]}];M(_.center,v.center)||T.push({command:ze.setCenter,args:[v.center]}),M(_.zoom,v.zoom)||T.push({command:ze.setZoom,args:[v.zoom]}),M(_.bearing,v.bearing)||T.push({command:ze.setBearing,args:[v.bearing]}),M(_.pitch,v.pitch)||T.push({command:ze.setPitch,args:[v.pitch]}),M(_.sprite,v.sprite)||T.push({command:ze.setSprite,args:[v.sprite]}),M(_.glyphs,v.glyphs)||T.push({command:ze.setGlyphs,args:[v.glyphs]}),M(_.transition,v.transition)||T.push({command:ze.setTransition,args:[v.transition]}),M(_.light,v.light)||T.push({command:ze.setLight,args:[v.light]});const A={},I=[];(function(z,N,j,ee){let K;for(K in N=N||{},z=z||{})Object.prototype.hasOwnProperty.call(z,K)&&(Object.prototype.hasOwnProperty.call(N,K)||Ue(K,j,ee));for(K in N)Object.prototype.hasOwnProperty.call(N,K)&&(Object.prototype.hasOwnProperty.call(z,K)?M(z[K],N[K])||(z[K].type==="geojson"&&N[K].type==="geojson"&&yt(z,N,K)?j.push({command:ze.setGeoJSONSourceData,args:[K,N[K].data]}):Tt(K,N,j,ee)):$e(K,N,j))})(_.sources,v.sources,I,A);const R=[];_.layers&&_.layers.forEach(z=>{A[z.source]?T.push({command:ze.removeLayer,args:[z.id]}):R.push(z)}),T=T.concat(I),function(z,N,j){N=N||[];const ee=(z=z||[]).map(Lt),K=N.map(Lt),Q=z.reduce(Vt,{}),ue=N.reduce(Vt,{}),ge=ee.slice(),xe=Object.create(null);let te,Se,be,Le,ke,Ge,Me;for(te=0,Se=0;te<ee.length;te++)be=ee[te],Object.prototype.hasOwnProperty.call(ue,be)?Se++:(j.push({command:ze.removeLayer,args:[be]}),ge.splice(ge.indexOf(be,Se),1));for(te=0,Se=0;te<K.length;te++)be=K[K.length-1-te],ge[ge.length-1-te]!==be&&(Object.prototype.hasOwnProperty.call(Q,be)?(j.push({command:ze.removeLayer,args:[be]}),ge.splice(ge.lastIndexOf(be,ge.length-Se),1)):Se++,Ge=ge[ge.length-te],j.push({command:ze.addLayer,args:[ue[be],Ge]}),ge.splice(ge.length-te,0,be),xe[be]=!0);for(te=0;te<K.length;te++)if(be=K[te],Le=Q[be],ke=ue[be],!xe[be]&&!M(Le,ke))if(M(Le.source,ke.source)&&M(Le["source-layer"],ke["source-layer"])&&M(Le.type,ke.type)){for(Me in wt(Le.layout,ke.layout,j,be,null,ze.setLayoutProperty),wt(Le.paint,ke.paint,j,be,null,ze.setPaintProperty),M(Le.filter,ke.filter)||j.push({command:ze.setFilter,args:[be,ke.filter]}),M(Le.minzoom,ke.minzoom)&&M(Le.maxzoom,ke.maxzoom)||j.push({command:ze.setLayerZoomRange,args:[be,ke.minzoom,ke.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?wt(Le[Me],ke[Me],j,be,Me.slice(6),ze.setPaintProperty):M(Le[Me],ke[Me])||j.push({command:ze.setLayerProperty,args:[be,Me,ke[Me]]}));for(Me in ke)Object.prototype.hasOwnProperty.call(ke,Me)&&!Object.prototype.hasOwnProperty.call(Le,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?wt(Le[Me],ke[Me],j,be,Me.slice(6),ze.setPaintProperty):M(Le[Me],ke[Me])||j.push({command:ze.setLayerProperty,args:[be,Me,ke[Me]]}))}else j.push({command:ze.removeLayer,args:[be]}),Ge=ge[ge.lastIndexOf(be)+1],j.push({command:ze.addLayer,args:[ke,Ge]})}(R,v.layers,T)}catch(A){console.warn("Unable to compute style diff:",A),T=[{command:ze.setStyle,args:[v]}]}return T}(this.serialize(),s).filter(_=>!(_.command in Ti));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Kt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${s}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[s]=new $t(s,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:s})),_.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,p={}){this._checkLoaded();const _=s.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let v;if(s.type==="custom"){if(Zt(this,l.validateCustomStyleLayer(s)))return;v=l.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(_,s.source),s=l.clone$1(s),s=l.extend(s,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,s,{arrayIndex:-1},p))return;v=l.createStyleLayer(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}const T=h?this._order.indexOf(h):this._order.length;if(h&&T===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=v,this._removedLayers[_]&&v.source&&v.type!=="custom"){const A=this._removedLayers[_];delete this._removedLayers[_],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const p=this._order.indexOf(s);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(_,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,p){this._checkLoaded();const _=this.getLayer(s);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,p={}){this._checkLoaded();const _=this.getLayer(s);if(_){if(!M(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,h,p,_={}){this._checkLoaded();const v=this.getLayer(s);v?M(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,_),this._updateLayer(v)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const p=this.getLayer(s);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,p,_={}){this._checkLoaded();const v=this.getLayer(s);v?M(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const p=s.source,_=s.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=v.getSource().type;T==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||_?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(_,s.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const p=s.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.getSource().type,T=v==="vector"?s.sourceLayer:void 0;v!=="vector"||T?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(T,s.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,p=s.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,s.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=T=>this._layers[T].type==="fill-extrusion",p={},_=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(h(A)){p[A]=T;for(const I of s){const R=I[A];if(R)for(const z of R)_.push(z)}}}_.sort((T,A)=>A.intersectionZ-T.intersectionZ);const v=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(h(A))for(let I=_.length-1;I>=0;I--){const R=_[I].feature;if(p[R.layer.id]<T)break;v.push(R),_.pop()}else for(const I of s){const R=I[A];if(R)for(const z of R)v.push(z.feature)}}return v}queryRenderedFeatures(s,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const T of h.layers){const A=this._layers[T];if(!A)return this.fire(new l.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];_[A.source]=!0}}const v=[];h.availableImages=this._availableImages;for(const T in this.sourceCaches)h.layers&&!_[T]||v.push(gr(this.sourceCaches[T],this._layers,this._serializedLayers,s,h,p));return this.placement&&v.push(function(T,A,I,R,z,N,j){const ee={},K=N.queryRenderedSymbols(R),Q=[];for(const ue of Object.keys(K).map(Number))Q.push(j[ue]);Q.sort(Vn);for(const ue of Q){const ge=ue.featureIndex.lookupSymbolFeatures(K[ue.bucketInstanceId],A,ue.bucketIndex,ue.sourceLayerIndex,z.filter,z.layers,z.availableImages,T);for(const xe in ge){const te=ee[xe]=ee[xe]||[],Se=ge[xe];Se.sort((be,Le)=>{const ke=ue.featureSortOrder;if(ke){const Ge=ke.indexOf(be.featureIndex);return ke.indexOf(Le.featureIndex)-Ge}return Le.featureIndex-be.featureIndex});for(const be of Se)te.push(be)}}for(const ue in ee)ee[ue].forEach(ge=>{const xe=ge.feature,te=I[T[ue].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=te});return ee}(this._layers,this._serializedLayers,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[s];return p?function(_,v){const T=_.getRenderableIds().map(R=>_.getTileByID(R)),A=[],I={};for(let R=0;R<T.length;R++){const z=T[R],N=z.tileID.canonical.key;I[N]||(I[N]=!0,z.querySourceFeatures(A,v))}return A}(p,h):[]}addSourceType(s,h,p){return ln.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(ln.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const T in s)if(!M(s[T],p[T])){_=!0;break}if(!_)return;const v={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(v)}_validate(s,h,p,_,v={}){return(!v||v.validate!==!1)&&Zt(this,s.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const h=this.sourceCaches[s];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,p,_,v=!1){let T=!1,A=!1;const I={};for(const R of this._order){const z=this._layers[R];if(z.type!=="symbol")continue;if(!I[z.source]){const j=this.sourceCaches[z.source];I[z.source]=j.getRenderableIds(!0).map(ee=>j.getTileByID(ee)).sort((ee,K)=>K.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(K.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(z,I[z.source],s.center.lng);T=T||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),s.zoom))&&(this.pauseablePlacement=new Ie(s,this.terrain,this._order,v,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),A=!0),T&&this.pauseablePlacement.placement.setStale()),A||T)for(const R of this._order){const z=this._layers[R];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(s,h,p){return l.makeRequest(h,p)}}ln.getSourceType=function(m){return Fi[m]},ln.setSourceType=function(m,s){Fi[m]=s},ln.registerForPluginStateChange=l.registerForPluginStateChange;var Pr="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Tn={prelude:li(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:li(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:li(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:li(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:li(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:li("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:li(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:li(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:li(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:li(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:li(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:li(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:li(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:li(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:li(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:li(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:li(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:li("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Pr),terrainDepth:li("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Pr),terrainCoords:li("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Pr)};function li(m,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=v?v.concat(_):_,A={};return{fragmentSource:m=m.replace(h,(I,R,z,N,j)=>(A[j]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${z} ${N} ${j};
#else
uniform ${z} ${N} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${z} ${N} ${j} = u_${j};
#endif
`)),vertexSource:s=s.replace(h,(I,R,z,N,j)=>{const ee=N==="float"?"vec2":"vec4",K=j.match(/color/)?"color":ee;return A[j]?R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${ee} a_${j};
varying ${z} ${N} ${j};
#else
uniform ${z} ${N} u_${j};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${z} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${K}(a_${j}, u_${j}_t);
#else
    ${z} ${N} ${j} = u_${j};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${z} ${ee} a_${j};
#else
uniform ${z} ${N} u_${j};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${N} ${j} = a_${j};
#else
    ${z} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${z} ${N} ${j} = unpack_mix_${K}(a_${j}, u_${j}_t);
#else
    ${z} ${N} ${j} = u_${j};
#endif
`}),staticAttributes:p,staticUniforms:T}}class Ws{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,p,_,v,T,A,I,R){this.context=s;let z=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!z&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(z=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===R?(s.bindVertexArrayOES.set(this.vao),A&&A.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),R&&R.bind()):this.freshBind(h,p,_,v,T,A,I,R)}freshBind(s,h,p,_,v,T,A,I){let R;const z=s.numAttributes,N=this.context,j=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=I;else{R=N.currentNumAttributes||0;for(let ee=z;ee<R;ee++)j.disableVertexAttribArray(ee)}h.enableAttributes(j,s);for(const ee of p)ee.enableAttributes(j,s);T&&T.enableAttributes(j,s),A&&A.enableAttributes(j,s),I&&I.enableAttributes(j,s),h.bind(),h.setVertexAttribPointers(j,s,v);for(const ee of p)ee.bind(),ee.setVertexAttribPointers(j,s,v);T&&(T.bind(),T.setVertexAttribPointers(j,s,v)),_&&_.bind(),A&&(A.bind(),A.setVertexAttribPointers(j,s,v)),I&&(I.bind(),I.setVertexAttribPointers(j,s,v)),N.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Hs(m){const s=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");s.push(p.pop())}return s}class _o{constructor(s,h,p,_,v,T,A){const I=s.gl;this.program=I.createProgram();const R=Hs(p.staticAttributes),z=_?_.getBinderAttributes():[],N=R.concat(z),j=Tn.prelude.staticUniforms?Hs(Tn.prelude.staticUniforms):[],ee=p.staticUniforms?Hs(p.staticUniforms):[],K=_?_.getBinderUniforms():[],Q=j.concat(ee).concat(K),ue=[];for(const ke of Q)ue.indexOf(ke)<0&&ue.push(ke);const ge=_?_.defines():[];T&&ge.push("#define OVERDRAW_INSPECTOR;"),A&&ge.push("#define TERRAIN3D;");const xe=ge.concat(Tn.prelude.fragmentSource,p.fragmentSource).join(`
`),te=ge.concat(Tn.prelude.vertexSource,p.vertexSource).join(`
`),Se=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Se,xe),I.compileShader(Se),I.attachShader(this.program,Se);const be=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(be,te),I.compileShader(be),I.attachShader(this.program,be),this.attributes={};const Le={};this.numAttributes=N.length;for(let ke=0;ke<this.numAttributes;ke++)N[ke]&&(I.bindAttribLocation(this.program,ke,N[ke]),this.attributes[N[ke]]=ke);I.linkProgram(this.program),I.deleteShader(be),I.deleteShader(Se);for(let ke=0;ke<ue.length;ke++){const Ge=ue[ke];if(Ge&&!Le[Ge]){const Me=I.getUniformLocation(this.program,Ge);Me&&(Le[Ge]=Me)}}this.fixedUniforms=v(s,Le),this.terrainUniforms=((ke,Ge)=>({u_depth:new l.Uniform1i(ke,Ge.u_depth),u_terrain:new l.Uniform1i(ke,Ge.u_terrain),u_terrain_dim:new l.Uniform1f(ke,Ge.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(ke,Ge.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(ke,Ge.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(ke,Ge.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(ke,Ge.u_terrain_exaggeration)}))(s,Le),this.binderUniforms=_?_.getUniforms(s,Le):[]}draw(s,h,p,_,v,T,A,I,R,z,N,j,ee,K,Q,ue,ge,xe){const te=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(_),s.setColorMode(v),s.setCullFace(T),I){s.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,I.depthTexture),s.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,I.texture);for(const be in this.terrainUniforms)this.terrainUniforms[be].set(I[be])}for(const be in this.fixedUniforms)this.fixedUniforms[be].set(A[be]);Q&&Q.setUniforms(s,this.binderUniforms,ee,{zoom:K});let Se=0;switch(h){case te.LINES:Se=2;break;case te.TRIANGLES:Se=3;break;case te.LINE_STRIP:Se=1}for(const be of j.get()){const Le=be.vaos||(be.vaos={});(Le[R]||(Le[R]=new Ws)).bind(s,this,z,Q?Q.getPaintVertexBuffers():[],N,be.vertexOffset,ue,ge,xe),te.drawElements(h,be.primitiveLength*Se,te.UNSIGNED_SHORT,be.primitiveOffset*Se*2)}}}function yo(m,s,h){const p=1/Gi(h,1,s.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,s.transform.tileZoom)/_,T=v*(h.tileID.canonical.x+h.tileID.wrap*_),A=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[T>>16,A>>16],u_pixel_coord_lower:[65535&T,65535&A]}}const bs=(m,s,h,p)=>{const _=s.style.light,v=_.properties.get("position"),T=[v.x,v.y,v.z],A=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(A,-s.transform.angle),l.transformMat3(T,T,A);const I=_.properties.get("color");return{u_matrix:m,u_lightpos:T,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+h,u_opacity:p}},Ir=(m,s,h,p,_,v,T)=>l.extend(bs(m,s,h,p),yo(v,s,T),{u_height_factor:-Math.pow(2,_.overscaledZ)/T.tileSize/8}),xo=m=>({u_matrix:m}),vo=(m,s,h,p)=>l.extend(xo(m),yo(h,s,p)),bo=(m,s)=>({u_matrix:m,u_world:s}),ia=(m,s,h,p,_)=>l.extend(vo(m,s,h,p),{u_world:_}),$a=(m,s,h,p)=>{const _=m.transform;let v,T;if(p.paint.get("circle-pitch-alignment")==="map"){const A=Gi(h,1,_.zoom);v=!0,T=[A,A]}else v=!1,T=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(s.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:T}},ts=(m,s,h)=>{const p=Gi(h,1,s.zoom),_=Math.pow(2,s.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*_),s.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:v}},G=(m,s,h=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:h}),Z=m=>({u_matrix:m}),ae=(m,s,h,p)=>({u_matrix:m,u_extrude_scale:Gi(s,1,h),u_intensity:p});function Pe(m,s){const h=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const We=(m,s,h,p)=>{const _=m.transform;return{u_matrix:Xi(m,s,h,p),u_ratio:1/Gi(s,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},dt=(m,s,h,p,_)=>l.extend(We(m,s,h,_),{u_image:0,u_image_height:p}),Xt=(m,s,h,p,_)=>{const v=m.transform,T=Wt(s,v);return{u_matrix:Xi(m,s,h,_),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Gi(s,1,v.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Di=(m,s,h,p,_,v)=>{const T=m.lineAtlas,A=Wt(s,m.transform),I=h.layout.get("line-cap")==="round",R=T.getDash(p.from,I),z=T.getDash(p.to,I),N=R.width*_.fromScale,j=z.width*_.toScale;return l.extend(We(m,s,h,v),{u_patternscale_a:[A/N,-R.height/2],u_patternscale_b:[A/j,-z.height/2],u_sdfgamma:T.width/(256*Math.min(N,j)*m.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:z.y,u_mix:_.t})};function Wt(m,s){return 1/Gi(m,1,s.tileZoom)}function Xi(m,s,h,p){return m.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const tr=(m,s,h,p,_)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(T=_.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Wu(_.paint.get("raster-hue-rotate"))};var v,T};function Wu(m){m*=Math.PI/180;const s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const nc=(m,s,h,p,_,v,T,A,I,R)=>{const z=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:z.width/z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+p,u_texsize:R,u_texture:0}},Za=(m,s,h,p,_,v,T,A,I,R,z)=>{const N=_.transform;return l.extend(nc(m,s,h,p,_,v,T,A,I,R),{u_gamma_scale:p?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+z})},Hu=(m,s,h,p,_,v,T,A,I,R)=>l.extend(Za(m,s,h,p,_,v,T,A,!0,I,!0),{u_texsize_icon:R,u_texture_icon:1}),wf=(m,s,h)=>({u_matrix:m,u_opacity:s,u_color:h}),Tf=(m,s,h,p,_,v)=>l.extend(function(T,A,I,R){const z=I.imageManager.getPattern(T.from.toString()),N=I.imageManager.getPattern(T.to.toString()),{width:j,height:ee}=I.imageManager.getPixelSize(),K=Math.pow(2,R.tileID.overscaledZ),Q=R.tileSize*Math.pow(2,I.transform.tileZoom)/K,ue=Q*(R.tileID.canonical.x+R.tileID.wrap*K),ge=Q*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[j,ee],u_mix:A.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Gi(R,1,I.transform.tileZoom),u_pixel_coord_upper:[ue>>16,ge>>16],u_pixel_coord_lower:[65535&ue,65535&ge]}}(p,v,h,_),{u_matrix:m,u_opacity:s}),rc={fillExtrusion:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,s.u_height_factor),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,s.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,s.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,s.u_overscale_factor)}),collisionCircle:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,s.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new l.UniformColor(m,s.u_color),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_overlay:new l.Uniform1i(m,s.u_overlay),u_overlay_scale:new l.Uniform1f(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new l.Uniform1f(m,s.u_extrude_scale),u_intensity:new l.Uniform1f(m,s.u_intensity),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_color_ramp:new l.Uniform1i(m,s.u_color_ramp),u_opacity:new l.Uniform1f(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_latrange:new l.Uniform2f(m,s.u_latrange),u_light:new l.Uniform2f(m,s.u_light),u_shadow:new l.UniformColor(m,s.u_shadow),u_highlight:new l.UniformColor(m,s.u_highlight),u_accent:new l.UniformColor(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_dimension:new l.Uniform2f(m,s.u_dimension),u_zoom:new l.Uniform1f(m,s.u_zoom),u_unpack:new l.Uniform4f(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_image:new l.Uniform1i(m,s.u_image),u_image_height:new l.Uniform1f(m,s.u_image_height)}),linePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texsize:new l.Uniform2f(m,s.u_texsize),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_image:new l.Uniform1i(m,s.u_image),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),lineSDF:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,s.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,s.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,s.u_sdfgamma),u_image:new l.Uniform1i(m,s.u_image),u_tex_y_a:new l.Uniform1f(m,s.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,s.u_tex_y_b),u_mix:new l.Uniform1f(m,s.u_mix)}),raster:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_tl_parent:new l.Uniform2f(m,s.u_tl_parent),u_scale_parent:new l.Uniform1f(m,s.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,s.u_buffer_scale),u_fade_t:new l.Uniform1f(m,s.u_fade_t),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image0:new l.Uniform1i(m,s.u_image0),u_image1:new l.Uniform1i(m,s.u_image1),u_brightness_low:new l.Uniform1f(m,s.u_brightness_low),u_brightness_high:new l.Uniform1f(m,s.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,s.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,s.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texsize_icon:new l.Uniform2f(m,s.u_texsize_icon),u_texture:new l.Uniform1i(m,s.u_texture),u_texture_icon:new l.Uniform1i(m,s.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),background:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_color:new l.UniformColor(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image:new l.Uniform1i(m,s.u_image),u_pattern_tl_a:new l.Uniform2f(m,s.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,s.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,s.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,s.u_pattern_br_b),u_texsize:new l.Uniform2f(m,s.u_texsize),u_mix:new l.Uniform1f(m,s.u_mix),u_pattern_size_a:new l.Uniform2f(m,s.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,s.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,s.u_scale_a),u_scale_b:new l.Uniform1f(m,s.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture)}),terrainDepth:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),terrainCoords:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture),u_terrain_coords_id:new l.Uniform1f(m,s.u_terrain_coords_id)})};class sc{constructor(s,h,p){this.context=s;const _=s.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const oc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ac{constructor(s,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&s.enableVertexAttribArray(_)}}setVertexAttribPointers(s,h,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],T=h.attributes[v.name];T!==void 0&&s.vertexAttribPointer(T,v.components,s[oc[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ui{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qu extends ui{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ef extends ui{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class na extends ui{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class ra extends ui{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class $u extends ui{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class ir extends ui{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class lc extends ui{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Xa extends ui{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Ya extends ui{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class cc extends ui{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class uc extends ui{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class Ka extends ui{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class hc extends ui{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class dc extends ui{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Ja extends ui{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Zu extends ui{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Xu extends ui{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class wo extends ui{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Sf extends ui{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Af extends ui{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Pf extends ui{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class If extends ui{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Cf extends ui{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Mf extends ui{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class fc extends ui{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Qa extends ui{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class pc extends ui{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class mc extends ui{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class To extends ui{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Yu extends ui{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Ku extends ui{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class el extends ui{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class qs extends el{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Ju extends el{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Eo{constructor(s,h,p,_){this.context=s,this.width=h,this.height=p;const v=s.gl,T=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new qs(s,T),_&&(this.depthAttachment=new Ju(s,T)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class Ai{constructor(s,h,p){this.blendFunction=s,this.blendColor=h,this.mask=p}}Ai.Replace=[1,0],Ai.disabled=new Ai(Ai.Replace,l.Color.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,l.Color.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Qu{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qu(this),this.clearDepth=new Ef(this),this.clearStencil=new na(this),this.colorMask=new ra(this),this.depthMask=new $u(this),this.stencilMask=new ir(this),this.stencilFunc=new lc(this),this.stencilOp=new Xa(this),this.stencilTest=new Ya(this),this.depthRange=new cc(this),this.depthTest=new uc(this),this.depthFunc=new Ka(this),this.blend=new hc(this),this.blendFunc=new dc(this),this.blendColor=new Ja(this),this.blendEquation=new Zu(this),this.cullFace=new Xu(this),this.cullFaceSide=new wo(this),this.frontFace=new Sf(this),this.program=new Af(this),this.activeTexture=new Pf(this),this.viewport=new If(this),this.bindFramebuffer=new Cf(this),this.bindRenderbuffer=new Mf(this),this.bindTexture=new fc(this),this.bindVertexBuffer=new Qa(this),this.bindElementBuffer=new pc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mc(this),this.pixelStoreUnpack=new To(this),this.pixelStoreUnpackPremultiplyAlpha=new Yu(this),this.pixelStoreUnpackFlipY=new Ku(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new sc(this,s,h)}createVertexBuffer(s,h,p){return new ac(this,s,h,p)}createRenderbuffer(s,h,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,s,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(s,h,p){return new Eo(this,s,h,p)}clear({color:s,depth:h}){const p=this.gl;let _=0;s&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){M(s.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ei{constructor(s,h,p){this.func=s,this.mask=h,this.range=p}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);const hi=7680;class Si{constructor(s,h,p,_,v,T){this.test=s,this.ref=h,this.mask=p,this.fail=_,this.depthFail=v,this.pass=T}}Si.disabled=new Si({func:519,mask:0},0,0,hi,hi,hi);class Mi{constructor(s,h,p){this.enable=s,this.mode=h,this.frontFace=p}}let sa;function So(m,s,h,p,_,v,T){const A=m.context,I=A.gl,R=m.useProgram("collisionBox"),z=[];let N=0,j=0;for(let te=0;te<p.length;te++){const Se=p[te],be=s.getTile(Se),Le=be.getBucket(h);if(!Le)continue;let ke=Se.posMatrix;_[0]===0&&_[1]===0||(ke=m.translatePosMatrix(Se.posMatrix,be,_,v));const Ge=T?Le.textCollisionBox:Le.iconCollisionBox,Me=Le.collisionCircleArray;if(Me.length>0){const st=l.create(),Ke=ke;l.mul(st,Le.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(st,st,Le.placementViewportMatrix),z.push({circleArray:Me,circleOffset:j,transform:Ke,invTransform:st,coord:Se}),N+=Me.length/4,j=N}Ge&&R.draw(A,I.LINES,ei.disabled,Si.disabled,m.colorModeForRenderPass(),Mi.disabled,ts(ke,m.transform,be),m.style.terrain&&m.style.terrain.getTerrainData(Se),h.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,m.transform.zoom,null,null,Ge.collisionVertexBuffer)}if(!T||!z.length)return;const ee=m.useProgram("collisionCircle"),K=new l.CollisionCircleLayoutArray;K.resize(4*N),K._trim();let Q=0;for(const te of z)for(let Se=0;Se<te.circleArray.length/4;Se++){const be=4*Se,Le=te.circleArray[be+0],ke=te.circleArray[be+1],Ge=te.circleArray[be+2],Me=te.circleArray[be+3];K.emplace(Q++,Le,ke,Ge,Me,0),K.emplace(Q++,Le,ke,Ge,Me,1),K.emplace(Q++,Le,ke,Ge,Me,2),K.emplace(Q++,Le,ke,Ge,Me,3)}(!sa||sa.length<2*N)&&(sa=function(te){const Se=2*te,be=new l.QuadTriangleArray;be.resize(Se),be._trim();for(let Le=0;Le<Se;Le++){const ke=6*Le;be.uint16[ke+0]=4*Le+0,be.uint16[ke+1]=4*Le+1,be.uint16[ke+2]=4*Le+2,be.uint16[ke+3]=4*Le+2,be.uint16[ke+4]=4*Le+3,be.uint16[ke+5]=4*Le+0}return be}(N));const ue=A.createIndexBuffer(sa,!0),ge=A.createVertexBuffer(K,l.collisionCircleLayout.members,!0);for(const te of z){const Se={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};ee.draw(A,I.TRIANGLES,ei.disabled,Si.disabled,m.colorModeForRenderPass(),Mi.disabled,Se,m.style.terrain&&m.style.terrain.getTerrainData(te.coord),h.id,ge,ue,l.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;ge.destroy(),ue.destroy()}Mi.disabled=new Mi(!1,1029,2305),Mi.backCCW=new Mi(!0,1029,2305);const Lf=l.identity(new Float32Array(16));function Rf(m,s,h,p,_,v){const{horizontalAlign:T,verticalAlign:A}=l.getAnchorAlignment(m),I=-(T-.5)*s,R=-(A-.5)*h,z=l.evaluateVariableOffset(m,p);return new l.pointGeometry((I/_+z[0])*v,(R/_+z[1])*v)}function eh(m,s,h,p,_,v,T,A,I,R,z){const N=m.text.placedSymbolArray,j=m.text.dynamicLayoutVertexArray,ee=m.icon.dynamicLayoutVertexArray,K={};j.clear();for(let Q=0;Q<N.length;Q++){const ue=N.get(Q),ge=m.allowVerticalPlacement&&!ue.placedOrientation,xe=ue.hidden||!ue.crossTileID||ge?null:p[ue.crossTileID];if(xe){const te=new l.pointGeometry(ue.anchorX,ue.anchorY),Se=jt(te,h?T:v,z),be=Qi(_.cameraToCenterDistance,Se.signedDistanceFromCamera);let Le=l.evaluateSizeForFeature(m.textSizeData,I,ue)*be/l.ONE_EM;h&&(Le*=m.tilePixelRatio/A);const{width:ke,height:Ge,anchor:Me,textOffset:st,textBoxScale:Ke}=xe,ot=Rf(Me,ke,Ge,st,Ke,Le),Nt=h?jt(te.add(ot),v,z).point:Se.point.add(s?ot.rotate(-_.angle):ot),Ht=m.allowVerticalPlacement&&ue.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let At=0;At<ue.numGlyphs;At++)l.addDynamicAttributes(j,Nt,Ht);R&&ue.associatedIconIndex>=0&&(K[ue.associatedIconIndex]={shiftedAnchor:Nt,angle:Ht})}else Dt(ue.numGlyphs,j)}if(R){ee.clear();const Q=m.icon.placedSymbolArray;for(let ue=0;ue<Q.length;ue++){const ge=Q.get(ue);if(ge.hidden)Dt(ge.numGlyphs,ee);else{const xe=K[ue];if(xe)for(let te=0;te<ge.numGlyphs;te++)l.addDynamicAttributes(ee,xe.shiftedAnchor,xe.angle);else Dt(ge.numGlyphs,ee)}}m.icon.dynamicLayoutVertexBuffer.updateData(ee)}m.text.dynamicLayoutVertexBuffer.updateData(j)}function kf(m,s,h){return h.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function tl(m,s,h,p,_,v,T,A,I,R,z,N){const j=m.context,ee=j.gl,K=m.transform,Q=A==="map",ue=I==="map",ge=A!=="viewport"&&h.layout.get("symbol-placement")!=="point",xe=Q&&!ue&&!ge,te=!h.layout.get("symbol-sort-key").isConstant();let Se=!1;const be=m.depthModeForSublayer(0,ei.ReadOnly),Le=h.layout.get("text-variable-anchor"),ke=[];for(const Ge of p){const Me=s.getTile(Ge),st=Me.getBucket(h);if(!st)continue;const Ke=_?st.text:st.icon;if(!Ke||!Ke.segments.get().length)continue;const ot=Ke.programConfigurations.get(h.id),Nt=_||st.sdfIcons,Ht=_?st.textSizeData:st.iconSizeData,At=ue||K.pitch!==0,pi=m.useProgram(kf(Nt,_,st),ot),mi=l.evaluateSizeForZoom(Ht,K.zoom),ii=m.style.terrain&&m.style.terrain.getTerrainData(Ge);let si,_i,gn,qr,Mr=[0,0],$r=null;if(_){if(_i=Me.glyphAtlasTexture,gn=ee.LINEAR,si=Me.glyphAtlasTexture.size,st.iconsInText){Mr=Me.imageAtlasTexture.size,$r=Me.imageAtlasTexture;const br=Ht.kind==="composite"||Ht.kind==="camera";qr=At||m.options.rotating||m.options.zooming||br?ee.LINEAR:ee.NEAREST}}else{const br=h.layout.get("icon-size").constantOr(0)!==1||st.iconsNeedLinear;_i=Me.imageAtlasTexture,gn=Nt||m.options.rotating||m.options.zooming||br||At?ee.LINEAR:ee.NEAREST,si=Me.imageAtlasTexture.size}const Is=Gi(Me,1,m.transform.zoom),vr=ji(Ge.posMatrix,ue,Q,m.transform,Is),Wn=Bi(Ge.posMatrix,ue,Q,m.transform,Is),rs=Le&&st.hasTextData(),cl=h.layout.get("icon-text-fit")!=="none"&&rs&&st.hasIconData();if(ge){const br=m.style.terrain?(Mc,Lo)=>m.style.terrain.getElevation(Ge,Mc,Lo):null,Ys=h.layout.get("text-rotation-alignment")==="map";vi(st,Ge.posMatrix,m,_,vr,Wn,ue,R,Ys,br)}const cn=m.translatePosMatrix(Ge.posMatrix,Me,v,T),Yt=ge||_&&Le||cl?Lf:vr,fi=m.translatePosMatrix(Wn,Me,v,T,!0),_n=Nt&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let yn;yn=Nt?st.iconsInText?Hu(Ht.kind,mi,xe,ue,m,cn,Yt,fi,si,Mr):Za(Ht.kind,mi,xe,ue,m,cn,Yt,fi,_,si,!0):nc(Ht.kind,mi,xe,ue,m,cn,Yt,fi,_,si);const Ri={program:pi,buffers:Ke,uniformValues:yn,atlasTexture:_i,atlasTextureIcon:$r,atlasInterpolation:gn,atlasInterpolationIcon:qr,isSDF:Nt,hasHalo:_n};if(te&&st.canOverlap){Se=!0;const br=Ke.segments.get();for(const Ys of br)ke.push({segments:new l.SegmentVector([Ys]),sortKey:Ys.sortKey,state:Ri,terrainData:ii})}else ke.push({segments:Ke.segments,sortKey:0,state:Ri,terrainData:ii})}Se&&ke.sort((Ge,Me)=>Ge.sortKey-Me.sortKey);for(const Ge of ke){const Me=Ge.state;if(j.activeTexture.set(ee.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,ee.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(j.activeTexture.set(ee.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),Me.isSDF){const st=Me.uniformValues;Me.hasHalo&&(st.u_is_halo=1,oa(Me.buffers,Ge.segments,h,m,Me.program,be,z,N,st,Ge.terrainData)),st.u_is_halo=0}oa(Me.buffers,Ge.segments,h,m,Me.program,be,z,N,Me.uniformValues,Ge.terrainData)}}function oa(m,s,h,p,_,v,T,A,I,R){const z=p.context;_.draw(z,z.gl.TRIANGLES,v,T,A,Mi.disabled,I,R,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function aa(m,s,h,p,_,v,T){const A=m.context.gl,I=h.paint.get("fill-pattern"),R=I&&I.constantOr(1),z=h.getCrossfadeParameters();let N,j,ee,K,Q;T?(j=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=A.LINES):(j=R?"fillPattern":"fill",N=A.TRIANGLES);for(const ue of p){const ge=s.getTile(ue);if(R&&!ge.patternsLoaded())continue;const xe=ge.getBucket(h);if(!xe)continue;const te=xe.programConfigurations.get(h.id),Se=m.useProgram(j,te),be=m.style.terrain&&m.style.terrain.getTerrainData(ue);R&&(m.context.activeTexture.set(A.TEXTURE0),ge.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),te.updatePaintBuffers(z));const Le=I.constantOr(null);if(Le&&ge.imageAtlas){const Me=ge.imageAtlas,st=Me.patternPositions[Le.to.toString()],Ke=Me.patternPositions[Le.from.toString()];st&&Ke&&te.setConstantPatternPositions(st,Ke)}const ke=be?ue:null,Ge=m.translatePosMatrix(ke?ke.posMatrix:ue.posMatrix,ge,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){K=xe.indexBuffer2,Q=xe.segments2;const Me=[A.drawingBufferWidth,A.drawingBufferHeight];ee=j==="fillOutlinePattern"&&R?ia(Ge,m,z,ge,Me):bo(Ge,Me)}else K=xe.indexBuffer,Q=xe.segments,ee=R?vo(Ge,m,z,ge):xo(Ge);Se.draw(m.context,N,_,m.stencilModeForClipping(ue),v,Mi.disabled,ee,be,h.id,xe.layoutVertexBuffer,K,Q,h.paint,m.transform.zoom,te)}}function la(m,s,h,p,_,v,T){const A=m.context,I=A.gl,R=h.paint.get("fill-extrusion-pattern"),z=R.constantOr(1),N=h.getCrossfadeParameters(),j=h.paint.get("fill-extrusion-opacity");for(const ee of p){const K=s.getTile(ee),Q=K.getBucket(h);if(!Q)continue;const ue=m.style.terrain&&m.style.terrain.getTerrainData(ee),ge=Q.programConfigurations.get(h.id),xe=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ge);z&&(m.context.activeTexture.set(I.TEXTURE0),K.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ge.updatePaintBuffers(N));const te=R.constantOr(null);if(te&&K.imageAtlas){const ke=K.imageAtlas,Ge=ke.patternPositions[te.to.toString()],Me=ke.patternPositions[te.from.toString()];Ge&&Me&&ge.setConstantPatternPositions(Ge,Me)}const Se=m.translatePosMatrix(ee.posMatrix,K,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),be=h.paint.get("fill-extrusion-vertical-gradient"),Le=z?Ir(Se,m,be,j,ee,N,K):bs(Se,m,be,j);xe.draw(A,A.gl.TRIANGLES,_,v,T,Mi.backCCW,Le,ue,h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,m.transform.zoom,ge,m.style.terrain&&Q.centroidVertexBuffer)}}function gc(m,s,h,p,_,v,T){const A=m.context,I=A.gl,R=h.fbo;if(!R)return;const z=m.useProgram("hillshade"),N=m.style.terrain&&m.style.terrain.getTerrainData(s);A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get()),z.draw(A,I.TRIANGLES,_,v,T,Mi.disabled,((j,ee,K,Q)=>{const ue=K.paint.get("hillshade-shadow-color"),ge=K.paint.get("hillshade-highlight-color"),xe=K.paint.get("hillshade-accent-color");let te=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);K.paint.get("hillshade-illumination-anchor")==="viewport"&&(te-=j.transform.angle);const Se=!j.options.moving;return{u_matrix:Q?Q.posMatrix:j.transform.calculatePosMatrix(ee.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Pe(0,ee.tileID),u_light:[K.paint.get("hillshade-exaggeration"),te],u_shadow:ue,u_highlight:ge,u_accent:xe}})(m,h,p,N?s:null),N,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function th(m,s,h,p,_,v){const T=m.context,A=T.gl,I=s.dem;if(I&&I.data){const R=I.dim,z=I.stride,N=I.getPixels();if(T.activeTexture.set(A.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(z),s.demTexture){const ee=s.demTexture;ee.update(N,{premultiply:!1}),ee.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else s.demTexture=new J(T,N,A.RGBA,{premultiply:!1}),s.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);T.activeTexture.set(A.TEXTURE0);let j=s.fbo;if(!j){const ee=new J(T,{width:R,height:R,data:null},A.RGBA);ee.bind(A.LINEAR,A.CLAMP_TO_EDGE),j=s.fbo=T.createFramebuffer(R,R,!0),j.colorAttachment.set(ee.texture)}T.bindFramebuffer.set(j.framebuffer),T.viewport.set([0,0,R,R]),m.useProgram("hillshadePrepare").draw(T,A.TRIANGLES,p,_,v,Mi.disabled,((ee,K)=>{const Q=K.stride,ue=l.create();return l.ortho(ue,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(ue,ue,[0,-l.EXTENT,0]),{u_matrix:ue,u_image:1,u_dimension:[Q,Q],u_zoom:ee.overscaledZ,u_unpack:K.getUnpackVector()}})(s.tileID,I),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function il(m,s,h,p,_,v){const T=p.paint.get("raster-fade-duration");if(!v&&T>0){const A=l.exported.now(),I=(A-m.timeAdded)/T,R=s?(A-s.timeAdded)/T:-1,z=h.getSource(),N=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),j=!s||Math.abs(s.tileID.overscaledZ-N)>Math.abs(m.tileID.overscaledZ-N),ee=j&&m.refreshedUponExpiration?1:l.clamp(j?I:1-R,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}const nl=new l.Color(1,0,0,1),Cr=new l.Color(0,1,0,1),ih=new l.Color(0,0,1,1),_c=new l.Color(1,0,1,1),nh=new l.Color(0,1,1,1);function $s(m,s,h,p){Ao(m,0,s+h/2,m.transform.width,h,p)}function ca(m,s,h,p){Ao(m,s-h/2,0,h,m.transform.height,p)}function Ao(m,s,h,p,_,v){const T=m.context,A=T.gl;A.enable(A.SCISSOR_TEST),A.scissor(s*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),T.clear({color:v}),A.disable(A.SCISSOR_TEST)}function Df(m,s,h){const p=m.context,_=p.gl,v=h.posMatrix,T=m.useProgram("debug"),A=ei.disabled,I=Si.disabled,R=m.colorModeForRenderPass(),z="$debug",N=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const j=s.getTileByID(h.key).latestRawTileData,ee=Math.floor((j&&j.byteLength||0)/1024),K=s.getTile(h).tileSize,Q=512/Math.min(K,512)*(h.overscaledZ/m.transform.zoom)*.5;let ue=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ue+=` => ${h.overscaledZ}`),function(ge,xe){ge.initDebugOverlayCanvas();const te=ge.debugOverlayCanvas,Se=ge.context.gl,be=ge.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,te.width,te.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(xe,5,5),be.strokeText(xe,5,5),ge.debugOverlayTexture.update(te),ge.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}(m,`${ue} ${ee}kB`),T.draw(p,_.TRIANGLES,A,I,Ai.alphaBlended,Mi.disabled,G(v,l.Color.transparent,Q),null,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),T.draw(p,_.LINE_STRIP,A,I,R,Mi.disabled,G(v,l.Color.red),N,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function rl(m,s,h){const p=m.context,_=p.gl,v=m.colorModeForRenderPass(),T=new ei(_.LEQUAL,ei.ReadWrite,m.depthRangeFor3D),A=m.useProgram("terrain"),I=s.getTerrainMesh(),R=s.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,s.getRTTFramebuffer().colorAttachment.get());const z=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());A.draw(p,_.TRIANGLES,T,Si.disabled,v,Mi.backCCW,{u_matrix:z,u_texture:0},R,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function rh(m,s,h,p){const _=m.context,v=h.tileSize*s.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(v)||new J(_,{width:v,height:v,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&s.sourceCache.renderHistory.unshift(h.tileID.key));const T=s.getRTTFramebuffer();T.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(T.framebuffer),_.viewport.set([0,0,v,v])}class sh{constructor(s){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=s,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=s.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const s=this.painter.style,h=s.terrain;for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const _=s.sourceCaches[p].getVisibleCoordinates();for(const v of _){const T=h.sourceCache.getTerrainCoords(v);for(const A in T)this._coordsDescendingInv[p][A]||(this._coordsDescendingInv[p][A]=[]),this._coordsDescendingInv[p][A].push(T[A])}}for(const p of s._order){const _=s._layers[p],v=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const T in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][T]=this._coordsDescendingInv[v][T].map(A=>A.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[_][p.tileID.key];v&&v!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(s){const h=s.type,p=this.painter,_=p.style._order,v=p.currentLayer,T=v+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[v]),!T))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&T){this._prevType=h;const A=this._stacks.length-1,I=this._stacks[A]||[];for(const R of this._renderableTiles){if(rh(p,p.style.terrain,R,A),this._rerender[R.tileID.key]){p.context.clear({color:l.Color.transparent});for(let z=0;z<I.length;z++){const N=p.style._layers[I[z]],j=N.source?this._coordsDescendingInv[N.source][R.tileID.key]:[R.tileID];p._renderTileClippingMasks(N,j),p.renderLayer(p,p.style.sourceCaches[N.source],N,j),N.source&&(R.textureCoords[N.source]=this._coordsDescendingInvStr[N.source][R.tileID.key])}}rl(p,p.style.terrain,R)}if(h==="hillshade"){this._stacks.push([_[v]]);for(const R of this._renderableTiles){const z=this._coordsDescendingInv[s.source][R.tileID.key];rh(p,p.style.terrain,R,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(s,z),p.renderLayer(p,p.style.sourceCaches[s.source],s,z),rl(p,p.style.terrain,R)}return!0}return this._renderToTexture[h]}return!1}}const ua={symbol:function(m,s,h,p,_){if(m.renderPass!=="translucent")return;const v=Si.disabled,T=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,I,R,z,N,j,ee){const K=I.transform,Q=N==="map",ue=j==="map";for(const ge of A){const xe=z.getTile(ge),te=xe.getBucket(R);if(!te||!te.text||!te.text.segments.get().length)continue;const Se=l.evaluateSizeForZoom(te.textSizeData,K.zoom),be=Gi(xe,1,I.transform.zoom),Le=ji(ge.posMatrix,ue,Q,I.transform,be),ke=R.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(Se){const Ge=Math.pow(2,K.zoom-xe.tileID.overscaledZ);eh(te,Q,ue,ee,K,Le,ge.posMatrix,Ge,Se,ke,I.style.terrain?(Me,st)=>I.style.terrain.getElevation(ge,Me,st):null)}}}(p,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&tl(m,s,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),v,T),h.paint.get("text-opacity").constantOr(1)!==0&&tl(m,s,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),v,T),s.map.showCollisionBoxes&&(So(m,s,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),So(m,s,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),v=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),A=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(v.constantOr(1)===0||T.constantOr(1)===0))return;const I=m.context,R=I.gl,z=m.depthModeForSublayer(0,ei.ReadOnly),N=Si.disabled,j=m.colorModeForRenderPass(),ee=[];for(let K=0;K<p.length;K++){const Q=p[K],ue=s.getTile(Q),ge=ue.getBucket(h);if(!ge)continue;const xe=ge.programConfigurations.get(h.id),te=m.useProgram("circle",xe),Se=ge.layoutVertexBuffer,be=ge.indexBuffer,Le=m.style.terrain&&m.style.terrain.getTerrainData(Q),ke={programConfiguration:xe,program:te,layoutVertexBuffer:Se,indexBuffer:be,uniformValues:$a(m,Q,ue,h),terrainData:Le};if(A){const Ge=ge.segments.get();for(const Me of Ge)ee.push({segments:new l.SegmentVector([Me]),sortKey:Me.sortKey,state:ke})}else ee.push({segments:ge.segments,sortKey:0,state:ke})}A&&ee.sort((K,Q)=>K.sortKey-Q.sortKey);for(const K of ee){const{programConfiguration:Q,program:ue,layoutVertexBuffer:ge,indexBuffer:xe,uniformValues:te,terrainData:Se}=K.state;ue.draw(I,R.TRIANGLES,z,N,j,Mi.disabled,te,Se,h.id,ge,xe,K.segments,h.paint,m.transform.zoom,Q)}},heatmap:function(m,s,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,v=_.gl,T=Si.disabled,A=new Ai([v.ONE,v.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(I,R,z){const N=I.gl;I.activeTexture.set(N.TEXTURE1),I.viewport.set([0,0,R.width/4,R.height/4]);let j=z.heatmapFbo;if(j)N.bindTexture(N.TEXTURE_2D,j.colorAttachment.get()),I.bindFramebuffer.set(j.framebuffer);else{const ee=N.createTexture();N.bindTexture(N.TEXTURE_2D,ee),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),j=z.heatmapFbo=I.createFramebuffer(R.width/4,R.height/4,!1),function(K,Q,ue,ge){const xe=K.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,Q.width/4,Q.height/4,0,xe.RGBA,K.extRenderToTextureHalfFloat?K.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),ge.colorAttachment.set(ue)}(I,R,ee,j)}})(_,m,h),_.clear({color:l.Color.transparent});for(let I=0;I<p.length;I++){const R=p[I];if(s.hasRenderableParent(R))continue;const z=s.getTile(R),N=z.getBucket(h);if(!N)continue;const j=N.programConfigurations.get(h.id),ee=m.useProgram("heatmap",j),{zoom:K}=m.transform;ee.draw(_,v.TRIANGLES,ei.disabled,T,A,Mi.disabled,ae(R.posMatrix,z,K,h.paint.get("heatmap-intensity")),null,h.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,h.paint,m.transform.zoom,j)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,v){const T=_.context,A=T.gl,I=v.heatmapFbo;if(!I)return;T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),T.activeTexture.set(A.TEXTURE1);let R=v.colorRampTexture;R||(R=v.colorRampTexture=new J(T,v.colorRamp,A.RGBA)),R.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(T,A.TRIANGLES,ei.disabled,Si.disabled,_.colorModeForRenderPass(),Mi.disabled,((z,N,j,ee)=>{const K=l.create();l.ortho(K,0,z.width,z.height,0,0,1);const Q=z.context.gl;return{u_matrix:K,u_world:[Q.drawingBufferWidth,Q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(_,v),null,v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(m,h))},line:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),v=h.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const T=m.depthModeForSublayer(0,ei.ReadOnly),A=m.colorModeForRenderPass(),I=h.paint.get("line-dasharray"),R=h.paint.get("line-pattern"),z=R.constantOr(1),N=h.paint.get("line-gradient"),j=h.getCrossfadeParameters(),ee=z?"linePattern":I?"lineSDF":N?"lineGradient":"line",K=m.context,Q=K.gl;let ue=!0;for(const ge of p){const xe=s.getTile(ge);if(z&&!xe.patternsLoaded())continue;const te=xe.getBucket(h);if(!te)continue;const Se=te.programConfigurations.get(h.id),be=m.context.program.get(),Le=m.useProgram(ee,Se),ke=ue||Le.program!==be,Ge=m.style.terrain&&m.style.terrain.getTerrainData(ge),Me=R.constantOr(null);if(Me&&xe.imageAtlas){const ot=xe.imageAtlas,Nt=ot.patternPositions[Me.to.toString()],Ht=ot.patternPositions[Me.from.toString()];Nt&&Ht&&Se.setConstantPatternPositions(Nt,Ht)}const st=Ge?ge:null,Ke=z?Xt(m,xe,h,j,st):I?Di(m,xe,h,I,j,st):N?dt(m,xe,h,te.lineClipsArray.length,st):We(m,xe,h,st);if(z)K.activeTexture.set(Q.TEXTURE0),xe.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Se.updatePaintBuffers(j);else if(I&&(ke||m.lineAtlas.dirty))K.activeTexture.set(Q.TEXTURE0),m.lineAtlas.bind(K);else if(N){const ot=te.gradients[h.id];let Nt=ot.texture;if(h.gradientVersion!==ot.version){let Ht=256;if(h.stepInterpolant){const At=s.getSource().maxzoom,pi=ge.canonical.z===At?Math.ceil(1<<m.transform.maxZoom-ge.canonical.z):1;Ht=l.clamp(l.nextPowerOfTwo(te.maxLineLength/l.EXTENT*1024*pi),256,K.maxTextureSize)}ot.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:ot.gradient||void 0,clips:te.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new J(K,ot.gradient,Q.RGBA),ot.version=h.gradientVersion,Nt=ot.texture}K.activeTexture.set(Q.TEXTURE0),Nt.bind(h.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}Le.draw(K,Q.TRIANGLES,T,m.stencilModeForClipping(ge),A,Mi.disabled,Ke,Ge,h.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,h.paint,m.transform.zoom,Se,te.layoutVertexBuffer2),ue=!1}},fill:function(m,s,h,p){const _=h.paint.get("fill-color"),v=h.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const T=m.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),I=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===I){const R=m.depthModeForSublayer(1,m.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly);aa(m,s,h,p,R,T,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const R=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly);aa(m,s,h,p,R,T,!0)}},"fill-extrusion":function(m,s,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const v=new ei(m.context.gl.LEQUAL,ei.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))la(m,s,h,p,v,Si.disabled,Ai.disabled),la(m,s,h,p,v,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const T=m.colorModeForRenderPass();la(m,s,h,p,v,Si.disabled,T)}}},hillshade:function(m,s,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,v=m.depthModeForSublayer(0,ei.ReadOnly),T=m.colorModeForRenderPass(),[A,I]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const R of I){const z=s.getTile(R);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&m.renderPass==="offscreen"?th(m,z,h,v,Si.disabled,T):m.renderPass==="translucent"&&gc(m,R,z,h,v,A[R.overscaledZ],T)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,s,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,v=_.gl,T=s.getSource(),A=m.useProgram("raster"),I=m.colorModeForRenderPass(),[R,z]=T instanceof Vi?[{},p]:m.stencilConfigForOverlap(p),N=z[z.length-1].overscaledZ,j=!m.options.moving;for(const ee of z){const K=m.depthModeForSublayer(ee.overscaledZ-N,h.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,v.LESS),Q=s.getTile(ee);Q.registerFadeDuration(h.paint.get("raster-fade-duration"));const ue=s.findLoadedParent(ee,0),ge=il(Q,ue,s,h,m.transform,m.style.terrain);let xe,te;const Se=h.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;_.activeTexture.set(v.TEXTURE0),Q.texture.bind(Se,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(v.TEXTURE1),ue?(ue.texture.bind(Se,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,ue.tileID.overscaledZ-Q.tileID.overscaledZ),te=[Q.tileID.canonical.x*xe%1,Q.tileID.canonical.y*xe%1]):Q.texture.bind(Se,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const be=m.style.terrain&&m.style.terrain.getTerrainData(ee),Le=be?ee:null,ke=Le?Le.posMatrix:m.transform.calculatePosMatrix(ee.toUnwrapped(),j),Ge=tr(ke,te||[0,0],xe||1,ge,h);T instanceof Vi?A.draw(_,v.TRIANGLES,K,Si.disabled,I,Mi.disabled,Ge,be,h.id,T.boundsBuffer,m.quadTriangleIndexBuffer,T.boundsSegments):A.draw(_,v.TRIANGLES,K,R[ee.overscaledZ],I,Mi.disabled,Ge,be,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,s,h,p){const _=h.paint.get("background-color"),v=h.paint.get("background-opacity");if(v===0)return;const T=m.context,A=T.gl,I=m.transform,R=I.tileSize,z=h.paint.get("background-pattern");if(m.isPatternMissing(z))return;const N=!z&&_.a===1&&v===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==N)return;const j=Si.disabled,ee=m.depthModeForSublayer(0,N==="opaque"?ei.ReadWrite:ei.ReadOnly),K=m.colorModeForRenderPass(),Q=m.useProgram(z?"backgroundPattern":"background"),ue=p||I.coveringTiles({tileSize:R,terrain:m.style.terrain});z&&(T.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));const ge=h.getCrossfadeParameters();for(const xe of ue){const te=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Se=z?Tf(te,v,m,z,{tileID:xe,tileSize:R},ge):wf(te,v,_),be=m.style.terrain&&m.style.terrain.getTerrainData(xe);Q.draw(T,A.TRIANGLES,ee,j,K,Mi.disabled,Se,be,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,s,h){for(let p=0;p<h.length;p++)Df(m,s,h[p])},custom:function(m,s,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const v=_.prerender;v&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),v.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(Si.disabled);const v=_.renderingMode==="3d"?new ei(m.context.gl.LEQUAL,ei.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,ei.ReadOnly);p.setDepthMode(v),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class yc{constructor(s,h){this.context=new Qu(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=$t.maxUnderzooming+$t.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vt,this.gpuTimers={}}resize(s,h,p){if(this.width=s*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const s=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,Gt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=s.createVertexBuffer(p,Gt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(_,ti.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const v=new l.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,Gt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const T=new l.LineStripIndexArray;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(T);const A=new l.TriangleIndexArray;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A),this.emptyTexture=new J(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new Si({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,ei.disabled,this.stencilClearMode,Ai.disabled,Mi.disabled,Z(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Ai.disabled),p.setDepthMode(ei.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of h){const A=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(T);v.draw(p,_.TRIANGLES,ei.disabled,new Si({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),Ai.disabled,Mi.disabled,Z(T.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Si({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new Si({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,p=s.sort((T,A)=>A.overscaledZ-T.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const T={};for(let A=0;A<v;A++)T[A+_]=new Si({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[T,p]}return[{[_]:Si.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Ai([s.CONSTANT_COLOR,s.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ai.unblended:Ai.alphaBlended}depthModeForSublayer(s,h,p){if(!this.opaquePassEnabledForLayer())return ei.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new ei(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,v=this.style.terrain&&new sh(this);for(const R in _){const z=_[R];z.used&&z.prepare(this.context)}const T={},A={},I={};for(const R in _){const z=_[R];T[R]=z.getVisibleCoordinates(),A[R]=T[R].slice().reverse(),I[R]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<p.length;R++)if(this.style._layers[p[R]].is3D()){this.opaquePassCutoff=R;break}if(v){this.opaquePassCutoff=0;const R=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||R.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,N){const j=z.context,ee=j.gl,K=Ai.unblended,Q=new ei(ee.LEQUAL,ei.ReadWrite,[0,1]),ue=N.getTerrainMesh(),ge=N.sourceCache.getRenderableTiles(),xe=z.useProgram("terrainDepth");j.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),j.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),j.clear({color:l.Color.transparent,depth:1});for(const te of ge){const Se=N.getTerrainData(te.tileID),be=z.transform.calculatePosMatrix(te.tileID.toUnwrapped());xe.draw(j,ee.TRIANGLES,Q,Si.disabled,K,Mi.backCCW,{u_matrix:be},Se,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments)}j.bindFramebuffer.set(null),j.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,N){const j=z.context,ee=j.gl,K=Ai.unblended,Q=new ei(ee.LEQUAL,ei.ReadWrite,[0,1]),ue=N.getTerrainMesh(),ge=N.getCoordsTexture(),xe=N.sourceCache.getRenderableTiles(),te=z.useProgram("terrainCoords");j.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),j.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),j.clear({color:l.Color.transparent,depth:1}),N.coordsIndex=[];for(const Se of xe){const be=N.getTerrainData(Se.tileID);j.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,ge.texture);const Le=z.transform.calculatePosMatrix(Se.tileID.toUnwrapped());te.draw(j,ee.TRIANGLES,Q,Si.disabled,K,Mi.backCCW,{u_matrix:Le,u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0},be,"terrain",ue.vertexBuffer,ue.indexBuffer,ue.segments),N.coordsIndex.push(Se.tileID.key)}j.bindFramebuffer.set(null),j.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const R of p){const z=this.style._layers[R];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const N=A[z.source];(z.type==="custom"||N.length)&&this.renderLayer(this,_[z.source],z,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[p[this.currentLayer]],z=_[R.source],N=T[R.source];this._renderTileClippingMasks(R,N),this.renderLayer(this,z,R,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const R=this.style._layers[p[this.currentLayer]],z=_[R.source];if(v&&v.renderLayer(R))continue;const N=(R.type==="symbol"?I:A)[R.source];this._renderTileClippingMasks(R,T[R.source]),this.renderLayer(this,z,R,N)}if(this.options.showTileBoundaries){let R,z;Object.values(this.style._layers).forEach(N=>{N.source&&!N.isHidden(this.transform.zoom)&&(N.source!==(z&&z.id)&&(z=this.style.sourceCaches[N.source]),(!R||R.getSource().maxzoom<z.getSource().maxzoom)&&(R=z))}),R&&ua.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const z=R.transform.padding;$s(R,R.transform.height-(z.top||0),3,nl),$s(R,z.bottom||0,3,Cr),ca(R,z.left||0,3,ih),ca(R,R.transform.width-(z.right||0),3,_c);const N=R.transform.centerPoint;(function(j,ee,K,Q){Ao(j,ee-1,K-10,2,20,Q),Ao(j,ee-10,K-1,20,2,Q)})(R,N.x,R.transform.height-N.y,nh)}(this),this.context.setDefault()}renderLayer(s,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),ua[p.type](s,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[s.id];p||(p=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const p in s){const _=s[p],v=this.context.extTimerQuery,T=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),h[p]=T}return h}translatePosMatrix(s,h,p,_,v){if(!p[0]&&!p[1])return s;const T=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const R=Math.sin(T),z=Math.cos(T);p=[p[0]*z-p[1]*R,p[0]*R+p[1]*z]}const A=[v?p[0]:Gi(h,p[0],this.transform.zoom),v?p[1]:Gi(h,p[1],this.transform.zoom),0],I=new Float32Array(16);return l.translate(I,s,A),I}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!h||!p}useProgram(s,h){this.cache=this.cache||{};const p=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new _o(this.context,s,Tn[s],h,rc[s],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new J(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class sl{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,p){const _=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const I=1/(A=l.transformMat4([],A,s))[3]/h*_;return l.mul$1(A,A,[I,I,1/A[3],I])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const I=l.sub([],v[A[0]],v[A[1]]),R=l.sub([],v[A[2]],v[A[1]]),z=l.normalize([],l.cross([],I,R)),N=-l.dot(z,v[A[1]]);return z.concat(N)});return new sl(v,T)}}class ha{constructor(s,h){this.min=s,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],_[v]=h[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new ha(p,_)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<s.planes.length;_++){const v=s.planes[_];let T=0;for(let A=0;A<h.length;A++)l.dot$1(v,h[A])>=0&&T++;if(T===0)return 0;T!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let A=0;A<s.points.length;A++){const I=s.points[A][_]-this.min[_];v=Math.min(v,I),T=Math.max(T,I)}if(T<0||v>this.max[_]-this.min[_])return 0}return 1}}class Po{constructor(s=0,h=0,p=0,_=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=p,this.right=_}interpolate(s,h,p){return h.top!=null&&s.top!=null&&(this.top=l.number(s.top,h.top,p)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.number(s.bottom,h.bottom,p)),h.left!=null&&s.left!=null&&(this.left=l.number(s.left,h.left,p)),h.right!=null&&s.right!=null&&(this.right=l.number(s.right,h.right,p)),this}getCenter(s,h){const p=l.clamp((this.left+s-this.right)/2,0,s),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Po(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class da{constructor(s,h,p,_,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Po,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new da(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s._elevation=this._elevation,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-l.wrap(s,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,v,T){var A=v[0],I=v[1],R=v[2],z=v[3],N=Math.sin(T),j=Math.cos(T);_[0]=A*j+R*N,_[1]=I*j+z*N,_[2]=A*-N+R*j,_[3]=I*-N+z*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,p){this._unmodified=!1,this._edgeInsets.interpolate(s,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),v=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new l.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,_.x,v.x,T.x)),I=Math.floor(Math.max(p.x,_.x,v.x,T.x)),R=1;for(let z=A-R;z<=I+R;z++)z!==0&&h.push(new l.UnwrappedTileID(z,s))}return h}coveringTiles(s){var h,p;let _=this.coveringZoomLevel(s);const v=_;if(s.minzoom!==void 0&&_<s.minzoom)return[];s.maxzoom!==void 0&&_>s.maxzoom&&(_=s.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),A=l.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,_),R=[I*T.x,I*T.y,0],z=[I*A.x,I*A.y,0],N=sl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let j=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=_);const ee=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,K=te=>({aabb:new ha([te*I,0,0],[(te+1)*I,I,0]),zoom:0,x:0,y:0,wrap:te,fullyVisible:!1}),Q=[],ue=[],ge=_,xe=s.reparseOverscaled?v:_;if(this._renderWorldCopies)for(let te=1;te<=3;te++)Q.push(K(-te)),Q.push(K(te));for(Q.push(K(0));Q.length>0;){const te=Q.pop(),Se=te.x,be=te.y;let Le=te.fullyVisible;if(!Le){const ot=te.aabb.intersects(N);if(ot===0)continue;Le=ot===2}const ke=s.terrain?R:z,Ge=te.aabb.distanceX(ke),Me=te.aabb.distanceY(ke),st=Math.max(Math.abs(Ge),Math.abs(Me)),Ke=ee+(1<<ge-te.zoom)-2;if(te.zoom===ge||st>Ke&&te.zoom>=j){const ot=ge-te.zoom,Nt=R[0]-.5-(Se<<ot),Ht=R[1]-.5-(be<<ot);ue.push({tileID:new l.OverscaledTileID(te.zoom===ge?xe:te.zoom,te.wrap,te.zoom,Se,be),distanceSq:l.sqrLen([z[0]-.5-Se,z[1]-.5-be]),tileDistanceToCamera:Math.sqrt(Nt*Nt+Ht*Ht)})}else for(let ot=0;ot<4;ot++){const Nt=(Se<<1)+ot%2,Ht=(be<<1)+(ot>>1),At=te.zoom+1;let pi=te.aabb.quadrant(ot);if(s.terrain){const mi=new l.OverscaledTileID(At,te.wrap,At,Nt,Ht),ii=s.terrain.getMinMaxElevation(mi),si=(h=ii.minElevation)!==null&&h!==void 0?h:this.elevation,_i=(p=ii.maxElevation)!==null&&p!==void 0?p:this.elevation;pi=new ha([pi.min[0],pi.min[1],si],[pi.max[0],pi.max[1],_i])}Q.push({aabb:pi,zoom:At,x:Nt,y:Ht,wrap:te.wrap,fullyVisible:Le})}}return ue.sort((te,Se)=>te.distanceSq-Se.distanceSq).map(te=>te.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(s.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new l.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(s){this.freezeElevation||(this.elevation=s?this.getElevation(this._center,s):0)}getElevation(s,h){const p=l.MercatorCoordinate.fromLngLat(s),_=(1<<this.tileZoom)*l.EXTENT,v=p.x*_,T=p.y*_,A=Math.floor(v/l.EXTENT),I=Math.floor(T/l.EXTENT),R=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,A,I);return h.getElevation(R,v%l.EXTENT,T%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),p=this.getElevation(h,s);if(!(this.elevation-p))return;const _=this.getCameraPosition(),v=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),T=l.MercatorCoordinate.fromLngLat(h,p),A=v.x-T.x,I=v.y-T.y,R=v.z-T.z,z=Math.sqrt(A*A+I*I+R*R),N=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=p,this._center=h,this.zoom=N}setLocationAtPoint(s,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),T=new l.MercatorCoordinate(v.x-(p.x-_.x),v.y-(p.y-_.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),this.getElevation(s,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return l.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const j=h.pointCoordinate(s);if(j!=null)return j}const p=[s.x,s.y,0,1],_=[s.x,s.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const v=p[3],T=_[3],A=p[1]/v,I=_[1]/T,R=p[2]/v,z=_[2]/T,N=(0-R)/(z-R);return new l.MercatorCoordinate(l.number(p[0]/v,_[0]/T,N)/this.worldSize,l.number(A,I,N)/this.worldSize)}coordinatePoint(s,h=0,p=this.pixelMatrix){const _=[s.x*this.worldSize,s.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,s))).extend(this.pointLocation(new l.pointGeometry(this.width,s))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const p=s.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const v=s.canonical,T=this.worldSize/this.zoomScale(v.z),A=v.x+Math.pow(2,v.z)*s.wrap,I=l.identity(new Float64Array(16));return l.translate(I,I,[A*T,v.y*T,0]),l.scale(I,I,[T/l.EXTENT,T/l.EXTENT,1]),l.multiply(I,h?this.alignedProjMatrix:this.projMatrix,I),_[p]=new Float32Array(I),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,p,_,v=-90,T=90,A=-180,I=180;const R=this.size,z=this._unmodified;if(this.latRange){const ee=this.latRange;v=l.mercatorYfromLat(ee[1])*this.worldSize,T=l.mercatorYfromLat(ee[0])*this.worldSize,s=T-v<R.y?R.y/(T-v):0}if(this.lngRange){const ee=this.lngRange;A=l.wrap(l.mercatorXfromLng(ee[0])*this.worldSize,0,this.worldSize),I=l.wrap(l.mercatorXfromLng(ee[1])*this.worldSize,0,this.worldSize),I<A&&(I+=this.worldSize),h=I-A<R.x?R.x/(I-A):0}const N=this.point,j=Math.max(h||0,s||0);if(j)return this.center=this.unproject(new l.pointGeometry(h?(I+A)/2:N.x,s?(T+v)/2:N.y)),this.zoom+=this.scaleZoom(j),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const ee=N.y,K=R.y/2;ee-K<v&&(_=v+K),ee+K>T&&(_=T-K)}if(this.lngRange){const ee=(A+I)/2,K=l.wrap(N.x,ee-this.worldSize/2,ee+this.worldSize/2),Q=R.x/2;K-Q<A&&(p=A+Q),K+Q>I&&(p=I-Q)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:N.x,_!==void 0?_:N.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,T=this._fov*(.5+s.y/this.height),A=Math.sin(T)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-v-T,.01,Math.PI-.01)),I=this.getHorizon(),R=2*Math.atan(I/this.cameraToCenterDistance)*(.5+s.y/(2*I)),z=Math.sin(R)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-v-R,.01,Math.PI-.01)),N=Math.cos(Math.PI/2-this._pitch)*A+this.cameraToSeaLevelDistance,j=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,ee=1.01*Math.min(N,j),K=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,K,ee),_[8]=2*-s.x/this.width,_[9]=2*s.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const Q=this.width%2/2,ue=this.height%2/2,ge=Math.cos(this.angle),xe=Math.sin(this.angle),te=h-Math.round(h)+ge*Q+xe*ue,Se=p-Math.round(p)+ge*ue+xe*Q,be=new Float64Array(_);if(l.translate(be,be,[te>.5?te-1:te,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=be,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.pointGeometry(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let p=h.x,_=h.y,v=h.x,T=h.y;for(const A of s)p=Math.min(p,A.x),_=Math.min(_,A.y),v=Math.max(v,A.x),T=Math.max(T,A.y);return[new l.pointGeometry(p,_),new l.pointGeometry(v,_),new l.pointGeometry(v,T),new l.pointGeometry(p,T),new l.pointGeometry(p,_)]}}}class oh{constructor(s){this._hashName=s&&encodeURIComponent(s),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,v=null;const T=()=>{v=null,_&&(h(),v=setTimeout(T,300),_=!1)};return()=>(_=!0,v||T(),v)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),T=Math.round(h.lng*v)/v,A=Math.round(h.lat*v)/v,I=this._map.getBearing(),R=this._map.getPitch();let z="";if(z+=s?`/${T}/${A}/${p}`:`${p}/${A}/${T}`,(I||R)&&(z+="/"+Math.round(10*I)/10),R&&(z+=`/${Math.round(R)}`),this._hashName){const N=this._hashName;let j=!1;const ee=window.location.hash.slice(1).split("&").map(K=>{const Q=K.split("=")[0];return Q===N?(j=!0,`${Q}=${z}`):K}).filter(K=>K);return j||ee.push(`${N}=${z}`),`#${ee.join("&")}`}return`#${z}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const fa={linearity:.3,easing:l.bezier(0,0,.3,1)},ah=l.extend({deceleration:2500,maxSpeed:1400},fa),lh=l.extend({deceleration:20,maxSpeed:1400},fa),ch=l.extend({deceleration:1e3,maxSpeed:360},fa),Io=l.extend({deceleration:1e3,maxSpeed:90},fa);class uh{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const v=ma(h.pan.mag(),p,l.extend({},ah,s||{}));_.offset=h.pan.mult(v.amount/h.pan.mag()),_.center=this._map.transform.center,pa(_,v)}if(h.zoom){const v=ma(h.zoom,p,lh);_.zoom=this._map.transform.zoom+v.amount,pa(_,v)}if(h.bearing){const v=ma(h.bearing,p,ch);_.bearing=this._map.transform.bearing+l.clamp(v.amount,-179,179),pa(_,v)}if(h.pitch){const v=ma(h.pitch,p,Io);_.pitch=this._map.transform.pitch+v.amount,pa(_,v)}if(_.zoom||_.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function pa(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function ma(m,s,h){const{maxSpeed:p,linearity:_,deceleration:v}=h,T=l.clamp(m*_/(s/1e3),-p,p),A=Math.abs(T)/(v*_);return{easing:h.easing,duration:1e3*A,amount:T*(A/2)}}class nr extends l.Event{constructor(s,h,p,_={}){const v=C.mousePos(h.getCanvasContainer(),p),T=h.unproject(v);super(s,l.extend({point:v,lngLat:T,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ga extends l.Event{constructor(s,h,p){const _=s==="touchend"?p.changedTouches:p.touches,v=C.touchPos(h.getCanvasContainer(),_),T=v.map(I=>h.unproject(I)),A=v.reduce((I,R,z,N)=>I.add(R.div(N.length)),new l.pointGeometry(0,0));super(s,{points:v,point:A,lngLats:T,lngLat:h.unproject(A),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class rr extends l.Event{constructor(s,h,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class zf{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new rr(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new nr(s.type,this._map,s))}mouseup(s){this._map.fire(new nr(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new nr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new nr(s.type,this._map,s))}mouseover(s){this._map.fire(new nr(s.type,this._map,s))}mouseout(s){this._map.fire(new nr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ga(s.type,this._map,s))}touchmove(s){this._map.fire(new ga(s.type,this._map,s))}touchend(s){this._map.fire(new ga(s.type,this._map,s))}touchcancel(s){this._map.fire(new ga(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ws{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new nr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new nr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hh{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(_.x,p.x),T=Math.max(_.x,p.x),A=Math.min(_.y,p.y),I=Math.max(_.y,p.y);C.setTransform(this._box,`translate(${v}px,${A}px)`),this._box.style.width=T-v+"px",this._box.style.height=I-A+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const p=this._startPos,_=h;if(this.reset(),C.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.Event(s,{originalEvent:h}))}}function is(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=s[p];return h}class _a{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new l.pointGeometry(0,0);for(const T of _)v._add(T);return v.div(_.length)}(h),this.touches=is(p,h)))}touchmove(s,h,p){if(this.aborted||!this.centroid)return;const _=is(p,h);for(const v in this.touches){const T=this.touches[v],A=_[v];(!A||A.dist(T)>30)&&(this.aborted=!0)}}touchend(s,h,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class xc{constructor(s){this.singleTap=new _a(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,p){this.singleTap.touchstart(s,h,p)}touchmove(s,h,p){this.singleTap.touchmove(s,h,p)}touchend(s,h,p){const _=this.singleTap.touchend(s,h,p);if(_){const v=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(v&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Of{constructor(){this._zoomIn=new xc({numTouches:1,numTaps:2}),this._zoomOut=new xc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,p){this._zoomIn.touchstart(s,h,p),this._zoomOut.touchstart(s,h,p)}touchmove(s,h,p){this._zoomIn.touchmove(s,h,p),this._zoomOut.touchmove(s,h,p)}touchend(s,h,p){const _=this._zoomIn.touchend(s,h,p),v=this._zoomOut.touchend(s,h,p);return _?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ff={0:1,2:2};class ol{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const p=C.mouseButton(s);this._correctButton(s,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(s,h){const p=this._lastPoint;if(p){if(s.preventDefault(),function(_,v){const T=Ff[v];return _.buttons===void 0||(_.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(s){this._lastPoint&&C.mouseButton(s)===this._eventButton&&(this._moved&&C.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya extends ol{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class ns extends ol{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=.8*(h.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){s.preventDefault()}}class ut extends ol{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=-.5*(h.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){s.preventDefault()}}class dh{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,p){return this._calculateTransform(s,h,p)}touchmove(s,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,p)}touchend(s,h,p){this._calculateTransform(s,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,p){p.length>0&&(this._active=!0);const _=is(p,h),v=new l.pointGeometry(0,0),T=new l.pointGeometry(0,0);let A=0;for(const R in _){const z=_[R],N=this._touches[R];N&&(v._add(z),T._add(z.sub(N)),A++,_[R]=z)}if(this._touches=_,A<this._minTouches||!T.mag())return;const I=T.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,p){return{}}touchstart(s,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,p){if(!this._firstTwoTouches)return;s.preventDefault();const[_,v]=this._firstTwoTouches,T=Ts(p,h,_),A=Ts(p,h,v);if(!T||!A)return;const I=this._aroundCenter?null:T.add(A).div(2);return this._move([T,A],I,s)}touchend(s,h,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,T=Ts(p,h,_),A=Ts(p,h,v);T&&A||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ts(m,s,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return s[p]}function vc(m,s){return Math.log(m/s)/Math.LN2}class tt extends Zs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(vc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vc(this._distance,p),pinchAround:h}}}function al(m,s){return 180*m.angleWith(s)/Math.PI}class Bf extends Zs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:al(this._vector,p),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,p=al(s,this._startVector);return Math.abs(p)<h}}function bc(m){return Math.abs(m.y)>Math.abs(m.x)}class wc extends Zs{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,p){super.touchstart(s,h,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,bc(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,v,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,p){if(this._valid!==void 0)return this._valid;const _=s.mag()>=2,v=h.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=s.y>0==h.y>0;return bc(s)&&bc(h)&&T}}const fh={panStep:100,bearingStep:15,pitchStep:10};class ph{constructor(){const s=fh;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,p=0,_=0,v=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?_=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?_=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Nf,zoom:h?Math.round(I)+h*(s.shiftKey?2:1):I,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:A.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nf(m){return m*(2-m)}const mh=4.000244140625;class Tc{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%mh==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._el,s);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>mh?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&I!==0&&(I=1/I);const R=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(R*I))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,_=this._easing;let v,T=!1;if(this._type==="wheel"&&p&&_){const A=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),I=_(A);v=l.number(p,h,I),A<1?this._frameId||(this._frameId=!0):T=!0}else v=h,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),T=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-T*T);h=l.bezier(T,A,.25,1)}return this._prevEase={start:l.exported.now(),duration:s,easing:h},h}reset(){this._active=!1}}class Ec{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sc{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ac{constructor(){this._tap=new xc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,h,p))}touchmove(s,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,h,p)}touchend(s,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(s,h,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gn{constructor(s,h,p){this._el=s,this._mousePan=h,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Es{constructor(s,h,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gh{constructor(s,h,p,_){this._el=s,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Co=m=>m.zoom||m.drag||m.pitch||m.rotate;class Pc extends l.Event{}function xa(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class _h{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uh(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,T]of this._listeners)C.addEventListener(_,v,_===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[s,h,p]of this._listeners)C.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new zf(h,s));const _=h.boxZoom=new hh(h,s);this._add("boxZoom",_);const v=new Of,T=new Sc;h.doubleClickZoom=new Ec(T,v),this._add("tapZoom",v),this._add("clickZoom",T);const A=new Ac;this._add("tapDragZoom",A);const I=h.touchPitch=new wc(h);this._add("touchPitch",I);const R=new ns(s),z=new ut(s);h.dragRotate=new Es(s,R,z),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const N=new ya(s),j=new dh(s,h);h.dragPan=new Gn(p,N,j),this._add("mousePan",N),this._add("touchPan",j,["touchZoom","touchRotate"]);const ee=new Bf,K=new tt;h.touchZoomRotate=new gh(p,K,ee,A),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]);const Q=h.scrollZoom=new Tc(h,this);this._add("scrollZoom",Q,["mousePan"]);const ue=h.keyboard=new ph;this._add("keyboard",ue),this._add("blockableMapEvent",new ws(h));for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ge]&&h[ge].enable(s[ge])}_add(s,h,p){this._handlers.push({handlerName:s,handler:h,allowed:p}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Co(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,h,p){for(const _ in s)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const p of s)this._el.contains(p.target)&&h.push(p);return h}handleEvent(s,h){if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},v={},T={},A=s.touches,I=A?this._getMapTouches(A):void 0,R=I?C.touchPos(this._el,I):C.mousePos(this._el,s);for(const{handlerName:j,handler:ee,allowed:K}of this._handlers){if(!ee.isEnabled())continue;let Q;this._blockedByActive(T,K,j)?ee.reset():ee[h||s.type]&&(Q=ee[h||s.type](s,R,I),this.mergeHandlerResult(_,v,Q,j,p),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||ee.isActive())&&(T[j]=ee)}const z={};for(const j in this._previousActiveHandlers)T[j]||(z[j]=p);this._previousActiveHandlers=T,(Object.keys(z).length||xa(_))&&(this._changes.push([_,v,z]),this._triggerRenderFrame()),(Object.keys(T).length||xa(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=_;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,h,p,_,v){if(!p)return;l.extend(s,p);const T={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=T),p.panDelta!==void 0&&(h.drag=T),p.pitchDelta!==void 0&&(h.pitch=T),p.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){const s={},h={},p={};for(const[_,v,T]of this._changes)_.panDelta&&(s.panDelta=(s.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(s.around=_.around),_.pinchAround!==void 0&&(s.pinchAround=_.pinchAround),_.noInertia&&(s.noInertia=_.noInertia),l.extend(h,v),l.extend(p,T);this._updateMapTransform(s,h,p),this._changes=[]}_updateMapTransform(s,h,p){const _=this._map,v=_.transform,T=_.style&&_.style.terrain;if(!(xa(s)||T&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:A,zoomDelta:I,bearingDelta:R,pitchDelta:z,around:N,pinchAround:j}=s;j!==void 0&&(N=j),_._stop(!0),N=N||_.transform.centerPoint;const ee=v.pointLocation(A?N.sub(A):N);R&&(v.bearing+=R),z&&(v.pitch+=z),I&&(v.zoom+=I),T?h.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(N),point:N,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(A))):v.setLocationAtPoint(ee,N),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,p,!0)}_fireEvents(s,h,p){const _=Co(this._eventsInProgress),v=Co(s),T={};for(const z in s){const{originalEvent:N}=s[z];this._eventsInProgress[z]||(T[`${z}start`]=N),this._eventsInProgress[z]=s[z]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in T)this._fireEvent(z,T[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in s){const{originalEvent:N}=s[z];this._fireEvent(z,N)}const A={};let I;for(const z in this._eventsInProgress){const{handlerName:N,originalEvent:j}=this._eventsInProgress[z];this._handlersById[N].isActive()||(delete this._eventsInProgress[z],I=h[N]||j,A[`${z}end`]=I)}for(const z in A)this._fireEvent(z,A[z]);const R=Co(this._eventsInProgress);if(p&&(_||v)&&!R){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(N(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new l.Event("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Pc("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const xr={extend:(m,...s)=>l.extend(m,...s),run(m){m()},logToElement(m,s=!1,h="log"){const p=window.document.getElementById(h);p&&(s&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class Li extends l.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,p){return s=l.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,l.extend({offset:s},h),p)}panTo(s,h,p){return this.easeTo(l.extend({center:s},h),p)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,p){return this.easeTo(l.extend({zoom:s},h),p)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,p){return this.easeTo(l.extend({bearing:s},h),p)}resetNorth(s,h){return this.rotateTo(0,l.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=l.LngLatBounds.convert(s);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,h)}_cameraForBoxAndBearing(s,h,p,_){const v={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const be=_.padding;_.padding={top:be,bottom:be,right:be,left:be}}_.padding=l.extend(v,_.padding);const T=this.transform,A=T.padding,I=T.project(l.LngLat.convert(s)),R=T.project(l.LngLat.convert(h)),z=I.rotate(-p*Math.PI/180),N=R.rotate(-p*Math.PI/180),j=new l.pointGeometry(Math.max(z.x,N.x),Math.max(z.y,N.y)),ee=new l.pointGeometry(Math.min(z.x,N.x),Math.min(z.y,N.y)),K=j.sub(ee),Q=(T.width-(A.left+A.right+_.padding.left+_.padding.right))/K.x,ue=(T.height-(A.top+A.bottom+_.padding.top+_.padding.bottom))/K.y;if(ue<0||Q<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(T.scaleZoom(T.scale*Math.min(Q,ue)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),te=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Se=xe.add(te).mult(T.scale/T.zoomScale(ge));return{center:T.unproject(I.add(R).div(2).sub(Se)),zoom:ge,bearing:p}}fitBounds(s,h,p){return this._fitInternal(this.cameraForBounds(s,h),h,p)}fitScreenCoordinates(s,h,p,_,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(s)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,v)}_fitInternal(s,h,p){return s?(delete(h=l.extend(s,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(s,h){this.stop();const p=this.transform;let _=!1,v=!1,T=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(_=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=l.LngLat.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(v=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(T=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),v&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),T&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(s,h,p,_=0){const v=l.MercatorCoordinate.fromLngLat(s,h),T=l.MercatorCoordinate.fromLngLat(p,_),A=T.x-v.x,I=T.y-v.y,R=T.z-v.z,z=Math.hypot(A,I,R);if(z===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(A,I),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),ee=180*Math.atan2(A,-I)/Math.PI;let K=180*Math.acos(N/z)/Math.PI;return K=R<0?90-K:90+K,{center:T.toLngLat(),zoom:j,pitch:K,bearing:ee}}easeTo(s,h){this._stop(!1,s.easeId),((s=l.extend({offset:[0,0],duration:500,easing:l.ease},s)).animate===!1||!s.essential&&l.exported.prefersReducedMotion)&&(s.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),T=this.getPitch(),A=this.getPadding(),I="zoom"in s?+s.zoom:_,R="bearing"in s?this._normalizeBearing(s.bearing,v):v,z="pitch"in s?+s.pitch:T,N="padding"in s?s.padding:p.padding,j=l.pointGeometry.convert(s.offset);let ee=p.centerPoint.add(j);const K=p.pointLocation(ee),Q=l.LngLat.convert(s.center||K);this._normalizeCenter(Q);const ue=p.project(K),ge=p.project(Q).sub(ue),xe=p.zoomScale(I-_);let te,Se;s.around&&(te=l.LngLat.convert(s.around),Se=p.locationPoint(te));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==_,this._rotating=this._rotating||v!==R,this._pitching=this._pitching||z!==T,this._padding=!p.isPaddingEqual(N),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,be),this._ease(Le=>{if(this._zooming&&(p.zoom=l.number(_,I,Le)),this._rotating&&(p.bearing=l.number(v,R,Le)),this._pitching&&(p.pitch=l.number(T,z,Le)),this._padding&&(p.interpolatePadding(A,N,Le),ee=p.centerPoint.add(j)),te)p.setLocationAtPoint(te,Se);else{const ke=p.zoomScale(p.zoom-_),Ge=I>_?Math.min(2,xe):Math.max(.5,xe),Me=Math.pow(Ge,1-Le),st=p.unproject(ue.add(ge.mult(Le*Me)).mult(ke));p.setLocationAtPoint(p.renderWorldCopies?st.wrap():st,ee)}this._fireMoveEvents(h)},Le=>{this._afterEase(h,Le)},s),this}_prepareEase(s,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",s)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new l.Event("move",s)),this._zooming&&this.fire(new l.Event("zoom",s)),this._rotating&&this.fire(new l.Event("rotate",s)),this._pitching&&this.fire(new l.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",s)),_&&this.fire(new l.Event("rotateend",s)),v&&this.fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}flyTo(s,h){if(!s.essential&&l.exported.prefersReducedMotion){const At=l.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(At,h)}this.stop(),s=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},s);const p=this.transform,_=this.getZoom(),v=this.getBearing(),T=this.getPitch(),A=this.getPadding(),I="zoom"in s?l.clamp(+s.zoom,p.minZoom,p.maxZoom):_,R="bearing"in s?this._normalizeBearing(s.bearing,v):v,z="pitch"in s?+s.pitch:T,N="padding"in s?s.padding:p.padding,j=p.zoomScale(I-_),ee=l.pointGeometry.convert(s.offset);let K=p.centerPoint.add(ee);const Q=p.pointLocation(K),ue=l.LngLat.convert(s.center||Q);this._normalizeCenter(ue);const ge=p.project(Q),xe=p.project(ue).sub(ge);let te=s.curve;const Se=Math.max(p.width,p.height),be=Se/j,Le=xe.mag();if("minZoom"in s){const At=l.clamp(Math.min(s.minZoom,_,I),p.minZoom,p.maxZoom),pi=Se/p.zoomScale(At-_);te=Math.sqrt(pi/Le*2)}const ke=te*te;function Ge(At){const pi=(be*be-Se*Se+(At?-1:1)*ke*ke*Le*Le)/(2*(At?be:Se)*ke*Le);return Math.log(Math.sqrt(pi*pi+1)-pi)}function Me(At){return(Math.exp(At)-Math.exp(-At))/2}function st(At){return(Math.exp(At)+Math.exp(-At))/2}const Ke=Ge(0);let ot=function(At){return st(Ke)/st(Ke+te*At)},Nt=function(At){return Se*((st(Ke)*(Me(pi=Ke+te*At)/st(pi))-Me(Ke))/ke)/Le;var pi},Ht=(Ge(1)-Ke)/te;if(Math.abs(Le)<1e-6||!isFinite(Ht)){if(Math.abs(Se-be)<1e-6)return this.easeTo(s,h);const At=be<Se?-1:1;Ht=Math.abs(Math.log(be/Se))/te,Nt=function(){return 0},ot=function(pi){return Math.exp(At*te*pi)}}return s.duration="duration"in s?+s.duration:1e3*Ht/("screenSpeed"in s?+s.screenSpeed/te:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==R,this._pitching=z!==T,this._padding=!p.isPaddingEqual(N),this._prepareEase(h,!1),this._ease(At=>{const pi=At*Ht,mi=1/ot(pi);p.zoom=At===1?I:_+p.scaleZoom(mi),this._rotating&&(p.bearing=l.number(v,R,At)),this._pitching&&(p.pitch=l.number(T,z,At)),this._padding&&(p.interpolatePadding(A,N,At),K=p.centerPoint.add(ee));const ii=At===1?ue:p.unproject(ge.add(xe.mult(Nt(pi))).mult(mi));p.setLocationAtPoint(p.renderWorldCopies?ii.wrap():ii,K),this._fireMoveEvents(h)},()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,h,p){p.animate===!1||p.duration===0?(s(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=l.wrap(s,-180,180);const p=Math.abs(s-h);return Math.abs(s-360-h)<p&&(s-=360),Math.abs(s+360-h)<p&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=s.lng-h.center.lng;s.lng+=p>180?-360:p<-180?360:0}}class va{constructor(s={}){this.options=s,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const p=this._map._getUIString(`AttributionControl.${h}`);s.title=p,s.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const v=h[_];if(v.used||v.usedForTerrain){const T=v.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s=s.filter(_=>String(_).trim()),s.sort((_,v)=>_.length-v.length),s=s.filter((_,v)=>{for(let T=v+1;T<s.length;T++)if(s[T].indexOf(_)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ll{constructor(s={}){this.options=s,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=C.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class yh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===s)return void(_.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const xh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},vh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Uf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Wr{constructor(s,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new ns({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new ut({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchmove",this.touchmove),C.addEventListener(h,"touchend",this.touchend),C.addEventListener(h,"touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),C.disableDrag()}move(s,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(s,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(s,h);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const s=this.element;C.removeEventListener(s,"mousedown",this.mousedown),C.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(s,"touchmove",this.touchmove),C.removeEventListener(s,"touchend",this.touchend),C.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup)}mousedown(s){this.down(l.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),C.mousePos(this.element,s)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.move(s,C.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ba(m,s,h){if(m=new l.LngLat(m.lng,m.lat),s){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),v=h.locationPoint(m).distSqr(s);h.locationPoint(p).distSqr(s)<v?m=p:h.locationPoint(_).distSqr(s)<v&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const xt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mt(m,s,h){const p=m.classList;for(const _ in xt)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${s}`,`mapboxgl-${h}-anchor-${s}`)}class Mo extends l.Evented{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=l.extend({element:s},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=l.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const p=C.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${v}px`),p.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const T=C.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const A=C.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const I=C.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of R){const te=C.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",xe.rx),te.setAttributeNS(null,"ry",xe.ry),I.appendChild(te)}const z=C.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const N=C.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(N);const j=C.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"opacity","0.25"),j.setAttributeNS(null,"fill","#000000");const ee=C.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),j.appendChild(ee);const K=C.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(6.0, 7.0)"),K.setAttributeNS(null,"fill","#FFFFFF");const Q=C.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ue=C.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#000000"),ue.setAttributeNS(null,"opacity","0.25"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962");const ge=C.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),Q.appendChild(ue),Q.appendChild(ge),A.appendChild(I),A.appendChild(z),A.appendChild(j),A.appendChild(K),A.appendChild(Q),p.appendChild(A),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),Mt(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,p=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ba(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${xt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(s){return this._offset=l.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ss,En=0,As=!1;const Hr={maxWidth:100,unit:"metric"};function bh(m,s,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,v=m.unproject([0,_]),T=m.unproject([p,_]),A=v.distanceTo(T);if(h&&h.unit==="imperial"){const I=3.2808*A;I>5280?Ps(s,p,I/5280,m._getUIString("ScaleControl.Miles")):Ps(s,p,I,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ps(s,p,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Ps(s,p,A/1e3,m._getUIString("ScaleControl.Kilometers")):Ps(s,p,A,m._getUIString("ScaleControl.Meters"))}function Ps(m,s,h,p){const _=function(v){const T=Math.pow(10,`${Math.floor(v)}`.length-1);let A=v/T;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(I){const R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R}(A),T*A}(h);m.style.width=s*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const Wi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},tn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cc(m){if(m){if(typeof m=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(s,s),"top-right":new l.pointGeometry(-s,s),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(s,-s),"bottom-right":new l.pointGeometry(-s,-s),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const s=l.pointGeometry.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return Cc(new l.pointGeometry(0,0))}const Xs={supported:x,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends Li{constructor(m){var s;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},vh,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new da(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new yh,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},xh,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(s=m.pixelRatio)!==null&&s!==void 0?s:devicePixelRatio,this._requestManager=new V(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _h(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new oh(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new va({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new ll,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,s,h,p)}resize(m){const s=this._containerDimensions(),h=s[0],p=s[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[s,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(s,h,m),this.painter.resize(s,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:v=>{const T=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];T.length?p||(p=!0,h.call(this,new nr(m,this,v.originalEvent,{features:T}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:T=>{(this.getLayer(s)?this.queryRenderedFeatures(T.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,h.call(this,new nr(m,this,T.originalEvent)))},mouseout:T=>{p&&(p=!1,h.call(this,new nr(m,this,T.originalEvent)))}}}}{const p=_=>{const v=this.getLayer(s)?this.queryRenderedFeatures(_.point,{layers:[s]}):[];v.length&&(_.features=v,h.call(this,_),delete _.features)};return{layer:s,listener:h,delegates:{[m]:p}}}}on(m,s,h){if(h===void 0)return super.on(m,s);const p=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,s,h){if(h===void 0)return super.once(m,s);const p=this._createDelegatedListener(m,s,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,s,h){return h===void 0?super.off(m,s):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let v=0;v<_.length;v++){const T=_[v];if(T.layer===s&&T.listener===h){for(const A in T.delegates)this.off(A,T.delegates[A]);return _.splice(v,1),this}}})(),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let h;if(s!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(s=m,m=void 0),s=s||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return(s=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new ln(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,s)})}else typeof m=="object"&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(s!==void 0)return s.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const h=m[s]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:v,content:T}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||l.isImageBitmap(s)){const{width:A,height:I,data:R}=l.exported.getImageData(s);this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},R),pixelRatio:h,stretchX:_,stretchY:v,content:T,sdf:p,version:0})}else{if(s.width===void 0||s.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:R}=s,z=s;this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},new Uint8Array(R)),pixelRatio:h,stretchX:_,stretchY:v,content:T,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}}updateImage(m,s){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||l.isImageBitmap(s)?l.exported.getImageData(s):s,{width:_,height:v,data:T}=p;if(_===void 0||v===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||v!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(s instanceof HTMLImageElement||l.isImageBitmap(s));h.data.replace(T,A),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),s)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,s,h){return this.style.setLayerZoomRange(m,s,h),this._update(!0)}setFilter(m,s,h={}){return this.style.setFilter(m,s,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,h,p={}){return this.style.setPaintProperty(m,s,h,p),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,h,p={}){return this.style.setLayoutProperty(m,s,h,p),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const s=this._canvasContainer=C.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=C.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=C.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=C.create("div","maplibregl-cooperative-gesture-screen",m);let s="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",s="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===s&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===s&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,s,h){this._canvas.width=h*m,this._canvas.height=h*s,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m=l.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);s?(this.painter=new yc(s,this.transform),l.exported$1.testSupport(s)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let s,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,s),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,A=l.exported.now();this.style.zoomHistory.update(T,A);const I=new l.EvaluationParameters(T,{now:A,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=I.crossFadingFactor();R===1&&R===this._crossFadingFactor||(_=!0,this._crossFadingFactor=R),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const T=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,s),setTimeout(()=>{const A=p.getQueryObjectEXT(s,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s),this.fire(new l.Event("gpu-timing-frame",{cpuTime:T,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(T);this.fire(new l.Event("gpu-timing-layer",{layerTimes:A}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._cooperativeGestures&&C.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,s){l.setCacheLimits(m,s)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},Uf,m),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),s=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const h=C.create("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){const h=this._map._getUIString(`NavigationControl.${s}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},Ic,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var s;return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,Ss!==void 0?s(Ss):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ss=h.state!=="denied",s(Ss)}):(Ss=!!window.navigator.geolocation,s(Ss)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,En=0,As=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),h=m.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,s=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=s.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&As)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Mo(this._dotElement),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":En--,As=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),En++,En>1?(m={maximumAge:6e5,timeout:0},As=!0):(m=this.options.positionOptions,As=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:va,LogoControl:ll,ScaleControl:class{constructor(m){this.options=l.extend({},Hr,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){bh(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,bh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(Wi),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=C.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ba(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const s=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=Cc(this.options.offset);if(!h){const v=this._container.offsetWidth,T=this._container.offsetHeight;let A;A=s.y+p.bottom.y<T?["top"]:s.y>this._map.transform.height-T?["bottom"]:[],s.x<v/2?A.push("left"):s.x>this._map.transform.width-v/2&&A.push("right"),h=A.length===0?"bottom":A.join("-")}const _=s.add(p[h]).round();C.setTransform(this._container,`${xt[h]} translate(${_.x}px,${_.y}px)`),Mt(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(tn);m&&m.focus()}_onClose(){this.remove()}},Marker:Mo,Style:ln,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:wn,GeoJSONSource:oi,ImageSource:Vi,RasterDEMTileSource:ft,RasterTileSource:Ut,VectorTileSource:zt,VideoSource:fn,prewarm:function(){Be().acquire(oe)},clearPrewarmedResources:function(){const m=Ve;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(oe),Ve=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return me.workerCount},set workerCount(m){me.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,s){l.config.REGISTERED_PROTOCOLS[m]=s},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return xr.extend(Xs,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),Xs});var f=a;return f})})(FS);function Eu(i){return Eu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Eu(i)}function BS(i,e){if(Eu(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Eu(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function NS(i){var e=BS(i,"string");return Eu(e)==="symbol"?e:String(e)}function B(i,e,t){return e=NS(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Dd(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const Ag=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),l0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);l0&&parseFloat(l0[1]);const US="3.3.1";function co(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const _d=typeof process!="object"||String(process)!=="[object process]"||process.browser,VS=typeof window<"u"&&typeof window.orientation<"u",c0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);c0&&parseFloat(c0[1]);class jS{constructor(e,t){B(this,"name",void 0),B(this,"workerThread",void 0),B(this,"isRunning",!0),B(this,"result",void 0),B(this,"_resolve",()=>{}),B(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,a)=>{this._resolve=r,this._reject=a})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){co(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){co(this.isRunning),this.isRunning=!1,this._reject(e)}}let Rp=class{terminate(){}};const kp=new Map;function GS(i){co(i.source&&!i.url||!i.source&&i.url);let e=kp.get(i.source||i.url);return e||(i.url&&(e=WS(i.url),kp.set(i.url,e)),i.source&&(e=wb(i.source),kp.set(i.source,e))),co(e),e}function WS(i){if(!i.startsWith("http"))return i;const e=HS(i);return wb(e)}function wb(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function HS(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Tb(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(i){if(u0(i))r.add(i);else if(u0(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const a in i)Tb(i[a],e,r)}}return t===void 0?Array.from(r):[]}function u0(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const Dp=()=>{};class Am{static isSupported(){return typeof Worker<"u"&&_d||typeof Rp<"u"&&!_d}constructor(e){B(this,"name",void 0),B(this,"source",void 0),B(this,"url",void 0),B(this,"terminated",!1),B(this,"worker",void 0),B(this,"onMessage",void 0),B(this,"onError",void 0),B(this,"_loadableURL","");const{name:t,source:r,url:a}=e;co(r||a),this.name=t,this.source=r,this.url=a,this.onMessage=Dp,this.onError=u=>console.log(u),this.worker=_d?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Dp,this.onError=Dp,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Tb(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=GS({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Rp(r,{eval:!1})}else if(this.source)e=new Rp(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class qS{static isSupported(){return Am.isSupported()}constructor(e){B(this,"name","unnamed"),B(this,"source",void 0),B(this,"url",void 0),B(this,"maxConcurrency",1),B(this,"maxMobileConcurrency",1),B(this,"onDebug",()=>{}),B(this,"reuseWorkers",!0),B(this,"props",{}),B(this,"jobQueue",[]),B(this,"idleQueue",[]),B(this,"count",0),B(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(u,f,l)=>u.done(l),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(u,f)=>u.error(f);const a=new Promise(u=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:u}),this));return this._startQueuedJob(),await a}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new jS(t.name,e);e.onMessage=a=>t.onMessage(r,a.type,a.payload),e.onError=a=>t.onError(r,a),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Am({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return VS?this.maxMobileConcurrency:this.maxConcurrency}}const $S={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ao{static isSupported(){return Am.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ao._workerFarm=ao._workerFarm||new ao({}),ao._workerFarm.setProps(e),ao._workerFarm}constructor(e){B(this,"props",void 0),B(this,"workerPools",new Map),this.props={...$S},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:a}=e;let u=this.workerPools.get(t);return u||(u=new qS({name:t,source:r,url:a}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}B(ao,"_workerFarm",void 0);const ZS="latest";function XS(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[i.id]||{},r="".concat(i.id,"-worker.js");let a=t.workerUrl;if(!a&&i.id==="compression"&&(a=e.workerUrl),e._workerType==="test"&&(a="modules/".concat(i.module,"/dist/").concat(r)),!a){let u=i.version;u==="latest"&&(u=ZS);const f=u?"@".concat(u):"";a="https://unpkg.com/@loaders.gl/".concat(i.module).concat(f,"/dist/").concat(r)}return co(a),a}function YS(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:US;co(i,"no worker provided");const t=i.version;return!(!e||!t)}function KS(i,e){return!ao.isSupported()||!_d&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function JS(i,e,t,r,a){const u=i.id,f=XS(i,t),x=ao.getWorkerFarm(t).getWorkerPool({name:u,url:f});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const w=await x.startJob("process-on-worker",QS.bind(null,a));return w.postMessage("process",{input:e,options:t,context:r}),await(await w.result).result}async function QS(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:a,input:u,options:f}=r;try{const l=await i(u,f);e.postMessage("done",{id:a,result:l})}catch(l){const x=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:a,error:x})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function eA(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),a=new Uint8Array(e);for(let u=0;u<r.length;++u)if(r[u]!==a[u])return!1;return!0}function tA(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];const r=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),a=r.reduce((l,x)=>l+x.byteLength,0),u=new Uint8Array(a);let f=0;for(const l of r)u.set(l,f),f+=l.byteLength;return u.buffer}async function iA(i){const e=[];for await(const t of i)e.push(t);return tA(...e)}function h0(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class d0{constructor(e,t){B(this,"name",void 0),B(this,"type",void 0),B(this,"sampleSize",1),B(this,"time",void 0),B(this,"count",void 0),B(this,"samples",void 0),B(this,"lastTiming",void 0),B(this,"lastSampleTime",void 0),B(this,"lastSampleCount",void 0),B(this,"_count",0),B(this,"_time",0),B(this,"_samples",0),B(this,"_startTime",0),B(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=h0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(h0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Pg{constructor(e){B(this,"id",void 0),B(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof d0?this.stats[t]=e:this.stats[t]=new d0(t,r)),this.stats[t]}}let nA="";const f0={};function rA(i){for(const e in f0)if(i.startsWith(e)){const t=f0[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(nA).concat(i)),i}function sA(i){return i&&typeof i=="object"&&i.isBuffer}function Eb(i){if(sA(i))return(void 0)(i);if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function oA(i){const e=i&&i.lastIndexOf("/");return e>=0?i.substr(e+1):""}const aA=i=>typeof i=="boolean",fu=i=>typeof i=="function",zu=i=>i!==null&&typeof i=="object",p0=i=>zu(i)&&i.constructor==={}.constructor,lA=i=>i&&typeof i[Symbol.iterator]=="function",cA=i=>i&&typeof i[Symbol.asyncIterator]=="function",Kl=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,Jl=i=>typeof Blob<"u"&&i instanceof Blob,uA=i=>i&&typeof i=="object"&&i.isBuffer,hA=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||zu(i)&&fu(i.tee)&&fu(i.cancel)&&fu(i.getReader),dA=i=>zu(i)&&fu(i.read)&&fu(i.pipe)&&aA(i.readable),Sb=i=>hA(i)||dA(i),fA=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,pA=/^([-\w.]+\/[-\w.+]+)/;function mA(i){const e=pA.exec(i);return e?e[1]:i}function m0(i){const e=fA.exec(i);return e?e[1]:""}const gA=/\?.*/;function df(i){if(Kl(i)){const e=zp(i.url||""),t=i.headers.get("content-type")||"";return{url:e,type:mA(t)||m0(e)}}return Jl(i)?{url:zp(i.name||""),type:i.type||""}:typeof i=="string"?{url:zp(i),type:m0(i)}:{url:"",type:""}}function _A(i){return Kl(i)?i.headers["content-length"]||-1:Jl(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}function zp(i){return i.replace(gA,"")}async function Ab(i){if(Kl(i))return i;const e={},t=_A(i);t>=0&&(e["content-length"]=String(t));const{url:r,type:a}=df(i);a&&(e["content-type"]=a);const u=await vA(i);u&&(e["x-first-bytes"]=u),typeof i=="string"&&(i=new TextEncoder().encode(i));const f=new Response(i,{headers:e});return Object.defineProperty(f,"url",{value:r}),f}async function yA(i){if(!i.ok){const e=await xA(i);throw new Error(e)}}async function xA(i){let e="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const t=i.headers.get("Content-Type");let r=i.statusText;t.includes("application/json")&&(r+=" ".concat(await i.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function vA(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const a=new FileReader;a.onload=u=>{var f;return r(u==null||(f=u.target)===null||f===void 0?void 0:f.result)},a.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),r=bA(t);return"data:base64,".concat(r)}return null}function bA(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function g0(i,e){if(typeof i=="string"){i=rA(i);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(i,t)}return await Ab(i)}function Pb(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function po(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Pb()}const yd={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Jh=yd.window||yd.self||yd.global,Yc=yd.process||{},Ib=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";po();const Op=globalThis;function Cb(i){if(!i&&!po())return"Node";if(Pb(i))return"Electron";const t=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,a=t.indexOf("Trident/")!==-1;return r||a?"IE":Op.chrome?"Chrome":Op.safari?"Safari":Op.mozInnerScreenX?"Firefox":"Unknown"}function wA(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class TA{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";B(this,"storage",void 0),B(this,"id",void 0),B(this,"config",void 0),this.storage=wA(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function EA(i){let e;return i<10?e="".concat(i.toFixed(2),"ms"):i<100?e="".concat(i.toFixed(1),"ms"):i<1e3?e="".concat(i.toFixed(0),"ms"):e="".concat((i/1e3).toFixed(2),"s"),e}function SA(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return"".concat(" ".repeat(t)).concat(i)}function Fp(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const a=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const u=i.width*t,f=i.height*t,l=["font-size:1px;","padding:".concat(Math.floor(f/2),"px ").concat(Math.floor(u/2),"px;"),"line-height:".concat(f,"px;"),"background:url(".concat(a,");"),"background-size:".concat(u,"px ").concat(f,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let zd;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zd||(zd={}));function _0(i){return typeof i=="string"?zd[i.toUpperCase()]||zd.WHITE:i}function AA(i,e,t){return!po&&typeof i=="string"&&(e&&(e=_0(e),i="\x1B[".concat(e,"m").concat(i,"\x1B[39m")),t&&(e=_0(t),i="\x1B[".concat(t+10,"m").concat(i,"\x1B[49m"))),i}function PA(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t);for(const a of r)typeof i[a]=="function"&&(e.find(u=>a===u)||(i[a]=i[a].bind(i)))}function Od(i,e){if(!i)throw new Error(e||"Assertion failed")}function vl(){let i;if(po&&"performance"in Jh){var e,t;i=Jh==null||(e=Jh.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Yc){var r;const a=Yc==null||(r=Yc.hrtime)===null||r===void 0?void 0:r.call(Yc);i=a[0]*1e3+a[1]/1e6}else i=Date.now();return i}const bl={debug:po&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},IA={enabled:!0,level:0};function Yr(){}const y0={},x0={once:!0};class Ou{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};B(this,"id",void 0),B(this,"VERSION",Ib),B(this,"_startTs",vl()),B(this,"_deltaTs",vl()),B(this,"_storage",void 0),B(this,"userData",{}),B(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new TA("__probe-".concat(this.id,"__"),IA),this.timeStamp("".concat(this.id," started")),PA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((vl()-this._startTs).toPrecision(10))}getDelta(){return Number((vl()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Od(e,t)}warn(e){return this._getLogFunction(0,e,bl.warn,arguments,x0)}error(e){return this._getLogFunction(0,e,bl.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,bl.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,bl.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,a=new Array(r>2?r-2:0),u=2;u<r;u++)a[u-2]=arguments[u];return this._getLogFunction(e,t,bl.debug||bl.info,arguments,x0)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||Yr,r&&[r],{tag:RA(t)}):Yr}image(e){let{logLevel:t,priority:r,image:a,message:u="",scale:f=1}=e;return this._shouldLog(t||r)?po?LA({image:a,message:u,scale:f}):MA():Yr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Yr)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const a=v0({logLevel:e,message:t,opts:r}),{collapsed:u}=r;return a.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Yr)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Mb(e)}_getLogFunction(e,t,r,a,u){if(this._shouldLog(e)){u=v0({logLevel:e,message:t,args:a,opts:u}),r=r||u.method,Od(r),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=vl();const f=u.tag||u.message;if(u.once)if(!y0[f])y0[f]=vl();else return Yr;return t=CA(this.id,u.message,u),r.bind(console,t,...u.args)}return Yr}}B(Ou,"VERSION",Ib);function Mb(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return Od(Number.isFinite(e)&&e>=0),e}function v0(i){const{logLevel:e,message:t}=i;i.logLevel=Mb(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const a=typeof i.message;return Od(a==="string"||a==="object"),Object.assign(i,{args:r},i.opts)}function CA(i,e,t){if(typeof e=="string"){const r=t.time?SA(EA(t.total)):"";e=t.time?"".concat(i,": ").concat(r,"  ").concat(e):"".concat(i,": ").concat(e),e=AA(e,t.color,t.background)}return e}function MA(i){return console.warn("removed"),Yr}function LA(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const u=new Image;return u.onload=()=>{const f=Fp(u,t,r);console.log(...f)},u.src=e,Yr}const a=e.nodeName||"";if(a.toLowerCase()==="img")return console.log(...Fp(e,t,r)),Yr;if(a.toLowerCase()==="canvas"){const u=new Image;return u.onload=()=>console.log(...Fp(u,t,r)),u.src=e.toDataURL(),Yr}return Yr}function RA(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const b0=new Ou({id:"loaders.gl"});class kA{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class DA{constructor(){B(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const Lb={fetch:null,mimeType:void 0,nothrow:!1,log:new DA,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ag,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},zA={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Rb(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const kb=()=>{const i=Rb();return i.globalOptions=i.globalOptions||{...Lb},i.globalOptions};function OA(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],FA(i,t),NA(e,i,r)}function Db(i,e){const t=kb(),r=i||t;return typeof r.fetch=="function"?r.fetch:zu(r.fetch)?a=>g0(a,r):e!=null&&e.fetch?e==null?void 0:e.fetch:g0}function FA(i,e){w0(i,null,Lb,zA,e);for(const t of e){const r=i&&i[t.id]||{},a=t.options&&t.options[t.id]||{},u=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};w0(r,t.id,a,u,e)}}function w0(i,e,t,r,a){const u=e||"Top level",f=e?"".concat(e,"."):"";for(const l in i){const x=!e&&zu(i[l]),w=l==="baseUri"&&!e,P=l==="workerUrl"&&e;if(!(l in t)&&!w&&!P){if(l in r)b0.warn("".concat(u," loader option '").concat(f).concat(l,"' no longer supported, use '").concat(r[l],"'"))();else if(!x){const M=BA(l,a);b0.warn("".concat(u," loader option '").concat(f).concat(l,"' not recognized. ").concat(M))()}}}}function BA(i,e){const t=i.toLowerCase();let r="";for(const a of e)for(const u in a.options){if(i===u)return"Did you mean '".concat(a.id,".").concat(u,"'?");const f=u.toLowerCase();(t.startsWith(f)||f.startsWith(t))&&(r=r||"Did you mean '".concat(a.id,".").concat(u,"'?"))}return r}function NA(i,e,t){const a={...i.options||{}};return UA(a,t),a.log===null&&(a.log=new kA),T0(a,kb()),T0(a,e),a}function T0(i,e){for(const t in e)if(t in e){const r=e[t];p0(r)&&p0(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function UA(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function Ig(i){var e;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((e=i)===null||e===void 0?void 0:e.extensions)):!1}function Cg(i){var e,t;Dd(i,"null loader"),Dd(Ig(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((e=i)!==null&&e!==void 0&&e.parseTextSync||(t=i)!==null&&t!==void 0&&t.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const zb=()=>{const i=Rb();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function VA(i){const e=zb();i=Array.isArray(i)?i:[i];for(const t of i){const r=Cg(t);e.find(a=>r===a)||e.unshift(r)}}function jA(){return zb()}const GA=new Ou({id:"loaders.gl"}),WA=/\.([^.]+)$/;async function HA(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Ob(i))return null;let a=E0(i,e,{...t,nothrow:!0},r);if(a)return a;if(Jl(i)&&(i=await i.slice(0,10).arrayBuffer(),a=E0(i,e,t,r)),!a&&!(t!=null&&t.nothrow))throw new Error(Fb(i));return a}function E0(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Ob(i))return null;if(e&&!Array.isArray(e))return Cg(e);let a=[];e&&(a=a.concat(e)),t!=null&&t.ignoreRegisteredLoaders||a.push(...jA()),$A(a);const u=qA(i,a,t,r);if(!u&&!(t!=null&&t.nothrow))throw new Error(Fb(i));return u}function qA(i,e,t,r){const{url:a,type:u}=df(i),f=a||(r==null?void 0:r.url);let l=null,x="";if(t!=null&&t.mimeType&&(l=Bp(e,t==null?void 0:t.mimeType),x="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),l=l||ZA(e,f),x=x||(l?"matched url ".concat(f):""),l=l||Bp(e,u),x=x||(l?"matched MIME type ".concat(u):""),l=l||YA(e,i),x=x||(l?"matched initial data ".concat(Bb(i)):""),l=l||Bp(e,t==null?void 0:t.fallbackMimeType),x=x||(l?"matched fallback MIME type ".concat(u):""),x){var w;GA.log(1,"selectLoader selected ".concat((w=l)===null||w===void 0?void 0:w.name,": ").concat(x,"."))}return l}function Ob(i){return!(i instanceof Response&&i.status===204)}function Fb(i){const{url:e,type:t}=df(i);let r="No valid loader found (";r+=e?"".concat(oA(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const a=i?Bb(i):"";return r+=a?' first bytes: "'.concat(a,'"'):"first bytes: not available",r+=")",r}function $A(i){for(const e of i)Cg(e)}function ZA(i,e){const t=e&&WA.exec(e),r=t&&t[1];return r?XA(i,r):null}function XA(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Bp(i,e){for(const t of i)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function YA(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(KA(e,t))return t}else if(ArrayBuffer.isView(e)){if(S0(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&S0(e,0,t))return t;return null}function KA(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function S0(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(a=>JA(i,e,t,a))}function JA(i,e,t,r){if(r instanceof ArrayBuffer)return eA(r,i,r.byteLength);switch(typeof r){case"function":return r(i,t);case"string":const a=Pm(i,e,r.length);return r===a;default:return!1}}function Bb(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Pm(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Pm(i,0,e):""}function Pm(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let a="";for(let u=0;u<t;u++)a+=String.fromCharCode(r.getUint8(e+u));return a}const QA=256*1024;function*eP(i,e){const t=(e==null?void 0:e.chunkSize)||QA;let r=0;const a=new TextEncoder;for(;r<i.length;){const u=Math.min(i.length-r,t),f=i.slice(r,r+u);r+=u,yield a.encode(f)}}const tP=256*1024;function*iP(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{chunkSize:t=tP}=e;let r=0;for(;r<i.byteLength;){const a=Math.min(i.byteLength-r,t),u=new ArrayBuffer(a),f=new Uint8Array(i,r,a);new Uint8Array(u).set(f),r+=a,yield u}}const nP=1024*1024;async function*rP(i,e){const t=(e==null?void 0:e.chunkSize)||nP;let r=0;for(;r<i.size;){const a=r+t,u=await i.slice(r,a).arrayBuffer();r=a,yield u}}function A0(i,e){return Ag?sP(i,e):oP(i)}async function*sP(i,e){const t=i.getReader();let r;try{for(;;){const a=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:u,value:f}=await a;if(u)return;yield Eb(f)}}catch{t.releaseLock()}}async function*oP(i,e){for await(const t of i)yield Eb(t)}function aP(i,e){if(typeof i=="string")return eP(i,e);if(i instanceof ArrayBuffer)return iP(i,e);if(Jl(i))return rP(i,e);if(Sb(i))return A0(i,e);if(Kl(i))return A0(i.body,e);throw new Error("makeIterator")}const Nb="Cannot convert supplied data type";function lP(i,e,t){if(e.text&&typeof i=="string")return i;if(uA(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const a=i.byteLength||i.length;return(i.byteOffset!==0||a!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+a)),r}throw new Error(Nb)}async function cP(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return lP(i,e);if(Jl(i)&&(i=await Ab(i)),Kl(i)){const a=i;return await yA(a),e.binary?await a.arrayBuffer():await a.text()}if(Sb(i)&&(i=aP(i,t)),lA(i)||cA(i))return iA(i);throw new Error(Nb)}function uP(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(t)return t;const r={fetch:Db(e,i),...i};return Array.isArray(r.loaders)||(r.loaders=null),r}function hP(i,e){if(!e&&i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function Mg(i,e,t,r){co(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Ig(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const{url:a}=df(i),f=hP(e,r),l=await HA(i,f,t);return l?(t=OA(t,l,f,a),r=uP({url:a,parse:Mg,loaders:f},t,r),await dP(l,i,t,r)):null}async function dP(i,e,t,r){if(YS(i),Kl(e)){const a=e,{ok:u,redirected:f,status:l,statusText:x,type:w,url:P}=a,M=Object.fromEntries(a.headers.entries());r.response={headers:M,ok:u,redirected:f,status:l,statusText:x,type:w,url:P}}if(e=await cP(e,i,t),i.parseTextSync&&typeof e=="string")return t.dataType="text",i.parseTextSync(e,t,r,i);if(KS(i,t))return await JS(i,e,t,r,Mg);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r,i);if(i.parse)return await i.parse(e,t,r,i);throw co(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function Fd(i,e,t,r){!Array.isArray(e)&&!Ig(e)&&(t=e,e=void 0);const a=Db(t);let u=i;return typeof i=="string"&&(u=await a(i)),Jl(i)&&(u=await a(i)),await Mg(u,e,t)}const fP="3.3.1",{_parseImageNode:pP}=globalThis,Im=typeof Image<"u",Cm=typeof ImageBitmap<"u",mP=Boolean(pP),Mm=Ag?!0:mP;function gP(i){switch(i){case"auto":return Cm||Im||Mm;case"imagebitmap":return Cm;case"image":return Im;case"data":return Mm;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function _P(){if(Cm)return"imagebitmap";if(Im)return"image";if(Mm)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function yP(i){const e=vP(i);if(!e)throw new Error("Not an image");return e}function xP(i){switch(yP(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function vP(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const bP=/^data:image\/svg\+xml/,wP=/\.svg((\?|#).*)?$/;function Lg(i){return i&&(bP.test(i)||wP.test(i))}function TP(i,e){if(Lg(e)){let r=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(u){throw new Error(u.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return Ub(i,e)}function Ub(i,e){if(Lg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function Vb(i,e,t){const r=TP(i,t),a=self.URL||self.webkitURL,u=typeof r!="string"&&a.createObjectURL(r);try{return await EP(u||r,e)}finally{u&&a.revokeObjectURL(u)}}async function EP(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,a)=>{try{t.onload=()=>r(t),t.onerror=u=>a(new Error("Could not load image ".concat(i,": ").concat(u)))}catch(u){a(u)}})}const SP={};let P0=!0;async function AP(i,e,t){let r;Lg(t)?r=await Vb(i,e,t):r=Ub(i,t);const a=e&&e.imagebitmap;return await PP(r,a)}async function PP(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((IP(e)||!P0)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),P0=!1}return await createImageBitmap(i)}function IP(i){for(const e in i||SP)return!1;return!0}const Bs=!1,pu=!0;function jb(i){const e=Fu(i);return CP(e)||RP(e)||MP(e)||LP(e)}function CP(i){const e=Fu(i);return e.byteLength>=24&&e.getUint32(0,Bs)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Bs),height:e.getUint32(20,Bs)}:null}function MP(i){const e=Fu(i);return e.byteLength>=10&&e.getUint32(0,Bs)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,pu),height:e.getUint16(8,pu)}:null}function LP(i){const e=Fu(i);return e.byteLength>=14&&e.getUint16(0,Bs)===16973&&e.getUint32(2,pu)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,pu),height:e.getUint32(22,pu)}:null}function RP(i){const e=Fu(i);if(!(e.byteLength>=3&&e.getUint16(0,Bs)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:a}=kP();let u=2;for(;u+9<e.byteLength;){const f=e.getUint16(u,Bs);if(a.has(f))return{mimeType:"image/jpeg",height:e.getUint16(u+5,Bs),width:e.getUint16(u+7,Bs)};if(!r.has(f))return null;u+=2,u+=e.getUint16(u,Bs)}return null}function kP(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Fu(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function DP(i,e){const{mimeType:t}=jb(i)||{},r=globalThis._parseImageNode;return Dd(r),await r(i,t)}async function zP(i,e,t){e=e||{};const a=(e.image||{}).type||"auto",{url:u}=t||{},f=OP(a);let l;switch(f){case"imagebitmap":l=await AP(i,e,u);break;case"image":l=await Vb(i,e,u);break;case"data":l=await DP(i);break;default:Dd(!1)}return a==="data"&&(l=xP(l)),l}function OP(i){switch(i){case"auto":case"data":return _P();default:return gP(i),i}}const FP=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],BP=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],NP={image:{type:"auto",decode:!0}},UP={id:"image",module:"images",name:"Images",version:fP,mimeTypes:BP,extensions:FP,parse:zP,tests:[i=>Boolean(jb(new DataView(i)))],options:NP},ai=new Ou({id:"deck"});let Lm={};function VP(i){Lm=i}function Xn(i,e,t,r){ai.level>0&&Lm[i]&&Lm[i].call(null,e,t,r)}function jP(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const GP={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:jP,parseTextSync:JSON.parse};function WP(){const i="8.9.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(i));return e||(ai.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:ai,_registerLoggers:VP},VA([GP,[UP,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const HP=WP(),yi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(yi,"IDENTITY",{get:()=>(ai.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ns={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qo={common:0,meters:1,pixels:2},I0={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Rt=new Ou({id:"luma.gl"});function hr(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}const qP="Invalid WebGLRenderingContext",$P="Requires WebGL2";function ff(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:Boolean(i&&Number.isFinite(i._version))}function ci(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:Boolean(i&&i._version===2)}function ZP(i){return ci(i)?i:null}function pf(i){return hr(ff(i),qP),i}function Kn(i){return hr(ci(i),$P),i}const ru={};function XP(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function YP(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function KP(i,e){ru[i]=!0,e!==void 0&&XP(e)}function JP(i){const e=i.getError;i.getError=function(){let r;do r=e.apply(i),r!==0&&(ru[r]=!0);while(r!==0);for(r in ru)if(ru[r])return delete ru[r],parseInt(r,10);return 0}}const Bu=function i(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const a=new i.VertexAttrib(t);this.attribs[r]=a}this.maxAttrib=0};Bu.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Bu.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const qa=function(e){const t=this;this.gl=e,JP(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(u){return u===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(u){const f=t.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(u){const f=t.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(u,f){switch(u){case 34962:t.currentArrayBuffer=f;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=f;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(u,f){const x=t.currentVertexArrayObject.attribs[u];switch(f){case 34975:return x.buffer;case 34338:return x.enabled;case 34339:return x.size;case 34340:return x.stride;case 34341:return x.type;case 34922:return x.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(u,f,l,x,w,P){const M=t.currentVertexArrayObject;M.maxAttrib=Math.max(M.maxAttrib,u);const C=M.attribs[u];return C.buffer=t.currentArrayBuffer,C.size=f,C.type=l,C.normalized=x,C.stride=w,C.offset=P,C.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{YP("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};qa.prototype.VERTEX_ARRAY_BINDING_OES=34229;qa.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new Bu(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};qa.prototype.createVertexArrayOES=function(){const e=new Bu(this);return this.vertexArrayObjects.push(e),e};qa.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};qa.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Bu&&e.hasBeenBound&&e.ext===this)};qa.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){KP(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,a=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const u=this.currentVertexArrayObject;if(a===u)return;(!a||u.elementArrayBuffer!==a.elementArrayBuffer)&&r.bindBuffer.call(t,34963,u.elementArrayBuffer);let f=this.currentArrayBuffer;const l=Math.max(a?a.maxAttrib:0,u.maxAttrib);for(let x=0;x<=l;x++){const w=u.attribs[x],P=a?a.attribs[x]:null;if((!a||w.enabled!==P.enabled)&&(w.enabled?r.enableVertexAttribArray.call(t,x):r.disableVertexAttribArray.call(t,x)),w.enabled){let M=!1;(!a||w.buffer!==P.buffer)&&(f!==w.buffer&&(r.bindBuffer.call(t,34962,w.buffer),f=w.buffer),M=!0),(M||w.cached!==P.cached)&&r.vertexAttribPointer.call(t,x,w.size,w.type,w.normalized,w.stride,w.offset)}}this.currentArrayBuffer!==f&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function QP(i){if(typeof i.createVertexArray=="function")return;const e=i.getSupportedExtensions;i.getSupportedExtensions=function(){const a=e.call(this)||[];return a.indexOf("OES_vertex_array_object")<0&&a.push("OES_vertex_array_object"),a};const t=i.getExtension;i.getExtension=function(a){const u=t.call(this,a);return u||(a!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new qa(this)),this.__OESVertexArrayObject))}}const C0="OES_element_index",M0="WEBGL_draw_buffers",eI="EXT_disjoint_timer_query",tI="EXT_disjoint_timer_query_webgl2",iI="EXT_texture_filter_anisotropic",L0="WEBGL_debug_renderer_info",nI=35723,rI=4352,sI=36795,oI=34047,aI=37445,lI=37446,Oi=i=>ci(i)?void 0:0,cI={[3074]:i=>ci(i)?void 0:36064,[nI]:i=>ci(i)?void 0:rI,[35977]:Oi,[32937]:Oi,[sI]:(i,e)=>{const t=ci(i)?i.getExtension(tI):i.getExtension(eI);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[aI]:(i,e)=>{const t=i.getExtension(L0);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[lI]:(i,e)=>{const t=i.getExtension(L0);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[oI]:(i,e)=>{const t=i.luma.extensions[iI];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:Oi,[35071]:Oi,[37447]:Oi,[36063]:(i,e)=>{if(!ci(i)){const t=i.getExtension(M0);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:Oi,[35374]:Oi,[35377]:Oi,[34852]:i=>{if(!ci(i)){const e=i.getExtension(M0);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:i=>i.getExtension(C0)?2147483647:65535,[33001]:i=>i.getExtension(C0)?16777216:65535,[33e3]:i=>16777216,[37157]:Oi,[35373]:Oi,[35657]:Oi,[36183]:Oi,[37137]:Oi,[34045]:Oi,[35978]:Oi,[35979]:Oi,[35968]:Oi,[35376]:Oi,[35375]:Oi,[35659]:Oi,[37154]:Oi,[35371]:Oi,[35658]:Oi,[35076]:Oi,[35077]:Oi,[35380]:Oi};function uI(i,e,t){const r=cI[t],a=typeof r=="function"?r(i,e,t):r;return a!==void 0?a:e(t)}const hI="OES_vertex_array_object",Gb="ANGLE_instanced_arrays",dI="WEBGL_draw_buffers",fI="EXT_disjoint_timer_query",pI="EXT_texture_filter_anisotropic",mI="VertexArray requires WebGL2 or OES_vertex_array_object extension";function gI(i,e){return{webgl2:ci(i),ext:i.getExtension(e)}}const Wb={[hI]:{meta:{suffix:"OES"},createVertexArray:()=>{hr(!1,mI)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Gb]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,e){hr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[dI]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{hr(!1)}},[fI]:{meta:{suffix:"EXT"},createQuery:()=>{hr(!1)},deleteQuery:()=>{hr(!1)},beginQuery:()=>{hr(!1)},endQuery:()=>{},getQuery(i,e){return this.getQueryObject(i,e)},getQueryParameter(i,e){return this.getQueryObject(i,e)},getQueryObject:()=>{}}},Np={readBuffer:(i,e,t)=>{ci(i)&&e(t)},getVertexAttrib:(i,e,t,r)=>{const{webgl2:a,ext:u}=gI(i,Gb);let f;switch(r){case 35069:f=a?void 0:!1;break;case 35070:f=!a&&!u?0:void 0;break}return f!==void 0?f:e(t,r)},getProgramParameter:(i,e,t,r)=>{if(!ci(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(i,e,t,r,a)=>{if(!ci(i))switch(a){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(t,r,a)},getTexParameter(i,e,t,r){switch(r){case 34046:const{extensions:a}=i.luma,u=a[pI];r=u&&u.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:uI,hint(i,e,t,r){return e(t,r)}};function _I(i){i.luma=i.luma||{};const{luma:e}=i;return e.polyfilled||(QP(i),yI(i),vI(i,Wb),xI(i,{target:e,target2:i}),e.polyfilled=!0),i}globalThis.polyfillContext=_I;function yI(i){i.luma.extensions={};const e=i.getSupportedExtensions()||[];for(const t of e)i.luma[t]=i.getExtension(t)}function xI(i,e){let{target:t,target2:r}=e;Object.keys(Np).forEach(a=>{if(typeof Np[a]=="function"){const u=i[a]?i[a].bind(i):()=>{},f=Np[a].bind(null,i,u);t[a]=f,r[a]=f}})}function vI(i,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&bI(i,{extension:t,target:i.luma,target2:i})}function bI(i,e){let{extension:t,target:r,target2:a}=e;const u=Wb[t];hr(u);const{meta:f={}}=u,{suffix:l=""}=f,x=i.getExtension(t);for(const w of Object.keys(u)){const P="".concat(w).concat(l);let M=null;w==="meta"||typeof i[w]=="function"||(x&&typeof x[P]=="function"?M=function(){return x[P](...arguments)}:typeof u[w]=="function"&&(M=u[w].bind(r))),M&&(r[w]=M,a[w]=M)}}const Rg={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Bo=(i,e,t)=>e?i.enable(t):i.disable(t),R0=(i,e,t)=>i.hint(t,e),zr=(i,e,t)=>i.pixelStorei(t,e),wI=(i,e)=>{const t=ci(i)?36009:36160;return i.bindFramebuffer(t,e)},TI=(i,e)=>i.bindFramebuffer(36008,e);function Kc(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const EI={[3042]:Bo,[32773]:(i,e)=>i.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(i,e)=>i.clearColor(...e),[3107]:(i,e)=>i.colorMask(...e),[2884]:Bo,[2885]:(i,e)=>i.cullFace(e),[2929]:Bo,[2931]:(i,e)=>i.clearDepth(e),[2932]:(i,e)=>i.depthFunc(e),[2928]:(i,e)=>i.depthRange(...e),[2930]:(i,e)=>i.depthMask(e),[3024]:Bo,[35723]:R0,[36006]:wI,[2886]:(i,e)=>i.frontFace(e),[33170]:R0,[2849]:(i,e)=>i.lineWidth(e),[32823]:Bo,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Bo,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Bo,[3088]:(i,e)=>i.scissor(...e),[2960]:Bo,[2961]:(i,e)=>i.clearStencil(e),[2968]:(i,e)=>i.stencilMaskSeparate(1028,e),[36005]:(i,e)=>i.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(i,e)=>i.viewport(...e),[3333]:zr,[3317]:zr,[37440]:zr,[37441]:zr,[37443]:zr,[3330]:zr,[3332]:zr,[3331]:zr,[36010]:TI,[3314]:zr,[32878]:zr,[3316]:zr,[3315]:zr,[32877]:zr,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{e=Kc(e)?e:[e,e],i.blendEquationSeparate(...e)},blendFunc:(i,e)=>{e=Kc(e)&&e.length===2?[...e,...e]:e,i.blendFuncSeparate(...e)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(...e),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=Kc(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=Kc(e)&&e.length===3?[...e,...e]:e;const[t,r,a,u,f,l]=e;i.stencilFuncSeparate(1028,t,r,a),i.stencilFuncSeparate(1029,u,f,l)},stencilOp:(i,e)=>{e=Kc(e)&&e.length===3?[...e,...e]:e;const[t,r,a,u,f,l]=e;i.stencilOpSeparate(1028,t,r,a),i.stencilOpSeparate(1029,u,f,l)},viewport:(i,e)=>i.viewport(...e)};function sn(i,e,t){return e[i]!==void 0?e[i]:t[i]}const SI={blendEquation:(i,e,t)=>i.blendEquationSeparate(sn(32777,e,t),sn(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(sn(32969,e,t),sn(32968,e,t),sn(32971,e,t),sn(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(sn(32824,e,t),sn(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(sn(32938,e,t),sn(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,sn(2962,e,t),sn(2967,e,t),sn(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,sn(34816,e,t),sn(36003,e,t),sn(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,sn(2964,e,t),sn(2965,e,t),sn(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,sn(34817,e,t),sn(34818,e,t),sn(34819,e,t))},k0={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({[36006]:t,[36010]:t});case 36009:return i({[36006]:t});case 36008:return i({[36010]:t});default:return null}},blendColor:(i,e,t,r,a)=>i({[32773]:new Float32Array([e,t,r,a])}),blendEquation:(i,e)=>i({[32777]:e,[34877]:e}),blendEquationSeparate:(i,e,t)=>i({[32777]:e,[34877]:t}),blendFunc:(i,e,t)=>i({[32969]:e,[32968]:t,[32971]:e,[32970]:t}),blendFuncSeparate:(i,e,t,r,a)=>i({[32969]:e,[32968]:t,[32971]:r,[32970]:a}),clearColor:(i,e,t,r,a)=>i({[3106]:new Float32Array([e,t,r,a])}),clearDepth:(i,e)=>i({[2931]:e}),clearStencil:(i,e)=>i({[2961]:e}),colorMask:(i,e,t,r,a)=>i({[3107]:[e,t,r,a]}),cullFace:(i,e)=>i({[2885]:e}),depthFunc:(i,e)=>i({[2932]:e}),depthRange:(i,e,t)=>i({[2928]:new Float32Array([e,t])}),depthMask:(i,e)=>i({[2930]:e}),frontFace:(i,e)=>i({[2886]:e}),lineWidth:(i,e)=>i({[2849]:e}),polygonOffset:(i,e,t)=>i({[32824]:e,[10752]:t}),sampleCoverage:(i,e,t)=>i({[32938]:e,[32939]:t}),scissor:(i,e,t,r,a)=>i({[3088]:new Int32Array([e,t,r,a])}),stencilMask:(i,e)=>i({[2968]:e,[36005]:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({[2962]:e,[2967]:t,[2963]:r,[34816]:e,[36003]:t,[36004]:r}),stencilFuncSeparate:(i,e,t,r,a)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:a}),stencilOp:(i,e,t,r)=>i({[2964]:e,[2965]:t,[2966]:r,[34817]:e,[34818]:t,[34819]:r}),stencilOpSeparate:(i,e,t,r,a)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:a}),viewport:(i,e,t,r,a)=>i({[2978]:[e,t,r,a]})},Rs=(i,e)=>i.isEnabled(e),D0={[3042]:Rs,[2884]:Rs,[2929]:Rs,[3024]:Rs,[32823]:Rs,[32926]:Rs,[32928]:Rs,[3089]:Rs,[2960]:Rs,[35977]:Rs};function Hb(i){for(const e in i)return!1;return!0}function AI(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&i.length===e.length){for(let a=0;a<i.length;++a)if(i[a]!==e[a])return!1;return!0}return!1}function z0(i,e){const t=i[e].bind(i);i[e]=function(){const a=arguments.length<=0?void 0:arguments[0];return a in i.state.cache?i.state.enable?i.state.cache[a]:t(...arguments):t(...arguments)},Object.defineProperty(i[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function PI(i,e,t){const r=i[e].bind(i);i[e]=function(){for(var u=arguments.length,f=new Array(u),l=0;l<u;l++)f[l]=arguments[l];const{valueChanged:x,oldValue:w}=t(i.state._updateCache,...f);return x&&r(...f),w},Object.defineProperty(i[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function II(i){const e=i.useProgram.bind(i);i.useProgram=function(r){i.state.program!==r&&(e(r),i.state.program=r)}}class CI{constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?LI(e):Object.assign({},Rg),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){hr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];uo(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const u in e){hr(u!==void 0);const f=e[u],l=this.cache[u];AI(f,l)||(t=!0,r=l,a&&!(u in a)&&(a[u]=l),this.cache[u]=f)}return{valueChanged:t,oldValue:r}}}function qb(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(hr(r!==void 0),!i.state){const{polyfillContext:a}=globalThis;a&&a(i),i.state=new CI(i,{copyState:r}),II(i);for(const u in k0){const f=k0[u];PI(i,u,f)}z0(i,"getParameter"),z0(i,"isEnabled")}return i.state.enable=t,i}function MI(i){i.state||qb(i,{copyState:!1}),i.state.push()}function O0(i){hr(i.state),i.state.pop()}function uo(i,e){if(hr(ff(i),"setParameters requires a WebGL context"),Hb(e))return;const t={};for(const a in e){const u=Number(a),f=EI[a];f&&(typeof f=="string"?t[f]=!0:f(i,e[a],u))}const r=i.state&&i.state.cache;if(r)for(const a in t){const u=SI[a];u(i,e,r)}}function LI(i,e){if(e=e||Rg,typeof e=="number"){const a=e,u=D0[a];return u?u(i,a):i.getParameter(a)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const a of t){const u=D0[a];r[a]=u?u(i,Number(a)):i.getParameter(Number(a))}return r}function RI(i){uo(i,Rg)}function gs(i,e,t){if(Hb(e))return t(i);const{nocatch:r=!0}=e;MI(i),uo(i,e);let a;if(r)a=t(i),O0(i);else try{a=t(i)}finally{O0(i)}return a}function Ul(i){const{luma:e}=i;if(i.canvas&&e){const{clientWidth:t}=e.canvasSizeInfo;return t?i.drawingBufferWidth/t:1}return 1}function Up(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=Ul(i),a=i.drawingBufferWidth,u=i.drawingBufferHeight;return DI(e,r,a,u,t)}function kI(i){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?e:1}function DI(i,e,t,r,a){const u=F0(i[0],e,t);let f=B0(i[1],e,r,a),l=F0(i[0]+1,e,t);const x=l===t-1?l:l-1;l=B0(i[1]+1,e,r,a);let w;return a?(l=l===0?l:l+1,w=f,f=l):w=l===r-1?l:l-1,{x:u,y:f,width:Math.max(x-u+1,1),height:Math.max(w-f+1,1)}}function F0(i,e,t){return Math.min(Math.round(i*e),t-1)}function B0(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const kg=po(),zI=kg&&typeof document<"u",$b={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Zb(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hr(kg,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},$b,i);const{width:e,height:t}=i;function r(l){if(i.throwOnError)throw new Error(l);return console.error(l),null}i.onError=r;let a;const{canvas:u}=i,f=NI({canvas:u,width:e,height:t,onError:r});return a=BI(f,i),a?(a=Dg(a,i),UI(a),a):null}function Dg(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||VI(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},e=Object.assign({},$b,e);const{manageState:t,debug:r}=e;return t&&qb(i,{copyState:!1,log:function(){for(var a=arguments.length,u=new Array(a),f=0;f<a;f++)u[f]=arguments[f];return Rt.log(1,...u)()}}),kg&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,e),Rt.level=Math.max(Rt.level,1)):Rt.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function OI(i){const e=i.getParameter(7936),t=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),a=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),u=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:a||e,renderer:u||t,vendorMasked:e,rendererMasked:t,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function FI(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=kI(e.useDevicePixels);jI(i,r,e);return}const t=i.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function BI(i,e){const{onError:t}=e;let r=null;const a=x=>r=x.statusMessage||r;i.addEventListener("webglcontextcreationerror",a,!1);const{webgl1:u=!0,webgl2:f=!0}=e;let l=null;return f&&(l=l||i.getContext("webgl2",e),l=l||i.getContext("experimental-webgl2",e)),u&&(l=l||i.getContext("webgl",e),l=l||i.getContext("experimental-webgl",e)),i.removeEventListener("webglcontextcreationerror",a,!1),l?(e.onContextLost&&i.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&i.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):t("Failed to create ".concat(f&&!u?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function NI(i){let{canvas:e,width:t=800,height:r=600,onError:a}=i,u;return typeof e=="string"?(zI&&document.readyState==="complete"||a("createGLContext called on canvas '".concat(e,"' before page was loaded")),u=document.getElementById(e)):e?u=e:(u=document.createElement("canvas"),u.id="lumagl-canvas",u.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",u.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(u,document.body.firstChild)),u}function UI(i){const e=ci(i)?"WebGL2":"WebGL1",t=OI(i),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",a=i.debug?" debug":"";Rt.info(1,"".concat(e).concat(a," context ").concat(r))()}function VI(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function jI(i,e,t){let r="width"in t?t.width:i.canvas.clientWidth,a="height"in t?t.height:i.canvas.clientHeight;(!r||!a)&&(Rt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=i.canvas.width||1,a=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const u=i.luma.canvasSizeInfo;if(u.clientWidth!==r||u.clientHeight!==a||u.devicePixelRatio!==e){let f=e;const l=Math.floor(r*f),x=Math.floor(a*f);i.canvas.width=l,i.canvas.height=x,(i.drawingBufferWidth!==l||i.drawingBufferHeight!==x)&&(Rt.warn("Device pixel ratio clamped")(),f=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/a),i.canvas.width=Math.floor(r*f),i.canvas.height=Math.floor(a*f)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:a,devicePixelRatio:e})}}const mu="8.5.18",GI="set luma.log.level=1 (or higher) to trace rendering";class WI{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Pg({id:e})),this.stats.get(e)}}const Fa=new WI;if(globalThis.luma&&globalThis.luma.VERSION!==mu)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(mu));globalThis.luma||(po()&&Rt.log(1,"luma.gl ".concat(mu," - ").concat(GI))(),globalThis.luma=globalThis.luma||{VERSION:mu,version:mu,log:Rt,stats:Fa,globals:{modules:{},nodeIO:{}}});function HI(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function qI(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function gt(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}function Vp(i,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=i[e];return gt(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Xo(i,e){e=Number(e);for(const t in i)if(i[t]===e)return"GL.".concat(t);return String(e)}const jp={};function ea(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";jp[i]=jp[i]||1;const e=jp[i]++;return"".concat(i,"-").concat(e)}function N0(i){return gt(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function Vl(i){let e=!0;for(const t in i){e=!1;break}return e}function Xb(i,e,t,r){const a="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),u=Object.getPrototypeOf(i);r.forEach(f=>{u.methodName||(u[f]=()=>{throw Rt.removed("Calling removed method ".concat(e,".").concat(f,": "),a)(),new Error(f)})})}const wl="Resource subclass must define virtual methods";let mo=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pf(e);const{id:r,userData:a={}}=t;this.gl=e,this.gl2=e,this.id=r||ea(this[Symbol.toStringTag]),this.userData=a,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Vp(this.gl,e),gt(e);const a=(this.constructor.PARAMETERS||{})[e];if(a){const u=ci(this.gl);if(!((!("webgl2"in a)||u)&&(!("extension"in a)||this.gl.getExtension(a.extension)))){const l=a.webgl1,x="webgl2"in a?a.webgl2:a.webgl1;return u?x:l}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,a=this.constructor.PARAMETERS||{},u=ci(this.gl),f={},l=t||Object.keys(a);for(const x of l){const w=a[x];if(w&&(!("webgl2"in w)||u)&&(!("extension"in w)||this.gl.getExtension(w.extension))){const M=r?Xo(this.gl,x):x;f[M]=this.getParameter(x,e),r&&w.type==="GLenum"&&(f[M]=Xo(this.gl,f[M]))}}return f}setParameter(e,t){e=Vp(this.gl,e),gt(e);const a=(this.constructor.PARAMETERS||{})[e];if(a){const u=ci(this.gl);if(!((!("webgl2"in a)||u)&&(!("extension"in a)||this.gl.getExtension(a.extension))))throw new Error("Parameter not available on this platform");a.type==="GLenum"&&(t=Vp(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return Xb(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(wl)}_deleteHandle(){throw new Error(wl)}_bindHandle(e){throw new Error(wl)}_getOptsFromHandle(){throw new Error(wl)}_getParameter(e,t){throw new Error(wl)}_setParameter(e,t){throw new Error(wl)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=Fa.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Fa.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const a=Fa.get("Memory Usage".concat(r));a.get("GPU Memory").addCount(e),a.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=Fa.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const $I="Failed to deduce GL constant from typed array";function Rm(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error($I)}}function Su(i){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function ZI(i){let{data:e,width:t,height:r,bytesPerPixel:a=4,temp:u}=i;const f=t*a;u=u||new Uint8Array(f);for(let l=0;l<r/2;++l){const x=l*f,w=(r-l-1)*f;u.set(e.subarray(x,x+f)),e.copyWithin(x,w,w+f),e.set(u,w)}}function XI(i){let{data:e,width:t,height:r}=i;const a=Math.round(t/2),u=Math.round(r/2),f=new Uint8Array(a*u*4);for(let l=0;l<u;l++)for(let x=0;x<a;x++)for(let w=0;w<4;w++)f[(l*a+x)*4+w]=e[(l*2*t+x*2)*4+w];return{data:f,width:a,height:u}}function km(i,e,t){const{removedProps:r={},deprecatedProps:a={},replacedProps:u={}}=t;for(const l in r)if(l in e){const w=r[l]?"".concat(i,".").concat(r[l]):"N/A";Rt.removed("".concat(i,".").concat(l),w)()}for(const l in a)if(l in e){const x=a[l];Rt.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(x))()}let f=null;for(const l in u)if(l in e){const x=u[l];Rt.deprecated("".concat(i,".").concat(l),"".concat(i,".").concat(x))(),f=f||Object.assign({},e),f[x]=e[l],delete f[l]}return f||e}const YI={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},KI={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Nr{static getBytesPerElement(e){return Su(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return gt(e.size),Su(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Nr(YI,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(a=>this._assign(a)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Nr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Nr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=km("Accessor",e,KI),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const U0=10,Yb={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},JI={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Yb},QI={removedProps:Yb};class Ii extends mo{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Nr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Nr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=km("Buffer",e,JI),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=km("Buffer",e,QI),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Nr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:a=0}=e,u=e.byteLength||e.length;gt(t);const f=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(f,this.handle),a!==0||u!==void 0?(Kn(this.gl),this.gl.bufferSubData(this.target,r,t,a,u)):this.gl.bufferSubData(f,r,t),this.gl.bindBuffer(f,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:a=0,size:u}=e;const{gl:f}=this;return Kn(f),f.bindBuffer(36662,t.handle),f.bindBuffer(36663,this.handle),f.copyBufferSubData(36662,36663,r,a,u),f.bindBuffer(36662,null),f.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:a=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Kn(this.gl);const u=Su(this.accessor.type||5126,{clamped:!1}),f=this._getAvailableElementCount(t),l=r;let x,w;e?(w=e.length,x=w-l):(x=Math.min(f,a||f),w=l+x);const P=Math.min(f,x);return a=a||P,gt(a<=P),e=e||new u(w),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,a),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:a}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?a!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,a):(gt(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(U0,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;gt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const a=this._getTarget();this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,r,this.usage),this.gl.bufferSubData(a,t,e),this.gl.bindBuffer(a,null),this.debugData=e.slice(0,U0),this.bytesUsed=r,this._trackAllocatedMemory(r);const u=Rm(e);return gt(u),this.setAccessor(new Nr(this.accessor,{type:u})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;gt(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const a=this._getTarget();return this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,r,t),this.gl.bindBuffer(a,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=Su(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new Nr(this.accessor,{type:Rm(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return Rt.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Rt.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Rt.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Rt.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Nr(this.accessor,e),this}}const zg={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},Kb={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},Jb={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function eC(i,e){const t=zg[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=ci(i)&&t.gl2||t.gl1;return typeof r=="string"?i.getExtension(r):r}function tC(i,e){const t=zg[e];switch(t&&t.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const iC=[9729,9728],V0=globalThis.WebGLBuffer||function(){};class Va extends mo{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:a}=t;let u=!0;return r&&(u=u&&eC(e,r),u=u&&(!a||tC(e,r))),u}constructor(e,t){const{id:r=ea("texture"),handle:a,target:u}=t;super(e,{id:r,handle:a}),this.target=u,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(ve=>this.initialize(Object.assign({},e,{pixels:ve,data:ve}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:a=null,format:u=6408,border:f=0,recreate:l=!1,parameters:x={},pixelStore:w={},textureUnit:P=void 0}=e;t||(t=a);let{width:M,height:C,dataFormat:V,type:Y,compressed:J=!1,mipmaps:ce=!0}=e;const{depth:pe=0}=e;return{width:M,height:C,compressed:J,dataFormat:V,type:Y}=this._deduceParameters({format:u,type:Y,dataFormat:V,compressed:J,data:t,width:M,height:C}),this.width=M,this.height=C,this.depth=pe,this.format=u,this.type=Y,this.dataFormat=V,this.border=f,this.textureUnit=P,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ce&&this._isNPOT()&&(Rt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ce=!1,this._updateForNPOT(x)),this.mipmaps=ce,this.setImageData({data:t,width:M,height:C,depth:pe,format:u,type:Y,dataFormat:V,border:f,mipmaps:ce,parameters:w,compressed:J}),ce&&this.generateMipmap(),this.setParameters(x),l&&(this.data=t),r&&(this._video={video:t,parameters:x,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:a=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:a}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Rt.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),gs(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:a=0,format:u=this.format,border:f=this.border,offset:l=0,parameters:x={}}=e;let{data:w=null,type:P=this.type,width:M=this.width,height:C=this.height,dataFormat:V=this.dataFormat,compressed:Y=!1}=e;w||(w=r),{type:P,dataFormat:V,compressed:Y,width:M,height:C}=this._deduceParameters({format:u,type:P,dataFormat:V,compressed:Y,data:w,width:M,height:C});const{gl:J}=this;J.bindTexture(this.target,this.handle);let ce=null;({data:w,dataType:ce}=this._getDataType({data:w,compressed:Y}));let pe,ve=0;if(gs(this.gl,x,()=>{switch(ce){case"null":J.texImage2D(t,a,u,M,C,f,V,P,w);break;case"typed-array":J.texImage2D(t,a,u,M,C,f,V,P,w,l);break;case"buffer":pe=Kn(J),pe.bindBuffer(35052,w.handle||w),pe.texImage2D(t,a,u,M,C,f,V,P,l),pe.bindBuffer(35052,null);break;case"browser-object":ci(J)?J.texImage2D(t,a,u,M,C,f,V,P,w):J.texImage2D(t,a,u,V,P,w);break;case"compressed":for(const[he,Ee]of w.entries())J.compressedTexImage2D(t,he,Ee.format,Ee.width,Ee.height,f,Ee.data),ve+=Ee.levelSize;break;default:gt(!1,"Unknown image data type")}}),ce==="compressed")this._trackAllocatedMemory(ve,"Texture");else if(w&&w.byteLength)this._trackAllocatedMemory(w.byteLength,"Texture");else{const he=Kb[this.dataFormat]||4,Ee=Jb[this.type]||1;this._trackAllocatedMemory(this.width*this.height*he*Ee,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:a=null,x:u=0,y:f=0,width:l=this.width,height:x=this.height,level:w=0,format:P=this.format,type:M=this.type,dataFormat:C=this.dataFormat,compressed:V=!1,offset:Y=0,border:J=this.border,parameters:ce={}}=e;if({type:M,dataFormat:C,compressed:V,width:l,height:x}=this._deduceParameters({format:P,type:M,dataFormat:C,compressed:V,data:a,width:l,height:x}),gt(this.depth===0,"texSubImage not supported for 3D textures"),a||(a=r),a&&a.data){const pe=a;a=pe.data,l=pe.shape[0],x=pe.shape[1]}a instanceof Ii&&(a=a.handle),this.gl.bindTexture(this.target,this.handle),gs(this.gl,ce,()=>{if(V)this.gl.compressedTexSubImage2D(t,w,u,f,l,x,P,a);else if(a===null)this.gl.texSubImage2D(t,w,u,f,l,x,C,M,null);else if(ArrayBuffer.isView(a))this.gl.texSubImage2D(t,w,u,f,l,x,C,M,a,Y);else if(a instanceof V0){const pe=Kn(this.gl);pe.bindBuffer(35052,a),pe.texSubImage2D(t,w,u,f,l,x,C,M,Y),pe.bindBuffer(35052,null)}else ci(this.gl)?Kn(this.gl).texSubImage2D(t,w,u,f,l,x,C,M,a):this.gl.texSubImage2D(t,w,u,f,C,M,a)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Rt.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof Ii?{data:t.handle,dataType:"buffer"}:t instanceof V0?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:a,height:u,dataFormat:f,type:l,compressed:x}=e;const w=zg[t];return f=f||w&&w.dataFormat,l=l||w&&w.types[0],x=x||w&&w.compressed,{width:a,height:u}=this._deduceImageSize(r,a,u),{dataFormat:f,type:l,compressed:x,width:a,height:u,format:t,data:r}}_deduceImageSize(e,t,r){let a;return typeof ImageData<"u"&&e instanceof ImageData?a={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?a={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?a={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?a={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?a={width:e.videoWidth,height:e.videoHeight}:e?a={width:t,height:r}:a={width:t>=0?t:1,height:r>=0?r:1},gt(a,"Could not deduced texture size"),gt(t===void 0||a.width===t,"Deduced texture width does not match supplied width"),gt(r===void 0||a.height===r,"Deduced texture height does not match supplied height"),a}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:gt(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ci(this.gl)||!this.width||!this.height?!1:!N0(this.width)||!N0(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:iC.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let nC="";function rC(i,e){return gt(typeof i=="string"),i=nC+i,new Promise((t,r)=>{try{const a=new Image;a.onload=()=>t(a),a.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),a.crossOrigin=e&&e.crossOrigin||"anonymous",a.src=i}catch(a){r(a)}})}class jr extends Va{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Va.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pf(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:rC(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const Dm=[34069,34070,34071,34072,34073,34074];class Qb extends Va{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pf(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:a=0,y:u=0,mipmapLevel:f=0}=e;return this._subImage({target:t,data:r,x:a,y:u,mipmapLevel:f})}async setCubeMapImageData(e){let{width:t,height:r,pixels:a,data:u,border:f=0,format:l=6408,type:x=5121}=e;const{gl:w}=this,P=a||u,M=await Promise.all(Dm.map(C=>{const V=P[C];return Promise.all(Array.isArray(V)?V:[V])}));this.bind(),Dm.forEach((C,V)=>{M[V].length>1&&this.opts.mipmaps!==!1&&Rt.warn("".concat(this.id," has mipmap and multiple LODs."))(),M[V].forEach((Y,J)=>{t&&r?w.texImage2D(C,J,l,t,r,f,l,x,Y):w.texImage2D(C,J,l,l,x,Y)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:a,pixels:u,data:f,border:l=0,format:x=6408,type:w=5121}=e,{gl:P}=this,M=u||f;return this.bind(),M instanceof Promise?M.then(C=>this.setImageDataForFace(Object.assign({},e,{face:t,data:C,pixels:C}))):this.width||this.height?P.texImage2D(t,0,x,r,a,l,x,w,M):P.texImage2D(t,0,x,x,w,M),this}}Qb.FACES=Dm;class sC extends Va{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return ci(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Kn(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:a,height:u,depth:f=1,border:l=0,format:x,type:w=5121,offset:P=0,data:M,parameters:C={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),gs(this.gl,C,()=>{ArrayBuffer.isView(M)&&this.gl.texImage3D(this.target,t,r,a,u,f,l,x,w,M),M instanceof Ii&&(this.gl.bindBuffer(35052,M.handle),this.gl.texImage3D(this.target,t,r,a,u,f,l,x,w,P))}),M&&M.byteLength)this._trackAllocatedMemory(M.byteLength,"Texture");else{const V=Kb[this.dataFormat]||4,Y=Jb[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*V*Y,"Texture")}return this.loaded=!0,this}}const Ma="EXT_color_buffer_float",j0={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:Ma,bpp:2},[33327]:{gl2:Ma,bpp:4},[34842]:{gl2:Ma,bpp:8},[33326]:{gl2:Ma,bpp:4},[33328]:{gl2:Ma,bpp:8},[34836]:{gl2:Ma,bpp:16},[35898]:{gl2:Ma,bpp:4}};function oC(i,e,t){const r=t[e];if(!r)return!1;const a=ci(i)&&r.gl2||r.gl1;return typeof a=="string"?i.getExtension(a):a}class Il extends mo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||oC(e,t,j0)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:a=1,samples:u=0}=e;return gt(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),u!==0&&ci(this.gl)?this.gl.renderbufferStorageMultisample(36161,u,t,r,a):this.gl.renderbufferStorage(36161,t,r,a),this.format=t,this.width=r,this.height=a,this.samples=u,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*j0[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const aC=256,lC=1024,cC=16384,G0=6144,W0=6145,H0=6146,q0=34041,e1="clear: bad arguments";function Og(i){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:a=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u={};e&&(u.framebuffer=e);let f=0;t&&(f|=cC,t!==!0&&(u.clearColor=t)),r&&(f|=aC,r!==!0&&(u.clearDepth=r)),a&&(f|=lC,r!==!0&&(u.clearStencil=r)),gt(f!==0,e1),gs(i,u,()=>{i.clear(f)})}function uC(i){let{framebuffer:e=null,buffer:t=G0,drawBuffer:r=0,value:a=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Kn(i),gs(i,{framebuffer:e},()=>{switch(t){case G0:switch(a.constructor){case Int32Array:i.clearBufferiv(t,r,a);break;case Uint32Array:i.clearBufferuiv(t,r,a);break;case Float32Array:default:i.clearBufferfv(t,r,a)}break;case W0:i.clearBufferfv(W0,0,[a]);break;case H0:i.clearBufferiv(H0,0,[a]);break;case q0:const[u,f]=a;i.clearBufferfi(q0,0,u,f);break;default:gt(!1,e1)}})}function hC(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return gt(!1),0}}function mf(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:a=6408}=e;let{sourceAttachment:u=36064,target:f=null,sourceWidth:l,sourceHeight:x,sourceType:w}=e;const{framebuffer:P,deleteFramebuffer:M}=t1(i);gt(P);const{gl:C,handle:V,attachments:Y}=P;l=l||P.width,x=x||P.height,u===36064&&V===null&&(u=1028),gt(Y[u]),w=w||Y[u].type,f=fC(f,w,a,l,x),w=w||Rm(f);const J=C.bindFramebuffer(36160,V);return C.readPixels(t,r,l,x,a,w,f),C.bindFramebuffer(36160,J||null),M&&P.delete(),f}function $0(i){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=mf(i,{sourceAttachment:e}),{width:a,height:u}=i;for(;u>t;)({data:r,width:a,height:u}=XI({data:r,width:a,height:u}));ZI({data:r,width:a,height:u});const f=document.createElement("canvas");f.width=a,f.height=u;const l=f.getContext("2d"),x=l.createImageData(a,u);return x.data.set(r),l.putImageData(x,0,0),f.toDataURL()}function dC(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:a=0,targetMipmaplevel:u=0,targetInternalFormat:f=6408}=t;let{targetX:l,targetY:x,targetZ:w,width:P,height:M}=t;const{framebuffer:C,deleteFramebuffer:V}=t1(i);gt(C);const{gl:Y,handle:J}=C,ce=typeof l<"u"||typeof x<"u"||typeof w<"u";l=l||0,x=x||0,w=w||0;const pe=Y.bindFramebuffer(36160,J);gt(e);let ve=null;if(e instanceof Va&&(ve=e,P=Number.isFinite(P)?P:ve.width,M=Number.isFinite(M)?M:ve.height,ve.bind(0),e=ve.target),!ce)Y.copyTexImage2D(e,u,f,r,a,P,M,0);else switch(e){case 3553:case 34067:Y.copyTexSubImage2D(e,u,l,x,r,a,P,M);break;case 35866:case 32879:Kn(Y).copyTexSubImage3D(e,u,l,x,w,r,a,P,M);break}return ve&&ve.unbind(),Y.bindFramebuffer(36160,pe||null),V&&C.delete(),ve}function t1(i){return i instanceof Pn?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:TC(i),deleteFramebuffer:!0}}function fC(i,e,t,r,a){if(i)return i;e=e||5121;const u=Su(e,{clamped:!1}),f=hC(t);return new u(r*a*f)}const Ui={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function pC(i){const e=new jr(i,{format:6408,type:5126,dataFormat:6408}),t=new Pn(i,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const i1={[Ui.WEBGL2]:[!1,!0],[Ui.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Ui.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Ui.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Ui.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Ui.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Ui.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Ui.FLOAT_BLEND]:["EXT_float_blend"],[Ui.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Ui.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Ui.TEXTURE_FLOAT]:["OES_texture_float",!0],[Ui.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Ui.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Ui.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Ui.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Ui.COLOR_ATTACHMENT_RGBA32F]:[pC,"EXT_color_buffer_float"],[Ui.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Ui.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Ui.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Ui.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Ui.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Ui.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},mC=2;function gC(i,e){return Fg(i,e)}function Fg(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>n1(i,t))}function _C(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const e in i1)i.luma.caps[e]===void 0&&(i.luma.caps[e]=n1(i,e));return i.luma.caps}function n1(i,e){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[e]===void 0&&(i.luma.caps[e]=yC(i,e)),i.luma.caps[e]||Rt.log(mC,"Feature: ".concat(e," not supported"))(),i.luma.caps[e]}function yC(i,e){const t=i1[e];gt(t,e);let r;const a=ci(i)&&t[1]||t[0];if(typeof a=="function")r=a(i);else if(Array.isArray(a)){r=!0;for(const u of a)r=r&&Boolean(i.getExtension(u))}else typeof a=="string"?r=Boolean(i.getExtension(a)):typeof a=="boolean"?r=a:gt(!1);return r}const Z0="Multiple render targets not supported";class Pn extends mo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:a}=t;let u=!0;return r&&(u=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),a&&(u=u&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),u}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Pn(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Kn(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Kn(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:a=null,color:u=!0,depth:f=!0,stencil:l=!1,check:x=!0,readBuffer:w=void 0,drawBuffers:P=void 0}=e;if(gt(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,a)for(const M in a){const C=a[M];(Array.isArray(C)?C[0]:C).resize({width:t,height:r})}else a=this._createDefaultAttachments(u,f,l,t,r);this.update({clearAttachments:!0,attachments:a,readBuffer:w,drawBuffers:P}),a&&x&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:a,clearAttachments:u=!1,resizeAttachments:f=!0}=e;this.attach(t,{clearAttachments:u,resizeAttachments:f});const{gl:l}=this,x=l.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),a&&this._setDrawBuffers(a),l.bindFramebuffer(36160,x||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return gt(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&Rt.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const a in this.attachments)this.attachments[a].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a={};t&&Object.keys(this.attachments).forEach(f=>{a[f]=null}),Object.assign(a,e);const u=this.gl.bindFramebuffer(36160,this.handle);for(const f in a){gt(f!==void 0,"Misspelled framebuffer binding point?");const l=Number(f),x=a[l];let w=x;if(!w)this._unattach(l);else if(w instanceof Il)this._attachRenderbuffer({attachment:l,renderbuffer:w});else if(Array.isArray(x)){const[P,M=0,C=0]=x;w=P,this._attachTexture({attachment:l,texture:P,layer:M,level:C})}else this._attachTexture({attachment:l,texture:w,layer:0,level:0});r&&w&&w.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(f=>!this.attachments[f]).forEach(f=>{delete this.attachments[f]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(vC(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:a,drawBuffers:u=[]}=e,f=this.gl.bindFramebuffer(36160,this.handle);return(t||r||a)&&Og(this.gl,{color:t,depth:r,stencil:a}),u.forEach((l,x)=>{uC(this.gl,{drawBuffer:x,value:l})}),this.gl.bindFramebuffer(36160,f||null),this}readPixels(){return Rt.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Rt.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Rt.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Rt.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Rt.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Rt.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:a=0,width:u,height:f}=e;const l=Kn(this.gl),x=l.bindFramebuffer(36008,this.handle);return r===0&&a===0&&u===void 0&&f===void 0?l.invalidateFramebuffer(36008,t):l.invalidateFramebuffer(36008,t,r,a,u,f),l.bindFramebuffer(36008,x),this}getAttachmentParameter(e,t,r){let a=this._getAttachmentParameterFallback(t);return a===null&&(this.gl.bindFramebuffer(36160,this.handle),a=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&a>1e3&&(a=Xo(this.gl,a)),a}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const a={};for(const u of r){const f=t?Xo(this.gl,u):u;a[f]=this.getAttachmentParameter(e,u,t)}return a}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const a of t){const u=Number(a),f=e?Xo(this.gl,u):u;r[f]=this.getAttachmentParameters(u,e)}return r}show(){return typeof window<"u"&&window.open($0(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Rt.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=$0(this,{targetMaxHeight:100});return Rt.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,a,u){let f=null;return e&&(f=f||{},f[36064]=new jr(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:a,height:u,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(f[36064])),t&&r?(f=f||{},f[33306]=new Il(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:a,height:111}),this.ownResources.push(f[33306])):t?(f=f||{},f[36096]=new Il(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:a,height:u}),this.ownResources.push(f[36096])):r&&gt(!1),f}_unattach(e){const t=this.attachments[e];t&&(t instanceof Il?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:a}=this;a.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:a,level:u}=e;const{gl:f}=this;switch(f.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Kn(f).framebufferTextureLayer(36160,t,r.target,u,a);break;case 34067:const x=xC(a);f.framebufferTexture2D(36160,t,x,r.handle,u);break;case 3553:f.framebufferTexture2D(36160,t,3553,r.handle,u);break;default:gt(!1,"Illegal texture type")}f.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=ZP(this.gl);t?t.readBuffer(e):gt(e===36064||e===1029,Z0),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=Kn(t);if(r)r.drawBuffers(e);else{const a=t.getExtension("WEBGL_draw_buffers");a?a.drawBuffersWEBGL(e):gt(e.length===1&&(e[0]===36064||e[0]===1029),Z0)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=_C(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function xC(i){return i<34069?i+34069:i}function vC(i){return(Pn.STATUS||{})[i]||"Framebuffer error ".concat(i)}const bC=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Pn.ATTACHMENT_PARAMETERS=bC;function wC(i,e){gt(i instanceof jr||i instanceof Qb||i instanceof sC);const t=i.constructor,{gl:r,width:a,height:u,format:f,type:l,dataFormat:x,border:w,mipmaps:P}=i,M=Object.assign({width:a,height:u,format:f,type:l,dataFormat:x,border:w,mipmaps:P},e);return new t(r,M)}function TC(i,e){const{gl:t,width:r,height:a,id:u}=i;return new Pn(t,Object.assign({},e,{id:"framebuffer-for-".concat(u),width:r,height:a,attachments:{[36064]:i}}))}function xd(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(t);return r?r[1]:e}const EC=35632,SC=35633;function AC(i){switch(i){case EC:return"fragment";case SC:return"vertex";default:return"unknown type"}}function PC(i,e,t,r){const a=i.split(/\r?\n/),u={},f={},l=r||xd(e)||"(unnamed)",x="".concat(AC(t)," shader ").concat(l);for(let P=0;P<a.length;P++){const M=a[P];if(M.length<=1)continue;const C=M.split(":"),V=C[0],Y=parseInt(C[2],10);if(isNaN(Y))throw new Error("GLSL compilation error in ".concat(x,": ").concat(i));V!=="WARNING"?u[Y]=M:f[Y]=M}const w=IC(e);return{shaderName:x,errors:X0(u,w),warnings:X0(f,w)}}function X0(i,e){let t="";for(let r=0;r<e.length;r++){const a=e[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(t+="".concat(a,`
`),i[r+1])){const u=i[r+1],f=u.split(":",3),l=f[0],x=parseInt(f[1],10)||0,w=u.substring(f.join(":").length+1).trim();t+=r1("^^^ ".concat(l,": ").concat(w,`

`),x)}}return t}function IC(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),a=String(r.length+e-1).length;return r.map((u,f)=>{const l=String(f+e),x=l.length;return r1(l,a-x)+t+u})}function r1(i,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(i)}function s1(i){let e=100;const t=i.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const CC="Shader: GLSL source code must be a JavaScript string";class Au extends mo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return gt(!1),"unknown"}}constructor(e,t){pf(e),gt(typeof t.source=="string",CC);const r=xd(t.source,null)||t.id||ea("unnamed ".concat(Au.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=xd(t,null);r&&(this.id=ea(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Au.getTypeName(this.shaderType),":").concat(this.id)}getName(){return xd(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:a,errors:u,warnings:f}=PC(r,this.source,this.shaderType,this.id);throw Rt.error("GLSL compilation errors in ".concat(a,`
`).concat(u))(),Rt.warn("GLSL compilation warnings in ".concat(a,`
`).concat(f))(),new Error("GLSL compilation errors in ".concat(a))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Gp extends Au{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class Wp extends Au{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const MC={[5126]:Ni.bind(null,"uniform1fv",Or,1,Zn),[35664]:Ni.bind(null,"uniform2fv",Or,2,Zn),[35665]:Ni.bind(null,"uniform3fv",Or,3,Zn),[35666]:Ni.bind(null,"uniform4fv",Or,4,Zn),[5124]:Ni.bind(null,"uniform1iv",No,1,Zn),[35667]:Ni.bind(null,"uniform2iv",No,2,Zn),[35668]:Ni.bind(null,"uniform3iv",No,3,Zn),[35669]:Ni.bind(null,"uniform4iv",No,4,Zn),[35670]:Ni.bind(null,"uniform1iv",No,1,Zn),[35671]:Ni.bind(null,"uniform2iv",No,2,Zn),[35672]:Ni.bind(null,"uniform3iv",No,3,Zn),[35673]:Ni.bind(null,"uniform4iv",No,4,Zn),[35674]:Ni.bind(null,"uniformMatrix2fv",Or,4,so),[35675]:Ni.bind(null,"uniformMatrix3fv",Or,9,so),[35676]:Ni.bind(null,"uniformMatrix4fv",Or,16,so),[35678]:On,[35680]:On,[5125]:Ni.bind(null,"uniform1uiv",Qh,1,Zn),[36294]:Ni.bind(null,"uniform2uiv",Qh,2,Zn),[36295]:Ni.bind(null,"uniform3uiv",Qh,3,Zn),[36296]:Ni.bind(null,"uniform4uiv",Qh,4,Zn),[35685]:Ni.bind(null,"uniformMatrix2x3fv",Or,6,so),[35686]:Ni.bind(null,"uniformMatrix2x4fv",Or,8,so),[35687]:Ni.bind(null,"uniformMatrix3x2fv",Or,6,so),[35688]:Ni.bind(null,"uniformMatrix3x4fv",Or,12,so),[35689]:Ni.bind(null,"uniformMatrix4x2fv",Or,8,so),[35690]:Ni.bind(null,"uniformMatrix4x3fv",Or,12,so),[35678]:On,[35680]:On,[35679]:On,[35682]:On,[36289]:On,[36292]:On,[36293]:On,[36298]:On,[36299]:On,[36300]:On,[36303]:On,[36306]:On,[36307]:On,[36308]:On,[36311]:On},LC={},RC={},kC={},Y0=[0];function Bg(i,e,t,r){e===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(Y0[0]=i,i=Y0);const a=i.length;if(a%e&&Rt.warn("Uniform size should be multiples of ".concat(e),i)(),i instanceof t)return i;let u=r[a];u||(u=new t(a),r[a]=u);for(let f=0;f<a;f++)u[f]=i[f];return u}function Or(i,e){return Bg(i,e,Float32Array,LC)}function No(i,e){return Bg(i,e,Int32Array,RC)}function Qh(i,e){return Bg(i,e,Uint32Array,kC)}function K0(i,e,t){const r=MC[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,i,e)}function DC(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=i.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function zC(i,e,t){for(const r in i){const a=i[r];if((!t||Boolean(t[r]))&&!OC(a))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),a),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function OC(i){return Array.isArray(i)||ArrayBuffer.isView(i)?BC(i):isFinite(i)||i===!0||i===!1||i instanceof Va||i instanceof Il?!0:i instanceof Pn?Boolean(i.texture):!1}function FC(i,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(i[e]){const r=i[e];for(let a=0,u=t.length;a<u;++a)r[a]=t[a]}else i[e]=t.slice();else i[e]=t}function BC(i){if(i.length===0)return!1;const e=Math.min(i.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(i[t]))return!1;return!0}function On(){let i=null;return(e,t,r)=>{const a=i!==r;return a&&(e.uniform1i(t,r),i=r),a}}function Ni(i,e,t,r){let a=null,u=null;return(f,l,x)=>{const w=e(x,t),P=w.length;let M=!1;if(a===null)a=new Float32Array(P),u=P,M=!0;else{gt(u===P,"Uniform length cannot change.");for(let C=0;C<P;++C)if(w[C]!==a[C]){M=!0;break}}return M&&(r(f,i,l,w),a.set(w)),M}}function Zn(i,e,t,r){i[e](t,r)}function so(i,e,t,r){i[e](t,!1,r)}const NC=5120,UC=5121,VC=5122,jC=5123,J0=0,ed=1,GC=2,WC=3,td=4,HC=5,qC=6,An=5126,$C=35664,ZC=35665,XC=35666,Jc=5124,YC=35667,KC=35668,JC=35669,Qc=5125,QC=36294,eM=36295,tM=36296,iM=35670,nM=35671,rM=35672,sM=35673,oM=35674,aM=35675,lM=35676,cM=35685,uM=35686,hM=35687,dM=35688,fM=35689,pM=35690,zm={[An]:[An,1,"float"],[$C]:[An,2,"vec2"],[ZC]:[An,3,"vec3"],[XC]:[An,4,"vec4"],[Jc]:[Jc,1,"int"],[YC]:[Jc,2,"ivec2"],[KC]:[Jc,3,"ivec3"],[JC]:[Jc,4,"ivec4"],[Qc]:[Qc,1,"uint"],[QC]:[Qc,2,"uvec2"],[eM]:[Qc,3,"uvec3"],[tM]:[Qc,4,"uvec4"],[iM]:[An,1,"bool"],[nM]:[An,2,"bvec2"],[rM]:[An,3,"bvec3"],[sM]:[An,4,"bvec4"],[oM]:[An,8,"mat2"],[cM]:[An,8,"mat2x3"],[uM]:[An,8,"mat2x4"],[aM]:[An,12,"mat3"],[hM]:[An,12,"mat3x2"],[dM]:[An,12,"mat3x4"],[lM]:[An,16,"mat4"],[fM]:[An,16,"mat4x2"],[pM]:[An,16,"mat4x3"]};function mM(i){switch(i){case J0:return J0;case ed:return ed;case WC:return ed;case GC:return ed;case td:return td;case HC:return td;case qC:return td;default:return gt(!1),0}}function Q0(i){const e=zm[i];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function o1(i,e){switch(i){case NC:case UC:case VC:case jC:i=An;break}for(const t in zm){const[r,a,u]=zm[t];if(r===i&&a===e)return{glType:t,name:u}}return null}class gM{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let a=0;a<r;a++){const{name:u,type:f,size:l}=t.getActiveAttrib(e.handle,a),x=t.getAttribLocation(e.handle,u);x>=0&&this._addAttribute(x,u,f,l)}this.attributeInfos.sort((a,u)=>a.location-u.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!ci(t))return;const r=t.getProgramParameter(e.handle,35971);for(let a=0;a<r;a++){const{name:u,type:f,size:l}=t.getTransformFeedbackVarying(e.handle,a);this._addVarying(a,u,f,l)}this.varyingInfos.sort((a,u)=>a.location-u.location)}_addAttribute(e,t,r,a){const{type:u,components:f}=Q0(r),l={type:u,size:a*f};this._inferProperties(e,t,l);const x={location:e,name:t,accessor:new Nr(l)};this.attributeInfos.push(x),this.attributeInfosByLocation[e]=x,this.attributeInfosByName[x.name]=x}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,a){const{type:u,components:f}=Q0(r),l=new Nr({type:u,size:a*f}),x={location:e,name:t,accessor:l};this.varyingInfos.push(x),this.varyingInfosByName[x.name]=x}}const ex=4,_M=35981,yM=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class a1 extends mo{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",yM),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:a,varyings:u,bufferMode:f=_M}=e;return this.hash=t||"",this.vs=typeof r=="string"?new Gp(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof a=="string"?new Wp(this.gl,{id:"".concat(e.id,"-fs"),source:a}):a,gt(this.vs instanceof Gp),gt(this.fs instanceof Wp),this.uniforms={},this._textureUniforms={},u&&u.length>0&&(Kn(this.gl),this.varyings=u,this.gl2.transformFeedbackVaryings(this.handle,u,f)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new gM(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:a,offset:u=0,start:f,end:l,isIndexed:x=!1,indexType:w=5123,instanceCount:P=0,isInstanced:M=P>0,vertexArray:C=null,transformFeedback:V,framebuffer:Y,parameters:J={},uniforms:ce,samplers:pe}=e;if((ce||pe)&&(Rt.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ce||{})),Rt.priority>=t){const ve=Y?Y.id:"default",he="mode=".concat(Xo(this.gl,r)," verts=").concat(a," ")+"instances=".concat(P," indexType=").concat(Xo(this.gl,w)," ")+"isInstanced=".concat(M," isIndexed=").concat(x," ")+"Framebuffer=".concat(ve);Rt.log(t,he)()}return gt(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||a===0||M&&P===0?!1:(C.bindForDraw(a,P,()=>{if(Y!==void 0&&(J=Object.assign({},J,{framebuffer:Y})),V){const ve=mM(r);V.begin(ve)}this._bindTextures(),gs(this.gl,J,()=>{x&&M?this.gl2.drawElementsInstanced(r,a,w,u,P):x&&ci(this.gl)&&!isNaN(f)&&!isNaN(l)?this.gl2.drawRangeElements(r,f,l,a,w,u):x?this.gl.drawElements(r,a,w,u):M?this.gl2.drawArraysInstanced(r,u,a,P):this.gl.drawArrays(r,u,a)}),V&&V.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rt.priority>=2&&zC(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],a=this._uniformSetters[t];if(a){let u=r,f=!1;if(u instanceof Pn&&(u=u.texture),u instanceof Va)if(f=this.uniforms[t]!==r,f){a.textureIndex===void 0&&(a.textureIndex=this._textureIndexCounter++);const l=u,{textureIndex:x}=a;l.bind(x),u=x,this._textureUniforms[t]=l}else u=a.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(a(u)||f)&&FC(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const a of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Gp({handle:a});break;case 35632:r.fs=new Wp({handle:a});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=ea(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Rt.time(ex,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Rt.timeEnd(ex,"linkProgram for ".concat(this._getName()))(),e.debug||Rt.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:a}=DC(r.name);let u=e.getUniformLocation(this.handle,a);if(this._uniformSetters[a]=K0(e,u,r),r.size>1)for(let f=0;f<r.size;f++)u=e.getUniformLocation(this.handle,"".concat(a,"[").concat(f,"]")),this._uniformSetters["".concat(a,"[").concat(f,"]")]=K0(e,u,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const xM=34918,vM=34919,bM=35007,wM=36795,TM=35976,EM=35887,SM=36202;class Bd extends mo{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=ci(e),a=Fg(e,Ui.TIMER_QUERY);let u=r||a;for(const f of t)switch(f){case"queries":u=u&&r;break;case"timers":u=u&&a;break;default:gt(!1)}return u}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(bM)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?SM:EM)}beginTransformFeedbackQuery(){return this.begin(TM)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,vM);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(wM)}getResult(){return this.gl2.getQueryParameter(this.handle,xM)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,a)=>{const u=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}_createHandle(){return Bd.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class l1 extends mo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return ci(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Kn(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Vl(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:a,byteSize:u,byteOffset:f}=this._getBufferParams(t);return r<0?(this.unused[e]=a,Rt.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,a,f,u),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,a;return e instanceof Ii?a=e:(a=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||a.byteLength-t),{buffer:a,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:a}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,a,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;const u=t&&t.handle;return!u||a===void 0?this.gl.bindBufferBase(35982,e,u):this.gl.bindBufferRange(35982,e,u,r,a),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let id=null;function AM(i){return(!id||id.byteLength<i)&&(id=new ArrayBuffer(i)),id}function PM(i,e){const t=AM(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function IM(i){let{target:e,source:t,start:r=0,count:a=1}=i;const u=t.length,f=a*u;let l=0;for(let x=r;l<u;l++)e[x++]=t[l];for(;l<f;)l<f-l?(e.copyWithin(r+l,r,r+l),l*=2):(e.copyWithin(r+l,r,r+f-l),l=f);return e}const CM="elements must be GL.ELEMENT_ARRAY_BUFFER";class Fr extends mo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?ci(e)||Cb()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Fr(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Fr.MAX_ATTRIBUTES=Fr.MAX_ATTRIBUTES||e.getParameter(34921),Fr.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:Fr._setConstantFloatArray(e,t,r);break;case Int32Array:Fr._setConstantIntArray(e,t,r);break;case Uint32Array:Fr._setConstantUintArray(e,t,r);break;default:gt(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Fr.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return gt(!e||e.target===34963,CM),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:a,type:u,stride:f,offset:l,normalized:x,integer:w,divisor:P}=r,{gl:M,gl2:C}=this;return e=Number(e),this.bind(()=>{M.bindBuffer(34962,t.handle),w?(gt(ci(M)),C.vertexAttribIPointer(e,a,u,f,l)):M.vertexAttribPointer(e,a,u,x,f,l),M.enableVertexAttribArray(e),C.vertexAttribDivisor(e,P||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!Fr.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),a=r.byteLength*e,u=r.length*e;let f=!this.buffer;if(this.buffer=this.buffer||new Ii(this.gl,a),f=f||this.buffer.reallocate(a),f=f||!this._compareConstantArrayValues(r,this.bufferValue),f){const l=PM(t.constructor,u);IM({target:l,source:r,start:0,count:u}),this.buffer.subData(l),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:gt(!1)}}static _setConstantIntArray(e,t,r){switch(gt(ci(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:gt(!1)}}static _setConstantUintArray(e,t,r){switch(gt(ci(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:gt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return gt(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const MM="VertexArray: attributes must be Buffers or constants (i.e. typed array)",LM=/^(.+)__LOCATION_([0-9]+)$/,RM=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class kM{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Fr(e),Xb(this,"VertexArray","v6.0",RM),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:a,accessor:u}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return a>=0&&(this.values[a]=t,this.accessors[a]=u,this.clearDrawParams(),this.vertexArrayObject.setBuffer(a,t,u)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:a,accessor:u}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return a>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[a]=t,this.accessors[a]=u,this.clearDrawParams(),this.vertexArrayObject.enable(a,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Ii(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Ii&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof Ii&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let a;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),a=r()}),a}_resolveLocationAndAccessor(e,t,r,a){const u={location:-1,accessor:null},{location:f,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(f)||f<0)return this.unused[e]=t,Rt.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),u;const x=this._getAttributeInfo(l||f);if(!x)return u;const w=this.accessors[f]||{},P=Nr.resolve(x.accessor,w,r,a),{size:M,type:C}=P;return gt(Number.isFinite(M)&&Number.isFinite(C)),{location:f,accessor:P}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=LM.exec(e),a=r?r[1]:e,u=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+u,name:a}:{location:-1}}_setAttribute(e,t){if(t instanceof Ii)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof Ii){const r=t[0],a=t[1];this.setBuffer(e,r,a)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof Ii){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(MM)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,r);for(let u=1;u<this.vertexArrayObject.MAX_ATTRIBUTES;u++)a=this.values[u],ArrayBuffer.isView(a)&&this._setConstantAttribute(u,a)}_setConstantAttributeZero(e,t){if(Fr.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){Fr.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],a=this.accessors[t];if(!r)return;const{divisor:u}=a,f=u>0;if(e.isInstanced=e.isInstanced||f,r instanceof Ii){const l=r;if(f){const x=l.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,x)}else{const x=l.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,x)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Rt.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function DM(i,e){const{maxElts:t=16,size:r=1}=e;let a="[";for(let f=0;f<i.length&&f<t;++f)f>0&&(a+=",".concat(f%r===0?" ":"")),a+=Pu(i[f],e);const u=i.length>t?"...":"]";return"".concat(a).concat(u)}function Pu(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(i)||ArrayBuffer.isView(i))return DM(i,e);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<t)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const a=i.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a}function tx(i){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:a=!1}=i;gt(t);const u=".*_.*",f=".*Matrix",l=t._uniformSetters,x={},w=Object.keys(l).sort();let P=0;for(const V of w)!V.match(u)&&!V.match(f)&&Hp({table:x,header:e,uniforms:r,uniformName:V,undefinedOnly:a})&&P++;for(const V of w)V.match(f)&&Hp({table:x,header:e,uniforms:r,uniformName:V,undefinedOnly:a})&&P++;for(const V of w)x[V]||Hp({table:x,header:e,uniforms:r,uniformName:V,undefinedOnly:a})&&P++;let M=0;const C={};if(!a)for(const V in r){const Y=r[V];x[V]||(M++,C[V]={Type:"NOT USED: ".concat(Y),[e]:Pu(Y)})}return{table:x,count:P,unusedTable:C,unusedCount:M}}function Hp(i){let{table:e,header:t,uniforms:r,uniformName:a,undefinedOnly:u}=i;const f=r[a],l=zM(f);return!u||!l?(e[a]={[t]:l?Pu(f):"N/A","Uniform Type":l?f:"NOT PROVIDED"},!0):!1}function zM(i){return i!=null}function OM(i){let{vertexArray:e,header:t="Attributes"}=i;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=ix(e,e.elements,null,t));const a=e.values;for(const u in a){const f=e._getAttributeInfo(u);if(f){let l="".concat(u,": ").concat(f.name);const x=e.accessors[f.location];x&&(l="".concat(u,": ").concat(FM(f.name,x))),r[l]=ix(e,a[u],x,t)}}return r}function ix(i,e,t,r){const{gl:a}=i;if(!e)return{[r]:"null","Format ":"N/A"};let u="NOT PROVIDED",f=1,l=0,x=0,w,P,M;if(t&&(u=t.type,f=t.size,u=String(u).replace("Array",""),w=u.indexOf("nt")!==-1),e instanceof Ii){const C=e,{data:V,changed:Y}=C.getDebugData();P=Y?"*":"",M=V,x=C.byteLength,l=x/V.BYTES_PER_ELEMENT/f;let J;if(t){const ce=t.divisor>0;J="".concat(ce?"I ":"P "," ").concat(l," (x").concat(f,"=").concat(x," bytes ").concat(Xo(a,u),")")}else w=!0,J="".concat(x," bytes");return{[r]:"".concat(P).concat(Pu(M,{size:f,isInteger:w})),"Format ":J}}return M=e,f=e.length,u=String(e.constructor.name).replace("Array",""),w=u.indexOf("nt")!==-1,{[r]:"".concat(Pu(M,{size:f,isInteger:w})," (constant)"),"Format ":"".concat(f,"x").concat(u," (constant)")}}function FM(i,e){const{type:t,size:r}=e,a=o1(t,r);return a?"".concat(i," (").concat(a.name,")"):i}function BM(i){const e={},t="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const a=nx(r);e["in ".concat(a)]={[t]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const a=nx(r);e["out ".concat(a)]={[t]:JSON.stringify(r.accessor)}}return e}function nx(i){const{type:e,size:t}=i.accessor,r=o1(e,t);return r?"".concat(r.name," ").concat(i.name):i.name}const rx=po()&&typeof document<"u";let NM=0;class UM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=ce=>Zb(ce),onAddHTML:r=null,onInitialize:a=()=>{},onRender:u=()=>{},onFinalize:f=()=>{},onError:l,gl:x=null,glOptions:w={},debug:P=!1,createFramebuffer:M=!1,autoResizeViewport:C=!0,autoResizeDrawingBuffer:V=!0,stats:Y=Fa.get("animation-loop-".concat(NM++))}=e;let{useDevicePixels:J=!0}=e;"useDevicePixelRatio"in e&&(Rt.deprecated("useDevicePixelRatio","useDevicePixels")(),J=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:a,onRender:u,onFinalize:f,onError:l,gl:x,glOptions:w,debug:P,createFramebuffer:M},this.gl=x,this.needsRedraw=null,this.timeline=null,this.stats=Y,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:C,autoResizeDrawingBuffer:V,useDevicePixels:J}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return gt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Bd.isSupported(this.gl,["timers"])?new Bd(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return Rt.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=rx?new Promise((e,t)=>{if(rx&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):qI(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):HI(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Dg(this.props.gl,e):this.onCreateContext(e),!ff(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");RI(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:a}=this.gl;return a&&a.clientHeight?r=a.clientWidth/a.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&FI(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Pn(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Nu="vs",Ng="fs";function Vr(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const qp={number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},array:{validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function VM(i){const e={};for(const t in i){const r=i[t],a=jM(r);e[t]=a}return e}function jM(i){let e=sx(i);return e==="object"?i?"type"in i?Object.assign({},i,qp[i.type]):"value"in i?(e=sx(i.value),Object.assign({type:e},i,qp[e])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:e,value:i},qp[e])}function sx(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const GM="vs",WM="fs";class ox{constructor(e){let{name:t,vs:r,fs:a,dependencies:u=[],uniforms:f,getUniforms:l,deprecations:x=[],defines:w={},inject:P={},vertexShader:M,fragmentShader:C}=e;Vr(typeof t=="string"),this.name=t,this.vs=r||M,this.fs=a||C,this.getModuleUniforms=l,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(x),this.defines=w,this.injections=HM(P),f&&(this.uniforms=VM(f))}getModuleSource(e){let t;switch(e){case GM:t=this.vs||"";break;case WM:t=this.fs||"";break;default:Vr(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const a in r){const u=r[a];a in e&&!u.private?(u.validate&&Vr(u.validate(e[a],u),"".concat(this.name,": invalid ").concat(a)),t[a]=e[a]):t[a]=u.value}return t}}function HM(i){const e={vs:{},fs:{}};for(const t in i){let r=i[t];const a=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[a][t]=r}return e}function qM(i){return $M(u1(i))}function $M(i){const e={},t={};return c1({modules:i,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,a)=>t[a]-t[r]).map(r=>e[r])}function c1(i){let{modules:e,level:t,moduleMap:r,moduleDepth:a}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)r[u.name]=u,(a[u.name]===void 0||a[u.name]<t)&&(a[u.name]=t);for(const u of e)u.dependencies&&c1({modules:u.dependencies,level:t+1,moduleMap:r,moduleDepth:a})}function u1(i,e){return i.map(t=>(t instanceof ox||(Vr(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),Vr(t.name,"shader module has no name"),t=new ox(t),t.dependencies=u1(t.dependencies)),t))}function ZM(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=i.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,a=t.indexOf("Trident/")!==-1;return r||a}const XM=7936,YM=7937,KM=7938,JM=35724,Ug={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Da={};Object.keys(Ug).forEach(i=>{Da[i]=i});function QM(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:Boolean(i&&i._version===2)}function eL(i){const e=i.getExtension("WEBGL_debug_renderer_info"),t=i.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||XM),r=i.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||YM);return{gpuVendor:tL(t,r),vendor:t,renderer:r,version:i.getParameter(KM),shadingLanguageVersion:i.getParameter(JM)}}function tL(i,e){return i.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||e.match(/AMD/i)||i.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const $p={};function ax(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Ug[e];if(Vr(r,e),!ZM(t))return!0;if(e in $p)return $p[e];const a=r[0],u=t.behavior||"enable",f="#extension GL_".concat(a," : ").concat(u,`
void main(void) {}`),l=i.createShader(35633);i.shaderSource(l,f),i.compileShader(l);const x=i.getShaderParameter(l,35713);return i.deleteShader(l),$p[e]=x,x}function iL(i,e){const t=Ug[e];Vr(t,e);const r=QM(i)&&t[1]||t[0],a=typeof r=="string"?Boolean(i.getExtension(r)):r;return Vr(a===!1||a===!0),a}function nd(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>iL(i,t))}function nL(i){switch(eL(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function rL(i,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return nd(i,Da.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),nd(i,Da.GLSL_DERIVATIVES)&&ax(i,Da.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),nd(i,Da.GLSL_FRAG_DATA)&&ax(i,Da.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),nd(i,Da.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const sL=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,oL=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,aL={[Nu]:sL,[Ng]:oL},vd="__LUMA_INJECT_DECLARATIONS__",lx=/void\s+main\s*\([^)]*\)\s*\{\n?/,cx=/}\n?[^{}]*$/,Zp=[];function ux(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=e===Nu;for(const u in t){const f=t[u];f.sort((x,w)=>x.order-w.order),Zp.length=f.length;for(let x=0,w=f.length;x<w;++x)Zp[x]=f[x].injection;const l="".concat(Zp.join(`
`),`
`);switch(u){case"vs:#decl":a&&(i=i.replace(vd,l));break;case"vs:#main-start":a&&(i=i.replace(lx,x=>x+l));break;case"vs:#main-end":a&&(i=i.replace(cx,x=>l+x));break;case"fs:#decl":a||(i=i.replace(vd,l));break;case"fs:#main-start":a||(i=i.replace(lx,x=>x+l));break;case"fs:#main-end":a||(i=i.replace(cx,x=>l+x));break;default:i=i.replace(u,x=>x+l)}}return i=i.replace(vd,""),r&&(i=i.replace(/\}\s*$/,u=>u+aL[e])),i}function Om(i){const e={};return Vr(Array.isArray(i)&&i.length>1),i.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function jl(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const h1=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],lL=[...h1,[jl("attribute"),"in $1"],[jl("varying"),"out $1"]],cL=[...h1,[jl("varying"),"in $1"]],d1=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],uL=[...d1,[jl("in"),"attribute $1"],[jl("out"),"varying $1"]],hL=[...d1,[jl("in"),"varying $1"]],Fm="gl_FragColor",Bm=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,dL=/void\s+main\s*\([^)]*\)\s*\{\n?/;function fL(i,e,t){switch(e){case 300:return t?Nd(i,lL):pL(i);case 100:return t?Nd(i,uL):mL(i);default:throw new Error("unknown GLSL version ".concat(e))}}function Nd(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function pL(i){i=Nd(i,cL);const e=i.match(Bm);if(e){const t=e[1];i=i.replace(new RegExp("\\b".concat(Fm,"\\b"),"g"),t)}else{const t="fragmentColor";i=i.replace(dL,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(Fm,"\\b"),"g"),t)}return i}function mL(i){i=Nd(i,hL);const e=i.match(Bm);if(e){const t=e[1];i=i.replace(Bm,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),Fm)}return i}const gL=`

`.concat(vd,`

`),f1={[Nu]:"vertex",[Ng]:"fragment"},_L=`precision highp float;

`;function yL(i,e){const{vs:t,fs:r}=e,a=qM(e.modules||[]);return{gl:i,vs:hx(i,Object.assign({},e,{source:t,type:Nu,modules:a})),fs:hx(i,Object.assign({},e,{source:r,type:Ng,modules:a})),getUniforms:xL(a)}}function hx(i,e){let{id:t,source:r,type:a,modules:u,defines:f={},hookFunctions:l=[],inject:x={},transpileToGLSL100:w=!1,prologue:P=!0,log:M}=e;Vr(typeof r=="string","shader source must be a string");const C=a===Nu,V=r.split(`
`);let Y=100,J="",ce=r;V[0].indexOf("#version ")===0?(Y=300,J=V[0],ce=V.slice(1).join(`
`)):J="#version ".concat(Y);const pe={};u.forEach(ht=>{Object.assign(pe,ht.getDefines())}),Object.assign(pe,f);let ve=P?"".concat(J,`
`).concat(bL({id:t,source:r,type:a}),`
`).concat(vL({type:a}),`
`).concat(nL(i),`
`).concat(rL(i),`
`).concat(wL(pe),`
`).concat(C?"":_L,`
`):"".concat(J,`
`);const he=EL(l),Ee={},Fe={},Ze={};for(const ht in x){const _t=typeof x[ht]=="string"?{injection:x[ht],order:0}:x[ht],lt=ht.match(/^(v|f)s:(#)?([\w-]+)$/);if(lt){const Et=lt[2],It=lt[3];Et?It==="decl"?Fe[ht]=[_t]:Ze[ht]=[_t]:Ee[ht]=[_t]}else Ze[ht]=[_t]}for(const ht of u){M&&ht.checkDeprecations(ce,M);const _t=ht.getModuleSource(a,Y);ve+=_t;const lt=ht.injections[a];for(const Et in lt){const It=Et.match(/^(v|f)s:#([\w-]+)$/);if(It){const zt=It[2]==="decl"?Fe:Ze;zt[Et]=zt[Et]||[],zt[Et].push(lt[Et])}else Ee[Et]=Ee[Et]||[],Ee[Et].push(lt[Et])}}return ve+=gL,ve=ux(ve,a,Fe),ve+=TL(he[a],Ee),ve+=ce,ve=ux(ve,a,Ze),ve=fL(ve,w?100:Y,C),ve}function xL(i){return function(t){const r={};for(const a of i){const u=a.getUniforms(t,r);Object.assign(r,u)}return r}}function vL(i){let{type:e}=i;return`
#define SHADER_TYPE_`.concat(f1[e].toUpperCase(),`
`)}function bL(i){let{id:e,source:t,type:r}=i;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(f1[r],`

`):""}function wL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in i){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const a=i[r];(a||Number.isFinite(a))&&(t+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return e===0&&(t+=`
`),t}function TL(i,e){let t="";for(const r in i){const a=i[r];if(t+="void ".concat(a.signature,` {
`),a.header&&(t+="  ".concat(a.header)),e[r]){const u=e[r];u.sort((f,l)=>f.order-l.order);for(const f of u)t+="  ".concat(f.injection,`
`)}a.footer&&(t+="  ".concat(a.footer)),t+=`}
`}return t}function EL(i){const e={vs:{},fs:{}};return i.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[a,u]=t.split(":"),f=t.replace(/\(.+/,"");e[a][f]=Object.assign(r,{signature:u})}),e}const SL="void main() {gl_FragColor = vec4(0);}",p1=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,AL=`#version 300 es
`.concat(p1);function m1(i,e){e=Array.isArray(e)?e:[e];const t=i.replace(/^\s+/,"").split(/\s+/),[r,a,u]=t;if(!e.includes(r)||!a||!u)return null;const f=u.split(";")[0];return{qualifier:r,type:a,name:f}}function g1(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:a}=i;if(!t)return e===300?AL:e>300?"#version ".concat(e,`
`).concat(p1):SL;const u=CL(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(u,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(u,`;
}`)}function PL(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Vr(!1),null}}function IL(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Vr(!1),null}}function CL(i,e){switch(e){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return Vr(!1),null}}const ML=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,LL={name:"fp32",vs:ML,fs:null};function dx(i,e){if(!i)throw new Error("math.gl assertion ".concat(e))}const Ur={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function RL(i,{precision:e=Ur.precision}={}){return i=kL(i),"".concat(parseFloat(i.toPrecision(e)))}function Gl(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Wo(i,e,t){return zL(i,r=>Math.max(e,Math.min(t,r)))}function Ud(i,e,t){return Gl(i)?i.map((r,a)=>Ud(r,e[a],t)):t*e+(1-t)*i}function Iu(i,e,t){const r=Ur.EPSILON;t&&(Ur.EPSILON=t);try{if(i===e)return!0;if(Gl(i)&&Gl(e)){if(i.length!==e.length)return!1;for(let a=0;a<i.length;++a)if(!Iu(i[a],e[a]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=Ur.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{Ur.EPSILON=r}}function kL(i){return Math.round(i/Ur.EPSILON)*Ur.EPSILON}function DL(i){return i.clone?i.clone():new Array(i.length)}function zL(i,e,t){if(Gl(i)){const r=i;t=t||DL(r);for(let a=0;a<t.length&&a<r.length;++a)t[a]=e(i[a],a,t);return t}return e(i)}function OL(i){function e(){var t=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e}class _1 extends OL(Array){clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Gl(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ur)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+RL(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Iu(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let a=0;a<this.ELEMENTS;++a){const u=e[a];this[a]=u+r*(t[a]-u)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Ur.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function FL(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function Br(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function Xp(i,e,t=""){if(Ur.debug&&!FL(i,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return i}class BL extends _1{get x(){return this[0]}set x(e){this[0]=Br(e)}get y(){return this[1]}set y(e){this[1]=Br(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const a=this[r]-e[r];t+=a*a}return Br(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return Br(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return dx(e>=0&&e<this.ELEMENTS,"index is out of range"),Br(this[e])}setComponent(e,t){return dx(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var bd=1e-6,Wl=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function NL(){var i=new Wl(2);return Wl!=Float32Array&&(i[0]=0,i[1]=0),i}function fx(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function UL(i,e){return i[0]=-e[0],i[1]=-e[1],i}function y1(i,e,t,r){var a=e[0],u=e[1];return i[0]=a+r*(t[0]-a),i[1]=u+r*(t[1]-u),i}function VL(i,e,t){var r=e[0],a=e[1];return i[0]=t[0]*r+t[4]*a+t[12],i[1]=t[1]*r+t[5]*a+t[13],i}(function(){var i=NL();return function(e,t,r,a,u,f){var l,x;for(t||(t=2),r||(r=0),a?x=Math.min(a*t+r,e.length):x=e.length,l=r;l<x;l+=t)i[0]=e[l],i[1]=e[l+1],u(i,i,f),e[l]=i[0],e[l+1]=i[1];return e}})();function jL(i,e,t){const r=e[0],a=e[1],u=t[3]*r+t[7]*a||1;return i[0]=(t[0]*r+t[4]*a)/u,i[1]=(t[1]*r+t[5]*a)/u,i}function x1(i,e,t){const r=e[0],a=e[1],u=e[2],f=t[3]*r+t[7]*a+t[11]*u||1;return i[0]=(t[0]*r+t[4]*a+t[8]*u)/f,i[1]=(t[1]*r+t[5]*a+t[9]*u)/f,i[2]=(t[2]*r+t[6]*a+t[10]*u)/f,i}function GL(i,e,t){const r=e[0],a=e[1];return i[0]=t[0]*r+t[2]*a,i[1]=t[1]*r+t[3]*a,i[2]=e[2],i}function WL(){var i=new Wl(3);return Wl!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function HL(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function qL(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function $L(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function ZL(i,e,t){var r=e[0],a=e[1],u=e[2],f=t[0],l=t[1],x=t[2];return i[0]=a*x-u*l,i[1]=u*f-r*x,i[2]=r*l-a*f,i}function v1(i,e,t){var r=e[0],a=e[1],u=e[2],f=t[3]*r+t[7]*a+t[11]*u+t[15];return f=f||1,i[0]=(t[0]*r+t[4]*a+t[8]*u+t[12])/f,i[1]=(t[1]*r+t[5]*a+t[9]*u+t[13])/f,i[2]=(t[2]*r+t[6]*a+t[10]*u+t[14])/f,i}function XL(i,e,t){var r=e[0],a=e[1],u=e[2];return i[0]=r*t[0]+a*t[3]+u*t[6],i[1]=r*t[1]+a*t[4]+u*t[7],i[2]=r*t[2]+a*t[5]+u*t[8],i}function YL(i,e,t){var r=t[0],a=t[1],u=t[2],f=t[3],l=e[0],x=e[1],w=e[2],P=a*w-u*x,M=u*l-r*w,C=r*x-a*l,V=a*C-u*M,Y=u*P-r*C,J=r*M-a*P,ce=f*2;return P*=ce,M*=ce,C*=ce,V*=2,Y*=2,J*=2,i[0]=l+P+V,i[1]=x+M+Y,i[2]=w+C+J,i}function KL(i,e,t,r){var a=[],u=[];return a[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],u[0]=a[0],u[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),u[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),i[0]=u[0]+t[0],i[1]=u[1]+t[1],i[2]=u[2]+t[2],i}function JL(i,e,t,r){var a=[],u=[];return a[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],u[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),u[1]=a[1],u[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),i[0]=u[0]+t[0],i[1]=u[1]+t[1],i[2]=u[2]+t[2],i}function QL(i,e,t,r){var a=[],u=[];return a[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],u[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),u[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),u[2]=a[2],i[0]=u[0]+t[0],i[1]=u[1]+t[1],i[2]=u[2]+t[2],i}function eR(i,e){var t=i[0],r=i[1],a=i[2],u=e[0],f=e[1],l=e[2],x=Math.sqrt(t*t+r*r+a*a),w=Math.sqrt(u*u+f*f+l*l),P=x*w,M=P&&$L(i,e)/P;return Math.acos(Math.min(Math.max(M,-1),1))}var tR=HL;(function(){var i=WL();return function(e,t,r,a,u,f){var l,x;for(t||(t=3),r||(r=0),a?x=Math.min(a*t+r,e.length):x=e.length,l=r;l<x;l+=t)i[0]=e[l],i[1]=e[l+1],i[2]=e[l+2],u(i,i,f),e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];return e}})();const Yp=[0,0,0];let rd;class js extends BL{static get ZERO(){return rd||(rd=new js(0,0,0),Object.freeze(rd)),rd}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Gl(e)?this.copy(e):(Ur.debug&&(Br(e),Br(t),Br(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ur.debug&&(Br(e.x),Br(e.y),Br(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Br(e)}angle(e){return eR(this,e)}cross(e){return ZL(this,this,e),this.check()}rotateX({radians:e,origin:t=Yp}){return KL(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Yp}){return JL(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Yp}){return QL(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return v1(this,this,e),this.check()}transformAsVector(e){return x1(this,this,e),this.check()}transformByMatrix3(e){return XL(this,this,e),this.check()}transformByMatrix2(e){return GL(this,this,e),this.check()}transformByQuaternion(e){return YL(this,this,e),this.check()}}class iR extends _1{toString(){let e="[";if(Ur.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=Br(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let a=0;a<this.RANK;++a)t[a]=this[r+a];return t}setColumn(e,t){const r=e*this.RANK;for(let a=0;a<this.RANK;++a)this[r+a]=t[a];return this}}function nR(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function rR(i,e){if(i===e){var t=e[1],r=e[2],a=e[3],u=e[6],f=e[7],l=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=u,i[11]=e[14],i[12]=a,i[13]=f,i[14]=l}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function Nm(i,e){var t=e[0],r=e[1],a=e[2],u=e[3],f=e[4],l=e[5],x=e[6],w=e[7],P=e[8],M=e[9],C=e[10],V=e[11],Y=e[12],J=e[13],ce=e[14],pe=e[15],ve=t*l-r*f,he=t*x-a*f,Ee=t*w-u*f,Fe=r*x-a*l,Ze=r*w-u*l,ht=a*w-u*x,_t=P*J-M*Y,lt=P*ce-C*Y,Et=P*pe-V*Y,It=M*ce-C*J,Ot=M*pe-V*J,zt=C*pe-V*ce,Ut=ve*zt-he*Ot+Ee*It+Fe*Et-Ze*lt+ht*_t;return Ut?(Ut=1/Ut,i[0]=(l*zt-x*Ot+w*It)*Ut,i[1]=(a*Ot-r*zt-u*It)*Ut,i[2]=(J*ht-ce*Ze+pe*Fe)*Ut,i[3]=(C*Ze-M*ht-V*Fe)*Ut,i[4]=(x*Et-f*zt-w*lt)*Ut,i[5]=(t*zt-a*Et+u*lt)*Ut,i[6]=(ce*Ee-Y*ht-pe*he)*Ut,i[7]=(P*ht-C*Ee+V*he)*Ut,i[8]=(f*Ot-l*Et+w*_t)*Ut,i[9]=(r*Et-t*Ot-u*_t)*Ut,i[10]=(Y*Ze-J*Ee+pe*ve)*Ut,i[11]=(M*Ee-P*Ze-V*ve)*Ut,i[12]=(l*lt-f*It-x*_t)*Ut,i[13]=(t*It-r*lt+a*_t)*Ut,i[14]=(J*he-Y*Fe-ce*ve)*Ut,i[15]=(P*Fe-M*he+C*ve)*Ut,i):null}function sR(i){var e=i[0],t=i[1],r=i[2],a=i[3],u=i[4],f=i[5],l=i[6],x=i[7],w=i[8],P=i[9],M=i[10],C=i[11],V=i[12],Y=i[13],J=i[14],ce=i[15],pe=e*f-t*u,ve=e*l-r*u,he=e*x-a*u,Ee=t*l-r*f,Fe=t*x-a*f,Ze=r*x-a*l,ht=w*Y-P*V,_t=w*J-M*V,lt=w*ce-C*V,Et=P*J-M*Y,It=P*ce-C*Y,Ot=M*ce-C*J;return pe*Ot-ve*It+he*Et+Ee*lt-Fe*_t+Ze*ht}function Ua(i,e,t){var r=e[0],a=e[1],u=e[2],f=e[3],l=e[4],x=e[5],w=e[6],P=e[7],M=e[8],C=e[9],V=e[10],Y=e[11],J=e[12],ce=e[13],pe=e[14],ve=e[15],he=t[0],Ee=t[1],Fe=t[2],Ze=t[3];return i[0]=he*r+Ee*l+Fe*M+Ze*J,i[1]=he*a+Ee*x+Fe*C+Ze*ce,i[2]=he*u+Ee*w+Fe*V+Ze*pe,i[3]=he*f+Ee*P+Fe*Y+Ze*ve,he=t[4],Ee=t[5],Fe=t[6],Ze=t[7],i[4]=he*r+Ee*l+Fe*M+Ze*J,i[5]=he*a+Ee*x+Fe*C+Ze*ce,i[6]=he*u+Ee*w+Fe*V+Ze*pe,i[7]=he*f+Ee*P+Fe*Y+Ze*ve,he=t[8],Ee=t[9],Fe=t[10],Ze=t[11],i[8]=he*r+Ee*l+Fe*M+Ze*J,i[9]=he*a+Ee*x+Fe*C+Ze*ce,i[10]=he*u+Ee*w+Fe*V+Ze*pe,i[11]=he*f+Ee*P+Fe*Y+Ze*ve,he=t[12],Ee=t[13],Fe=t[14],Ze=t[15],i[12]=he*r+Ee*l+Fe*M+Ze*J,i[13]=he*a+Ee*x+Fe*C+Ze*ce,i[14]=he*u+Ee*w+Fe*V+Ze*pe,i[15]=he*f+Ee*P+Fe*Y+Ze*ve,i}function Vd(i,e,t){var r=t[0],a=t[1],u=t[2],f,l,x,w,P,M,C,V,Y,J,ce,pe;return e===i?(i[12]=e[0]*r+e[4]*a+e[8]*u+e[12],i[13]=e[1]*r+e[5]*a+e[9]*u+e[13],i[14]=e[2]*r+e[6]*a+e[10]*u+e[14],i[15]=e[3]*r+e[7]*a+e[11]*u+e[15]):(f=e[0],l=e[1],x=e[2],w=e[3],P=e[4],M=e[5],C=e[6],V=e[7],Y=e[8],J=e[9],ce=e[10],pe=e[11],i[0]=f,i[1]=l,i[2]=x,i[3]=w,i[4]=P,i[5]=M,i[6]=C,i[7]=V,i[8]=Y,i[9]=J,i[10]=ce,i[11]=pe,i[12]=f*r+P*a+Y*u+e[12],i[13]=l*r+M*a+J*u+e[13],i[14]=x*r+C*a+ce*u+e[14],i[15]=w*r+V*a+pe*u+e[15]),i}function Vg(i,e,t){var r=t[0],a=t[1],u=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function oR(i,e,t,r){var a=r[0],u=r[1],f=r[2],l=Math.hypot(a,u,f),x,w,P,M,C,V,Y,J,ce,pe,ve,he,Ee,Fe,Ze,ht,_t,lt,Et,It,Ot,zt,Ut,$i;return l<bd?null:(l=1/l,a*=l,u*=l,f*=l,x=Math.sin(t),w=Math.cos(t),P=1-w,M=e[0],C=e[1],V=e[2],Y=e[3],J=e[4],ce=e[5],pe=e[6],ve=e[7],he=e[8],Ee=e[9],Fe=e[10],Ze=e[11],ht=a*a*P+w,_t=u*a*P+f*x,lt=f*a*P-u*x,Et=a*u*P-f*x,It=u*u*P+w,Ot=f*u*P+a*x,zt=a*f*P+u*x,Ut=u*f*P-a*x,$i=f*f*P+w,i[0]=M*ht+J*_t+he*lt,i[1]=C*ht+ce*_t+Ee*lt,i[2]=V*ht+pe*_t+Fe*lt,i[3]=Y*ht+ve*_t+Ze*lt,i[4]=M*Et+J*It+he*Ot,i[5]=C*Et+ce*It+Ee*Ot,i[6]=V*Et+pe*It+Fe*Ot,i[7]=Y*Et+ve*It+Ze*Ot,i[8]=M*zt+J*Ut+he*$i,i[9]=C*zt+ce*Ut+Ee*$i,i[10]=V*zt+pe*Ut+Fe*$i,i[11]=Y*zt+ve*Ut+Ze*$i,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function b1(i,e,t){var r=Math.sin(t),a=Math.cos(t),u=e[4],f=e[5],l=e[6],x=e[7],w=e[8],P=e[9],M=e[10],C=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*a+w*r,i[5]=f*a+P*r,i[6]=l*a+M*r,i[7]=x*a+C*r,i[8]=w*a-u*r,i[9]=P*a-f*r,i[10]=M*a-l*r,i[11]=C*a-x*r,i}function aR(i,e,t){var r=Math.sin(t),a=Math.cos(t),u=e[0],f=e[1],l=e[2],x=e[3],w=e[8],P=e[9],M=e[10],C=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a-w*r,i[1]=f*a-P*r,i[2]=l*a-M*r,i[3]=x*a-C*r,i[8]=u*r+w*a,i[9]=f*r+P*a,i[10]=l*r+M*a,i[11]=x*r+C*a,i}function w1(i,e,t){var r=Math.sin(t),a=Math.cos(t),u=e[0],f=e[1],l=e[2],x=e[3],w=e[4],P=e[5],M=e[6],C=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*a+w*r,i[1]=f*a+P*r,i[2]=l*a+M*r,i[3]=x*a+C*r,i[4]=w*a-u*r,i[5]=P*a-f*r,i[6]=M*a-l*r,i[7]=C*a-x*r,i}function lR(i,e){var t=e[0],r=e[1],a=e[2],u=e[3],f=t+t,l=r+r,x=a+a,w=t*f,P=r*f,M=r*l,C=a*f,V=a*l,Y=a*x,J=u*f,ce=u*l,pe=u*x;return i[0]=1-M-Y,i[1]=P+pe,i[2]=C-ce,i[3]=0,i[4]=P-pe,i[5]=1-w-Y,i[6]=V+J,i[7]=0,i[8]=C+ce,i[9]=V-J,i[10]=1-w-M,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function cR(i,e,t,r,a,u,f){var l=1/(t-e),x=1/(a-r),w=1/(u-f);return i[0]=u*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u*2*x,i[6]=0,i[7]=0,i[8]=(t+e)*l,i[9]=(a+r)*x,i[10]=(f+u)*w,i[11]=-1,i[12]=0,i[13]=0,i[14]=f*u*2*w,i[15]=0,i}function uR(i,e,t,r,a){var u=1/Math.tan(e/2),f;return i[0]=u/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(f=1/(r-a),i[10]=(a+r)*f,i[14]=2*a*r*f):(i[10]=-1,i[14]=-2*r),i}var hR=uR;function dR(i,e,t,r,a,u,f){var l=1/(e-t),x=1/(r-a),w=1/(u-f);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+t)*l,i[13]=(a+r)*x,i[14]=(f+u)*w,i[15]=1,i}var fR=dR;function pR(i,e,t,r){var a,u,f,l,x,w,P,M,C,V,Y=e[0],J=e[1],ce=e[2],pe=r[0],ve=r[1],he=r[2],Ee=t[0],Fe=t[1],Ze=t[2];return Math.abs(Y-Ee)<bd&&Math.abs(J-Fe)<bd&&Math.abs(ce-Ze)<bd?nR(i):(P=Y-Ee,M=J-Fe,C=ce-Ze,V=1/Math.hypot(P,M,C),P*=V,M*=V,C*=V,a=ve*C-he*M,u=he*P-pe*C,f=pe*M-ve*P,V=Math.hypot(a,u,f),V?(V=1/V,a*=V,u*=V,f*=V):(a=0,u=0,f=0),l=M*f-C*u,x=C*a-P*f,w=P*u-M*a,V=Math.hypot(l,x,w),V?(V=1/V,l*=V,x*=V,w*=V):(l=0,x=0,w=0),i[0]=a,i[1]=l,i[2]=P,i[3]=0,i[4]=u,i[5]=x,i[6]=M,i[7]=0,i[8]=f,i[9]=w,i[10]=C,i[11]=0,i[12]=-(a*Y+u*J+f*ce),i[13]=-(l*Y+x*J+w*ce),i[14]=-(P*Y+M*J+C*ce),i[15]=1,i)}function mR(){var i=new Wl(4);return Wl!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function gR(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function Uu(i,e,t){var r=e[0],a=e[1],u=e[2],f=e[3];return i[0]=t[0]*r+t[4]*a+t[8]*u+t[12]*f,i[1]=t[1]*r+t[5]*a+t[9]*u+t[13]*f,i[2]=t[2]*r+t[6]*a+t[10]*u+t[14]*f,i[3]=t[3]*r+t[7]*a+t[11]*u+t[15]*f,i}(function(){var i=mR();return function(e,t,r,a,u,f){var l,x;for(t||(t=4),r||(r=0),a?x=Math.min(a*t+r,e.length):x=e.length,l=r;l<x;l+=t)i[0]=e[l],i[1]=e[l+1],i[2]=e[l+2],i[3]=e[l+3],u(i,i,f),e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],e[l+3]=i[3];return e}})();var Um;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(Um||(Um={}));const _R=45*Math.PI/180,yR=1,Kp=.1,Jp=500,xR=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Gs extends iR{static get IDENTITY(){return bR()}static get ZERO(){return vR()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Um}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,a,u,f,l,x,w,P,M,C,V,Y,J,ce){return this[0]=e,this[1]=t,this[2]=r,this[3]=a,this[4]=u,this[5]=f,this[6]=l,this[7]=x,this[8]=w,this[9]=P,this[10]=M,this[11]=C,this[12]=V,this[13]=Y,this[14]=J,this[15]=ce,this.check()}setRowMajor(e,t,r,a,u,f,l,x,w,P,M,C,V,Y,J,ce){return this[0]=e,this[1]=u,this[2]=w,this[3]=V,this[4]=t,this[5]=f,this[6]=P,this[7]=Y,this[8]=r,this[9]=l,this[10]=M,this[11]=J,this[12]=a,this[13]=x,this[14]=C,this[15]=ce,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(xR)}fromObject(e){return this.check()}fromQuaternion(e){return lR(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:a,top:u,near:f=Kp,far:l=Jp}=e;return l===1/0?wR(this,t,r,a,u,f):cR(this,t,r,a,u,f,l),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:a=[0,1,0]}=e;return pR(this,t,r,a),this.check()}ortho(e){const{left:t,right:r,bottom:a,top:u,near:f=Kp,far:l=Jp}=e;return fR(this,t,r,a,u,f,l),this.check()}orthographic(e){const{fovy:t=_R,aspect:r=yR,focalDistance:a=1,near:u=Kp,far:f=Jp}=e;px(t);const l=t/2,x=a*Math.tan(l),w=x*r;return this.ortho({left:-w,right:w,bottom:-x,top:x,near:u,far:f})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:a=.1,far:u=500}=e;return px(t),hR(this,t,r,a,u),this.check()}determinant(){return sR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),a=1/r[0],u=1/r[1],f=1/r[2];return e[0]=this[0]*a,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*a,e[5]=this[5]*u,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*a,e[9]=this[9]*u,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),a=1/r[0],u=1/r[1],f=1/r[2];return e[0]=this[0]*a,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=this[4]*a,e[4]=this[5]*u,e[5]=this[6]*f,e[6]=this[8]*a,e[7]=this[9]*u,e[8]=this[10]*f,e}transpose(){return rR(this,this),this.check()}invert(){return Nm(this,this),this.check()}multiplyLeft(e){return Ua(this,e,this),this.check()}multiplyRight(e){return Ua(this,this,e),this.check()}rotateX(e){return b1(this,this,e),this.check()}rotateY(e){return aR(this,this,e),this.check()}rotateZ(e){return w1(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return oR(this,this,e,t),this.check()}scale(e){return Vg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Vd(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Uu(t||[-0,-0,-0,-0],e,this),Xp(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let a;switch(r){case 2:a=VL(t||[-0,-0],e,this);break;case 3:a=v1(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Xp(a,e.length),a}transformAsVector(e,t){let r;switch(e.length){case 2:r=jL(t||[-0,-0],e,this);break;case 3:r=x1(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Xp(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let sd,od;function vR(){return sd||(sd=new Gs([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(sd)),sd}function bR(){return od||(od=new Gs,Object.freeze(od)),od}function px(i){if(i>Math.PI*2)throw Error("expected radians")}function wR(i,e,t,r,a,u){const f=2*u/(t-e),l=2*u/(a-r),x=(t+e)/(t-e),w=(a+r)/(a-r),P=-1,M=-1,C=-2*u;return i[0]=f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=l,i[6]=0,i[7]=0,i[8]=x,i[9]=w,i[10]=P,i[11]=M,i[12]=0,i[13]=0,i[14]=C,i[15]=0,i}const mx=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,TR={lightSources:{}};function Qp(){let{color:i=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(t=>t*e/255)}function ER(i){let{ambientLight:e,pointLights:t=[],directionalLights:r=[]}=i;const a={};return e?a["lighting_uAmbientLight.color"]=Qp(e):a["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((u,f)=>{a["lighting_uPointLight[".concat(f,"].color")]=Qp(u),a["lighting_uPointLight[".concat(f,"].position")]=u.position,a["lighting_uPointLight[".concat(f,"].attenuation")]=u.attenuation||[1,0,0]}),a.lighting_uPointLightCount=t.length,r.forEach((u,f)=>{a["lighting_uDirectionalLight[".concat(f,"].color")]=Qp(u),a["lighting_uDirectionalLight[".concat(f,"].direction")]=u.direction}),a.lighting_uDirectionalLightCount=r.length,a}function T1(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:TR;if("lightSources"in i){const{ambientLight:e,pointLights:t,directionalLights:r}=i.lightSources||{};return e||t&&t.length>0||r&&r.length>0?Object.assign({},ER({ambientLight:e,pointLights:t,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const e={pointLights:[],directionalLights:[]};for(const t of i.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break}return T1({lightSources:e})}return{}}const SR={name:"lights",vs:mx,fs:mx,getUniforms:T1,defines:{MAX_LIGHTS:3}},AR=new Uint8Array([0,255,255,255]),PR={pickingSelectedColor:null,pickingHighlightColor:AR,pickingActive:!1,pickingAttribute:!1};function IR(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:PR;const e={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(i.pickingHighlightColor){const t=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return i.pickingActive!==void 0&&(e.picking_uActive=Boolean(i.pickingActive),e.picking_uAttribute=Boolean(i.pickingAttribute)),e}const CR=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,MR=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,LR={name:"picking",vs:CR,fs:MR,getUniforms:IR},RR=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,kR={};function DR(i){const{ambient:e=.35,diffuse:t=.6,shininess:r=32,specularColor:a=[30,30,30]}=i;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:r,lighting_uSpecularColor:a.map(u=>u/255)}}function zR(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kR;if(!("material"in i))return{};const{material:e}=i;return e?DR(e):{lighting_uEnabled:!1}}const OR={name:"gouraud-lighting",dependencies:[SR],vs:RR,defines:{LIGHTING_VERTEX:1},getUniforms:zR},FR=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,BR={name:"transform",vs:FR,fs:null};class Vu{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Vu(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:a={},inject:u={},varyings:f=[],bufferMode:l=35981,transpileToGLSL100:x=!1}=e,w=this._getModuleList(e.modules),P=this._getHash(t),M=this._getHash(r),C=w.map(he=>this._getHash(he.name)).sort(),V=f.map(he=>this._getHash(he)),Y=Object.keys(a).sort(),J=Object.keys(u).sort(),ce=[],pe=[];for(const he of Y)ce.push(this._getHash(he)),ce.push(this._getHash(a[he]));for(const he of J)pe.push(this._getHash(he)),pe.push(this._getHash(u[he]));const ve="".concat(P,"/").concat(M,"D").concat(ce.join("/"),"M").concat(C.join("/"),"I").concat(pe.join("/"),"V").concat(V.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(x?"T":"");if(!this._programCache[ve]){const he=yL(this.gl,{vs:t,fs:r,modules:w,inject:u,defines:a,hookFunctions:this._hookFunctions,transpileToGLSL100:x});this._programCache[ve]=new a1(this.gl,{hash:ve,vs:he.vs,fs:he.fs,varyings:f,bufferMode:l}),this._getUniforms[ve]=he.getUniforms||(Ee=>{}),this._useCounts[ve]=0}return this._useCounts[ve]++,this._programCache[ve]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let a=0;for(let u=0,f=this._defaultModules.length;u<f;++u){const l=this._defaultModules[u],x=l.name;t[a++]=l,r[x]=!0}for(let u=0,f=e.length;u<f;++u){const l=e[u],x=l.name;r[x]||(t[a++]=l,r[x]=!0)}return t.length=a,t}}const NR={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function UR(i,e,t){const r={};let a=e.indices;for(const u in e.attributes){const f=e.attributes[u],l=VR(u,t);if(u==="indices")a=f;else if(f.constant)r[l]=f.value;else{const x=f.value,w={...f};delete w.value,r[l]=[new Ii(i,x),w],jR(u,w)}}if(a){const u=a.value||a;gt(u instanceof Uint16Array||u instanceof Uint32Array,'attribute array for "indices" must be of integer type');const f={size:1,isIndexed:a.isIndexed===void 0?!0:a.isIndexed};r.indices=[new Ii(i,{data:u,target:34963}),f]}return r}function VR(i,e){const{attributeMap:t=NR}=e||{};return t&&t[i]||i}function jR(i,e){let t;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}gt(Number.isFinite(e.size),"attribute ".concat(i," needs size"))}const Tl=2,GR=1e4,WR="Model needs drawMode and vertexCount",gx=()=>{},HR={};class ta{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=ea("model")}=t;gt(ff(e)),this.id=r,this.gl=e,this.id=t.id||ea("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Vu.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:a,modules:u,defines:f,inject:l,varyings:x,bufferMode:w,transpileToGLSL100:P}=e;this.programProps={program:t,vs:r,fs:a,modules:u,defines:f,inject:l,varyings:x,bufferMode:w,transpileToGLSL100:P},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},gt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),WR)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:a,modules:u,defines:f,inject:l,varyings:x,bufferMode:w,transpileToGLSL100:P}=e;this.programProps={program:t,vs:r,fs:a,modules:u,defines:f,inject:l,varyings:x,bufferMode:w,transpileToGLSL100:P},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return gt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return gt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=UR(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Vl(e))return this;const t={};for(const r in e){const a=e[r];t[r]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return Og(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:a={},attributes:u={},transformFeedback:f=this.transformFeedback,parameters:l={},vertexArray:x=this.vertexArray}=e;this.setAttributes(u),this.updateModuleSettings(t),this.setUniforms(a);let w;Rt.priority>=Tl&&(w=this._logDrawCallStart(Tl));const P=this.vertexArray.getDrawParams(),{isIndexed:M=P.isIndexed,indexType:C=P.indexType,indexOffset:V=P.indexOffset,vertexArrayInstanced:Y=P.isInstanced}=this.props;Y&&!this.isInstanced&&Rt.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:J,instanceCount:ce}=this,{onBeforeRender:pe=gx,onAfterRender:ve=gx}=this.props;pe(),this.program.setUniforms(this.uniforms);const he=this.program.draw(Object.assign(HR,e,{logPriority:w,uniforms:null,framebuffer:r,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:x,transformFeedback:f,isIndexed:M,indexType:C,isInstanced:J,instanceCount:ce,offset:M?V:0}));return ve(),Rt.priority>=Tl&&this._logDrawCallEnd(w,x,r),he}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:a=[]}=e;let{parameters:u}=e;r&&this._setFeedbackBuffers(r),t&&(u=Object.assign({},u,{[35977]:t})),a.forEach(f=>f.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:u}))}finally{a.forEach(f=>f.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Rt.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:a,modules:u,inject:f,defines:l,varyings:x,bufferMode:w,transpileToGLSL100:P}=this.programProps;t=this.programManager.get({vs:r,fs:a,modules:u,inject:f,defines:l,varyings:x,bufferMode:w,transpileToGLSL100:P}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}gt(t instanceof a1,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new kM(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof Ii&&t.delete()}}_setAnimationProps(e){this.animated&&gt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Vl(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new l1(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:GR;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),Rt.group(Tl,">>> DRAWING MODEL ".concat(this.id),{collapsed:Rt.level<=2})(),e}_logDrawCallEnd(e,t,r,a){if(e===void 0)return;const u=OM({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:f,unusedTable:l,unusedCount:x}=tx({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:w,count:P}=tx({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});P>0&&Rt.log("MISSING UNIFORMS",Object.keys(w))(),x>0&&Rt.log("UNUSED UNIFORMS",Object.keys(l))();const M=BM(this.vertexArray.configuration);Rt.table(e,u)(),Rt.table(e,f)(),Rt.table(e+1,M)(),a&&a.log({logLevel:Tl,message:"Rendered to ".concat(a.id)}),Rt.groupEnd(Tl)()}}class qR{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:a}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:a}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof Ii?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&gt(ci(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const a in this.feedbackMap){const u=this.feedbackMap[a];a in t&&(r[u]=a)}Object.assign(r,e.feedbackBuffers);for(const a in r){const u=r[a];if(typeof u=="string"){const f=t[u],{byteLength:l,usage:x,accessor:w}=f;r[a]=this._createNewBuffer(a,{byteLength:l,usage:x,accessor:w})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:a}=r;e.transformFeedback=new l1(this.gl,{program:a,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),a=this._getNextIndex();this.bindings[a]=this._updateBinding(this.bindings[a],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const a in this.feedbackMap){const u=this.feedbackMap[a];t[a]=e.feedbackBuffers[u],r[u]=e.sourceBuffers[a],gt(r[u]instanceof Ii)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new Ii(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const $R="transform_uSampler_",jd="transform_uSize_",_x="transform_position";function ZR(i){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:a}=i,f=Object.keys(t).length,l=null;const x={};let w=e,P={};if(f>0||r){const M=w.split(`
`),C=M.slice();if(M.forEach((V,Y,J)=>{if(f>0){const ce=QR(V,t);if(ce){const{updatedLine:pe,inject:ve}=ce;C[Y]=pe,P=Om([P,ve]),Object.assign(x,ce.samplerTextureMap),f--}}r&&!l&&(l=JR(V,r))}),r){gt(a);const V="".concat(jd).concat(r),Y="uniform vec2 ".concat(V,`;
`),J="     vec2 ".concat(_x," = transform_getPos(").concat(V,`);
     gl_Position = vec4(`).concat(_x,`, 0, 1.);
`);P=Om([P,{"vs:#decl":Y,"vs:#main-start":J}])}w=C.join(`
`)}return{vs:w,targetTextureType:l,inject:P,samplerTextureMap:x}}function XR(i){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=i;const a={};let u,f;t&&({width:u,height:f}=r,a["".concat(jd).concat(t)]=[u,f]);for(const l in e)({width:u,height:f}=e[l]),a["".concat(jd).concat(l)]=[u,f];return a}function YR(i){return m1(i,["attribute","in"])}function KR(i){const e="".concat($R).concat(i),t="".concat(jd).concat(i),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function JR(i,e){const t=m1(i,["varying","out"]);return t&&t.name===e?t.type:null}function QR(i,e){const t={},r=YR(i);if(!r)return null;const{type:a,name:u}=r;if(u&&e[u]){const f="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:x,uniformDeclerations:w}=KR(u),P=PL(a),M="  ".concat(a," ").concat(u," = transform_getInput(").concat(l,", ").concat(x,").").concat(P,`;
`);return t[l]=u,{updatedLine:f,inject:{"vs:#decl":w,"vs:#main-start":M},samplerTextureMap:t}}return null}const e3={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},t3="transform_output";class i3{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:a,targetTexture:u}=this.bindings[this.currentIndex],f=Object.assign({},t,e.attributes),l=Object.assign({},e.uniforms),x=Object.assign({},e.parameters);let w=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){f.transform_elementID=this.elementIDBuffer;for(const M in this.samplerTextureMap){const C=this.samplerTextureMap[M];l[M]=r[C]}this._setSourceTextureParameters();const P=XR({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:u});Object.assign(l,P)}return this.hasTargetTexture&&(w=!1,x.viewport=[0,0,a.width,a.height]),{attributes:f,framebuffer:a,uniforms:l,discard:w,parameters:x}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=mf(t);if(!e)return r;const a=r.constructor,u=IL(this.targetTextureType),f=new a(r.length*u/4);let l=0;for(let x=0;x<r.length;x+=4)for(let w=0;w<u;w++)f[l++]=r[x+w];return f}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof jr)return r;const a=t[r];return a?(this._targetRefTexName=r,this._createNewTexture(a)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:a}=e,u=this._createTargetTexture({sourceTextures:r,textureOrReference:a});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:u}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,a,u)=>{u[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new Ii(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),a=this._getNextIndex();this.bindings[a]=this._updateBinding(this.bindings[a],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:a,targetTexture:u}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,r),u){e.targetTexture=u;const{width:f,height:l}=u,{framebuffer:x}=e;x?(x.update({attachments:{[36064]:u},resizeAttachments:!1}),x.resize({width:f,height:l})):e.framebuffer=new Pn(this.gl,{id:"transform-framebuffer",width:f,height:l,attachments:{[36064]:u}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(e3)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=wC(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:a,uniforms:u,targetTextureType:f,inject:l,samplerTextureMap:x}=ZR({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),w=Om([e.inject||{},l]);this.targetTextureType=f,this.samplerTextureMap=x;const P=e._fs||g1({version:s1(a),input:this.targetTextureVarying,inputType:f,output:t3}),M=this.hasSourceTextures||this.targetTextureVarying?[BR].concat(e.modules||[]):e.modules;return{vs:a,fs:P,modules:M,uniforms:u,inject:w}}}class jg{static isSupported(e){return ci(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();gt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const a=r.getData(e);if(a)return a}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new ta(t,Object.assign({},e,{fs:e.fs||g1({version:s1(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const a of r)t=a.updateModelProps(t);return t}_buildResourceTransforms(e,t){n3(t)&&(this.bufferTransform=new qR(e,t)),r3(t)&&(this.textureTransform=new i3(e,t)),gt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const a of r)t=Object.assign(t,a.getDrawOptions(t));return t}}function n3(i){return!!(!Vl(i.feedbackBuffers)||!Vl(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function r3(i){return!!(!Vl(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const yx={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Ql{static get DRAW_MODE(){return yx}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=ea("geometry"),drawMode:r=yx.TRIANGLES,attributes:a={},indices:u=null,vertexCount:f=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(a,u),this.vertexCount=f||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let a=e[r];a=ArrayBuffer.isView(a)?{value:a}:a,gt(ArrayBuffer.isView(a.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!a.size&&(a.size=3),r==="indices"?(gt(!this.indices),this.indices=a):this.attributes[r]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const a in e){const u=e[a],{value:f,size:l,constant:x}=u;!x&&f&&l>=1&&(r=Math.min(r,f.length/l))}return gt(Number.isFinite(r)),r}}let s3=1,o3=1;class E1{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:a=1,repeat:u=1}=e,f=s3++,l={time:0,delay:t,duration:r,rate:a,repeat:u};return this._setChannelTime(l,this.time),this.channels.set(f,l),f}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const a of t)this._setChannelTime(a,this.time);const r=this.animations.values();for(const a of r){const{animation:u,channel:f}=a;u.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=o3++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,a=e.duration*e.repeat;r>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const a3=[255,255,255],l3=1;let c3=0;class u3{constructor(e={}){B(this,"id",void 0),B(this,"color",void 0),B(this,"intensity",void 0),B(this,"type","ambient");const{color:t=a3}=e,{intensity:r=l3}=e;this.id=e.id||"ambient-".concat(c3++),this.color=t,this.intensity=r}}const h3=[255,255,255],d3=1,f3=[0,0,-1];let p3=0;class xx{constructor(e={}){B(this,"id",void 0),B(this,"color",void 0),B(this,"intensity",void 0),B(this,"type","directional"),B(this,"direction",void 0),B(this,"shadow",void 0);const{color:t=h3}=e,{intensity:r=d3}=e,{direction:a=f3}=e,{_shadow:u=!1}=e;this.id=e.id||"directional-".concat(p3++),this.color=t,this.intensity=r,this.type="directional",this.direction=new js(a).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class m3{constructor(e,t={id:"pass"}){B(this,"id",void 0),B(this,"gl",void 0),B(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Gg extends m3{constructor(...e){super(...e),B(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return uo(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:a,views:u,onViewportActive:f,clearStack:l=!0,clearCanvas:x=!0}=e;e.pass=e.pass||"unknown";const w=this.gl;x&&_3(w,t),l&&(this._lastRenderIndex=-1);const P=[];for(const M of a){const C=u&&u[M.id];f==null||f(M);const V=this._getDrawLayerParams(M,e),Y=M.subViewports||[M];for(const J of Y){const ce=this._drawLayersInViewport(w,{target:t,moduleParameters:r,viewport:J,view:C,pass:e.pass,layers:e.layers},V);P.push(ce)}}return P}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:a=!1,layerFilter:u,cullRect:f,effects:l,moduleParameters:x},w=!1){const P=[],M=S1(this._lastRenderIndex+1),C={layer:t[0],viewport:e,isPicking:a,renderPass:r,cullRect:f},V={};for(let Y=0;Y<t.length;Y++){const J=t[Y],ce=this._shouldDrawLayer(J,C,u,V),pe={shouldDrawLayer:ce};ce&&!w&&(pe.layerRenderIndex=M(J,ce),pe.moduleParameters=this._getModuleParameters(J,l,r,x),pe.layerParameters=this.getLayerParameters(J,Y,e)),P[Y]=pe}return P}_drawLayersInViewport(e,{layers:t,moduleParameters:r,pass:a,target:u,viewport:f,view:l},x){const w=g3(e,{moduleParameters:r,target:u,viewport:f});if(l&&l.props.clear){const M=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;gs(e,{scissorTest:!0,scissor:w},()=>Og(e,M))}const P={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};uo(e,{viewport:w});for(let M=0;M<t.length;M++){const C=t[M],{shouldDrawLayer:V,layerRenderIndex:Y,moduleParameters:J,layerParameters:ce}=x[M];if(V&&C.props.pickable&&P.pickableCount++,C.isComposite)P.compositeCount++;else if(V){P.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Y),J.viewport=f;try{C._drawLayer({moduleParameters:J,uniforms:{layerIndex:Y},parameters:ce})}catch(pe){C.raiseError(pe,"drawing ".concat(C," to ").concat(a))}}}return P}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,a){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(t))return!1;t.layer=f,f=f.parent}if(r){const l=t.layer.id;if(l in a||(a[l]=r(t)),!a[l])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,a){var u;const f=Object.assign(Object.create(((u=e.internalState)===null||u===void 0?void 0:u.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Ul(this.gl)});if(t)for(const x of t){var l;Object.assign(f,(l=x.getModuleParameters)===null||l===void 0?void 0:l.call(x,e))}return Object.assign(f,this.getModuleParameters(e,t),a)}}function S1(i=0,e={}){const t={},r=(a,u)=>{const f=a.props._offset,l=a.id,x=a.parent&&a.parent.id;let w;if(x&&!(x in e)&&r(a.parent,!1),x in t){const P=t[x]=t[x]||S1(e[x],e);w=P(a,u),t[l]=P}else Number.isFinite(f)?(w=f+(e[x]||0),t[l]=null):w=i;return u&&w>=i&&(i=w+1),e[l]=w,w};return r}function g3(i,{moduleParameters:e,target:t,viewport:r}){const a=t&&t.id!=="default-framebuffer",u=e&&e.devicePixelRatio||Ul(i),f=a?t.height:i.drawingBufferHeight,l=r;return[l.x*u,f-(l.y+l.height)*u,l.width*u,l.height*u]}function _3(i,e){const t=e?e.width:i.drawingBufferWidth,r=e?e.height:i.drawingBufferHeight;uo(i,{viewport:[0,0,t,r]}),i.clear(16640)}class y3 extends Gg{constructor(e,t){super(e,t),B(this,"shadowMap",void 0),B(this,"depthBuffer",void 0),B(this,"fbo",void 0),this.shadowMap=new jr(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Il(e,{format:33189,width:1,height:1}),this.fbo=new Pn(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const t=this.fbo;gs(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],a=Ul(this.gl),u=r.width*a,f=r.height*a;(u!==t.width||f!==t.height)&&t.resize({width:u,height:f}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const A1="#define SMOOTH_EDGE_RADIUS 0.5",x3=`
`.concat(A1,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),v3=`
`.concat(A1,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),b3={name:"geometry",vs:x3,fs:v3},w3=Object.keys(yi).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(yi[i],";")).join(""),T3=Object.keys(Ns).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(Ns[i],";")).join(""),E3=Object.keys(Qo).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(Qo[i],";")).join(""),S3="".concat(w3,`
`).concat(T3,`
`).concat(E3,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function A3(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function ju(i){let e={},t;return r=>{for(const a in r)if(!A3(r[a],e[a])){t=i(r),e=r;break}return t}}const vx=[0,0,0,0],P3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],P1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],I3=[0,0,0],I1=[0,0,0],C3=ju(R3);function C1(i,e,t=I1){t.length<3&&(t=[t[0],t[1],0]);let r=t,a,u=!0;switch(e===yi.LNGLAT_OFFSETS||e===yi.METER_OFFSETS?a=t:a=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Ns.WEB_MERCATOR:(e===yi.LNGLAT||e===yi.CARTESIAN)&&(a=[0,0,0],u=!1);break;case Ns.WEB_MERCATOR_AUTO_OFFSET:e===yi.LNGLAT?r=a:e===yi.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],a=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Ns.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case Ns.GLOBE:u=!1,a=null;break;default:u=!1}return{geospatialOrigin:a,shaderCoordinateOrigin:r,offsetMode:u}}function M3(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:a}=i;let{viewMatrix:u,viewProjectionMatrix:f}=i,l=vx,x=vx,w=i.cameraPosition;const{geospatialOrigin:P,shaderCoordinateOrigin:M,offsetMode:C}=C1(i,e,t);return C&&(x=i.projectPosition(P||M),w=[w[0]-x[0],w[1]-x[1],w[2]-x[2]],x[3]=1,l=Uu([],x,f),u=r||u,f=Ua([],a,u),f=Ua([],f,P3)),{viewMatrix:u,viewProjectionMatrix:f,projectionCenter:l,originCommon:x,cameraPosCommon:w,shaderCoordinateOrigin:M,geospatialOrigin:P}}function L3({viewport:i,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=yi.DEFAULT,coordinateOrigin:a=I1,autoWrapLongitude:u=!1}){r===yi.DEFAULT&&(r=i.isGeospatial?yi.LNGLAT:yi.CARTESIAN);const f=C3({viewport:i,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:a});return f.project_uWrapLongitude=u,f.project_uModelMatrix=t||P1,f}function R3({viewport:i,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:a,viewProjectionMatrix:u,originCommon:f,cameraPosCommon:l,shaderCoordinateOrigin:x,geospatialOrigin:w}=M3(i,t,r),P=i.getDistanceScales(),M=[i.width*e,i.height*e],C=Uu([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,V={project_uCoordinateSystem:t,project_uProjectionMode:i.projectionMode,project_uCoordinateOrigin:x,project_uCommonOrigin:f.slice(0,3),project_uCenter:a,project_uPseudoMeters:Boolean(i._pseudoMeters),project_uViewportSize:M,project_uDevicePixelRatio:e,project_uFocalDistance:C,project_uCommonUnitsPerMeter:P.unitsPerMeter,project_uCommonUnitsPerWorldUnit:P.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:I3,project_uScale:i.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:P1,project_uCameraPosition:l};if(w){const Y=i.getDistanceScales(w);switch(t){case yi.METER_OFFSETS:V.project_uCommonUnitsPerWorldUnit=Y.unitsPerMeter,V.project_uCommonUnitsPerWorldUnit2=Y.unitsPerMeter2;break;case yi.LNGLAT:case yi.LNGLAT_OFFSETS:i._pseudoMeters||(V.project_uCommonUnitsPerMeter=Y.unitsPerMeter),V.project_uCommonUnitsPerWorldUnit=Y.unitsPerDegree,V.project_uCommonUnitsPerWorldUnit2=Y.unitsPerDegree2;break;case yi.CARTESIAN:V.project_uCommonUnitsPerWorldUnit=[1,1,Y.unitsPerMeter[2]],V.project_uCommonUnitsPerWorldUnit2=[0,0,Y.unitsPerMeter2[2]];break}}return V}const k3={};function D3(i=k3){return"viewport"in i?L3(i):{}}const Wg={name:"project",dependencies:[LL,b3],vs:S3,getUniforms:D3};function z3(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Dl(i,e){const t=Uu([],e,i);return gR(t,t,1/t[3]),t}function bx(i,e){const t=i%e;return t<0?e+t:t}function Vm(i,e,t){return i<e?e:i>t?t:i}function O3(i){return Math.log(i)*Math.LOG2E}const Hg=Math.log2||O3;function ho(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ds=Math.PI,M1=ds/4,Qr=ds/180,jm=180/ds,Hl=512,Gd=4003e4,ad=85.051129,F3=1.5;function B3(i){return Hg(i)}function Cu(i){const[e,t]=i;ho(Number.isFinite(e)),ho(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Qr,a=t*Qr,u=Hl*(r+ds)/(2*ds),f=Hl*(ds+Math.log(Math.tan(M1+a*.5)))/(2*ds);return[u,f]}function ql(i){const[e,t]=i,r=e/Hl*(2*ds)-ds,a=2*(Math.atan(Math.exp(t/Hl*(2*ds)-ds))-M1);return[r*jm,a*jm]}function N3(i){const{latitude:e}=i;ho(Number.isFinite(e));const t=Math.cos(e*Qr);return B3(Gd*t)-9}function wd(i){const e=Math.cos(i*Qr);return Hl/Gd/e}function Gm(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;ho(Number.isFinite(e)&&Number.isFinite(t));const a=Hl,u=Math.cos(e*Qr),f=a/360,l=f/u,x=a/Gd/u,w={unitsPerMeter:[x,x,x],metersPerUnit:[1/x,1/x,1/x],unitsPerDegree:[f,l,x],degreesPerUnit:[1/f,1/l,1/x]};if(r){const P=Qr*Math.tan(e*Qr)/u,M=f*P/2,C=a/Gd*P,V=C/l*x;w.unitsPerDegree2=[0,M,C],w.unitsPerMeter2=[V,0,V]}return w}function L1(i,e){const[t,r,a]=i,[u,f,l]=e,{unitsPerMeter:x,unitsPerMeter2:w}=Gm({longitude:t,latitude:r,highPrecision:!0}),P=Cu(i);P[0]+=u*(x[0]+w[0]*f),P[1]+=f*(x[1]+w[1]*f);const M=ql(P),C=(a||0)+(l||0);return Number.isFinite(a)||Number.isFinite(l)?[M[0],M[1],C]:M}function U3(i){const{height:e,pitch:t,bearing:r,altitude:a,scale:u,center:f}=i,l=z3();Vd(l,l,[0,0,-a]),b1(l,l,-t*Qr),w1(l,l,r*Qr);const x=u/e;return Vg(l,l,[x,x,x]),f&&Vd(l,l,qL([],f)),l}function V3(i){const{width:e,height:t,altitude:r,pitch:a=0,offset:u,center:f,scale:l,nearZMultiplier:x=1,farZMultiplier:w=1}=i;let{fovy:P=Wd(F3)}=i;r!==void 0&&(P=Wd(r));const M=P*Qr,C=a*Qr,V=R1(P);let Y=V;f&&(Y+=f[2]*l/Math.cos(C)/t);const J=M*(.5+(u?u[1]:0)/t),ce=Math.sin(J)*Y/Math.sin(Vm(Math.PI/2-C-J,.01,Math.PI-.01)),pe=Math.sin(C)*ce+Y,ve=Y*10,he=Math.min(pe*w,ve);return{fov:M,aspect:e/t,focalDistance:V,near:x,far:he}}function Wd(i){return 2*Math.atan(.5/i)*jm}function R1(i){return .5/Math.tan(.5*i*Qr)}function k1(i,e){const[t,r,a=0]=i;return ho(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(a)),Dl(e,[t,r,a,1])}function qg(i,e,t=0){const[r,a,u]=i;if(ho(Number.isFinite(r)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(u))return Dl(e,[r,a,u,1]);const f=Dl(e,[r,a,0,1]),l=Dl(e,[r,a,1,1]),x=f[2],w=l[2],P=x===w?0:((t||0)-x)/(w-x);return y1([],f,l,P)}function j3(i){const{width:e,height:t,bounds:r,minExtent:a=0,maxZoom:u=24,offset:f=[0,0]}=i,[[l,x],[w,P]]=r,M=G3(i.padding),C=Cu([l,Vm(P,-ad,ad)]),V=Cu([w,Vm(x,-ad,ad)]),Y=[Math.max(Math.abs(V[0]-C[0]),a),Math.max(Math.abs(V[1]-C[1]),a)],J=[e-M.left-M.right-Math.abs(f[0])*2,t-M.top-M.bottom-Math.abs(f[1])*2];ho(J[0]>0&&J[1]>0);const ce=J[0]/Y[0],pe=J[1]/Y[1],ve=(M.right-M.left)/2/ce,he=(M.top-M.bottom)/2/pe,Ee=[(V[0]+C[0])/2+ve,(V[1]+C[1])/2+he],Fe=ql(Ee),Ze=Math.min(u,Hg(Math.abs(Math.min(ce,pe))));return ho(Number.isFinite(Ze)),{longitude:Fe[0],latitude:Fe[1],zoom:Ze}}function G3(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(ho(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const wx=Math.PI/180;function W3(i,e=0){const{width:t,height:r,unproject:a}=i,u={targetZ:e},f=a([0,r],u),l=a([t,r],u);let x,w;const P=i.fovy?.5*i.fovy*wx:Math.atan(.5/i.altitude),M=(90-i.pitch)*wx;return P>M-.01?(x=Tx(i,0,e),w=Tx(i,t,e)):(x=a([0,0],u),w=a([t,0],u)),[f,l,w,x]}function Tx(i,e,t){const{pixelUnprojectionMatrix:r}=i,a=Dl(r,[e,0,1,1]),u=Dl(r,[e,i.height,1,1]),l=(t*i.distanceScales.unitsPerMeter[2]-a[2])/(u[2]-a[2]),x=y1([],a,u,l),w=ql(x);return w.push(t),w}const Ex=512;function H3(i){const{width:e,height:t,pitch:r=0}=i;let{longitude:a,latitude:u,zoom:f,bearing:l=0}=i;(a<-180||a>180)&&(a=bx(a+180,360)-180),(l<-180||l>180)&&(l=bx(l+180,360)-180);const x=Hg(t/Ex);if(f<=x)f=x,u=0;else{const w=t/2/Math.pow(2,f),P=ql([0,w])[1];if(u<P)u=P;else{const M=ql([0,Ex-w])[1];u>M&&(u=M)}}return{width:e,height:t,longitude:a,latitude:u,zoom:f,pitch:r,bearing:l}}const q3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,$3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Z3=ju(Q3),X3=ju(ek),Y3=[0,0,0,1],K3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function J3(i,e){const[t,r,a]=i,u=qg([t,r,a],e);return Number.isFinite(a)?u:[u[0],u[1],0]}function Q3({viewport:i,center:e}){return new Gs(i.viewProjectionMatrix).invert().transform(e)}function ek({viewport:i,shadowMatrices:e}){const t=[],r=i.pixelUnprojectionMatrix,a=i.isGeospatial?void 0:1,u=[[0,0,a],[i.width,0,a],[0,i.height,a],[i.width,i.height,a],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(f=>J3(f,r));for(const f of e){const l=f.clone().translate(new js(i.center).negate()),x=u.map(P=>l.transform(P)),w=new Gs().ortho({left:Math.min(...x.map(P=>P[0])),right:Math.max(...x.map(P=>P[0])),bottom:Math.min(...x.map(P=>P[1])),top:Math.max(...x.map(P=>P[1])),near:Math.min(...x.map(P=>-P[2])),far:Math.max(...x.map(P=>-P[2]))});t.push(w.multiplyRight(f))}return t}function tk(i,e){const{shadowEnabled:t=!0}=i;if(!t||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:Boolean(i.drawToShadowMap),shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||Y3,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},a=Z3({viewport:i.viewport,center:e.project_uCenter}),u=[],f=X3({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let l=0;l<i.shadowMatrices.length;l++){const x=f[l],w=x.clone().translate(new js(i.viewport.center).negate());e.project_uCoordinateSystem===yi.LNGLAT&&e.project_uProjectionMode===Ns.WEB_MERCATOR?(f[l]=w,u[l]=a):(f[l]=x.clone().multiplyRight(K3),u[l]=w.transform(a))}for(let l=0;l<f.length;l++)r["shadow_uViewProjectionMatrices[".concat(l,"]")]=f[l],r["shadow_uProjectCenters[".concat(l,"]")]=u[l],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(l)]=i.shadowMaps[l]:r["shadow_uShadowMap".concat(l)]=i.dummyShadowMap;return r}const em={name:"shadow",dependencies:[Wg],vs:q3,fs:$3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(i={},e={})=>"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?tk(i,e):{}},ik={color:[255,255,255],intensity:1},Sx=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],nk=[0,0,0,200/255];class D1{constructor(e={}){B(this,"id","lighting-effect"),B(this,"props",void 0),B(this,"shadowColor",nk),B(this,"shadow",void 0),B(this,"ambientLight",void 0),B(this,"directionalLights",void 0),B(this,"pointLights",void 0),B(this,"shadowPasses",[]),B(this,"shadowMaps",[]),B(this,"dummyShadowMap",null),B(this,"programManager",void 0),B(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,{layers:t,layerFilter:r,viewports:a,onViewportActive:u,views:f}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Vu.getDefaultProgramManager(e),em&&this.programManager.addDefaultModule(em)),this.dummyShadowMap||(this.dummyShadowMap=new jr(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:t,layerFilter:r,viewports:a,onViewportActive:u,views:f,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(em),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Gs().lookAt({eye:new js(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new y3(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new u3(ik),this.directionalLights.push(new xx(Sx[0]),new xx(Sx[1])))}}class rk{constructor(e={}){B(this,"_pool",[]),B(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:a,padding:u=0,copy:f=!1,initialize:l=!1,maxCount:x}){const w=a||e&&e.constructor||Float32Array,P=t*r+u;if(ArrayBuffer.isView(e)){if(P<=e.length)return e;if(P*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,P)}let M=1/0;x&&(M=x*r+u);const C=this._allocate(w,P,l,M);return e&&f?C.set(e):l||C.fill(0,0,4),this._release(e),C}release(e){this._release(e)}_allocate(e,t,r,a){let u=Math.max(Math.ceil(t*this.opts.overAlloc),1);u>a&&(u=a);const f=this._pool,l=e.BYTES_PER_ELEMENT*u,x=f.findIndex(w=>w.byteLength>=l);if(x>=0){const w=new e(f.splice(x,1)[0],0,u);return r&&w.fill(0),w}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:a}=r,u=t.findIndex(f=>f.byteLength>=a);u<0?t.push(r):(u>0||t.length<this.opts.poolSize)&&t.splice(u,0,r),t.length>this.opts.poolSize&&t.shift()}}const $l=new rk;function su(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function sk(i){return[i[12],i[13],i[14]]}function ok(i){return{left:El(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:El(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:El(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:El(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:El(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:El(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const Ax=new js;function El(i,e,t,r){Ax.set(i,e,t);const a=Ax.len();return{distance:r/a,normal:new js(-i/a,-e/a,-t/a)}}function ak(i){return i-Math.fround(i)}let eu;function tm(i,e){const{size:t=1,startIndex:r=0}=e,a=e.endIndex!==void 0?e.endIndex:i.length,u=(a-r)/t;eu=$l.allocate(eu,u,{type:Float32Array,size:t*2});let f=r,l=0;for(;f<a;){for(let x=0;x<t;x++){const w=i[f++];eu[l+x]=w,eu[l+x+t]=ak(w)}l+=t*2}return eu.subarray(0,u*t*2)}function lk(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const ck=Math.PI/180,uk=su(),Px=[0,0,0],hk={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function dk({width:i,height:e,orthographic:t,fovyRadians:r,focalDistance:a,padding:u,near:f,far:l}){const x=i/e,w=t?new Gs().orthographic({fovy:r,aspect:x,focalDistance:a,near:f,far:l}):new Gs().perspective({fovy:r,aspect:x,near:f,far:l});if(u){const{left:P=0,right:M=0,top:C=0,bottom:V=0}=u,Y=Wo((P+i-M)/2,0,i)-i/2,J=Wo((C+e-V)/2,0,e)-e/2;w[8]-=Y*2/i,w[9]+=J*2/e}return w}class ec{constructor(e={}){B(this,"id",void 0),B(this,"x",void 0),B(this,"y",void 0),B(this,"width",void 0),B(this,"height",void 0),B(this,"padding",void 0),B(this,"isGeospatial",void 0),B(this,"zoom",void 0),B(this,"focalDistance",void 0),B(this,"position",void 0),B(this,"modelMatrix",void 0),B(this,"distanceScales",void 0),B(this,"scale",void 0),B(this,"center",void 0),B(this,"cameraPosition",void 0),B(this,"projectionMatrix",void 0),B(this,"viewMatrix",void 0),B(this,"viewMatrixUncentered",void 0),B(this,"viewMatrixInverse",void 0),B(this,"viewProjectionMatrix",void 0),B(this,"pixelProjectionMatrix",void 0),B(this,"pixelUnprojectionMatrix",void 0),B(this,"resolution",void 0),B(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||hk,this.focalDistance=e.focalDistance||1,this.position=e.position||Px,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ns.WEB_MERCATOR:Ns.WEB_MERCATOR_AUTO_OFFSET:Ns.IDENTITY}equals(e){return e instanceof ec?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Iu(e.projectionMatrix,this.projectionMatrix)&&Iu(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),a=k1(r,this.pixelProjectionMatrix),[u,f]=a,l=t?f:this.height-f;return e.length===2?[u,l]:[u,l,a[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[a,u,f]=e,l=t?u:this.height-u,x=r&&r*this.distanceScales.unitsPerMeter[2],w=qg([a,l,f],this.pixelUnprojectionMatrix,x),[P,M,C]=this.unprojectPosition(w);return Number.isFinite(f)?[P,M,C]:Number.isFinite(r)?[P,M,r]:[P,M]}projectPosition(e){const[t,r]=this.projectFlat(e),a=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,a]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),a=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,a]}projectFlat(e){if(this.isGeospatial){const t=Cu(e);return t[1]=Wo(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ql(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),a=this.unproject([this.width,0],t),u=this.unproject([0,this.height],t),f=this.unproject([this.width,this.height],t);return[Math.min(r[0],a[0],u[0],f[0]),Math.min(r[1],a[1],u[1],f[1]),Math.max(r[0],a[0],u[0],f[0]),Math.max(r[1],a[1],u[1],f[1])]}getDistanceScales(e){return e?Gm({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:a=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+a}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,ok(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=N3({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Gm({latitude:r,longitude:t}));const a=Math.pow(2,this.zoom);this.scale=a;const{position:u,modelMatrix:f}=e;let l=Px;if(u&&(l=f?new Gs(f).transformAsVector(u,[]):u),this.isGeospatial){const x=this.projectPosition([t,r,0]);this.center=new js(l).scale(this.distanceScales.unitsPerMeter).add(x)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=uk,projectionMatrix:r=null,orthographic:a=!1,fovyRadians:u,fovy:f=75,near:l=.1,far:x=1e3,padding:w=null,focalDistance:P=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Gs().multiplyRight(t).translate(new js(this.center).negate()),this.projectionMatrix=r||dk({width:this.width,height:this.height,orthographic:a,fovyRadians:u||f*ck,focalDistance:P,padding:w,near:l,far:x});const M=su();Ua(M,M,this.projectionMatrix),Ua(M,M,this.viewMatrix),this.viewProjectionMatrix=M,this.viewMatrixInverse=Nm([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=sk(this.viewMatrixInverse);const C=su(),V=su();Vg(C,C,[this.width/2,-this.height/2,1]),Vd(C,C,[1,-1,0]),Ua(V,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=V,this.pixelUnprojectionMatrix=Nm(su(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ai.warn("Pixel project matrix not invertible")()}}B(ec,"displayName","Viewport");class ja extends ec{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:a=0,pitch:u=0,bearing:f=0,nearZMultiplier:l=.1,farZMultiplier:x=1.01,orthographic:w=!1,projectionMatrix:P,repeat:M=!1,worldOffset:C=0,position:V,padding:Y,legacyMeterSizes:J=!1}=e;let{width:ce,height:pe,altitude:ve=1.5}=e;const he=Math.pow(2,a);ce=ce||1,pe=pe||1;let Ee,Fe=null;if(P)ve=P[5]/2,Ee=Wd(ve);else{e.fovy?(Ee=e.fovy,ve=R1(Ee)):Ee=Wd(ve);let ht;if(Y){const{top:_t=0,bottom:lt=0}=Y;ht=[0,Wo((_t+pe-lt)/2,0,pe)-pe/2]}Fe=V3({width:ce,height:pe,scale:he,center:V&&[0,0,V[2]*wd(t)],offset:ht,pitch:u,fovy:Ee,nearZMultiplier:l,farZMultiplier:x})}let Ze=U3({height:pe,pitch:u,bearing:f,scale:he,altitude:ve});C&&(Ze=new Gs().translate([512*C,0,0]).multiplyLeft(Ze)),super({...e,width:ce,height:pe,viewMatrix:Ze,longitude:r,latitude:t,zoom:a,...Fe,fovy:Ee,focalDistance:ve}),B(this,"longitude",void 0),B(this,"latitude",void 0),B(this,"pitch",void 0),B(this,"bearing",void 0),B(this,"altitude",void 0),B(this,"fovy",void 0),B(this,"orthographic",void 0),B(this,"_subViewports",void 0),B(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=a,this.pitch=u,this.bearing=f,this.altitude=ve,this.fovy=Ee,this.orthographic=w,this._subViewports=M?[]:null,this._pseudoMeters=J,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let a=t;a<=r;a++){const u=a?new ja({...this,worldOffset:a}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),a=(e[2]||0)*wd(e[1]);return[t,r,a]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),a=(e[2]||0)/wd(r);return[t,r,a]}addMetersToLngLat(e,t){return L1(e,t)}panByPosition(e,t){const r=qg(t,this.pixelUnprojectionMatrix),a=this.projectFlat(e),u=fx([],a,UL([],r)),f=fx([],this.center,u),[l,x]=this.unprojectFlat(f);return{longitude:l,latitude:x}}getBounds(e={}){const t=W3(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:a}=this,{longitude:u,latitude:f,zoom:l}=j3({width:r,height:a,bounds:e,...t});return new ja({width:r,height:a,longitude:u,latitude:f,zoom:l})}}B(ja,"displayName","WebMercatorViewport");const Ix=[0,0,0];function im(i,e,t=!1){const r=e.projectPosition(i);if(t&&e instanceof ja){const[a,u,f=0]=i,l=e.getDistanceScales([a,u]);r[2]=f*l.unitsPerMeter[2]}return r}function fk(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:a,fromCoordinateSystem:u,fromCoordinateOrigin:f}=i;return a===yi.DEFAULT&&(a=e.isGeospatial?yi.LNGLAT:yi.CARTESIAN),u===void 0&&(u=a),f===void 0&&(f=r),{viewport:e,coordinateSystem:a,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:u,fromCoordinateOrigin:f}}function z1(i,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:a,offsetMode:u}){let[f,l,x=0]=i;switch(t&&([f,l,x]=Uu([],[f,l,x,1],t)),r){case yi.LNGLAT:return im([f,l,x],e,u);case yi.LNGLAT_OFFSETS:return im([f+a[0],l+a[1],x+(a[2]||0)],e,u);case yi.METER_OFFSETS:return im(L1(a,[f,l,x]),e,u);case yi.CARTESIAN:default:return e.isGeospatial?[f+a[0],l+a[1],x+a[2]]:e.projectPosition([f,l,x])}}function pk(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:a,modelMatrix:u,fromCoordinateSystem:f,fromCoordinateOrigin:l}=fk(e),{autoOffset:x=!0}=e,{geospatialOrigin:w=Ix,shaderCoordinateOrigin:P=Ix,offsetMode:M=!1}=x?C1(t,r,a):{},C=z1(i,{viewport:t,modelMatrix:u,coordinateSystem:f,coordinateOrigin:l,offsetMode:M});if(M){const V=t.projectPosition(w||P);tR(C,C,V)}return C}const Cx={blendFunc:[1,0,32771,0],blendEquation:32774};class O1 extends Gg{constructor(...e){super(...e),B(this,"pickZ",void 0),B(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:a,onViewportActive:u,pickingFBO:f,deviceRect:{x:l,y:x,width:w,height:P},cullRect:M,effects:C,pass:V="picking",pickZ:Y,moduleParameters:J}){const ce=this.gl;this.pickZ=Y;const pe=this._resetColorEncoder(Y),ve=gs(ce,{scissorTest:!0,scissor:[l,x,w,P],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Cx,blend:!Y},()=>super.render({target:f,layers:e,layerFilter:t,views:r,viewports:a,onViewportActive:u,cullRect:M,effects:C==null?void 0:C.filter(Ee=>Ee.useInPicking),pass:V,isPicking:!0,moduleParameters:J}));return this._colorEncoderState=null,{decodePickingColor:pe&&gk.bind(null,pe),stats:ve}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const a={...e.props.parameters},{pickable:u,operation:f}=e.props;return this._colorEncoderState?u&&f.includes("draw")&&(Object.assign(a,Cx),a.blend=!0,a.blendColor=mk(this._colorEncoderState,e,r)):a.blend=!1,f.includes("terrain")&&(a.blend=!1),a}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function mk(i,e,t){const{byLayer:r,byAlpha:a}=i;let u,f=r.get(e);return f?(f.viewports.push(t),u=f.a):(u=r.size+1,u<=255?(f={a:u,layer:e,viewports:[t]},r.set(e,f),a[u]=f):(ai.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function gk(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Al={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Hd=Symbol.for("component"),Yo=Symbol.for("propTypes"),nm=Symbol.for("deprecatedProps"),zl=Symbol.for("asyncPropDefaults"),Ga=Symbol.for("asyncPropOriginal"),Ho=Symbol.for("asyncPropResolved");function gf(i,e=()=>!0){return Array.isArray(i)?F1(i,e,[]):e(i)?[i]:[]}function F1(i,e,t){let r=-1;for(;++r<i.length;){const a=i[r];Array.isArray(a)?F1(a,e,t):e(a)&&t.push(a)}return t}function _k({target:i,source:e,start:t=0,count:r=1}){const a=e.length,u=r*a;let f=0;for(let l=t;f<a;f++)i[l++]=e[f];for(;f<u;)f<u-f?(i.copyWithin(t+f,t,t+f),f*=2):(i.copyWithin(t+f,t,t+u-f),f=u);return i}class yk{constructor(e,t,r){B(this,"id",void 0),B(this,"context",void 0),B(this,"isLoaded",void 0),B(this,"persistent",void 0),B(this,"_loadCount",0),B(this,"_subscribers",new Set),B(this,"_data",void 0),B(this,"_loader",void 0),B(this,"_error",void 0),B(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let a=e;typeof e=="string"&&(a=Fd(e)),a instanceof Promise?(this.isLoaded=!1,this._loader=a.then(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===r&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class xk{constructor({gl:e,protocol:t}){B(this,"protocol",void 0),B(this,"_context",void 0),B(this,"_resources",void 0),B(this,"_consumers",void 0),B(this,"_pruneRequest",void 0),this.protocol=t||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:a=!0}){let u=this._resources[e];u?u.setData(t,r):(u=new yk(e,t,this._context),this._resources[e]=u),u.persistent=a}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const a=t[r],u=this._resources[a.resourceId];u&&u.unsubscribe(a)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:a="default"}){const{_resources:u,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=u[e];if(this._track(r,a,l,t),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,a){const u=this._consumers,f=u[e]=u[e]||{},l=f[t]||{},x=l.resourceId&&this._resources[l.resourceId];x&&(x.unsubscribe(l),this.prune()),r&&(f[t]=l,l.onChange=a,l.resourceId=r.id,r.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const vk=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,tc={name:"project32",dependencies:[Wg],vs:vk},ic={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...LR},bk=[Wg],wk=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Tk(i){const e=Vu.getDefaultProgramManager(i);for(const t of bk)e.addDefaultModule(t);for(const t of wk)e.addShaderHook(t);return e}const Ek="layerManager.setLayers",Sk="layerManager.activateViewport";class Ak{constructor(e,{deck:t,stats:r,viewport:a,timeline:u}={}){B(this,"layers",void 0),B(this,"context",void 0),B(this,"resourceManager",void 0),B(this,"_lastRenderedLayers",[]),B(this,"_needsRedraw",!1),B(this,"_needsUpdate",!1),B(this,"_nextLayers",null),B(this,"_debug",!1),B(this,"activateViewport",f=>{Xn(Sk,this,f),f&&(this.context.viewport=f)}),this.layers=[],this.resourceManager=new xk({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&Tk(e),stats:r||new Pg({id:"deck.gl"}),viewport:a||new ec({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new E1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const a=r.getNeedsRedraw(e);t=t||a}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Xn(Ek,this,t,e),this._lastRenderedLayers=e;const r=gf(e,Boolean);for(const a of r)a.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const f of e)r[f.id]?ai.warn("Multiple old layers with same id ".concat(f.id))():r[f.id]=f;const a=[];this._updateSublayersRecursively(t,r,a),this._finalizeOldLayers(r);let u=!1;for(const f of a)if(f.hasUniformTransition()){u="Uniform transition in ".concat(f);break}this._needsUpdate=u,this.layers=a}_updateSublayersRecursively(e,t,r){for(const a of e){a.context=this.context;const u=t[a.id];u===null&&ai.warn("Multiple new layers with same id ".concat(a.id))(),t[a.id]=null;let f=null;try{this._debug&&u!==a&&a.validateProps(),u?(this._transferLayerState(u,a),this._updateLayer(a)):this._initializeLayer(a),r.push(a),f=a.isComposite?a.getSubLayers():null}catch(l){this._handleError("matching",l,a)}f&&this._updateSublayersRecursively(f,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Al.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Al.MATCHED,t!==e&&(e.lifecycle=Al.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Al.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Al.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Us(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!Us(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),a=Object.keys(e);if(r.length!==a.length)return!1;for(const u of r)if(!e.hasOwnProperty(u)||!Us(i[u],e[u],t-1))return!1;return!0}return!1}class Pk{constructor(e){B(this,"width",void 0),B(this,"height",void 0),B(this,"views",void 0),B(this,"viewState",void 0),B(this,"controllers",void 0),B(this,"timeline",void 0),B(this,"_viewports",void 0),B(this,"_viewportMap",void 0),B(this,"_isUpdating",void 0),B(this,"_needsRedraw",void 0),B(this,"_needsUpdate",void 0),B(this,"_eventManager",void 0),B(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),a={x:e[0],y:e[1]};for(let u=r.length-1;u>=0;--u){const f=r[u];if(f.containsPixel(a)){const l=e.slice();return l[0]-=f.x,l[1]-=f.y,f.unproject(l,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=gf(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Us(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ai.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var f;return(f=this.getView(e.id))===null||f===void 0?void 0:f.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,t,r,a){const u=e.controller;if(u){const f={...t,...u,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return a||(a=this._createController(e,f)),a&&a.setProps(f),a}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let a=e.length;a--;){const u=e[a],f=this.getViewState(u),l=u.makeViewport({viewState:f,width:this.width,height:this.height});let x=t[u.id];const w=Boolean(u.controller);w&&!x&&(r=!0),(r||!w)&&x&&(x.finalize(),x=null),this.controllers[u.id]=this._updateController(u,f,l,x),this._viewports.unshift(l)}for(const a in t){const u=t[a];u&&!this.controllers[a]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,a)=>!e[a].equals(t[a]))}}const Ik=/([0-9]+\.?[0-9]*)(%|px)/;function Uo(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=Ik.exec(i);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(i))}}function Vo(i,e){return i.relative?Math.round(i.position*e):i.position}function Rn(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class Ck{constructor(e){B(this,"id",void 0),B(this,"viewportInstance",void 0),B(this,"_x",void 0),B(this,"_y",void 0),B(this,"_width",void 0),B(this,"_height",void 0),B(this,"_padding",void 0),B(this,"props",void 0);const{id:t,x:r=0,y:a=0,width:u="100%",height:f="100%",padding:l=null,viewportInstance:x}=e||{};Rn(!x||x instanceof ec),this.viewportInstance=x,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Uo(r),this._y=Uo(a),this._width=Uo(u),this._height=Uo(f),this._padding=l&&{left:Uo(l.left||0),right:Uo(l.right||0),top:Uo(l.top||0),bottom:Uo(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Us(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const a=this.getDimensions({width:e,height:t});return new this.ViewportType({...r,...this.props,...a})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:Vo(this._x,e),y:Vo(this._y,t),width:Vo(this._width,e),height:Vo(this._height,t)};return this._padding&&(r.padding={left:Vo(this._padding.left,e),top:Vo(this._padding.top,t),right:Vo(this._padding.right,e),bottom:Vo(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Gu{constructor(e){B(this,"_inProgress",void 0),B(this,"_handle",void 0),B(this,"_timeline",void 0),B(this,"time",void 0),B(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:a}=this;this._handle=r.addChannel({delay:r.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Mx=()=>{},Wm={BREAK:1,SNAP_TO_END:2,IGNORE:3},Mk=i=>i,Lk=Wm.BREAK;class Rk{constructor(e){B(this,"getControllerState",void 0),B(this,"props",void 0),B(this,"propsInTransition",void 0),B(this,"transition",void 0),B(this,"onViewStateChange",void 0),B(this,"onStateChange",void 0),B(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:a,startProps:u,endProps:f,duration:l,easing:x}}=t,w=x(r/l),P=a.interpolateProps(u,f,w);this.propsInTransition=this.getControllerState({...this.props,...P}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Gu(e.timeline),this.onViewStateChange=e.onViewStateChange||Mx,this.onStateChange=e.onStateChange||Mx}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let a=r;if(this.transition.inProgress){const{interruption:u,endProps:f}=this.transition.settings;a={...r,...u===Wm.SNAP_TO_END?f:this.propsInTransition||r}}this._triggerTransition(a,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&Boolean(r)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Wm.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),a=this.getControllerState(t).shortestPathFrom(r),u=t.transitionInterpolator,f=u.getDuration?u.getDuration(e,t):t.transitionDuration;if(f===0)return;const l=u.initializeProps(e,a);this.propsInTransition={};const x={duration:f,easing:t.transitionEasing||Mk,interpolator:u,interruption:t.transitionInterruption||Lk,startProps:l.start,endProps:l.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(x),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class kk{constructor(e){B(this,"_propsToCompare",void 0),B(this,"_propsToExtract",void 0),B(this,"_requiredProps",void 0);const{compare:t,extract:r,required:a}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=a}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!Iu(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},a={};for(const u of this._propsToExtract)(u in e||u in t)&&(r[u]=e[u],a[u]=t[u]);return this._checkRequiredProps(r),this._checkRequiredProps(a),{start:r,end:a}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];Rn(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const Dk=["longitude","latitude","zoom","bearing","pitch"],zk=["longitude","latitude","zoom"];class B1 extends kk{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Dk,required:zk},super(r.transitionProps),B(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:a,around:u}=this.opts;if(a&&u){const f=a(e),l=a(t),x=f.unproject(u);r.start.around=u,Object.assign(r.end,{around:l.project(x),aroundPosition:x,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const a={};for(const u of this._propsToExtract)a[u]=Ud(e[u]||0,t[u]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...t,...a});Object.assign(a,u.panByPosition(t.aroundPosition,Ud(e.around,t.around,r)))}return a}}const jo={transitionDuration:0},Ok=300,ld=i=>1-(1-i)*(1-i),Sl={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},La={};class Fk{constructor(e){B(this,"props",void 0),B(this,"state",{}),B(this,"transitionManager",void 0),B(this,"eventManager",void 0),B(this,"onViewStateChange",void 0),B(this,"onStateChange",void 0),B(this,"makeViewport",void 0),B(this,"_controllerState",void 0),B(this,"_events",{}),B(this,"_interactionState",{isDragging:!1}),B(this,"_customEvents",[]),B(this,"_eventStartBlocked",null),B(this,"_panMove",!1),B(this,"invertPan",!1),B(this,"dragMode","rotate"),B(this,"inertia",0),B(this,"scrollZoom",!0),B(this,"dragPan",!0),B(this,"dragRotate",!0),B(this,"doubleClickZoom",!0),B(this,"touchZoom",!0),B(this,"touchRotate",!1),B(this,"keyboard",!0),this.transitionManager=new Rk({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:a}=e;return[a.x-t,a.y-r]}isPointInBounds(e,t){const{width:r,height:a}=this.props;if(t&&t.handled)return!1;const u=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=a;return u&&t&&t.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?Ok:0;const{scrollZoom:r=!0,dragPan:a=!0,dragRotate:u=!0,doubleClickZoom:f=!0,touchZoom:l=!0,touchRotate:x=!1,keyboard:w=!0}=e,P=Boolean(this.onViewStateChange);this.toggleEvents(Sl.WHEEL,P&&r),this.toggleEvents(Sl.PAN,P&&(a||u)),this.toggleEvents(Sl.PINCH,P&&(l||x)),this.toggleEvents(Sl.TRIPLE_PAN,P&&x),this.toggleEvents(Sl.DOUBLE_TAP,P&&f),this.toggleEvents(Sl.KEYBOARD,P&&w),this.scrollZoom=r,this.dragPan=a,this.dragRotate=u,this.doubleClickZoom=f,this.touchZoom=l,this.touchRotate=x,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const a={...e.getViewportProps(),...t},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),u){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:f})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const a=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(a,jo,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,jo,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),a=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],u=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,jo,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),a=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],u=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const{speed:r=.01,smooth:a=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let f=2/(1+Math.exp(-Math.abs(u*r)));u<0&&f!==0&&(f=1/f);const l=this.controllerState.zoom({pos:t,scale:f});return this.updateViewport(l,{...this._getTransitionProps({around:t}),transitionDuration:a?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,jo,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,jo,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),a=[r[0],r[1]+=e.velocityY*t/2],u=this.controllerState.rotate({pos:a});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return La._startPinchRotation=e.rotation,La._lastPinchEvent=e,this.updateViewport(r,jo,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,a=this.getCenter(e);t=t.zoom({pos:a,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:La._startPinchRotation-r})}return this.updateViewport(t,jo,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),La._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=La;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const a=this.getCenter(e);let u=this.controllerState.rotateEnd();const f=Math.log2(e.scale),l=(f-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),x=Math.pow(2,f+l*t/2);u=u.zoom({pos:a,scale:x}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:a}),transitionDuration:t,transitionEasing:ld},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const a=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return La._startPinchRotation=null,La._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(a,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:a,rotateSpeedX:u,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let x;const w={};switch(e.srcEvent.code){case"Minus":x=t?l.zoomOut(r).zoomOut(r):l.zoomOut(r),w.isZooming=!0;break;case"Equal":x=t?l.zoomIn(r).zoomIn(r):l.zoomIn(r),w.isZooming=!0;break;case"ArrowLeft":t?(x=l.rotateLeft(u),w.isRotating=!0):(x=l.moveLeft(a),w.isPanning=!0);break;case"ArrowRight":t?(x=l.rotateRight(u),w.isRotating=!0):(x=l.moveRight(a),w.isPanning=!0);break;case"ArrowUp":t?(x=l.rotateUp(f),w.isRotating=!0):(x=l.moveUp(a),w.isPanning=!0);break;case"ArrowDown":t?(x=l.rotateDown(f),w.isRotating=!0):(x=l.moveDown(a),w.isPanning=!0);break;default:return!1}return this.updateViewport(x,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?jo:e?{...t,transitionInterpolator:new B1({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class Bk{constructor(e,t){B(this,"_viewportProps",void 0),B(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Lx=5,Nk=1.2;class Uk extends Bk{constructor(e){const{width:t,height:r,latitude:a,longitude:u,zoom:f,bearing:l=0,pitch:x=0,altitude:w=1.5,position:P=[0,0,0],maxZoom:M=20,minZoom:C=0,maxPitch:V=60,minPitch:Y=0,startPanLngLat:J,startZoomLngLat:ce,startRotatePos:pe,startBearing:ve,startPitch:he,startZoom:Ee,normalize:Fe=!0}=e;Rn(Number.isFinite(u)),Rn(Number.isFinite(a)),Rn(Number.isFinite(f)),super({width:t,height:r,latitude:a,longitude:u,zoom:f,bearing:l,pitch:x,altitude:w,maxZoom:M,minZoom:C,maxPitch:V,minPitch:Y,normalize:Fe,position:P},{startPanLngLat:J,startZoomLngLat:ce,startRotatePos:pe,startBearing:ve,startPitch:he,startZoom:Ee}),B(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:a,startBearing:u,startPitch:f}=this.getState();if(!a||u===void 0||f===void 0)return this;let l;return e?l=this._getNewRotation(e,a,f,u):l={bearing:u+t,pitch:f+r},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:a,startZoomLngLat:u}=this.getState();if(u||(a=this.getViewportProps().zoom,u=this._unproject(t)||this._unproject(e)),!u)return this;const{maxZoom:f,minZoom:l}=this.getViewportProps();let x=a+Math.log2(r);x=Wo(x,l,f);const w=this.makeViewport({...this.getViewportProps(),zoom:x});return this._getUpdatedState({zoom:x,...w.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:a,longitude:u}=r;return Math.abs(a-t.bearing)>180&&(r.bearing=a<0?a+360:a-360),Math.abs(u-t.longitude)>180&&(r.longitude=u<0?u+360:u-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:a}=e;e.zoom=Wo(a,r,t);const{maxPitch:u,minPitch:f,pitch:l}=e;e.pitch=Wo(l,f,u);const{normalize:x=!0}=e;return x&&Object.assign(e,H3(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,a){const u=e[0]-t[0],f=e[1]-t[1],l=e[1],x=t[1],{width:w,height:P}=this.getViewportProps(),M=u/w;let C=0;f>0?Math.abs(P-x)>Lx&&(C=f/(x-P)*Nk):f<0&&x>Lx&&(C=1-l/x),C=Wo(C,-1,1);const{minPitch:V,maxPitch:Y}=this.getViewportProps(),J=a+180*M;let ce=r;return C>0?ce=r+C*(Y-r):C<0&&(ce=r-C*(V-r)),{pitch:ce,bearing:J}}}class Vk extends Fk{constructor(...e){super(...e),B(this,"ControllerState",Uk),B(this,"transition",{transitionDuration:300,transitionInterpolator:new B1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),B(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class $g extends Ck{get ViewportType(){return ja}get ControllerType(){return Vk}}B($g,"displayName","MapView");const jk=new D1;function Gk(i,e){var t,r;const a=(t=i.order)!==null&&t!==void 0?t:1/0,u=(r=e.order)!==null&&r!==void 0?r:1/0;return a-u}class Wk{constructor(){B(this,"effects",void 0),B(this,"_resolvedEffects",[]),B(this,"_defaultEffects",[]),B(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(a=>Gk(a,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Us(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const a of this.effects)t[a.id]=a;const r=[];for(const a of e){const u=t[a.id];u&&u!==a?u.setProps?(u.setProps(a.props),r.push(u)):(u.cleanup(),r.push(a)):r.push(a),delete t[a.id]}for(const a in t)t[a].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(a=>a instanceof D1)||this._resolvedEffects.push(jk),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Hk extends Gg{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const qk="deckRenderer.renderLayers";class $k{constructor(e){B(this,"gl",void 0),B(this,"layerFilter",void 0),B(this,"drawPickingColors",void 0),B(this,"drawLayersPass",void 0),B(this,"pickLayersPass",void 0),B(this,"renderCount",void 0),B(this,"_needsRedraw",void 0),B(this,"renderBuffers",void 0),B(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Hk(e),this.pickLayersPass=new O1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Pn.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const a=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,u=t.render({...r,target:a});r.effects&&this._postRender(r.effects,r),this.renderCount++,Xn(qk,this,u,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Pn(this.gl),new Pn(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,a={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const u of e)if(u.postRender){if(u.id===this.lastPostProcessEffect){a.target=t.target,u.postRender(this.gl,a);break}const f=u.postRender(this.gl,a);a.inputBuffer=f,a.swapBuffer=f===r[0]?r[1]:r[0]}}}const Zk={pickedColor:null,pickedObjectIndex:-1};function Xk({pickedColors:i,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:a,deviceRect:u}){const{x:f,y:l,width:x,height:w}=u;let P=a*a,M=-1,C=0;for(let V=0;V<w;V++){const Y=V+l-r,J=Y*Y;if(J>P)C+=4*x;else for(let ce=0;ce<x;ce++){if(i[C+3]-1>=0){const ve=ce+f-t,he=ve*ve+J;he<=P&&(P=he,M=C)}C+=4}}if(M>=0){const V=i.slice(M,M+4),Y=e(V);if(Y){const J=Math.floor(M/4/x),ce=M/4-J*x;return{...Y,pickedColor:V,pickedX:f+ce,pickedY:l+J}}ai.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Zk}function Yk({pickedColors:i,decodePickingColor:e}){const t=new Map;if(i){for(let r=0;r<i.length;r+=4)if(i[r+3]-1>=0){const u=i.slice(r,r+4),f=u.join(",");if(!t.has(f)){const l=e(u);l?t.set(f,{...l,color:u}):ai.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function N1({pickInfo:i,viewports:e,pixelRatio:t,x:r,y:a,z:u}){let f=e[0];e.length>1&&(f=Jk((i==null?void 0:i.pickedViewports)||e,{x:r,y:a}));let l;if(f){const x=[r-f.x,a-f.y];u!==void 0&&(x[2]=u),l=f.unproject(x)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:r,y:a,pixel:[r,a],coordinate:l,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:t}}function Kk(i){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:a}=i,{pickedColor:u,pickedLayer:f,pickedObjectIndex:l}=e,x=f?[f]:[];if(r==="hover"){const M=t.index,C=t.layerId,V=f?f.props.id:null;if(V!==C||l!==M){if(V!==C){const Y=a.find(J=>J.props.id===C);Y&&x.unshift(Y)}t.layerId=V,t.index=l,t.info=null}}const w=N1(i),P=new Map;return P.set(null,w),x.forEach(M=>{let C={...w};M===f&&(C.color=u,C.index=l,C.picked=!0),C=U1({layer:M,info:C,mode:r});const V=C.layer;M===f&&r==="hover"&&(t.info=C),P.set(V.id,C),r==="hover"&&V.updateAutoHighlight(C)}),P}function U1({layer:i,info:e,mode:t}){for(;i&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=i,e=i.getPickingInfo({info:e,mode:t,sourceLayer:r}),i=i.parent}return e}function Jk(i,e){for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.containsPixel(e))return r}return i[0]}class Qk{constructor(e){B(this,"gl",void 0),B(this,"pickingFBO",void 0),B(this,"depthFBO",void 0),B(this,"pickLayersPass",void 0),B(this,"layerFilter",void 0),B(this,"lastPickedInfo",void 0),B(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new O1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:a},u=this.lastPickedInfo.info){const f=u&&u.layer&&u.layer.id,l=u&&u.viewport&&u.viewport.id,x=f?r.find(C=>C.id===f):null,w=l&&a.find(C=>C.id===l)||a[0],P=w&&w.unproject([e-w.x,t-w.y]);return{...u,...{x:e,y:t,viewport:w,coordinate:P,layer:x}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new Pn(r),Pn.isSupported(r,{colorBufferFloat:!0}))){const a=new Pn(r);a.attach({[36064]:new jr(r,{format:ci(r)?34836:6408,type:5126})}),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:a,y:u,radius:f=0,depth:l=1,mode:x="query",unproject3D:w,onViewportActive:P,effects:M}){const C=this._getPickable(e),V=Ul(this.gl);if(!C)return{result:[],emptyInfo:N1({viewports:r,x:a,y:u,pixelRatio:V})};this._resizeBuffer();const Y=Up(this.gl,[a,u],!0),J=[Y.x+Math.floor(Y.width/2),Y.y+Math.floor(Y.height/2)],ce=Math.round(f*V),{width:pe,height:ve}=this.pickingFBO,he=this._getPickingRect({deviceX:J[0],deviceY:J[1],deviceRadius:ce,deviceWidth:pe,deviceHeight:ve}),Ee={x:a-f,y:u-f,width:f*2+1,height:f*2+1};let Fe;const Ze=[],ht=new Set;for(let _t=0;_t<l;_t++){let lt;if(he){const It=this._drawAndSample({layers:C,views:t,viewports:r,onViewportActive:P,deviceRect:he,cullRect:Ee,effects:M,pass:"picking:".concat(x)});lt=Xk({...It,deviceX:J[0],deviceY:J[1],deviceRadius:ce,deviceRect:he})}else lt={pickedColor:null,pickedObjectIndex:-1};let Et;if(lt.pickedLayer&&w&&this.depthFBO){const{pickedColors:It}=this._drawAndSample({layers:[lt.pickedLayer],views:t,viewports:r,onViewportActive:P,deviceRect:{x:lt.pickedX,y:lt.pickedY,width:1,height:1},cullRect:Ee,effects:M,pass:"picking:".concat(x,":z")},!0);It[3]&&(Et=It[0])}lt.pickedLayer&&_t+1<l&&(ht.add(lt.pickedLayer),lt.pickedLayer.disablePickingIndex(lt.pickedObjectIndex)),Fe=Kk({pickInfo:lt,lastPickedInfo:this.lastPickedInfo,mode:x,layers:C,viewports:r,x:a,y:u,z:Et,pixelRatio:V});for(const It of Fe.values())It.layer&&Ze.push(It);if(!lt.pickedColor)break}for(const _t of ht)_t.restorePickingColors();return{result:Ze,emptyInfo:Fe.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:a,y:u,width:f=1,height:l=1,mode:x="query",maxObjects:w=null,onViewportActive:P,effects:M}){const C=this._getPickable(e);if(!C)return[];this._resizeBuffer();const V=Ul(this.gl),Y=Up(this.gl,[a,u],!0),J=Y.x,ce=Y.y+Y.height,pe=Up(this.gl,[a+f,u+l],!0),ve=pe.x+pe.width,he=pe.y,Ee={x:J,y:he,width:ve-J,height:ce-he},Fe=this._drawAndSample({layers:C,views:t,viewports:r,onViewportActive:P,deviceRect:Ee,cullRect:{x:a,y:u,width:f,height:l},effects:M,pass:"picking:".concat(x)}),Ze=Yk(Fe),ht=new Map,_t=Number.isFinite(w);for(let lt=0;lt<Ze.length&&!(_t&&w&&ht.size>=w);lt++){const Et=Ze[lt];let It={color:Et.pickedColor,layer:null,index:Et.pickedObjectIndex,picked:!0,x:a,y:u,pixelRatio:V};It=U1({layer:Et.pickedLayer,info:It,mode:x}),ht.has(It.object)||ht.set(It.object,It)}return Array.from(ht.values())}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:a,deviceRect:u,cullRect:f,effects:l,pass:x},w=!1){const P=w?this.depthFBO:this.pickingFBO,M={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:a,pickingFBO:P,deviceRect:u,cullRect:f,effects:l,pass:x,pickZ:w,preRenderStats:{}};for(const ve of l)ve.useInPicking&&(M.preRenderStats[ve.id]=ve.preRender(this.gl,M));const{decodePickingColor:C}=this.pickLayersPass.render(M),{x:V,y:Y,width:J,height:ce}=u,pe=new(w?Float32Array:Uint8Array)(J*ce*4);return mf(P,{sourceX:V,sourceY:Y,sourceWidth:J,sourceHeight:ce,target:pe}),{pickedColors:pe,decodePickingColor:C}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:a,deviceHeight:u}){const f=Math.max(0,e-r),l=Math.max(0,t-r),x=Math.min(a,e+r+1)-f,w=Math.min(u,t+r+1)-l;return x<=0||w<=0?null:{x:f,y:l,width:x,height:w}}}const eD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class tD{constructor(e){B(this,"el",null),B(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,eD),t.appendChild(this.el))}setTooltip(e,t,r){const a=this.el;if(a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className),Object.assign(a.style,e.style);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(t,"px, ").concat(r,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var Wa={},iD={get exports(){return Wa},set exports(i){Wa=i}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(e,t,r,a){var u=["","webkit","Moz","MS","ms","o"],f=t.createElement("div"),l="function",x=Math.round,w=Math.abs,P=Date.now;function M(G,Z,ae){return setTimeout(he(G,ae),Z)}function C(G,Z,ae){return Array.isArray(G)?(V(G,ae[Z],ae),!0):!1}function V(G,Z,ae){var Pe;if(G)if(G.forEach)G.forEach(Z,ae);else if(G.length!==a)for(Pe=0;Pe<G.length;)Z.call(ae,G[Pe],Pe,G),Pe++;else for(Pe in G)G.hasOwnProperty(Pe)&&Z.call(ae,G[Pe],Pe,G)}function Y(G,Z,ae){var Pe="DEPRECATED METHOD: "+Z+`
`+ae+` AT 
`;return function(){var We=new Error("get-stack-trace"),dt=We&&We.stack?We.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Xt=e.console&&(e.console.warn||e.console.log);return Xt&&Xt.call(e.console,Pe,dt),G.apply(this,arguments)}}var J;typeof Object.assign!="function"?J=function(Z){if(Z===a||Z===null)throw new TypeError("Cannot convert undefined or null to object");for(var ae=Object(Z),Pe=1;Pe<arguments.length;Pe++){var We=arguments[Pe];if(We!==a&&We!==null)for(var dt in We)We.hasOwnProperty(dt)&&(ae[dt]=We[dt])}return ae}:J=Object.assign;var ce=Y(function(Z,ae,Pe){for(var We=Object.keys(ae),dt=0;dt<We.length;)(!Pe||Pe&&Z[We[dt]]===a)&&(Z[We[dt]]=ae[We[dt]]),dt++;return Z},"extend","Use `assign`."),pe=Y(function(Z,ae){return ce(Z,ae,!0)},"merge","Use `assign`.");function ve(G,Z,ae){var Pe=Z.prototype,We;We=G.prototype=Object.create(Pe),We.constructor=G,We._super=Pe,ae&&J(We,ae)}function he(G,Z){return function(){return G.apply(Z,arguments)}}function Ee(G,Z){return typeof G==l?G.apply(Z&&Z[0]||a,Z):G}function Fe(G,Z){return G===a?Z:G}function Ze(G,Z,ae){V(Et(Z),function(Pe){G.addEventListener(Pe,ae,!1)})}function ht(G,Z,ae){V(Et(Z),function(Pe){G.removeEventListener(Pe,ae,!1)})}function _t(G,Z){for(;G;){if(G==Z)return!0;G=G.parentNode}return!1}function lt(G,Z){return G.indexOf(Z)>-1}function Et(G){return G.trim().split(/\s+/g)}function It(G,Z,ae){if(G.indexOf&&!ae)return G.indexOf(Z);for(var Pe=0;Pe<G.length;){if(ae&&G[Pe][ae]==Z||!ae&&G[Pe]===Z)return Pe;Pe++}return-1}function Ot(G){return Array.prototype.slice.call(G,0)}function zt(G,Z,ae){for(var Pe=[],We=[],dt=0;dt<G.length;){var Xt=Z?G[dt][Z]:G[dt];It(We,Xt)<0&&Pe.push(G[dt]),We[dt]=Xt,dt++}return ae&&(Z?Pe=Pe.sort(function(Wt,Xi){return Wt[Z]>Xi[Z]}):Pe=Pe.sort()),Pe}function Ut(G,Z){for(var ae,Pe,We=Z[0].toUpperCase()+Z.slice(1),dt=0;dt<u.length;){if(ae=u[dt],Pe=ae?ae+We:Z,Pe in G)return Pe;dt++}return a}var $i=1;function ft(){return $i++}function oi(G){var Z=G.ownerDocument||G;return Z.defaultView||Z.parentWindow||e}var ti=/mobile|tablet|ip(ad|hone|od)|android/i,Vi="ontouchstart"in e,fn=Ut(e,"PointerEvent")!==a,wn=Vi&&ti.test(navigator.userAgent),Fi="touch",Sr="pen",gr="mouse",Vn="kinect",Ji=25,xi=1,on=2,$t=4,Ci=8,jn=1,oe=2,me=4,Re=8,Ve=16,Be=oe|me,qe=Re|Ve,rt=Be|qe,ze=["x","y"],$e=["clientX","clientY"];function Ue(G,Z){var ae=this;this.manager=G,this.callback=Z,this.element=G.element,this.target=G.options.inputTarget,this.domHandler=function(Pe){Ee(G.options.enable,[G])&&ae.handler(Pe)},this.init()}Ue.prototype={handler:function(){},init:function(){this.evEl&&Ze(this.element,this.evEl,this.domHandler),this.evTarget&&Ze(this.target,this.evTarget,this.domHandler),this.evWin&&Ze(oi(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ht(this.element,this.evEl,this.domHandler),this.evTarget&&ht(this.target,this.evTarget,this.domHandler),this.evWin&&ht(oi(this.element),this.evWin,this.domHandler)}};function Tt(G){var Z,ae=G.options.inputClass;return ae?Z=ae:fn?Z=er:wn?Z=yr:Vi?Z=X:Z=Bt,new Z(G,yt)}function yt(G,Z,ae){var Pe=ae.pointers.length,We=ae.changedPointers.length,dt=Z&xi&&Pe-We===0,Xt=Z&($t|Ci)&&Pe-We===0;ae.isFirst=!!dt,ae.isFinal=!!Xt,dt&&(G.session={}),ae.eventType=Z,wt(G,ae),G.emit("hammer.input",ae),G.recognize(ae),G.session.prevInput=ae}function wt(G,Z){var ae=G.session,Pe=Z.pointers,We=Pe.length;ae.firstInput||(ae.firstInput=Qt(Z)),We>1&&!ae.firstMultiple?ae.firstMultiple=Qt(Z):We===1&&(ae.firstMultiple=!1);var dt=ae.firstInput,Xt=ae.firstMultiple,Di=Xt?Xt.center:dt.center,Wt=Z.center=we(Pe);Z.timeStamp=P(),Z.deltaTime=Z.timeStamp-dt.timeStamp,Z.angle=jt(Di,Wt),Z.distance=Bi(Di,Wt),Lt(ae,Z),Z.offsetDirection=ji(Z.deltaX,Z.deltaY);var Xi=je(Z.deltaTime,Z.deltaX,Z.deltaY);Z.overallVelocityX=Xi.x,Z.overallVelocityY=Xi.y,Z.overallVelocity=w(Xi.x)>w(Xi.y)?Xi.x:Xi.y,Z.scale=Xt?pn(Xt.pointers,Pe):1,Z.rotation=Xt?Qi(Xt.pointers,Pe):0,Z.maxPointers=ae.prevInput?Z.pointers.length>ae.prevInput.maxPointers?Z.pointers.length:ae.prevInput.maxPointers:Z.pointers.length,Vt(ae,Z);var tr=G.element;_t(Z.srcEvent.target,tr)&&(tr=Z.srcEvent.target),Z.target=tr}function Lt(G,Z){var ae=Z.center,Pe=G.offsetDelta||{},We=G.prevDelta||{},dt=G.prevInput||{};(Z.eventType===xi||dt.eventType===$t)&&(We=G.prevDelta={x:dt.deltaX||0,y:dt.deltaY||0},Pe=G.offsetDelta={x:ae.x,y:ae.y}),Z.deltaX=We.x+(ae.x-Pe.x),Z.deltaY=We.y+(ae.y-Pe.y)}function Vt(G,Z){var ae=G.lastInterval||Z,Pe=Z.timeStamp-ae.timeStamp,We,dt,Xt,Di;if(Z.eventType!=Ci&&(Pe>Ji||ae.velocity===a)){var Wt=Z.deltaX-ae.deltaX,Xi=Z.deltaY-ae.deltaY,tr=je(Pe,Wt,Xi);dt=tr.x,Xt=tr.y,We=w(tr.x)>w(tr.y)?tr.x:tr.y,Di=ji(Wt,Xi),G.lastInterval=Z}else We=ae.velocity,dt=ae.velocityX,Xt=ae.velocityY,Di=ae.direction;Z.velocity=We,Z.velocityX=dt,Z.velocityY=Xt,Z.direction=Di}function Qt(G){for(var Z=[],ae=0;ae<G.pointers.length;)Z[ae]={clientX:x(G.pointers[ae].clientX),clientY:x(G.pointers[ae].clientY)},ae++;return{timeStamp:P(),pointers:Z,center:we(Z),deltaX:G.deltaX,deltaY:G.deltaY}}function we(G){var Z=G.length;if(Z===1)return{x:x(G[0].clientX),y:x(G[0].clientY)};for(var ae=0,Pe=0,We=0;We<Z;)ae+=G[We].clientX,Pe+=G[We].clientY,We++;return{x:x(ae/Z),y:x(Pe/Z)}}function je(G,Z,ae){return{x:Z/G||0,y:ae/G||0}}function ji(G,Z){return G===Z?jn:w(G)>=w(Z)?G<0?oe:me:Z<0?Re:Ve}function Bi(G,Z,ae){ae||(ae=ze);var Pe=Z[ae[0]]-G[ae[0]],We=Z[ae[1]]-G[ae[1]];return Math.sqrt(Pe*Pe+We*We)}function jt(G,Z,ae){ae||(ae=ze);var Pe=Z[ae[0]]-G[ae[0]],We=Z[ae[1]]-G[ae[1]];return Math.atan2(We,Pe)*180/Math.PI}function Qi(G,Z){return jt(Z[1],Z[0],$e)+jt(G[1],G[0],$e)}function pn(G,Z){return Bi(Z[0],Z[1],$e)/Bi(G[0],G[1],$e)}var vi={mousedown:xi,mousemove:on,mouseup:$t},Zi="mousedown",Xe="mousemove mouseup";function Bt(){this.evEl=Zi,this.evWin=Xe,this.pressed=!1,Ue.apply(this,arguments)}ve(Bt,Ue,{handler:function(Z){var ae=vi[Z.type];ae&xi&&Z.button===0&&(this.pressed=!0),ae&on&&Z.which!==1&&(ae=$t),this.pressed&&(ae&$t&&(this.pressed=!1),this.callback(this.manager,ae,{pointers:[Z],changedPointers:[Z],pointerType:gr,srcEvent:Z}))}});var Ft={pointerdown:xi,pointermove:on,pointerup:$t,pointercancel:Ci,pointerout:Ci},an={2:Fi,3:Sr,4:gr,5:Vn},Ar="pointerdown",Dt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ar="MSPointerDown",Dt="MSPointerMove MSPointerUp MSPointerCancel");function er(){this.evEl=Ar,this.evWin=Dt,Ue.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}ve(er,Ue,{handler:function(Z){var ae=this.store,Pe=!1,We=Z.type.toLowerCase().replace("ms",""),dt=Ft[We],Xt=an[Z.pointerType]||Z.pointerType,Di=Xt==Fi,Wt=It(ae,Z.pointerId,"pointerId");dt&xi&&(Z.button===0||Di)?Wt<0&&(ae.push(Z),Wt=ae.length-1):dt&($t|Ci)&&(Pe=!0),!(Wt<0)&&(ae[Wt]=Z,this.callback(this.manager,dt,{pointers:ae,changedPointers:[Z],pointerType:Xt,srcEvent:Z}),Pe&&ae.splice(Wt,1))}});var en={touchstart:xi,touchmove:on,touchend:$t,touchcancel:Ci},ys="touchstart",Gi="touchstart touchmove touchend touchcancel";function mn(){this.evTarget=ys,this.evWin=Gi,this.started=!1,Ue.apply(this,arguments)}ve(mn,Ue,{handler:function(Z){var ae=en[Z.type];if(ae===xi&&(this.started=!0),!!this.started){var Pe=di.call(this,Z,ae);ae&($t|Ci)&&Pe[0].length-Pe[1].length===0&&(this.started=!1),this.callback(this.manager,ae,{pointers:Pe[0],changedPointers:Pe[1],pointerType:Fi,srcEvent:Z})}}});function di(G,Z){var ae=Ot(G.touches),Pe=Ot(G.changedTouches);return Z&($t|Ci)&&(ae=zt(ae.concat(Pe),"identifier",!0)),[ae,Pe]}var xs={touchstart:xi,touchmove:on,touchend:$t,touchcancel:Ci},_r="touchstart touchmove touchend touchcancel";function yr(){this.evTarget=_r,this.targetIds={},Ue.apply(this,arguments)}ve(yr,Ue,{handler:function(Z){var ae=xs[Z.type],Pe=es.call(this,Z,ae);Pe&&this.callback(this.manager,ae,{pointers:Pe[0],changedPointers:Pe[1],pointerType:Fi,srcEvent:Z})}});function es(G,Z){var ae=Ot(G.touches),Pe=this.targetIds;if(Z&(xi|on)&&ae.length===1)return Pe[ae[0].identifier]=!0,[ae,ae];var We,dt,Xt=Ot(G.changedTouches),Di=[],Wt=this.target;if(dt=ae.filter(function(Xi){return _t(Xi.target,Wt)}),Z===xi)for(We=0;We<dt.length;)Pe[dt[We].identifier]=!0,We++;for(We=0;We<Xt.length;)Pe[Xt[We].identifier]&&Di.push(Xt[We]),Z&($t|Ci)&&delete Pe[Xt[We].identifier],We++;if(Di.length)return[zt(dt.concat(Di),"identifier",!0),Di]}var vs=2500,Gr=25;function X(){Ue.apply(this,arguments);var G=he(this.handler,this);this.touch=new yr(this.manager,G),this.mouse=new Bt(this.manager,G),this.primaryTouch=null,this.lastTouches=[]}ve(X,Ue,{handler:function(Z,ae,Pe){var We=Pe.pointerType==Fi,dt=Pe.pointerType==gr;if(!(dt&&Pe.sourceCapabilities&&Pe.sourceCapabilities.firesTouchEvents)){if(We)k.call(this,ae,Pe);else if(dt&&q.call(this,Pe))return;this.callback(Z,ae,Pe)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function k(G,Z){G&xi?(this.primaryTouch=Z.changedPointers[0].identifier,F.call(this,Z)):G&($t|Ci)&&F.call(this,Z)}function F(G){var Z=G.changedPointers[0];if(Z.identifier===this.primaryTouch){var ae={x:Z.clientX,y:Z.clientY};this.lastTouches.push(ae);var Pe=this.lastTouches,We=function(){var dt=Pe.indexOf(ae);dt>-1&&Pe.splice(dt,1)};setTimeout(We,vs)}}function q(G){for(var Z=G.srcEvent.clientX,ae=G.srcEvent.clientY,Pe=0;Pe<this.lastTouches.length;Pe++){var We=this.lastTouches[Pe],dt=Math.abs(Z-We.x),Xt=Math.abs(ae-We.y);if(dt<=Gr&&Xt<=Gr)return!0}return!1}var $=Ut(f.style,"touchAction"),se=$!==a,de="compute",le="auto",re="manipulation",fe="none",Ce="pan-x",Ne="pan-y",Ie=et();function ct(G,Z){this.manager=G,this.set(Z)}ct.prototype={set:function(G){G==de&&(G=this.compute()),se&&this.manager.element.style&&Ie[G]&&(this.manager.element.style[$]=G),this.actions=G.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var G=[];return V(this.manager.recognizers,function(Z){Ee(Z.options.enable,[Z])&&(G=G.concat(Z.getTouchAction()))}),pt(G.join(" "))},preventDefaults:function(G){var Z=G.srcEvent,ae=G.offsetDirection;if(this.manager.session.prevented){Z.preventDefault();return}var Pe=this.actions,We=lt(Pe,fe)&&!Ie[fe],dt=lt(Pe,Ne)&&!Ie[Ne],Xt=lt(Pe,Ce)&&!Ie[Ce];if(We){var Di=G.pointers.length===1,Wt=G.distance<2,Xi=G.deltaTime<250;if(Di&&Wt&&Xi)return}if(!(Xt&&dt)&&(We||dt&&ae&Be||Xt&&ae&qe))return this.preventSrc(Z)},preventSrc:function(G){this.manager.session.prevented=!0,G.preventDefault()}};function pt(G){if(lt(G,fe))return fe;var Z=lt(G,Ce),ae=lt(G,Ne);return Z&&ae?fe:Z||ae?Z?Ce:Ne:lt(G,re)?re:le}function et(){if(!se)return!1;var G={},Z=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ae){G[ae]=Z?e.CSS.supports("touch-action",ae):!0}),G}var St=1,vt=2,Gt=4,Ct=8,kt=Ct,Zt=16,Kt=32;function Ti(G){this.options=J({},this.defaults,G||{}),this.id=ft(),this.manager=null,this.options.enable=Fe(this.options.enable,!0),this.state=St,this.simultaneous={},this.requireFail=[]}Ti.prototype={defaults:{},set:function(G){return J(this.options,G),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(G){if(C(G,"recognizeWith",this))return this;var Z=this.simultaneous;return G=Pr(G,this),Z[G.id]||(Z[G.id]=G,G.recognizeWith(this)),this},dropRecognizeWith:function(G){return C(G,"dropRecognizeWith",this)?this:(G=Pr(G,this),delete this.simultaneous[G.id],this)},requireFailure:function(G){if(C(G,"requireFailure",this))return this;var Z=this.requireFail;return G=Pr(G,this),It(Z,G)===-1&&(Z.push(G),G.requireFailure(this)),this},dropRequireFailure:function(G){if(C(G,"dropRequireFailure",this))return this;G=Pr(G,this);var Z=It(this.requireFail,G);return Z>-1&&this.requireFail.splice(Z,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(G){return!!this.simultaneous[G.id]},emit:function(G){var Z=this,ae=this.state;function Pe(We){Z.manager.emit(We,G)}ae<Ct&&Pe(Z.options.event+Ei(ae)),Pe(Z.options.event),G.additionalEvent&&Pe(G.additionalEvent),ae>=Ct&&Pe(Z.options.event+Ei(ae))},tryEmit:function(G){if(this.canEmit())return this.emit(G);this.state=Kt},canEmit:function(){for(var G=0;G<this.requireFail.length;){if(!(this.requireFail[G].state&(Kt|St)))return!1;G++}return!0},recognize:function(G){var Z=J({},G);if(!Ee(this.options.enable,[this,Z])){this.reset(),this.state=Kt;return}this.state&(kt|Zt|Kt)&&(this.state=St),this.state=this.process(Z),this.state&(vt|Gt|Ct|Zt)&&this.tryEmit(Z)},process:function(G){},getTouchAction:function(){},reset:function(){}};function Ei(G){return G&Zt?"cancel":G&Ct?"end":G&Gt?"move":G&vt?"start":""}function ln(G){return G==Ve?"down":G==Re?"up":G==oe?"left":G==me?"right":""}function Pr(G,Z){var ae=Z.manager;return ae?ae.get(G):G}function Tn(){Ti.apply(this,arguments)}ve(Tn,Ti,{defaults:{pointers:1},attrTest:function(G){var Z=this.options.pointers;return Z===0||G.pointers.length===Z},process:function(G){var Z=this.state,ae=G.eventType,Pe=Z&(vt|Gt),We=this.attrTest(G);return Pe&&(ae&Ci||!We)?Z|Zt:Pe||We?ae&$t?Z|Ct:Z&vt?Z|Gt:vt:Kt}});function li(){Tn.apply(this,arguments),this.pX=null,this.pY=null}ve(li,Tn,{defaults:{event:"pan",threshold:10,pointers:1,direction:rt},getTouchAction:function(){var G=this.options.direction,Z=[];return G&Be&&Z.push(Ne),G&qe&&Z.push(Ce),Z},directionTest:function(G){var Z=this.options,ae=!0,Pe=G.distance,We=G.direction,dt=G.deltaX,Xt=G.deltaY;return We&Z.direction||(Z.direction&Be?(We=dt===0?jn:dt<0?oe:me,ae=dt!=this.pX,Pe=Math.abs(G.deltaX)):(We=Xt===0?jn:Xt<0?Re:Ve,ae=Xt!=this.pY,Pe=Math.abs(G.deltaY))),G.direction=We,ae&&Pe>Z.threshold&&We&Z.direction},attrTest:function(G){return Tn.prototype.attrTest.call(this,G)&&(this.state&vt||!(this.state&vt)&&this.directionTest(G))},emit:function(G){this.pX=G.deltaX,this.pY=G.deltaY;var Z=ln(G.direction);Z&&(G.additionalEvent=this.options.event+Z),this._super.emit.call(this,G)}});function Ws(){Tn.apply(this,arguments)}ve(Ws,Tn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(G){return this._super.attrTest.call(this,G)&&(Math.abs(G.scale-1)>this.options.threshold||this.state&vt)},emit:function(G){if(G.scale!==1){var Z=G.scale<1?"in":"out";G.additionalEvent=this.options.event+Z}this._super.emit.call(this,G)}});function Hs(){Ti.apply(this,arguments),this._timer=null,this._input=null}ve(Hs,Ti,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[le]},process:function(G){var Z=this.options,ae=G.pointers.length===Z.pointers,Pe=G.distance<Z.threshold,We=G.deltaTime>Z.time;if(this._input=G,!Pe||!ae||G.eventType&($t|Ci)&&!We)this.reset();else if(G.eventType&xi)this.reset(),this._timer=M(function(){this.state=kt,this.tryEmit()},Z.time,this);else if(G.eventType&$t)return kt;return Kt},reset:function(){clearTimeout(this._timer)},emit:function(G){this.state===kt&&(G&&G.eventType&$t?this.manager.emit(this.options.event+"up",G):(this._input.timeStamp=P(),this.manager.emit(this.options.event,this._input)))}});function _o(){Tn.apply(this,arguments)}ve(_o,Tn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(G){return this._super.attrTest.call(this,G)&&(Math.abs(G.rotation)>this.options.threshold||this.state&vt)}});function yo(){Tn.apply(this,arguments)}ve(yo,Tn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Be|qe,pointers:1},getTouchAction:function(){return li.prototype.getTouchAction.call(this)},attrTest:function(G){var Z=this.options.direction,ae;return Z&(Be|qe)?ae=G.overallVelocity:Z&Be?ae=G.overallVelocityX:Z&qe&&(ae=G.overallVelocityY),this._super.attrTest.call(this,G)&&Z&G.offsetDirection&&G.distance>this.options.threshold&&G.maxPointers==this.options.pointers&&w(ae)>this.options.velocity&&G.eventType&$t},emit:function(G){var Z=ln(G.offsetDirection);Z&&this.manager.emit(this.options.event+Z,G),this.manager.emit(this.options.event,G)}});function bs(){Ti.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}ve(bs,Ti,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[re]},process:function(G){var Z=this.options,ae=G.pointers.length===Z.pointers,Pe=G.distance<Z.threshold,We=G.deltaTime<Z.time;if(this.reset(),G.eventType&xi&&this.count===0)return this.failTimeout();if(Pe&&We&&ae){if(G.eventType!=$t)return this.failTimeout();var dt=this.pTime?G.timeStamp-this.pTime<Z.interval:!0,Xt=!this.pCenter||Bi(this.pCenter,G.center)<Z.posThreshold;this.pTime=G.timeStamp,this.pCenter=G.center,!Xt||!dt?this.count=1:this.count+=1,this._input=G;var Di=this.count%Z.taps;if(Di===0)return this.hasRequireFailures()?(this._timer=M(function(){this.state=kt,this.tryEmit()},Z.interval,this),vt):kt}return Kt},failTimeout:function(){return this._timer=M(function(){this.state=Kt},this.options.interval,this),Kt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ir(G,Z){return Z=Z||{},Z.recognizers=Fe(Z.recognizers,Ir.defaults.preset),new bo(G,Z)}Ir.VERSION="2.0.7",Ir.defaults={domEvents:!1,touchAction:de,enable:!0,inputTarget:null,inputClass:null,preset:[[_o,{enable:!1}],[Ws,{enable:!1},["rotate"]],[yo,{direction:Be}],[li,{direction:Be},["swipe"]],[bs],[bs,{event:"doubletap",taps:2},["tap"]],[Hs]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var xo=1,vo=2;function bo(G,Z){this.options=J({},Ir.defaults,Z||{}),this.options.inputTarget=this.options.inputTarget||G,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=G,this.input=Tt(this),this.touchAction=new ct(this,this.options.touchAction),ia(this,!0),V(this.options.recognizers,function(ae){var Pe=this.add(new ae[0](ae[1]));ae[2]&&Pe.recognizeWith(ae[2]),ae[3]&&Pe.requireFailure(ae[3])},this)}bo.prototype={set:function(G){return J(this.options,G),G.touchAction&&this.touchAction.update(),G.inputTarget&&(this.input.destroy(),this.input.target=G.inputTarget,this.input.init()),this},stop:function(G){this.session.stopped=G?vo:xo},recognize:function(G){var Z=this.session;if(!Z.stopped){this.touchAction.preventDefaults(G);var ae,Pe=this.recognizers,We=Z.curRecognizer;(!We||We&&We.state&kt)&&(We=Z.curRecognizer=null);for(var dt=0;dt<Pe.length;)ae=Pe[dt],Z.stopped!==vo&&(!We||ae==We||ae.canRecognizeWith(We))?ae.recognize(G):ae.reset(),!We&&ae.state&(vt|Gt|Ct)&&(We=Z.curRecognizer=ae),dt++}},get:function(G){if(G instanceof Ti)return G;for(var Z=this.recognizers,ae=0;ae<Z.length;ae++)if(Z[ae].options.event==G)return Z[ae];return null},add:function(G){if(C(G,"add",this))return this;var Z=this.get(G.options.event);return Z&&this.remove(Z),this.recognizers.push(G),G.manager=this,this.touchAction.update(),G},remove:function(G){if(C(G,"remove",this))return this;if(G=this.get(G),G){var Z=this.recognizers,ae=It(Z,G);ae!==-1&&(Z.splice(ae,1),this.touchAction.update())}return this},on:function(G,Z){if(G!==a&&Z!==a){var ae=this.handlers;return V(Et(G),function(Pe){ae[Pe]=ae[Pe]||[],ae[Pe].push(Z)}),this}},off:function(G,Z){if(G!==a){var ae=this.handlers;return V(Et(G),function(Pe){Z?ae[Pe]&&ae[Pe].splice(It(ae[Pe],Z),1):delete ae[Pe]}),this}},emit:function(G,Z){this.options.domEvents&&$a(G,Z);var ae=this.handlers[G]&&this.handlers[G].slice();if(!(!ae||!ae.length)){Z.type=G,Z.preventDefault=function(){Z.srcEvent.preventDefault()};for(var Pe=0;Pe<ae.length;)ae[Pe](Z),Pe++}},destroy:function(){this.element&&ia(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ia(G,Z){var ae=G.element;if(ae.style){var Pe;V(G.options.cssProps,function(We,dt){Pe=Ut(ae.style,dt),Z?(G.oldCssProps[Pe]=ae.style[Pe],ae.style[Pe]=We):ae.style[Pe]=G.oldCssProps[Pe]||""}),Z||(G.oldCssProps={})}}function $a(G,Z){var ae=t.createEvent("Event");ae.initEvent(G,!0,!0),ae.gesture=Z,Z.target.dispatchEvent(ae)}J(Ir,{INPUT_START:xi,INPUT_MOVE:on,INPUT_END:$t,INPUT_CANCEL:Ci,STATE_POSSIBLE:St,STATE_BEGAN:vt,STATE_CHANGED:Gt,STATE_ENDED:Ct,STATE_RECOGNIZED:kt,STATE_CANCELLED:Zt,STATE_FAILED:Kt,DIRECTION_NONE:jn,DIRECTION_LEFT:oe,DIRECTION_RIGHT:me,DIRECTION_UP:Re,DIRECTION_DOWN:Ve,DIRECTION_HORIZONTAL:Be,DIRECTION_VERTICAL:qe,DIRECTION_ALL:rt,Manager:bo,Input:Ue,TouchAction:ct,TouchInput:yr,MouseInput:Bt,PointerEventInput:er,TouchMouseInput:X,SingleTouchInput:mn,Recognizer:Ti,AttrRecognizer:Tn,Tap:bs,Pan:li,Swipe:yo,Pinch:Ws,Rotate:_o,Press:Hs,on:Ze,off:ht,each:V,merge:pe,extend:ce,assign:J,inherit:ve,bindFn:he,prefixed:Ut});var ts=typeof e<"u"?e:typeof self<"u"?self:{};ts.Hammer=Ir,typeof a=="function"&&a.amd?a(function(){return Ir}):i.exports?i.exports=Ir:e[r]=Ir})(window,document,"Hammer")})(iD);const nD=Wa,ks=lE({__proto__:null,default:nD},[Wa]),V1=1,j1=2,Hm=4,rD={mousedown:V1,mousemove:j1,mouseup:Hm};function sD(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return!0;return!1}function oD(i){const e=i.prototype.handler;i.prototype.handler=function(r){const a=this.store;r.button>0&&r.type==="pointerdown"&&(sD(a,u=>u.pointerId===r.pointerId)||a.push(r)),e.call(this,r)}}function aD(i){i.prototype.handler=function(t){let r=rD[t.type];r&V1&&t.button>=0&&(this.pressed=!0),r&j1&&t.which===0&&(r=Hm),this.pressed&&(r&Hm&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}oD(Wa.PointerEventInput);aD(Wa.MouseInput);const lD=Wa.Manager;class _f{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const cD=ks?[[ks.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ks.Rotate,{enable:!1}],[ks.Pinch,{enable:!1}],[ks.Swipe,{enable:!1}],[ks.Pan,{threshold:0,enable:!1}],[ks.Press,{enable:!1}],[ks.Tap,{event:"doubletap",taps:2,enable:!1}],[ks.Tap,{event:"anytap",enable:!1}],[ks.Tap,{enable:!1}]]:null,Rx={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},uD={doubletap:["tap"]},hD={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Zg={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},dD={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},kx={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},fD=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Cl=typeof window<"u"?window:global;let qm=!1;try{const i={get passive(){return qm=!0,!0}};Cl.addEventListener("test",null,i),Cl.removeEventListener("test",null)}catch{qm=!1}const pD=fD.indexOf("firefox")!==-1,{WHEEL_EVENTS:mD}=Zg,Dx="wheel",zx=4.000244140625,gD=40,_D=.25;class yD extends _f{constructor(e,t,r){super(e,t,r),this.handleEvent=a=>{if(!this.options.enable)return;let u=a.deltaY;Cl.WheelEvent&&(pD&&a.deltaMode===Cl.WheelEvent.DOM_DELTA_PIXEL&&(u/=Cl.devicePixelRatio),a.deltaMode===Cl.WheelEvent.DOM_DELTA_LINE&&(u*=gD)),u!==0&&u%zx===0&&(u=Math.floor(u/zx)),a.shiftKey&&u&&(u=u*_D),this.callback({type:Dx,center:{x:a.clientX,y:a.clientY},delta:-u,srcEvent:a,pointerType:"mouse",target:a.target})},this.events=(this.options.events||[]).concat(mD),this.events.forEach(a=>e.addEventListener(a,this.handleEvent,qm?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Dx&&(this.options.enable=t)}}const{MOUSE_EVENTS:xD}=Zg,Ox="pointermove",Fx="pointerover",Bx="pointerout",Nx="pointerenter",Ux="pointerleave";class vD extends _f{constructor(e,t,r){super(e,t,r),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:a}=this.options;this.enableMoveEvent=a,this.enableLeaveEvent=a,this.enableEnterEvent=a,this.enableOutEvent=a,this.enableOverEvent=a,this.events=(this.options.events||[]).concat(xD),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Ox&&(this.enableMoveEvent=t),e===Fx&&(this.enableOverEvent=t),e===Bx&&(this.enableOutEvent=t),e===Nx&&(this.enableEnterEvent=t),e===Ux&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Fx,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Bx,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Nx,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Ux,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(Ox,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:bD}=Zg,Vx="keydown",jx="keyup";class wD extends _f{constructor(e,t,r){super(e,t,r),this.handleEvent=a=>{const u=a.target||a.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&a.type==="keydown"&&this.callback({type:Vx,srcEvent:a,key:a.key,target:a.target}),this.enableUpEvent&&a.type==="keyup"&&this.callback({type:jx,srcEvent:a,key:a.key,target:a.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(bD),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===Vx&&(this.enableDownEvent=t),e===jx&&(this.enableUpEvent=t)}}const Gx="contextmenu";class TD extends _f{constructor(e,t,r){super(e,t,r),this.handleEvent=a=>{this.options.enable&&this.callback({type:Gx,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===Gx&&(this.options.enable=t)}}const $m=1,qd=2,Zm=4,ED={pointerdown:$m,pointermove:qd,pointerup:Zm,mousedown:$m,mousemove:qd,mouseup:Zm},SD=1,AD=2,PD=3,ID=0,CD=1,MD=2,LD=1,RD=2,kD=4;function DD(i){const e=ED[i.srcEvent.type];if(!e)return null;const{buttons:t,button:r,which:a}=i.srcEvent;let u=!1,f=!1,l=!1;return e===Zm||e===qd&&!Number.isFinite(t)?(u=a===SD,f=a===AD,l=a===PD):e===qd?(u=Boolean(t&LD),f=Boolean(t&kD),l=Boolean(t&RD)):e===$m&&(u=r===ID,f=r===CD,l=r===MD),{leftButton:u,middleButton:f,rightButton:l}}function zD(i,e){const t=i.center;if(!t)return null;const r=e.getBoundingClientRect(),a=r.width/e.offsetWidth||1,u=r.height/e.offsetHeight||1,f={x:(t.x-r.left-e.clientLeft)/a,y:(t.y-r.top-e.clientTop)/u};return{center:t,offsetCenter:f}}const rm={srcElement:"root",priority:0};class OD{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let a=t.srcEvent.target;for(;a&&a!==r.rootElement;){if(this._emit(r,a),r.handled)return;a=a.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,a=!1,u=!1){const{handlers:f,handlersByElement:l}=this;let x=rm;typeof r=="string"||r&&r.addEventListener?x={...rm,srcElement:r}:r&&(x={...rm,...r});let w=l.get(x.srcElement);w||(w=[],l.set(x.srcElement,w));const P={type:e,handler:t,srcElement:x.srcElement,priority:x.priority};a&&(P.once=!0),u&&(P.passive=!0),f.push(P),this._active=this._active||!P.passive;let M=w.length-1;for(;M>=0&&!(w[M].priority>=P.priority);)M--;w.splice(M+1,0,P)}remove(e,t){const{handlers:r,handlersByElement:a}=this;for(let u=r.length-1;u>=0;u--){const f=r[u];if(f.type===e&&f.handler===t){r.splice(u,1);const l=a.get(f.srcElement);l.splice(l.indexOf(f),1),l.length===0&&a.delete(f.srcElement)}}this._active=r.some(u=>!u.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let a=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,a=!0},l=[];for(let x=0;x<r.length;x++){const{type:w,handler:P,once:M}=r[x];if(P({...e,type:w,stopPropagation:u,stopImmediatePropagation:f}),M&&l.push(r[x]),a)break}for(let x=0;x<l.length;x++){const{type:w,handler:P}=l[x];this.remove(w,P)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...DD(e),...zD(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const FD={events:null,recognizers:null,recognizerOptions:{},Manager:lD,touchAction:"none",tabIndex:0};class BD{constructor(e=null,t){this._onBasicInput=a=>{const{srcEvent:u}=a,f=hD[u.type];f&&this.manager.emit(f,a)},this._onOtherEvent=a=>{this.manager.emit(a.type,a)},this.options={...FD,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||cD}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(Rx).forEach(a=>{const u=this.manager.get(a);u&&Rx[a].forEach(f=>{u.recognizeWith(f)})});for(const a in t.recognizerOptions){const u=this.manager.get(a);if(u){const f=t.recognizerOptions[a];delete f.enable,u.set(f)}}this.wheelInput=new yD(e,this._onOtherEvent,{enable:!1}),this.moveInput=new vD(e,this._onOtherEvent,{enable:!1}),this.keyInput=new wD(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new TD(e,this._onOtherEvent,{enable:!1});for(const[a,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(a,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const a=r.get(e);if(a&&a.options.enable!==t){a.set({enable:t});const u=uD[e];u&&!this.options.recognizers&&u.forEach(f=>{const l=r.get(f);t?(l.requireFailure(e),a.dropRequireFailure(f)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,a,u){if(typeof e!="string"){r=t;for(const P in e)this._addEventHandler(P,e[P],r,a,u);return}const{manager:f,events:l}=this,x=kx[e]||e;let w=l.get(x);w||(w=new OD(this),l.set(x,w),w.recognizerName=dD[x]||x,f&&f.on(x,w.handleEvent)),w.add(e,t,r,a,u),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const f in e)this._removeEventHandler(f,e[f]);return}const{events:r}=this,a=kx[e]||e,u=r.get(a);if(u&&(u.remove(e,t),u.isEmpty())){const{recognizerName:f}=u;let l=!1;for(const x of r.values())if(x.recognizerName===f&&!x.isEmpty()){l=!0;break}l||this._toggleRecognizer(f,!1)}}}function Ra(){}const ND=({isDragging:i})=>i?"grabbing":"grab",G1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ra,onResize:Ra,onViewStateChange:Ra,onInteractionStateChange:Ra,onBeforeRender:Ra,onAfterRender:Ra,onLoad:Ra,onError:i=>ai.error(i.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:ND,getTooltip:null,debug:!1,drawPickingColors:!1};class Xg{constructor(e){B(this,"props",void 0),B(this,"width",0),B(this,"height",0),B(this,"userData",{}),B(this,"canvas",null),B(this,"viewManager",null),B(this,"layerManager",null),B(this,"effectManager",null),B(this,"deckRenderer",null),B(this,"deckPicker",null),B(this,"eventManager",null),B(this,"tooltip",null),B(this,"metrics",void 0),B(this,"animationLoop",void 0),B(this,"stats",void 0),B(this,"viewState",void 0),B(this,"cursorState",void 0),B(this,"_needsRedraw",void 0),B(this,"_pickRequest",void 0),B(this,"_lastPointerDownInfo",null),B(this,"_metricsCounter",void 0),B(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const a=t.offsetCenter;if(!a)return;r.x=a.x,r.y=a.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),B(this,"_onEvent",t=>{const r=I0[t.type],a=t.offsetCenter;if(!r||!a||!this.layerManager)return;const u=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:u,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:l}=f,x=l&&(l[r.handler]||l.props[r.handler]),w=this.props[r.handler];let P=!1;x&&(P=x.call(l,f,t)),!P&&w&&w(f,t)}),B(this,"_onPointerDown",t=>{const r=t.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props={...G1,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&ai.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Cb()==="IE"&&ai.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Pg({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&$l.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,a,u,f,l;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(t=this.viewManager)===null||t===void 0||t.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(u=this.deckPicker)===null||u===void 0||u.finalize(),this.deckPicker=null,(f=this.eventManager)===null||f===void 0||f.destroy(),this.eventManager=null,(l=this.tooltip)===null||l===void 0||l.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var x;(x=this.canvas.parentElement)===null||x===void 0||x.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ai.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ai.removed("onLayerClick","onClick")(),e.initialViewState&&!Us(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return t=t||r||a||u||f,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Rn(this.viewManager),this.viewManager.views}getViewports(e){return Rn(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){Rn(this.deckPicker);const{stats:a}=this;a.get("Pick Count").incrementCount(),a.get(t).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return a.get(t).timeEnd(),u}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Rn(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const u=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=u}if(r||r===0){var a;const u=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((a=e.style)===null||a===void 0?void 0:a.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth||e.width,r=e.clientHeight||e.height;if(t!==this.width||r!==this.height){var a;this.width=t,this.height=r,(a=this.viewManager)===null||a===void 0||a.setProps({width:t,height:r}),this.props.onResize({width:t,height:r})}}_createAnimationLoop(e){const{width:t,height:r,gl:a,glOptions:u,debug:f,onError:l,onBeforeRender:x,onAfterRender:w,useDevicePixels:P}=e;return new UM({width:t,height:r,useDevicePixels:P,autoResizeViewport:!1,gl:a,onCreateContext:M=>Zb({...u,...M,canvas:this.canvas,debug:f,onContextLost:()=>this._onContextLost()}),onInitialize:M=>this._setGLContext(M.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:x,onAfterRender:w,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new $g({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let u=a,f=!1;for(const l of r){var t;u=l,f=((t=l.layer)===null||t===void 0?void 0:t.onHover(l,e.event))||f}if(!f&&this.props.onHover&&this.props.onHover(u,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(u);this.tooltip.setTooltip(l,u.x,u.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Dg(e,{enable:!0,copyState:!0})),this.tooltip=new tD(this.canvas),uo(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new E1;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new BD(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in I0)this.eventManager.on(a,this._onEvent);this.viewManager=new Pk({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new Ak(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new Wk,this.deckRenderer=new $k(e),this.deckPicker=new Qk(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;uo(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ai.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=Fa.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}B(Xg,"defaultProps",G1);B(Xg,"VERSION",HP);class sm{constructor(e,t){B(this,"opts",void 0),B(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:a}=t;let u=r;if(r&&r.length!==a){u=new Float32Array(a);const f=t.elementOffset||0;for(let l=0;l<a;++l)u[l]=r[f+l]}return u}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function UD(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Td(i){return i.stride||i.size*i.bytesPerElement}function W1(i,e){e.offset&&ai.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Td(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,a=e.elementOffset||0,u=r*t+a*i.bytesPerElement+(i.offset||0);return{...e,offset:u,stride:t}}function VD(i,e){const t=W1(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class jD{constructor(e,t,r){B(this,"gl",void 0),B(this,"id",void 0),B(this,"size",void 0),B(this,"settings",void 0),B(this,"value",void 0),B(this,"doublePrecision",void 0),B(this,"_buffer",void 0),B(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const a=t.logicalType||t.type,u=a===5130;let{defaultValue:f}=t;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let l;u?l=5126:!a&&t.isIndexed?l=e&&gC(e,Ui.ELEMENT_INDEX_UINT32)?5125:5123:l=a||5126;let x=UD(a||l||5126);this.doublePrecision=u,u&&t.fp64===!1&&(x=Float32Array),this.value=null,this.settings={...t,defaultType:x,defaultValue:f,logicalType:a,type:l,size:this.size,bytesPerElement:x.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new Ii(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Td(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),$l.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},a=this.value instanceof Float64Array,u=VD(this.getAccessor(),t||{});return r[e]=new sm(this,u.high),r["".concat(e,"64Low")]=a?new sm(this,u.low):new Float32Array(this.size),r}if(t){const r=W1(this.getAccessor(),t);return{[e]:new sm(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:a}=this,u=r*a;if(t&&u&&t.length>=u){const f=new Array(a).fill(1/0),l=new Array(a).fill(-1/0);for(let x=0;x<u;)for(let w=0;w<a;w++){const P=t[x++];P<f[w]&&(f[w]=P),P>l[w]&&(l[w]=P)}e=[f,l]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Ii?r={buffer:e}:r=e;const a={...this.settings,...r};if(t.bufferAccessor=a,t.bounds=null,r.constant){let u=r.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!t.constant||!this._areValuesEqual(u,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=u}else if(r.buffer){const u=r.buffer;t.externalBuffer=u,t.constant=!1,this.value=r.value||null;const f=r.value instanceof Float64Array;a.type=r.type||u.accessor.type,a.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(f?2:1),a.stride=Td(a)}else if(r.value){this._checkExternalBuffer(r);let u=r.value;t.externalBuffer=null,t.constant=!1,this.value=u,a.bytesPerElement=u.BYTES_PER_ELEMENT,a.stride=Td(a);const{buffer:f,byteOffset:l}=this;this.doublePrecision&&u instanceof Float64Array&&(u=tm(u,a));const x=u.byteLength+l+a.stride*2;f.byteLength<x&&f.reallocate(x),f.setAccessor(null),f.subData({data:u,offset:l}),a.type=r.type||f.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:a}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?tm(t,{size:this.size,startIndex:r,endIndex:a}):t.subarray(r,a),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,t=!1){const{state:r}=this,a=r.allocatedValue,u=$l.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=u;const{buffer:f,byteOffset:l}=this;return f.byteLength<u.byteLength+l&&(f.reallocate(u.byteLength+l),t&&a&&f.subData({data:a instanceof Float64Array?tm(a,this):a,offset:l})),r.allocatedValue=u,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let a=!1;if(this.doublePrecision&&(a=t.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ai.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:a,size:u}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e)return t[r]=a[0],t;switch(u){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:a[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:a[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:a[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:a[0];break;default:let f=u;for(;--f>=0;)t[r+f]=Number.isFinite(e[f])?e[f]:a[f]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let a=0;a<r;a++)if(e[a]!==t[a])return!1;return!0}}const Wx=[],Hx=[];function yf(i,e=0,t=1/0){let r=Wx;const a={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(Hx.length=i.length,r=Hx):r=Wx,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),a.index=e-1),{iterable:r,objectInfo:a}}function H1(i){return i&&i[Symbol.asyncIterator]}function q1(i,e){const{size:t,stride:r,offset:a,startIndices:u,nested:f}=e,l=i.BYTES_PER_ELEMENT,x=r?r/l:t,w=a?a/l:0,P=Math.floor((i.length-w)/x);return(M,{index:C,target:V})=>{if(!u){const pe=C*x+w;for(let ve=0;ve<t;ve++)V[ve]=i[pe+ve];return V}const Y=u[C],J=u[C+1]||P;let ce;if(f){ce=new Array(J-Y);for(let pe=Y;pe<J;pe++){const ve=pe*x+w;V=new Array(t);for(let he=0;he<t;he++)V[he]=i[ve+he];ce[pe-Y]=V}}else if(x===t)ce=i.subarray(Y*t+w,J*t+w);else{ce=new i.constructor((J-Y)*t);let pe=0;for(let ve=Y;ve<J;ve++){const he=ve*x+w;for(let Ee=0;Ee<t;Ee++)ce[pe++]=i[he+Ee]}}return ce}}const GD=[],Ed=[[0,1/0]];function WD(i,e){if(i===Ed||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let a=0;for(let u=0;u<r;u++){const f=i[u];f[1]<e[0]?(t.push(f),a=u+1):f[0]>e[1]?t.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return t.splice(a,0,e),t}function om(i){const{source:e,target:t,start:r=0,size:a,getData:u}=i,f=i.end||t.length,l=e.length,x=f-r;if(l>x){t.set(e.subarray(0,x),r);return}if(t.set(e,r),!u)return;let w=l;for(;w<x;){const P=u(w,e);for(let M=0;M<a;M++)t[r+w]=P[M]||0,w++}}function HD({source:i,target:e,size:t,getData:r,sourceStartIndices:a,targetStartIndices:u}){if(!Array.isArray(u))return om({source:i,target:e,size:t,getData:r}),e;let f=0,l=0;const x=r&&((P,M)=>r(P+l,M)),w=Math.min(a.length,u.length);for(let P=1;P<w;P++){const M=a[P]*t,C=u[P]*t;om({source:i.subarray(f,M),target:e,start:l,end:C,size:t,getData:x}),f=M,l=C}return l<e.length&&om({source:[],target:e,start:l,size:t,getData:x}),e}const qD={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function $1(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...qD[t],...e,...i,type:t}}function Z1(i,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function X1(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function Y1(i){i.push(i.shift())}function Yg(i,e){const{doublePrecision:t,settings:r,value:a,size:u}=i,f=t&&a instanceof Float64Array?2:1;return(r.noAlloc?a.length:e*u)*f}function K1({buffer:i,numInstances:e,attribute:t,fromLength:r,fromStartIndices:a,getData:u=f=>f}){const f=t.doublePrecision&&t.value instanceof Float64Array?2:1,l=t.size*f,x=t.byteOffset,w=t.startIndices,P=a&&w,M=Yg(t,e),C=t.isConstant;if(!P&&r>=M)return;const V=C?t.value:t.getBuffer().getData({srcByteOffset:x});if(t.settings.normalized&&!C){const pe=u;u=(ve,he)=>t.normalizeConstant(pe(ve,he))}const Y=C?(pe,ve)=>u(V,ve):(pe,ve)=>u(V.subarray(pe,pe+l),ve),J=i.getData({length:r}),ce=new Float32Array(M);HD({source:J,target:ce,sourceStartIndices:a,targetStartIndices:w,size:l,getData:Y}),i.byteLength<ce.byteLength+x&&i.reallocate(ce.byteLength+x),i.subData({data:ce,offset:x})}class Kg extends jD{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:Ed}),B(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,a=Array.isArray(t)?e[t.find(u=>e[u])]:e[t];return $1(a,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:a=1/0}=t;this.state.updateRanges=WD(this.state.updateRanges,[r,a])}else this.state.updateRanges=Ed}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=GD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==Ed),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:a}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:f,noAlloc:l}}=this;let x=!0;if(f){for(const[w,P]of u)f.call(a,this,{data:t,startRow:w,endRow:P,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,P]of u){const M=Number.isFinite(w)?this.getVertexOffset(w):0,C=Number.isFinite(P)?this.getVertexOffset(P):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:M,endOffset:C})}this._checkAttributeArray()}else x=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),x}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:a}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(a.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),a.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Rn(ArrayBuffer.isView(f.value),"invalid ".concat(a.accessor));const l=Boolean(f.size)&&f.size!==this.size;return r.binaryAccessor=q1(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:t,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,{data:t,startRow:r,endRow:a,props:u,numInstances:f}){if(e.constant)return;const{settings:l,state:x,value:w,size:P,startIndices:M}=e,{accessor:C,transform:V}=l,Y=x.binaryAccessor||(typeof C=="function"?C:u[C]);Rn(typeof Y=="function",'accessor "'.concat(C,'" is not a function'));let J=e.getVertexOffset(r);const{iterable:ce,objectInfo:pe}=yf(t,r,a);for(const ve of ce){pe.index++;let he=Y(ve,pe);if(V&&(he=V.call(this,he)),M){const Ee=(pe.index<M.length-1?M[pe.index+1]:f)-M[pe.index];if(he&&Array.isArray(he[0])){let Fe=J;for(const Ze of he)e._normalizeValue(Ze,w,Fe),Fe+=P}else he&&he.length>P?w.set(he,J):(e._normalizeValue(he,pe.target,0),_k({target:w,source:pe.target,start:J,count:Ee}));J+=Ee*P}else e._normalizeValue(he,w,J),J+=P}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class $D{constructor({gl:e,attribute:t,timeline:r}){B(this,"gl",void 0),B(this,"type","interpolation"),B(this,"attributeInTransition",void 0),B(this,"settings",void 0),B(this,"attribute",void 0),B(this,"transition",void 0),B(this,"currentStartIndices",void 0),B(this,"currentLength",void 0),B(this,"transform",void 0),B(this,"buffers",void 0),this.gl=e,this.transition=new Gu(r),this.attribute=t,this.attributeInTransition=new Kg(e,t.settings),this.currentStartIndices=t.startIndices,this.currentLength=0,this.transform=XD(e,t);const a={byteLength:0,usage:35050};this.buffers=[new Ii(e,a),new Ii(e,a)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:a,attribute:u}=this;Y1(a);const f={numInstances:t,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of a)K1({buffer:l,...f});this.currentStartIndices=u.startIndices,this.currentLength=Yg(u,t),this.attributeInTransition.setData({buffer:a[1],value:u.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aFrom:a[0],aTo:Z1(r,u)},feedbackBuffers:{vCurrent:a[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:a}=this.transition;let u=a/t;r&&(u=r(u)),this.transform.run({uniforms:{time:u}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const ZD=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function XD(i,e){const t=X1(e.size);return new jg(i,{vs:ZD,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class YD{constructor({gl:e,attribute:t,timeline:r}){B(this,"gl",void 0),B(this,"type","spring"),B(this,"attributeInTransition",void 0),B(this,"settings",void 0),B(this,"attribute",void 0),B(this,"transition",void 0),B(this,"currentStartIndices",void 0),B(this,"currentLength",void 0),B(this,"texture",void 0),B(this,"framebuffer",void 0),B(this,"transform",void 0),B(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Gu(r),this.attribute=t,this.attributeInTransition=new Kg(e,{...t.settings,normalized:!1}),this.currentStartIndices=t.startIndices,this.currentLength=0,this.texture=JD(e),this.framebuffer=QD(e,this.texture),this.transform=KD(e,t,this.framebuffer);const a={byteLength:0,usage:35050};this.buffers=[new Ii(e,a),new Ii(e,a),new Ii(e,a)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:a,attribute:u}=this,f={numInstances:t,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of a)K1({buffer:l,...f});this.settings=e,this.currentStartIndices=u.startIndices,this.currentLength=Yg(u,t),this.attributeInTransition.setData({buffer:a[1],value:u.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aTo:Z1(r,u)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:a}=this;if(!a.update())return!1;const f=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:f.stiffness,damping:f.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Y1(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),mf(r)[0]>0||a.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function KD(i,e,t){const r=X1(e.size);return new jg(i,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function JD(i){return new jr(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function QD(i,e){return new Pn(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const ez={interpolation:$D,spring:YD};class tz{constructor(e,{id:t,timeline:r}){B(this,"id",void 0),B(this,"isSupported",void 0),B(this,"gl",void 0),B(this,"timeline",void 0),B(this,"transitions",void 0),B(this,"needsRedraw",void 0),B(this,"numInstances",void 0),this.id=t,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=jg.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const a in e){const u=e[a],f=u.getTransitionSetting(t);f&&this._updateAttribute(a,u,f)}for(const a in this.transitions){const u=e[a];(!u||!u.getTransitionSetting(t))&&this._removeTransition(a)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const a=this.transitions[e];let u=!a||a.type!==r.type;if(u){if(!this.isSupported){ai.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);const f=ez[r.type];f?this.transitions[e]=new f({attribute:t,timeline:this.timeline,gl:this.gl}):(ai.error("unsupported transition type '".concat(r.type,"'"))(),u=!1)}(u||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const qx="attributeManager.invalidate",iz="attributeManager.updateStart",nz="attributeManager.updateEnd",rz="attribute.updateStart",sz="attribute.allocate",oz="attribute.updateEnd";class az{constructor(e,{id:t="attribute-manager",stats:r,timeline:a}={}){B(this,"id",void 0),B(this,"gl",void 0),B(this,"attributes",void 0),B(this,"updateTriggers",void 0),B(this,"needsRedraw",void 0),B(this,"userData",void 0),B(this,"stats",void 0),B(this,"attributeTransitionManager",void 0),B(this,"mergeBoundsMemoized",ju(lk)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new tz(e,{id:"".concat(t,"-transitions"),timeline:a}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);Xn(qx,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Xn(qx,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:a,props:u={},buffers:f={},context:l={}}){let x=!1;Xn(iz,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const P=this.attributes[w],M=P.settings.accessor;P.startIndices=r,P.numInstances=t,u[w]&&ai.removed("props.".concat(w),"data.attributes.".concat(w))(),P.setExternalBuffer(f[w])||P.setBinaryValue(typeof M=="string"?f[M]:void 0,e.startIndices)||typeof M=="string"&&!f[M]&&P.setConstantValue(u[M])||P.needsUpdate()&&(x=!0,this._updateAttribute({attribute:P,numInstances:t,data:e,props:u,context:l})),this.needsRedraw=this.needsRedraw||P.needsRedraw()}x&&Xn(nz,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:a})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var a;return(a=this.attributes[r])===null||a===void 0?void 0:a.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,a={...r.getAttributes()};for(const u in t){const f=t[u];f.needsRedraw(e)&&!r.hasAttribute(u)&&(a[u]=f)}return a}getShaderAttributes(e,t={}){e||(e=this.getAttributes());const r={};for(const a in e)t[a]||Object.assign(r,e[a].getShaderAttributes());return r}_add(e,t={}){for(const r in e){const a=e[r];this.attributes[r]=this._createAttribute(r,a,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const a={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new Kg(this.gl,a)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(a=>{e[a]||(e[a]=[]),e[a].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:a}=this,u=a[e];return u&&u.forEach(f=>{const l=r[f];l&&l.setNeedsUpdate(l.id,t)}),u}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(Xn(rz,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&Xn(sz,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,Xn(oz,t,r))}}class lz extends Gu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:a,easing:u}}=this,f=u(e/a);this._value=Ud(t,r,f)}}const $x=1e-5;function Zx(i,e,t,r,a){const u=e-i,l=(t-e)*a,x=-u*r;return l+x+u+e}function cz(i,e,t,r,a){if(Array.isArray(t)){const u=[];for(let f=0;f<t.length;f++)u[f]=Zx(i[f],e[f],t[f],r,a);return u}return Zx(i,e,t,r,a)}function Xx(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const a=i[r]-e[r];t+=a*a}return Math.sqrt(t)}return Math.abs(i-e)}class uz extends Gu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:a}=this.settings,{_prevValue:u=e,_currValue:f=e}=this;let l=cz(u,f,t,r,a);const x=Xx(l,t),w=Xx(l,f);x<$x&&w<$x&&(l=t,this.end()),this._prevValue=f,this._currValue=l}}const hz={interpolation:lz,spring:uz};class dz{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,a){const{transitions:u}=this;if(u.has(e)){const x=u.get(e),{value:w=x.settings.fromValue}=x;t=w,this.remove(e)}if(a=$1(a),!a)return;const f=hz[a.type];if(!f){ai.error("unsupported transition type '".concat(a.type,"'"))();return}const l=new f(this.timeline);l.start({...a,fromValue:t,toValue:r}),u.set(e,l)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function fz(i){const e=i[Yo];for(const t in e){const r=e[t],{validate:a}=r;if(a&&!a(i[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(i[t]))}}function pz(i,e){const t=J1({newProps:i,oldProps:e,propTypes:i[Yo],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=gz(i,e);let a=!1;return r||(a=_z(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:a,extensionsChanged:yz(i,e),transitionsChanged:mz(i,e)}}function mz(i,e){if(!i.transitions)return!1;const t={},r=i[Yo];let a=!1;for(const u in i.transitions){const f=r[u],l=f&&f.type;(l==="number"||l==="color"||l==="array")&&Xm(i[u],e[u],f)&&(t[u]=!0,a=!0)}return a?t:!1}function J1({newProps:i,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:a="props"}){if(e===i)return!1;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return"".concat(a," changed shallowly");for(const u of Object.keys(i))if(!(u in t)){if(!(u in e))return"".concat(a,".").concat(u," added");const f=Xm(i[u],e[u],r[u]);if(f)return"".concat(a,".").concat(u," ").concat(f)}for(const u of Object.keys(e))if(!(u in t)){if(!(u in i))return"".concat(a,".").concat(u," dropped");if(!Object.hasOwnProperty.call(i,u)){const f=Xm(i[u],e[u],r[u]);if(f)return"".concat(a,".").concat(u," ").concat(f)}}return!1}function Xm(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function gz(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:a}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&a&&(t=a(i.data,e.data)||t),t}function _z(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&Yx(i,e,"all"))return{all:!0};const t={};let r=!1;for(const a in i.updateTriggers)a!=="all"&&Yx(i,e,a)&&(t[a]=!0,r=!0);return r?t:!1}function yz(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let a=0;a<r.length;a++)if(!r[a].equals(t[a]))return!0;return!1}function Yx(i,e,t){let r=i.updateTriggers[t];r=r??{};let a=e.updateTriggers[t];return a=a??{},J1({oldProps:a,newProps:r,triggerName:t})}const xz="count(): argument not an object",vz="count(): argument not a container";function bz(i){if(!Tz(i))throw new Error(xz);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(wz(i))return Object.keys(i).length;throw new Error(vz)}function wz(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function Tz(i){return i!==null&&typeof i=="object"}function Ez(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(a=>a.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const a in e.inject)r[a]=(r[a]||"")+e.inject[a];t.inject=r}return t}const Sz={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Ym={};function Az(i,e,t){if(e instanceof jr)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let r=null;e.compressed&&(r={[10241]:e.data.length>1?9985:9729});const a=new jr(i,{...e,parameters:{...Sz,...r,...t}});return Ym[a.id]=!0,a}function Pz(i){!i||!(i instanceof jr)||Ym[i.id]&&(i.delete(),delete Ym[i.id])}const Iz={boolean:{validate(i,e){return!0},equal(i,e,t){return Boolean(i)===Boolean(e)}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||Km(i)&&(i.length===3||i.length===4)},equal(i,e,t){return Us(i,e,1)}},accessor:{validate(i,e){const t=$d(i);return t==="function"||t===$d(e.value)},equal(i,e,t){return typeof e=="function"?!0:Us(i,e,1)}},array:{validate(i,e){return e.optional&&!i||Km(i)},equal(i,e,t){const{compare:r}=t,a=Number.isInteger(r)?r:r?1:0;return r?Us(i,e,a):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,a=Number.isInteger(r)?r:r?1:0;return r?Us(i,e,a):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{const{dataTransform:r}=t.props;return r&&i?r(i):i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.gl?null:Az(r.gl,i,{...e.parameters,...t.props.textureParameters})},release:i=>{Pz(i)}}};function Cz(i){const e={},t={},r={};for(const[a,u]of Object.entries(i)){const f=u==null?void 0:u.deprecatedFor;if(f)r[a]=Array.isArray(f)?f:[f];else{const l=Mz(a,u);e[a]=l,t[a]=l.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function Mz(i,e){switch($d(e)){case"object":return tu(i,e);case"array":return tu(i,{type:"array",value:e,compare:!1});case"boolean":return tu(i,{type:"boolean",value:e});case"number":return tu(i,{type:"number",value:e});case"function":return tu(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function tu(i,e){return"type"in e?{name:i,...Iz[e.type],...e}:"value"in e?{name:i,type:$d(e.value),...e}:{name:i,type:"object",value:e}}function Km(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function $d(i){return Km(i)?"array":i===null?"null":typeof i}function Lz(i,e){let t;for(let u=e.length-1;u>=0;u--){const f=e[u];"extensions"in f&&(t=f.extensions)}const r=Jm(i.constructor,t),a=Object.create(r);a[Hd]=i,a[Ga]={},a[Ho]={};for(let u=0;u<e.length;++u){const f=e[u];for(const l in f)a[l]=f[l]}return Object.freeze(a),a}const Rz="_mergedDefaultProps";function Jm(i,e){let t=Rz;if(e)for(const a of e){const u=a.constructor;u&&(t+=":".concat(u.extensionName||u.name))}const r=Zd(i,t);return r||(i[t]=kz(i,e||[]))}function kz(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),a=Jm(r),u=Zd(i,"defaultProps")||{},f=Cz(u),l=Object.assign(Object.create(null),a,f.defaultProps),x=Object.assign(Object.create(null),a==null?void 0:a[Yo],f.propTypes),w=Object.assign(Object.create(null),a==null?void 0:a[nm],f.deprecatedProps);for(const P of e){const M=Jm(P.constructor);M&&(Object.assign(l,M),Object.assign(x,M[Yo]),Object.assign(w,M[nm]))}return Dz(l,i),Oz(l,x),zz(l,w),l[Yo]=x,l[nm]=w,e.length===0&&!Jg(i,"_propTypes")&&(i._propTypes=x),l}function Dz(i,e){const t=Bz(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function zz(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const a="".concat(this.id,": ").concat(t);for(const u of e[t])Jg(this,u)||(this[u]=r);ai.deprecated(a,e[t].join("/"))()}})}function Oz(i,e){const t={},r={};for(const a in e){const u=e[a],{name:f,value:l}=u;u.async&&(t[f]=l,r[f]=Fz(f))}i[zl]=t,i[Ga]={},Object.defineProperties(i,r)}function Fz(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||H1(e)?this[Ga][i]=e:this[Ho][i]=e},get(){if(this[Ho]){if(i in this[Ho])return this[Ho][i]||this[zl][i];if(i in this[Ga]){const e=this[Hd]&&this[Hd].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[zl][i]}}return this[zl][i]}}}function Jg(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function Zd(i,e){return Jg(i,e)&&i[e]}function Bz(i){const e=Zd(i,"layerName")||Zd(i,"componentName");return e||ai.once(0,"".concat(i.name,".componentName not specified"))(),e||i.name}let Nz=0;class Qg{constructor(...e){B(this,"id",void 0),B(this,"props",void 0),B(this,"count",void 0),this.props=Lz(this,e),this.id=this.props.id,this.count=Nz++}clone(e){const{props:t}=this,r={};for(const a in t[zl])a in t[Ho]?r[a]=t[Ho][a]:a in t[Ga]&&(r[a]=t[Ga][a]);return new this.constructor({...t,...r,...e})}}B(Qg,"componentName","Component");B(Qg,"defaultProps",{});const Uz=Object.freeze({});class Vz{constructor(e){B(this,"component",void 0),B(this,"onAsyncPropUpdated",void 0),B(this,"asyncProps",void 0),B(this,"oldProps",void 0),B(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Uz}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Hd]||this.component;const t=e[Ho]||{},r=e[Ga]||e,a=e[zl]||{};for(const u in t){const f=t[u];this._createAsyncPropData(u,a[u]),this._updateAsyncProp(u,f),t[u]=this.getAsyncProp(u)}for(const u in r){const f=r[u];this._createAsyncPropData(u,a[u]),this._updateAsyncProp(u,f)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(H1(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const a=this.asyncProps[e];a&&r>=a.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=t,a.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const a=r.pendingLoadCount;t.then(u=>{this.component&&(u=this._postProcessValue(r,u),this._setAsyncPropValue(e,u,a),this._onResolve(e,u))}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const a=r.pendingLoadCount;let u=[],f=0;for await(const l of t){if(!this.component)return;const{dataTransform:x}=this.component.props;x?u=x(l,u):u=u.concat(l),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(e,u,a)}this._onResolve(e,u)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const a=this.component&&this.component.props[Yo];this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class jz extends Vz{constructor({attributeManager:e,layer:t}){super(t),B(this,"attributeManager",void 0),B(this,"needsRedraw",void 0),B(this,"needsUpdate",void 0),B(this,"subLayers",void 0),B(this,"usesPickingColorCache",void 0),B(this,"hasPickingBuffer",void 0),B(this,"changeFlags",void 0),B(this,"viewport",void 0),B(this,"uniformTransitions",void 0),B(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,a=r==null?void 0:r.props.fetch;return a?a(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const a=r.props.onDataLoad;e==="data"&&a&&a(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const Gz="layer.changeFlag",Wz="layer.initialize",Hz="layer.update",qz="layer.finalize",$z="layer.matched",Kx=2**24-1,Zz=Object.freeze([]),Xz=ju(({oldViewport:i,viewport:e})=>i.equals(e));let Ds=new Uint8ClampedArray(0);const Yz={data:{type:"data",value:Zz,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:e,layer:t,loaders:r,loadOptions:a,signal:u})=>{const{resourceManager:f}=t.context;if(a=a||t.getLoadOptions(),r=r||t.props.loaders,u){var l;a={...a,fetch:{...(l=a)===null||l===void 0?void 0:l.fetch,signal:u}}}let x=f.contains(i);return!x&&!a&&(f.add({resourceId:i,data:Fd(i,r),persistent:!1}),x=!0),x?f.subscribe({resourceId:i,onChange:w=>{var P;return(P=t.internalState)===null||P===void 0?void 0:P.reloadAsyncProp(e,w)},consumerId:t.id,requestId:e}):Fd(i,r,a)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:yi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class go extends Qg{constructor(...e){super(...e),B(this,"internalState",null),B(this,"lifecycle",Al.NO_STATE),B(this,"context",void 0),B(this,"state",void 0),B(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Rn(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=z1(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[a,u,f]=k1(r,t.pixelProjectionMatrix);return e.length===2?[a,u]:[a,u,f]}unproject(e){return Rn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Rn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return pk(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===yi.DEFAULT||e===yi.LNGLAT||e===yi.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Rn(e instanceof Uint8Array);const[t,r,a]=e;return t+r*256+a*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:bz(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=Ez(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const a of r)t.invalidateAll(a);else t.invalidateAll();if(t){const{props:a}=e,u=this.internalState.hasPickingBuffer,f=Number.isInteger(a.highlightedObjectIndex)||a.pickable||a.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(u!==f){this.internalState.hasPickingBuffer=f;const{pickingColors:l,instancePickingColors:x}=t.attributes,w=l||x;w&&(f&&w.constant&&(w.constant=!1,t.invalidate(w.id)),!w.value&&!f&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:a}=e;return a>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[a]),e}raiseError(e,t){var r,a;if(t&&(e.message="".concat(t,": ").concat(e.message)),!((r=(a=this.props).onError)!==null&&r!==void 0&&r.call(a,e))){var u,f;(u=this.context)===null||u===void 0||(f=u.onError)===null||f===void 0||f.call(u,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!Xz({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),a=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:a,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const a in t)Object.defineProperty(r,a,{value:t[a]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(Ds.length/3);if(this.internalState.usesPickingColorCache=!0,r<t){t>Kx&&ai.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ds=$l.allocate(Ds,t,{size:3,copy:!0,maxCount:Math.max(t,Kx)});const a=Math.floor(Ds.length/3),u=[];for(let f=r;f<a;f++)this.encodePickingColor(f,u),Ds[f*3+0]=u[0],Ds[f*3+1]=u[1],Ds[f*3+2]=u[2]}e.value=Ds.subarray(0,t*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),a=e.userData.excludeAttributes||{},u=r.getShaderAttributes(t,a);e.setAttributes(u)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,a=t||r;if(!a)return;const u=a.getVertexOffset(e),f=a.getVertexOffset(e+1);a.buffer.subData({data:new Uint8Array(f-u),offset:u})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Ds.buffer&&(r.value=Ds.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Rn(!this.internalState),Rn(Number.isFinite(this.props.coordinateSystem)),Xn(Wz,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new jz({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ai.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new dz(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Xn($z,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Xn(Hz,this,e),!e)return;const t=this.props,r=this.context,a=this.internalState,u=r.viewport,f=this._updateUniformTransition();a.propsInTransition=f,r.viewport=a.viewport||u,this.props=f;try{const l=this._getUpdateParams(),x=this.getModels();if(r.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const P of this.props.extensions)P.updateState.call(this,l,P);const w=this.getModels()[0]!==x[0];this._postUpdate(l,w)}finally{r.viewport=u,this.props=t,this._clearChangeFlags(),a.needsUpdate=!1,a.resetOldProps()}}_finalize(){Xn(qz,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:t={},parameters:r={}}){this._updateAttributeTransition();const a=this.props,u=this.context;this.props=this.internalState.propsInTransition||a;const f=this.props.opacity;t.opacity=Math.pow(f,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,x=l&&l(t)||[0,0];uo(u.gl,{polygonOffset:x}),gs(u.gl,r,()=>{const w={moduleParameters:e,uniforms:t,parameters:r,context:u};for(const P of this.props.extensions)P.draw.call(this,w,P);this.draw(w)})}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const a in e)if(e[a]){let u=!1;switch(a){case"dataChanged":const f=e[a],l=t[a];f&&Array.isArray(l)&&(t.dataChanged=Array.isArray(f)?l.concat(f):f,u=!0);default:t[a]||(t[a]=e[a],u=!0)}u&&Xn(Gz,this,a,e)}const r=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=pz(e,t);if(r.updateTriggersChanged)for(const u in r.updateTriggersChanged)r.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(r.transitionsChanged)for(const u in r.transitionsChanged){var a;this.internalState.uniformTransitions.add(u,t[u],e[u],(a=e.transitions)===null||a===void 0?void 0:a[u])}return this.setChangeFlags(r)}validateProps(){fz(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new az(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:a}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:u}=this.state;u==null||u.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:l,highlightColor:x}=r;if(t||a.autoHighlight!==f||a.highlightedObjectIndex!==l||a.highlightColor!==x){const w={};f||(w.pickingSelectedColor=null),Array.isArray(x)&&(w.pickingHighlightColor=x),(t||l!==a.highlightedObjectIndex)&&(w.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(w)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),a=r?r.getNeedsRedraw(e):!1;if(t=t||a,t)for(const u of this.props.extensions)u.onNeedsRedraw.call(this,u);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}B(go,"defaultProps",Yz);B(go,"layerName","Layer");const Kz="compositeLayer.renderLayers";class e_ extends go{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,a)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,a)}return e}getSubLayerProps(e={}){var t;const{opacity:r,pickable:a,visible:u,parameters:f,getPolygonOffset:l,highlightedObjectIndex:x,autoHighlight:w,highlightColor:P,coordinateSystem:M,coordinateOrigin:C,wrapLongitude:V,positionFormat:Y,modelMatrix:J,extensions:ce,fetch:pe,operation:ve,_subLayerProps:he}=this.props,Ee={id:"",updateTriggers:{},opacity:r,pickable:a,visible:u,parameters:f,getPolygonOffset:l,highlightedObjectIndex:x,autoHighlight:w,highlightColor:P,coordinateSystem:M,coordinateOrigin:C,wrapLongitude:V,positionFormat:Y,modelMatrix:J,extensions:ce,fetch:pe,operation:ve},Fe=he&&e.id&&he[e.id],Ze=Fe&&Fe.updateTriggers,ht=e.id||"sublayer";if(Fe){const _t=this.props[Yo],lt=e.type?e.type._propTypes:{};for(const Et in Fe){const It=lt[Et]||_t[Et];It&&It.type==="accessor"&&(Fe[Et]=this.getSubLayerAccessor(Fe[Et]))}}Object.assign(Ee,e,Fe),Ee.id="".concat(this.props.id,"-").concat(ht),Ee.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...Ze};for(const _t of ce){const lt=_t.getSubLayerProps.call(this,_t);lt&&Object.assign(Ee,lt,{updateTriggers:Object.assign(Ee.updateTriggers,lt.updateTriggers)})}return Ee}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const a=!r||this.needsUpdate();if(a){const u=this.renderLayers();r=gf(u,Boolean),this.internalState.subLayers=r}Xn(Kz,this,a,r);for(const u of r)u.parent=this}}B(e_,"layerName","CompositeLayer");class Q1{constructor(e){B(this,"opts",void 0),B(this,"typedArrayManager",void 0),B(this,"indexStarts",[0]),B(this,"vertexStarts",[0]),B(this,"vertexCount",0),B(this,"instanceCount",0),B(this,"attributes",void 0),B(this,"_attributeDefs",void 0),B(this,"data",void 0),B(this,"getGeometry",void 0),B(this,"geometryBuffer",void 0),B(this,"buffers",void 0),B(this,"positionSize",void 0),B(this,"normalize",void 0);const{attributes:t={}}=e;this.typedArrayManager=$l,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:r={},getGeometry:a,geometryBuffer:u,positionFormat:f,dataChanged:l,normalize:x=!0}=this.opts;if(this.data=t,this.getGeometry=a,this.positionSize=u&&u.size||(f==="XY"?2:3),this.buffers=r,this.normalize=x,u&&(Rn(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),x||(r.positions=u)),this.geometryBuffer=r.positions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?q1(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:r,buffers:a,_attributeDefs:u,typedArrayManager:f}=this;for(const l in u)if(l in a)f.release(r[l]),r[l]=null;else{const x=u[l];x.copy=t,r[l]=f.allocate(r[l],e,x)}}_forEachGeometry(e,t,r){const{data:a,getGeometry:u}=this,{iterable:f,objectInfo:l}=yf(a,t,r);for(const x of f){l.index++;const w=u?u(x,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:r,instanceCount:a}=this;const{data:u,geometryBuffer:f}=this,{startRow:l=0,endRow:x=1/0}=e||{},w={};if(e||(t=[0],r=[0]),this.normalize||!f)this._forEachGeometry((M,C)=>{const V=M&&this.normalizeGeometry(M);w[C]=V,r[C+1]=r[C]+(V?this.getGeometrySize(V):0)},l,x),a=r[r.length-1];else if(r=u.startIndices,a=r[u.length]||0,ArrayBuffer.isView(f))a=a||f.length/this.positionSize;else if(f instanceof Ii){const M=f.accessor.stride||this.positionSize*4;a=a||f.byteLength/M}else if(f.buffer){const M=f.stride||this.positionSize*4;a=a||f.buffer.byteLength/M}else if(f.value){const M=f.value,C=f.stride/M.BYTES_PER_ELEMENT||this.positionSize;a=a||M.length/C}this._allocate(a,Boolean(e)),this.indexStarts=t,this.vertexStarts=r,this.instanceCount=a;const P={};this._forEachGeometry((M,C)=>{const V=w[C]||M;P.vertexStart=r[C],P.indexStart=t[C];const Y=C<r.length-1?r[C+1]:a;P.geometrySize=Y-r[C],P.geometryIndex=C,this.updateGeometryAttributes(V,P)},l,x),this.vertexCount=t[t.length-1]}}const Jz=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Qz=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Xd=[0,0,0,255],eO={getSourcePosition:{type:"accessor",value:i=>i.sourcePosition},getTargetPosition:{type:"accessor",value:i=>i.targetPosition},getSourceColor:{type:"accessor",value:Xd},getTargetColor:{type:"accessor",value:Xd},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class t_ extends go{constructor(...e){super(...e),B(this,"state",void 0)}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Jz,fs:Qz,modules:[tc,ic]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:Xd},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:Xd},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;const{gl:r}=this.context;(t=this.state.model)===null||t===void 0||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:t,widthScale:r,widthMinPixels:a,widthMaxPixels:u,greatCircle:f,wrapLongitude:l}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:f,widthUnits:Qo[t],widthScale:r,widthMinPixels:a,widthMaxPixels:u,useShortestPath:l}).draw()}_getModel(e){let t=[];for(let u=0;u<50;u++)t=t.concat([u,1,0,u,-1,0]);const a=new ta(e,{...this.getShaders(),id:this.props.id,geometry:new Ql({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0});return a.setUniforms({numSegments:50}),a}}B(t_,"layerName","ArcLayer");B(t_,"defaultProps",eO);const tO=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,iO=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,nO=1024,rO=4,Jx=()=>{},Qx={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function sO(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function oO(i,e,t,r){const a=Math.min(t/e.width,r/e.height),u=Math.floor(e.width*a),f=Math.floor(e.height*a);return a===1?{data:e,width:u,height:f}:(i.canvas.height=f,i.canvas.width=u,i.clearRect(0,0,u,f),i.drawImage(e,0,0,e.width,e.height,0,0,u,f),{data:i.canvas,width:u,height:f})}function Mu(i){return i&&(i.id||i.url)}function aO(i,e,t,r){const a=i.width,u=i.height,f=new jr(i.gl,{width:e,height:t,parameters:r});return dC(i,f,{targetY:0,width:a,height:u}),i.delete(),f}function ev(i,e,t){for(let r=0;r<e.length;r++){const{icon:a,xOffset:u}=e[r],f=Mu(a);i[f]={...a,x:u,y:t}}}function lO({icons:i,buffer:e,mapping:t={},xOffset:r=0,yOffset:a=0,rowHeight:u=0,canvasWidth:f}){let l=[];for(let x=0;x<i.length;x++){const w=i[x],P=Mu(w);if(!t[P]){const{height:M,width:C}=w;r+C+e>f&&(ev(t,l,a),r=0,a=u+a+e,u=0,l=[]),l.push({icon:w,xOffset:r}),r=r+C+e,u=Math.max(u,M)}}return l.length>0&&ev(t,l,a),{mapping:t,rowHeight:u,xOffset:r,yOffset:a,canvasWidth:f,canvasHeight:sO(u+a+e)}}function cO(i,e,t){if(!i||!e)return null;t=t||{};const r={},{iterable:a,objectInfo:u}=yf(i);for(const f of a){u.index++;const l=e(f,u),x=Mu(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!r[x]&&(!t[x]||l.url!==t[x].url)&&(r[x]={...l,source:f,sourceIndex:u.index})}return r}class uO{constructor(e,{onUpdate:t=Jx,onError:r=Jx}){B(this,"gl",void 0),B(this,"onUpdate",void 0),B(this,"onError",void 0),B(this,"_loadOptions",null),B(this,"_texture",null),B(this,"_externalTexture",null),B(this,"_mapping",{}),B(this,"_textureParameters",null),B(this,"_pendingCount",0),B(this,"_autoPacking",!1),B(this,"_xOffset",0),B(this,"_yOffset",0),B(this,"_rowHeight",0),B(this,"_buffer",rO),B(this,"_canvasWidth",nO),B(this,"_canvasHeight",0),B(this,"_canvas",null),this.gl=e,this.onUpdate=t,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?Mu(e):e;return this._mapping[t]||{}}setProps({loadOptions:e,autoPacking:t,iconAtlas:r,iconMapping:a,textureParameters:u}){if(e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),a&&(this._mapping=a),r){var f;(f=this._texture)===null||f===void 0||f.delete(),this._texture=null,this._externalTexture=r}u&&(this._textureParameters=u)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(cO(e,t,this._mapping)||{});if(r.length>0){const{mapping:a,xOffset:u,yOffset:f,rowHeight:l,canvasHeight:x}=lO({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=a,this._xOffset=u,this._yOffset=f,this._canvasHeight=x,this._texture||(this._texture=new jr(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Qx})),this._texture.height!==this._canvasHeight&&(this._texture=aO(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Qx)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Fd(r.url,this._loadOptions).then(a=>{const u=Mu(r),f=this._mapping[u],{x:l,y:x,width:w,height:P}=f,{data:M,width:C,height:V}=oO(t,a,w,P);this._texture.setSubImageData({data:M,x:l+(w-C)/2,y:x+(P-V)/2,width:C,height:V}),f.width=C,f.height=V,this._texture.generateMipmap(),this.onUpdate()}).catch(a=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:a})}).finally(()=>{this._pendingCount--})}}const ew=[0,0,0,255],hO={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:i=>i.position},getIcon:{type:"accessor",value:i=>i.icon},getColor:{type:"accessor",value:ew},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class xf extends go{constructor(...e){super(...e),B(this,"state",void 0)}getShaders(){return super.getShaders({vs:tO,fs:iO,modules:[tc,ic]})}initializeState(){this.state={iconManager:new uO(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:ew},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:a}=e,u=this.getAttributeManager(),{iconAtlas:f,iconMapping:l,data:x,getIcon:w,textureParameters:P}=t,{iconManager:M}=this.state,C=f||this.internalState.isAsyncPropLoading("iconAtlas");if(M.setProps({loadOptions:t.loadOptions,autoPacking:!C,iconAtlas:f,iconMapping:C?l:null,textureParameters:P}),C?r.iconMapping!==t.iconMapping&&u.invalidate("getIcon"):(a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getIcon))&&M.packIcons(x,w),a.extensionsChanged){var V;const{gl:Y}=this.context;(V=this.state.model)===null||V===void 0||V.delete(),this.state.model=this._getModel(Y),u.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:r,sizeMaxPixels:a,sizeUnits:u,billboard:f,alphaCutoff:l}=this.props,{iconManager:x}=this.state,w=x.getTexture();w&&this.state.model.setUniforms(e).setUniforms({iconsTexture:w,iconsTextureDim:[w.width,w.height],sizeUnits:Qo[u],sizeScale:t,sizeMinPixels:r,sizeMaxPixels:a,billboard:f,alphaCutoff:l}).draw()}_getModel(e){const t=[-1,-1,-1,1,1,1,1,-1];return new ta(e,{...this.getShaders(),id:this.props.id,geometry:new Ql({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;const r=(t=this.getCurrentLayer())===null||t===void 0?void 0:t.props.onIconError;r?r(e):ai.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:r,anchorX:a=t/2,anchorY:u=r/2}=this.state.iconManager.getIconMapping(e);return[t/2-a,r/2-u]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:r,width:a,height:u}=this.state.iconManager.getIconMapping(e);return[t,r,a,u]}}B(xf,"defaultProps",hO);B(xf,"layerName","IconLayer");const dO=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,fO=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,tv=[0,0,0,255],pO={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:tv},getLineColor:{type:"accessor",value:tv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class i_ extends go{getShaders(){return super.getShaders({vs:dO,fs:fO,modules:[tc,ic]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var t;const{gl:r}=this.context;(t=this.state.model)===null||t===void 0||t.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:a,radiusMaxPixels:u,stroked:f,filled:l,billboard:x,antialiasing:w,lineWidthUnits:P,lineWidthScale:M,lineWidthMinPixels:C,lineWidthMaxPixels:V}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:f?1:0,filled:l,billboard:x,antialiasing:w,radiusUnits:Qo[t],radiusScale:r,radiusMinPixels:a,radiusMaxPixels:u,lineWidthUnits:Qo[P],lineWidthScale:M,lineWidthMinPixels:C,lineWidthMaxPixels:V}).draw()}_getModel(e){const t=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new ta(e,{...this.getShaders(),id:this.props.id,geometry:new Ql({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}B(i_,"defaultProps",pO);B(i_,"layerName","ScatterplotLayer");const tw={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function iw(i,e,t={}){return mO(i,t)!==e?(_O(i,t),!0):!1}function mO(i,e={}){return Math.sign(gO(i,e))}function gO(i,e={}){const{start:t=0,end:r=i.length}=e,a=e.size||2;let u=0;for(let f=t,l=r-a;f<r;f+=a)u+=(i[f]-i[l])*(i[f+1]+i[l+1]),l=f;return u/2}function _O(i,e){const{start:t=0,end:r=i.length,size:a=2}=e,u=(r-t)/a,f=Math.floor(u/2);for(let l=0;l<f;++l){const x=t+l*a,w=t+(u-1-l)*a;for(let P=0;P<a;++P){const M=i[x+P];i[x+P]=i[w+P],i[w+P]=M}}}function fs(i,e){const t=e.length,r=i.length;if(r>0){let a=!0;for(let u=0;u<t;u++)if(i[r-t+u]!==e[u]){a=!1;break}if(a)return!1}for(let a=0;a<t;a++)i[r+a]=e[a];return!0}function Qm(i,e){const t=e.length;for(let r=0;r<t;r++)i[r]=e[r]}function Lu(i,e,t,r,a=[]){const u=r+e*t;for(let f=0;f<t;f++)a[f]=i[u+f];return a}function eg(i,e,t,r,a=[]){let u,f;if(t&8)u=(r[3]-i[1])/(e[1]-i[1]),f=3;else if(t&4)u=(r[1]-i[1])/(e[1]-i[1]),f=1;else if(t&2)u=(r[2]-i[0])/(e[0]-i[0]),f=2;else if(t&1)u=(r[0]-i[0])/(e[0]-i[0]),f=0;else return null;for(let l=0;l<i.length;l++)a[l]=(f&1)===l?r[f]:u*(e[l]-i[l])+i[l];return a}function Sd(i,e){let t=0;return i[0]<e[0]?t|=1:i[0]>e[2]&&(t|=2),i[1]<e[1]?t|=4:i[1]>e[3]&&(t|=8),t}function nw(i,e){const{size:t=2,broken:r=!1,gridResolution:a=10,gridOffset:u=[0,0],startIndex:f=0,endIndex:l=i.length}=e||{},x=(l-f)/t;let w=[];const P=[w],M=Lu(i,0,t,f);let C,V;const Y=sw(M,a,u,[]),J=[];fs(w,M);for(let ce=1;ce<x;ce++){for(C=Lu(i,ce,t,f,C),V=Sd(C,Y);V;){eg(M,C,V,Y,J);const pe=Sd(J,Y);pe&&(eg(M,J,pe,Y,J),V=pe),fs(w,J),Qm(M,J),xO(Y,a,V),r&&w.length>t&&(w=[],P.push(w),fs(w,M)),V=Sd(C,Y)}fs(w,C),Qm(M,C)}return r?P:P[0]}const iv=0,yO=1;function cd(i,e){for(let t=0;t<e.length;t++)i.push(e[t]);return i}function rw(i,e=null,t){if(!i.length)return[];const{size:r=2,gridResolution:a=10,gridOffset:u=[0,0],edgeTypes:f=!1}=t||{},l=[],x=[{pos:i,types:f?new Array(i.length/r).fill(yO):null,holes:e||[]}],w=[[],[]];let P=[];for(;x.length;){const{pos:M,types:C,holes:V}=x.shift();vO(M,r,V[0]||M.length,w),P=sw(w[0],a,u,P);const Y=Sd(w[1],P);if(Y){let J=nv(M,C,r,0,V[0]||M.length,P,Y);const ce={pos:J[0].pos,types:J[0].types,holes:[]},pe={pos:J[1].pos,types:J[1].types,holes:[]};x.push(ce,pe);for(let ve=0;ve<V.length;ve++)J=nv(M,C,r,V[ve],V[ve+1]||M.length,P,Y),J[0]&&(ce.holes.push(ce.pos.length),ce.pos=cd(ce.pos,J[0].pos),f&&(ce.types=cd(ce.types,J[0].types))),J[1]&&(pe.holes.push(pe.pos.length),pe.pos=cd(pe.pos,J[1].pos),f&&(pe.types=cd(pe.types,J[1].types)))}else{const J={positions:M};f&&(J.edgeTypes=C),V.length&&(J.holeIndices=V),l.push(J)}}return l}function nv(i,e,t,r,a,u,f){const l=(a-r)/t,x=[],w=[],P=[],M=[],C=[];let V,Y,J;const ce=Lu(i,l-1,t,r);let pe=Math.sign(f&8?ce[1]-u[3]:ce[0]-u[2]),ve=e&&e[l-1],he=0,Ee=0;for(let Fe=0;Fe<l;Fe++)V=Lu(i,Fe,t,r,V),Y=Math.sign(f&8?V[1]-u[3]:V[0]-u[2]),J=e&&e[r/t+Fe],Y&&pe&&pe!==Y&&(eg(ce,V,f,u,C),fs(x,C)&&P.push(ve),fs(w,C)&&M.push(ve)),Y<=0?(fs(x,V)&&P.push(J),he-=Y):P.length&&(P[P.length-1]=iv),Y>=0?(fs(w,V)&&M.push(J),Ee+=Y):M.length&&(M[M.length-1]=iv),Qm(ce,V),pe=Y,ve=J;return[he?{pos:x,types:e&&P}:null,Ee?{pos:w,types:e&&M}:null]}function sw(i,e,t,r){const a=Math.floor((i[0]-t[0])/e)*e+t[0],u=Math.floor((i[1]-t[1])/e)*e+t[1];return r[0]=a,r[1]=u,r[2]=a+e,r[3]=u+e,r}function xO(i,e,t){t&8?(i[1]+=e,i[3]+=e):t&4?(i[1]-=e,i[3]-=e):t&2?(i[0]+=e,i[2]+=e):t&1&&(i[0]-=e,i[2]-=e)}function vO(i,e,t,r){let a=1/0,u=-1/0,f=1/0,l=-1/0;for(let x=0;x<t;x+=e){const w=i[x],P=i[x+1];a=w<a?w:a,u=w>u?w:u,f=P<f?P:f,l=P>l?P:l}return r[0][0]=a,r[0][1]=f,r[1][0]=u,r[1][1]=l,r}const bO=85.051129;function wO(i,e){const{size:t=2,startIndex:r=0,endIndex:a=i.length,normalize:u=!0}=e||{},f=i.slice(r,a);ow(f,t,0,a-r);const l=nw(f,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(u)for(const x of l)aw(x,t);return l}function TO(i,e=null,t){const{size:r=2,normalize:a=!0,edgeTypes:u=!1}=t||{};e=e||[];const f=[],l=[];let x=0,w=0;for(let M=0;M<=e.length;M++){const C=e[M]||i.length,V=w,Y=EO(i,r,x,C);for(let J=Y;J<C;J++)f[w++]=i[J];for(let J=x;J<Y;J++)f[w++]=i[J];ow(f,r,V,w),SO(f,r,V,w,t==null?void 0:t.maxLatitude),x=C,l[M]=w}l.pop();const P=rw(f,l,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:u});if(a)for(const M of P)aw(M.positions,r);return P}function EO(i,e,t,r){let a=-1,u=-1;for(let f=t+1;f<r;f+=e){const l=Math.abs(i[f]);l>a&&(a=l,u=f-1)}return u}function SO(i,e,t,r,a=bO){const u=i[t],f=i[r-e];if(Math.abs(u-f)>180){const l=Lu(i,0,e,t);l[0]+=Math.round((f-u)/360)*360,fs(i,l),l[1]=Math.sign(l[1])*a,fs(i,l),l[0]=u,fs(i,l)}}function ow(i,e,t,r){let a=i[0],u;for(let f=t;f<r;f+=e){u=i[f];const l=u-a;(l>180||l<-180)&&(u-=Math.round(l/360)*360),i[f]=a=u}}function aw(i,e){let t;const r=i.length/e;for(let u=0;u<r&&(t=i[u*e],(t+180)%360===0);u++);const a=-Math.round(t/360)*360;if(a!==0)for(let u=0;u<r;u++)i[u*e]+=a}function AO(i,e,t,r){let a;if(Array.isArray(i[0])){const u=i.length*e;a=new Array(u);for(let f=0;f<i.length;f++)for(let l=0;l<e;l++)a[f*e+l]=i[f][l]||0}else a=i;return t?nw(a,{size:e,gridResolution:t}):r?wO(a,{size:e}):a}const PO=1,IO=2,am=4;class CO extends Q1{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?AO(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(rv(e)){let r=0;for(const a of e)r+=this.getGeometrySize(a);return r}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&rv(e))for(const r of e){const a=this.getGeometrySize(r);t.geometrySize=a,this.updateGeometryAttributes(r,t),t.vertexStart+=a}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const r=this.attributes.segmentTypes,a=e?this.isClosed(e):!1,{vertexStart:u,geometrySize:f}=t;r.fill(0,u,u+f),a?(r[u]=am,r[u+f-2]=am):(r[u]+=PO,r[u+f-2]+=IO),r[u+f-1]=am}_updatePositions(e,t){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:a,geometrySize:u}=t,f=new Array(3);for(let l=a,x=0;x<u;l++,x++)this.getPointOnPath(e,x,f),r[l*3]=f[0],r[l*3+1]=f[1],r[l*3+2]=f[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,r=[]){const{positionSize:a}=this;t*a>=e.length&&(t+=1-e.length/a);const u=t*a;return r[0]=e[u],r[1]=e[u+1],r[2]=a===3&&e[u+2]||0,r}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,r=e.length-t;return e[0]===e[r]&&e[1]===e[r+1]&&(t===2||e[2]===e[r+2])}}function rv(i){return Array.isArray(i[0])}const MO=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,LO=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,lw=[0,0,0,255],RO={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:i=>i.path},getColor:{type:"accessor",value:lw},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},lm={enter:(i,e)=>e.length?e.subarray(e.length-i.length):i};class n_ extends go{constructor(...e){super(...e),B(this,"state",void 0)}getShaders(){return super.getShaders({vs:MO,fs:LO,modules:[tc,ic]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:lm,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:lm,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:lm,defaultValue:lw},instancePickingColors:{size:3,type:5121,accessor:(r,{index:a,target:u})=>this.encodePickingColor(r&&r.__source?r.__source.index:a,u)}}),this.setState({pathTesselator:new CO({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:r}=e,a=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,x=t.data.attributes||{};l.updateGeometry({data:t.data,geometryBuffer:x.getPath,buffers:x,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),r.dataChanged||a.invalidateAll()}if(r.extensionsChanged){var f;const{gl:l}=this.context;(f=this.state.model)===null||f===void 0||f.delete(),this.state.model=this._getModel(l),a.invalidateAll()}}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,{data:a}=this.props;return a[0]&&a[0].__source&&(t.object=a.find(u=>u.__source.index===r)),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:r,billboard:a,miterLimit:u,widthUnits:f,widthScale:l,widthMinPixels:x,widthMaxPixels:w}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(t),capType:Number(r),billboard:a,widthUnits:Qo[f],widthScale:l,miterLimit:u,widthMinPixels:x,widthMaxPixels:w}).draw()}_getModel(e){const t=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new ta(e,{...this.getShaders(),id:this.props.id,geometry:new Ql({drawMode:4,attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}B(n_,"defaultProps",RO);B(n_,"layerName","PathLayer");var Yd={},kO={get exports(){return Yd},set exports(i){Yd=i}};kO.exports=vf;Yd.default=vf;function vf(i,e,t){t=t||2;var r=e&&e.length,a=r?e[0]*t:i.length,u=cw(i,0,a,t,!0),f=[];if(!u||u.next===u.prev)return f;var l,x,w,P,M,C,V;if(r&&(u=BO(i,e,u,t)),i.length>80*t){l=w=i[0],x=P=i[1];for(var Y=t;Y<a;Y+=t)M=i[Y],C=i[Y+1],M<l&&(l=M),C<x&&(x=C),M>w&&(w=M),C>P&&(P=C);V=Math.max(w-l,P-x),V=V!==0?32767/V:0}return Ru(u,f,t,l,x,V,0),f}function cw(i,e,t,r,a){var u,f;if(a===ng(i,e,t,r)>0)for(u=e;u<t;u+=r)f=sv(u,i[u],i[u+1],f);else for(u=t-r;u>=e;u-=r)f=sv(u,i[u],i[u+1],f);return f&&bf(f,f.next)&&(Du(f),f=f.next),f}function Ha(i,e){if(!i)return i;e||(e=i);var t=i,r;do if(r=!1,!t.steiner&&(bf(t,t.next)||Ki(t.prev,t,t.next)===0)){if(Du(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function Ru(i,e,t,r,a,u,f){if(i){!f&&u&&GO(i,r,a,u);for(var l=i,x,w;i.prev!==i.next;){if(x=i.prev,w=i.next,u?zO(i,r,a,u):DO(i)){e.push(x.i/t|0),e.push(i.i/t|0),e.push(w.i/t|0),Du(i),i=w.next,l=w.next;continue}if(i=w,i===l){f?f===1?(i=OO(Ha(i),e,t),Ru(i,e,t,r,a,u,2)):f===2&&FO(i,e,t,r,a,u):Ru(Ha(i),e,t,r,a,u,1);break}}}}function DO(i){var e=i.prev,t=i,r=i.next;if(Ki(e,t,r)>=0)return!1;for(var a=e.x,u=t.x,f=r.x,l=e.y,x=t.y,w=r.y,P=a<u?a<f?a:f:u<f?u:f,M=l<x?l<w?l:w:x<w?x:w,C=a>u?a>f?a:f:u>f?u:f,V=l>x?l>w?l:w:x>w?x:w,Y=r.next;Y!==e;){if(Y.x>=P&&Y.x<=C&&Y.y>=M&&Y.y<=V&&Ml(a,l,u,x,f,w,Y.x,Y.y)&&Ki(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function zO(i,e,t,r){var a=i.prev,u=i,f=i.next;if(Ki(a,u,f)>=0)return!1;for(var l=a.x,x=u.x,w=f.x,P=a.y,M=u.y,C=f.y,V=l<x?l<w?l:w:x<w?x:w,Y=P<M?P<C?P:C:M<C?M:C,J=l>x?l>w?l:w:x>w?x:w,ce=P>M?P>C?P:C:M>C?M:C,pe=tg(V,Y,e,t,r),ve=tg(J,ce,e,t,r),he=i.prevZ,Ee=i.nextZ;he&&he.z>=pe&&Ee&&Ee.z<=ve;){if(he.x>=V&&he.x<=J&&he.y>=Y&&he.y<=ce&&he!==a&&he!==f&&Ml(l,P,x,M,w,C,he.x,he.y)&&Ki(he.prev,he,he.next)>=0||(he=he.prevZ,Ee.x>=V&&Ee.x<=J&&Ee.y>=Y&&Ee.y<=ce&&Ee!==a&&Ee!==f&&Ml(l,P,x,M,w,C,Ee.x,Ee.y)&&Ki(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;he&&he.z>=pe;){if(he.x>=V&&he.x<=J&&he.y>=Y&&he.y<=ce&&he!==a&&he!==f&&Ml(l,P,x,M,w,C,he.x,he.y)&&Ki(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;Ee&&Ee.z<=ve;){if(Ee.x>=V&&Ee.x<=J&&Ee.y>=Y&&Ee.y<=ce&&Ee!==a&&Ee!==f&&Ml(l,P,x,M,w,C,Ee.x,Ee.y)&&Ki(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function OO(i,e,t){var r=i;do{var a=r.prev,u=r.next.next;!bf(a,u)&&uw(a,r,r.next,u)&&ku(a,u)&&ku(u,a)&&(e.push(a.i/t|0),e.push(r.i/t|0),e.push(u.i/t|0),Du(r),Du(r.next),r=i=u),r=r.next}while(r!==i);return Ha(r)}function FO(i,e,t,r,a,u){var f=i;do{for(var l=f.next.next;l!==f.prev;){if(f.i!==l.i&&qO(f,l)){var x=hw(f,l);f=Ha(f,f.next),x=Ha(x,x.next),Ru(f,e,t,r,a,u,0),Ru(x,e,t,r,a,u,0);return}l=l.next}f=f.next}while(f!==i)}function BO(i,e,t,r){var a=[],u,f,l,x,w;for(u=0,f=e.length;u<f;u++)l=e[u]*r,x=u<f-1?e[u+1]*r:i.length,w=cw(i,l,x,r,!1),w===w.next&&(w.steiner=!0),a.push(HO(w));for(a.sort(NO),u=0;u<a.length;u++)t=UO(a[u],t);return t}function NO(i,e){return i.x-e.x}function UO(i,e){var t=VO(i,e);if(!t)return e;var r=hw(t,i);return Ha(r,r.next),Ha(t,t.next)}function VO(i,e){var t=e,r=i.x,a=i.y,u=-1/0,f;do{if(a<=t.y&&a>=t.next.y&&t.next.y!==t.y){var l=t.x+(a-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(l<=r&&l>u&&(u=l,f=t.x<t.next.x?t:t.next,l===r))return f}t=t.next}while(t!==e);if(!f)return null;var x=f,w=f.x,P=f.y,M=1/0,C;t=f;do r>=t.x&&t.x>=w&&r!==t.x&&Ml(a<P?r:u,a,w,P,a<P?u:r,a,t.x,t.y)&&(C=Math.abs(a-t.y)/(r-t.x),ku(t,i)&&(C<M||C===M&&(t.x>f.x||t.x===f.x&&jO(f,t)))&&(f=t,M=C)),t=t.next;while(t!==x);return f}function jO(i,e){return Ki(i.prev,i,e.prev)<0&&Ki(e.next,i,i.next)<0}function GO(i,e,t,r){var a=i;do a.z===0&&(a.z=tg(a.x,a.y,e,t,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==i);a.prevZ.nextZ=null,a.prevZ=null,WO(a)}function WO(i){var e,t,r,a,u,f,l,x,w=1;do{for(t=i,i=null,u=null,f=0;t;){for(f++,r=t,l=0,e=0;e<w&&(l++,r=r.nextZ,!!r);e++);for(x=w;l>0||x>0&&r;)l!==0&&(x===0||!r||t.z<=r.z)?(a=t,t=t.nextZ,l--):(a=r,r=r.nextZ,x--),u?u.nextZ=a:i=a,a.prevZ=u,u=a;t=r}u.nextZ=null,w*=2}while(f>1);return i}function tg(i,e,t,r,a){return i=(i-t)*a|0,e=(e-r)*a|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function HO(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Ml(i,e,t,r,a,u,f,l){return(a-f)*(e-l)>=(i-f)*(u-l)&&(i-f)*(r-l)>=(t-f)*(e-l)&&(t-f)*(u-l)>=(a-f)*(r-l)}function qO(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!$O(i,e)&&(ku(i,e)&&ku(e,i)&&ZO(i,e)&&(Ki(i.prev,i,e.prev)||Ki(i,e.prev,e))||bf(i,e)&&Ki(i.prev,i,i.next)>0&&Ki(e.prev,e,e.next)>0)}function Ki(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function bf(i,e){return i.x===e.x&&i.y===e.y}function uw(i,e,t,r){var a=hd(Ki(i,e,t)),u=hd(Ki(i,e,r)),f=hd(Ki(t,r,i)),l=hd(Ki(t,r,e));return!!(a!==u&&f!==l||a===0&&ud(i,t,e)||u===0&&ud(i,r,e)||f===0&&ud(t,i,r)||l===0&&ud(t,e,r))}function ud(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function hd(i){return i>0?1:i<0?-1:0}function $O(i,e){var t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&uw(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function ku(i,e){return Ki(i.prev,i,i.next)<0?Ki(i,e,i.next)>=0&&Ki(i,i.prev,e)>=0:Ki(i,e,i.prev)<0||Ki(i,i.next,e)<0}function ZO(i,e){var t=i,r=!1,a=(i.x+e.x)/2,u=(i.y+e.y)/2;do t.y>u!=t.next.y>u&&t.next.y!==t.y&&a<(t.next.x-t.x)*(u-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==i);return r}function hw(i,e){var t=new ig(i.i,i.x,i.y),r=new ig(e.i,e.x,e.y),a=i.next,u=e.prev;return i.next=e,e.prev=i,t.next=a,a.prev=t,r.next=t,t.prev=r,u.next=r,r.prev=u,r}function sv(i,e,t,r){var a=new ig(i,e,t);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function Du(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ig(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}vf.deviation=function(i,e,t,r){var a=e&&e.length,u=a?e[0]*t:i.length,f=Math.abs(ng(i,0,u,t));if(a)for(var l=0,x=e.length;l<x;l++){var w=e[l]*t,P=l<x-1?e[l+1]*t:i.length;f-=Math.abs(ng(i,w,P,t))}var M=0;for(l=0;l<r.length;l+=3){var C=r[l]*t,V=r[l+1]*t,Y=r[l+2]*t;M+=Math.abs((i[C]-i[Y])*(i[V+1]-i[C+1])-(i[C]-i[V])*(i[Y+1]-i[C+1]))}return f===0&&M===0?0:Math.abs((M-f)/f)};function ng(i,e,t,r){for(var a=0,u=e,f=t-r;u<t;u+=r)a+=(i[f]-i[u])*(i[u+1]+i[f+1]),f=u;return a}vf.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,a=0;a<i.length;a++){for(var u=0;u<i[a].length;u++)for(var f=0;f<e;f++)t.vertices.push(i[a][u][f]);a>0&&(r+=i[a-1].length,t.holes.push(r))}return t};const dd=tw.CLOCKWISE,ov=tw.COUNTER_CLOCKWISE,qo={isClosed:!0};function XO(i){if(i=i&&i.positions||i,!Array.isArray(i)&&!ArrayBuffer.isView(i))throw new Error("invalid polygon")}function ou(i){return"positions"in i?i.positions:i}function Ad(i){return"holeIndices"in i?i.holeIndices:null}function YO(i){return Array.isArray(i[0])}function KO(i){return i.length>=1&&i[0].length>=2&&Number.isFinite(i[0][0])}function JO(i){const e=i[0],t=i[i.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function QO(i,e,t,r){for(let a=0;a<e;a++)if(i[t+a]!==i[r-e+a])return!1;return!0}function av(i,e,t,r,a){let u=e;const f=t.length;for(let l=0;l<f;l++)for(let x=0;x<r;x++)i[u++]=t[l][x]||0;if(!JO(t))for(let l=0;l<r;l++)i[u++]=t[0][l]||0;return qo.start=e,qo.end=u,qo.size=r,iw(i,a,qo),u}function lv(i,e,t,r,a=0,u,f){u=u||t.length;const l=u-a;if(l<=0)return e;let x=e;for(let w=0;w<l;w++)i[x++]=t[a+w];if(!QO(t,r,a,u))for(let w=0;w<r;w++)i[x++]=t[a+w];return qo.start=e,qo.end=x,qo.size=r,iw(i,f,qo),x}function eF(i,e){XO(i);const t=[],r=[];if("positions"in i){const{positions:a,holeIndices:u}=i;if(u){let f=0;for(let l=0;l<=u.length;l++)f=lv(t,f,a,e,u[l-1],u[l],l===0?dd:ov),r.push(f);return r.pop(),{positions:t,holeIndices:r}}i=a}if(!YO(i))return lv(t,0,i,e,0,t.length,dd),t;if(!KO(i)){let a=0;for(const[u,f]of i.entries())a=av(t,a,f,e,u===0?dd:ov),r.push(a);return r.pop(),{positions:t,holeIndices:r}}return av(t,0,i,e,dd),t}function cm(i,e,t){const r=i.length/3;let a=0;for(let u=0;u<r;u++){const f=(u+1)%r;a+=i[u*3+e]*i[f*3+t],a-=i[f*3+e]*i[u*3+t]}return Math.abs(a/2)}function cv(i,e,t,r){const a=i.length/3;for(let u=0;u<a;u++){const f=u*3,l=i[f+0],x=i[f+1],w=i[f+2];i[f+e]=l,i[f+t]=x,i[f+r]=w}}function tF(i,e,t,r){let a=Ad(i);a&&(a=a.map(l=>l/e));let u=ou(i);const f=r&&e===3;if(t){const l=u.length;u=u.slice();const x=[];for(let w=0;w<l;w+=e){x[0]=u[w],x[1]=u[w+1],f&&(x[2]=u[w+2]);const P=t(x);u[w]=P[0],u[w+1]=P[1],f&&(u[w+2]=P[2])}}if(f){const l=cm(u,0,1),x=cm(u,0,2),w=cm(u,1,2);if(!l&&!x&&!w)return[];l>x&&l>w||(x>w?(t||(u=u.slice()),cv(u,0,2,1)):(t||(u=u.slice()),cv(u,1,2,0)))}return Yd(u,a,e)}class iF extends Q1{constructor(e){const{fp64:t,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=eF(e,this.positionSize);return this.opts.resolution?rw(ou(t),Ad(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?TO(ou(t),Ad(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(uv(e)){let t=0;for(const r of e)t+=this.getGeometrySize(r);return t}return ou(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&uv(e))for(const r of e){const a=this.getGeometrySize(r);t.geometrySize=a,this.updateGeometryAttributes(r,t),t.vertexStart+=a,t.indexStart=this.indexStarts[t.geometryIndex+1]}else this._updateIndices(e,t),this._updatePositions(e,t),this._updateVertexValid(e,t)}_updateIndices(e,{geometryIndex:t,vertexStart:r,indexStart:a}){const{attributes:u,indexStarts:f,typedArrayManager:l}=this;let x=u.indices;if(!x||!e)return;let w=a;const P=tF(e,this.positionSize,this.opts.preproject,this.opts.full3d);x=l.allocate(x,a+P.length,{copy:!0});for(let M=0;M<P.length;M++)x[w++]=P[M]+r;f[t+1]=a+P.length,u.indices=x}_updatePositions(e,{vertexStart:t,geometrySize:r}){const{attributes:{positions:a},positionSize:u}=this;if(!a||!e)return;const f=ou(e);for(let l=t,x=0;x<r;l++,x++){const w=f[x*u],P=f[x*u+1],M=u>2?f[x*u+2]:0;a[l*3]=w,a[l*3+1]=P,a[l*3+2]=M}}_updateVertexValid(e,{vertexStart:t,geometrySize:r}){const{positionSize:a}=this,u=this.attributes.vertexValid,f=e&&Ad(e);if(e&&e.edgeTypes?u.set(e.edgeTypes,t):u.fill(1,t,t+r),f)for(let l=0;l<f.length;l++)u[t+f[l]/a-1]=0;u[t+r-1]=0}}function uv(i){return Array.isArray(i)&&i.length>0&&!Number.isFinite(i[0])}const dw=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nF=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(dw,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),rF=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(dw,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),sF=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,Kd=[0,0,0,255],oF={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:i=>i.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Kd},getLineColor:{type:"accessor",value:Kd},material:!0},fd={enter:(i,e)=>e.length?e.subarray(e.length-i.length):i};class r_ extends go{constructor(...e){super(...e),B(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?nF:rF,fs:sF,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[tc,OR,ic]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:t}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:a}=this.props;t.isGeospatial&&r===yi.DEFAULT&&(r=yi.LNGLAT);let u;r===yi.LNGLAT&&(a?u=t.projectPosition.bind(t):u=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new iF({preproject:u,fp64:this.use64bitPositions(),IndexType:!e||Fg(e,Ui.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const f=this.getAttributeManager(),l=!0;f.remove(["instancePickingColors"]),f.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:l},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:fd,accessor:"getPolygon",update:this.calculatePositions,noAlloc:l,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:l},elevations:{size:1,transition:fd,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:fd,accessor:"getFillColor",defaultValue:Kd,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:fd,accessor:"getLineColor",defaultValue:Kd,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(x,{index:w,target:P})=>this.encodePickingColor(x&&x.__source?x.__source.index:w,P),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r}=t,{data:a}=this.props;return a[0]&&a[0].__source&&(t.object=a.find(u=>u.__source.index===r)),t}disablePickingIndex(e){const{data:t}=this.props;if(t[0]&&t[0].__source)for(let r=0;r<t.length;r++)t[r].__source.index===e&&this._disablePickingIndex(r);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:r,wireframe:a,elevationScale:u}=this.props,{topModel:f,sideModel:l,polygonTesselator:x}=this.state,w={...e,extruded:Boolean(t),elevationScale:u};l&&(l.setInstanceCount(x.instanceCount-1),l.setUniforms(w),a&&(l.setDrawMode(3),l.setUniforms({isWireframe:!0}).draw()),r&&(l.setDrawMode(6),l.setUniforms({isWireframe:!1}).draw())),f&&(f.setVertexCount(x.vertexCount),f.setUniforms(w).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:r,changeFlags:a}=e,u=this.getAttributeManager();if(a.extensionsChanged||t.filled!==r.filled||t.extruded!==r.extruded){var l;(l=this.state.models)===null||l===void 0||l.forEach(x=>x.delete()),this.setState(this._getModels(this.context.gl)),u.invalidateAll()}}updateGeometry({props:e,oldProps:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:u}=this.state,f=e.data.attributes||{};u.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:t,filled:r,extruded:a}=this.props;let u,f;if(r){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,u=new ta(e,{...l,id:"".concat(t,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return a&&(f=new ta(e,{...this.getShaders("side"),id:"".concat(t,"-side"),geometry:new Ql({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),f.userData.excludeAttributes={indices:!0}),{models:[f,u].filter(Boolean),topModel:u,sideModel:f}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}B(r_,"defaultProps",oF);B(r_,"layerName","SolidPolygonLayer");function aF({data:i,getIndex:e,dataRange:t,replace:r}){const{startRow:a=0,endRow:u=1/0}=t,f=i.length;let l=f,x=f;for(let C=0;C<f;C++){const V=e(i[C]);if(l>C&&V>=a&&(l=C),V>=u){x=C;break}}let w=l;const M=x-l!==r.length?i.slice(x):void 0;for(let C=0;C<r.length;C++)i[w++]=r[C];if(M){for(let C=0;C<M.length;C++)i[w++]=M[C];i.length=w}return{startRow:l,endRow:l+r.length}}function lF(i,e){if(!i)return null;const t="startIndices"in i?i.startIndices[e]:e,r=i.featureIds.value[t];return t!==-1?cF(i,r,t):null}function cF(i,e,t){const r={properties:{...i.properties[e]}};for(const a in i.numericProps)r.properties[a]=i.numericProps[a].value[t];return r}function uF(i,e){const t={points:null,lines:null,polygons:null};for(const r in t){const a=i[r].globalFeatureIds.value;t[r]=new Uint8ClampedArray(a.length*3);const u=[];for(let f=0;f<a.length;f++)e(a[f],u),t[r][f*3+0]=u[0],t[r][f*3+1]=u[1],t[r][f*3+2]=u[2]}return t}const hF=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,um=192/256,hv=[],dF={getIconOffsets:{type:"accessor",value:i=>i.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class s_ extends xf{constructor(...e){super(...e),B(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:hF}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:r,target:a})=>this.encodePickingColor(r,a)}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;let{outlineColor:a}=t;a!==r.outlineColor&&(a=a.map(u=>u/255),a[3]=Number.isFinite(a[3])?a[3]:1,this.setState({outlineColor:a})),!t.sdf&&t.outlineWidth&&ai.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:t,smoothing:r,outlineWidth:a}=this.props,{outlineColor:u}=this.state,f=a?Math.max(r,um*(1-a)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:um,outlineBuffer:f,gamma:r,sdf:Boolean(t),outlineColor:u},super.draw(e),t&&a){const{iconManager:l}=this.state;l.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:um}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):hv}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):hv}}B(s_,"defaultProps",dF);B(s_,"layerName","MultiIconLayer");const gu=1e20;class fF{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:l="normal"}={}){this.buffer=t,this.cutoff=a,this.radius=r;const x=this.size=e+t*4,w=this._createCanvas(x),P=this.ctx=w.getContext("2d",{willReadFrequently:!0});P.font=`${l} ${f} ${e}px ${u}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(e),l=Math.ceil(r),x=0,w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),P=Math.min(this.size-this.buffer,l+Math.ceil(a)),M=w+2*this.buffer,C=P+2*this.buffer,V=Math.max(M*C,0),Y=new Uint8ClampedArray(V),J={data:Y,width:M,height:C,glyphWidth:w,glyphHeight:P,glyphTop:l,glyphLeft:x,glyphAdvance:t};if(w===0||P===0)return J;const{ctx:ce,buffer:pe,gridInner:ve,gridOuter:he}=this;ce.clearRect(pe,pe,w,P),ce.fillText(e,pe,pe+l);const Ee=ce.getImageData(pe,pe,w,P);he.fill(gu,0,V),ve.fill(0,0,V);for(let Fe=0;Fe<P;Fe++)for(let Ze=0;Ze<w;Ze++){const ht=Ee.data[4*(Fe*w+Ze)+3]/255;if(ht===0)continue;const _t=(Fe+pe)*M+Ze+pe;if(ht===1)he[_t]=0,ve[_t]=gu;else{const lt=.5-ht;he[_t]=lt>0?lt*lt:0,ve[_t]=lt<0?lt*lt:0}}dv(he,0,0,M,C,M,this.f,this.v,this.z),dv(ve,pe,pe,w,P,M,this.f,this.v,this.z);for(let Fe=0;Fe<V;Fe++){const Ze=Math.sqrt(he[Fe])-Math.sqrt(ve[Fe]);Y[Fe]=Math.round(255-255*(Ze/this.radius+this.cutoff))}return J}}function dv(i,e,t,r,a,u,f,l,x){for(let w=e;w<e+r;w++)fv(i,t*u+w,u,a,f,l,x);for(let w=t;w<t+a;w++)fv(i,w*u+e,1,r,f,l,x)}function fv(i,e,t,r,a,u,f){u[0]=0,f[0]=-gu,f[1]=gu,a[0]=i[e];for(let l=1,x=0,w=0;l<r;l++){a[l]=i[e+l*t];const P=l*l;do{const M=u[x];w=(a[l]-a[M]+P-M*M)/(l-M)/2}while(w<=f[x]&&--x>-1);x++,u[x]=l,f[x]=w,f[x+1]=gu}for(let l=0,x=0;l<r;l++){for(;f[x+1]<l;)x++;const w=u[x],P=l-w;i[e+l*t]=a[w]+P*P}}const pF=32,mF=[];function gF(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function _F({characterSet:i,getFontWidth:e,fontHeight:t,buffer:r,maxCanvasWidth:a,mapping:u={},xOffset:f=0,yOffset:l=0}){let x=0,w=f;const P=t+r*2;for(const M of i)if(!u[M]){const C=e(M);w+C+r*2>a&&(w=0,x++),u[M]={x:w+r,y:l+x*P+r,width:C,height:P,layoutWidth:C,layoutHeight:t},w+=C+r*2}return{mapping:u,xOffset:w,yOffset:l+x*P,canvasHeight:gF(l+(x+1)*P)}}function fw(i,e,t,r){let a=0;for(let f=e;f<t;f++){var u;const l=i[f];a+=((u=r[l])===null||u===void 0?void 0:u.layoutWidth)||0}return a}function pw(i,e,t,r,a,u){let f=e,l=0;for(let x=e;x<t;x++){const w=fw(i,x,x+1,a);l+w>r&&(f<x&&u.push(x),f=x,l=0),l+=w}return l}function yF(i,e,t,r,a,u){let f=e,l=e,x=e,w=0;for(let P=e;P<t;P++)if((i[P]===" "||i[P+1]===" "||P+1===t)&&(x=P+1),x>l){let M=fw(i,l,x,a);w+M>r&&(f<l&&(u.push(l),f=l,w=0),M>r&&(M=pw(i,l,x,r,a,u),f=u[u.length-1])),l=x,w+=M}return w}function xF(i,e,t,r,a=0,u){u===void 0&&(u=i.length);const f=[];return e==="break-all"?pw(i,a,u,t,r,f):yF(i,a,u,t,r,f),f}function vF(i,e,t,r,a,u){let f=0,l=0;for(let x=e;x<t;x++){const w=i[x],P=r[w];P?(l||(l=P.layoutHeight),a[x]=f+P.layoutWidth/2,f+=P.layoutWidth):(ai.warn("Missing character: ".concat(w," (").concat(w.codePointAt(0),")"))(),a[x]=f,f+=pF)}u[0]=f,u[1]=l}function bF(i,e,t,r,a){const u=Array.from(i),f=u.length,l=new Array(f),x=new Array(f),w=new Array(f),P=(t==="break-word"||t==="break-all")&&isFinite(r)&&r>0,M=[0,0],C=[0,0];let V=0,Y=0,J=0;for(let pe=0;pe<=f;pe++){const ve=u[pe];if((ve===`
`||pe===f)&&(J=pe),J>Y){const he=P?xF(u,t,r,a,Y,J):mF;for(let Ee=0;Ee<=he.length;Ee++){const Fe=Ee===0?Y:he[Ee-1],Ze=Ee<he.length?he[Ee]:J;vF(u,Fe,Ze,a,l,C);for(let ht=Fe;ht<Ze;ht++){var ce;const _t=u[ht],lt=((ce=a[_t])===null||ce===void 0?void 0:ce.layoutOffsetY)||0;x[ht]=V+C[1]/2+lt,w[ht]=C[0]}V=V+C[1]*e,M[0]=Math.max(M[0],C[0])}Y=J}ve===`
`&&(l[Y]=0,x[Y]=0,w[Y]=0,Y++)}return M[1]=V,{x:l,y:x,rowWidth:w,size:M}}function wF({value:i,length:e,stride:t,offset:r,startIndices:a,characterSet:u}){const f=i.BYTES_PER_ELEMENT,l=t?t/f:1,x=r?r/f:0,w=a[e]||Math.ceil((i.length-x)/l),P=u&&new Set,M=new Array(e);let C=i;if(l>1||x>0){const V=i.constructor;C=new V(w);for(let Y=0;Y<w;Y++)C[Y]=i[Y*l+x]}for(let V=0;V<e;V++){const Y=a[V],J=a[V+1]||w,ce=C.subarray(Y,J);M[V]=String.fromCodePoint.apply(null,ce),P&&ce.forEach(P.add,P)}if(P)for(const V of P)u.add(String.fromCodePoint(V));return{texts:M,characterCount:w}}class mw{constructor(e=5){B(this,"limit",void 0),B(this,"_cache",{}),B(this,"_order",[]),this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function TF(){const i=[];for(let e=32;e<128;e++)i.push(String.fromCharCode(e));return i}const Ol={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:TF(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},pv=1024,mv=.9,gv=1.2,gw=3;let Jd=new mw(gw);function EF(i,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const r=Jd.get(i);if(!r)return t;for(const a in r.mapping)t.has(a)&&t.delete(a);return t}function SF(i,e){for(let t=0;t<i.length;t++)e.data[4*t+3]=i[t]}function _v(i,e,t,r){i.font="".concat(r," ").concat(t,"px ").concat(e),i.fillStyle="#000",i.textBaseline="alphabetic",i.textAlign="left"}function AF(i){ai.assert(Number.isFinite(i)&&i>=gw,"Invalid cache limit"),Jd=new mw(i)}class PF{constructor(){B(this,"props",{...Ol}),B(this,"_key",void 0),B(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*gv+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=EF(this._key,this.props.characterSet),r=Jd.get(this._key);if(r&&t.size===0){this._atlas!==r&&(this._atlas=r);return}const a=this._generateFontAtlas(t,r);this._atlas=a,Jd.set(this._key,a)}_generateFontAtlas(e,t){const{fontFamily:r,fontWeight:a,fontSize:u,buffer:f,sdf:l,radius:x,cutoff:w}=this.props;let P=t&&t.data;P||(P=document.createElement("canvas"),P.width=pv);const M=P.getContext("2d",{willReadFrequently:!0});_v(M,r,u,a);const{mapping:C,canvasHeight:V,xOffset:Y,yOffset:J}=_F({getFontWidth:ce=>M.measureText(ce).width,fontHeight:u*gv,buffer:f,characterSet:e,maxCanvasWidth:pv,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(P.height!==V){const ce=M.getImageData(0,0,P.width,P.height);P.height=V,M.putImageData(ce,0,0)}if(_v(M,r,u,a),l){const ce=new fF({fontSize:u,buffer:f,radius:x,cutoff:w,fontFamily:r,fontWeight:"".concat(a)});for(const pe of e){const{data:ve,width:he,height:Ee,glyphTop:Fe}=ce.draw(pe);C[pe].width=he,C[pe].layoutOffsetY=u*mv-Fe;const Ze=M.createImageData(he,Ee);SF(ve,Ze),M.putImageData(Ze,C[pe].x,C[pe].y)}}else for(const ce of e)M.fillText(ce,C[ce].x,C[ce].y+f+u*mv);return{xOffset:Y,yOffset:J,mapping:C,data:P,width:P.width,height:P.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:r,buffer:a,sdf:u,radius:f,cutoff:l}=this.props;return u?"".concat(e," ").concat(t," ").concat(r," ").concat(a," ").concat(f," ").concat(l):"".concat(e," ").concat(t," ").concat(r," ").concat(a)}}const IF=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,CF=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,MF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:i=>i.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class o_ extends go{constructor(...e){super(...e),B(this,"state",void 0)}getShaders(){return super.getShaders({vs:IF,fs:CF,modules:[tc,ic]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){var r;const{gl:a}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:t,sizeScale:r,sizeUnits:a,sizeMinPixels:u,sizeMaxPixels:f,getLineWidth:l}=this.props;let{padding:x}=this.props;x.length<4&&(x=[x[0],x[1],x[0],x[1]]),this.state.model.setUniforms(e).setUniforms({billboard:t,stroked:Boolean(l),padding:x,sizeUnits:Qo[a],sizeScale:r,sizeMinPixels:u,sizeMaxPixels:f}).draw()}_getModel(e){const t=[0,0,1,0,1,1,0,1];return new ta(e,{...this.getShaders(),id:this.props.id,geometry:new Ql({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}B(o_,"defaultProps",MF);B(o_,"layerName","TextBackgroundLayer");const yv={start:1,middle:0,end:-1},xv={top:1,center:0,bottom:-1},hm=[0,0,0,255],LF=1,RF={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:hm},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ol.characterSet},fontFamily:Ol.fontFamily,fontWeight:Ol.fontWeight,lineHeight:LF,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:hm},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:i=>i.text},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:hm},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class a_ extends e_{constructor(...e){super(...e),B(this,"state",void 0),B(this,"getBoundingRect",(t,r)=>{let{size:[a,u]}=this.transformParagraph(t,r);const{fontSize:f}=this.state.fontAtlasManager.props;a/=f,u/=f;const{getTextAnchor:l,getAlignmentBaseline:x}=this.props,w=yv[typeof l=="function"?l(t,r):l],P=xv[typeof x=="function"?x(t,r):x];return[(w-1)*a/2,(P-1)*u/2,a,u]}),B(this,"getIconOffsets",(t,r)=>{const{getTextAnchor:a,getAlignmentBaseline:u}=this.props,{x:f,y:l,rowWidth:x,size:[w,P]}=this.transformParagraph(t,r),M=yv[typeof a=="function"?a(t,r):a],C=xv[typeof u=="function"?u(t,r):u],V=f.length,Y=new Array(V*2);let J=0;for(let ce=0;ce<V;ce++){const pe=(1-M)*(w-x[ce])/2;Y[J++]=(M-1)*w/2+pe+f[ce],Y[J++]=(C-1)*P/2+l[ce]}return Y})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new PF},this.props.maxWidth>0&&ai.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:r,changeFlags:a}=e;(a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==r.lineHeight||t.wordBreak!==r.wordBreak||t.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:r}=this.props,{fontAtlasManager:a,characterSet:u}=this.state,f={...e,characterSet:u,fontFamily:t,fontWeight:r};if(!a.mapping)return a.setProps(f),!0;for(const l in f)if(f[l]!==a.props[l])return a.setProps(f),!0;return!1}_updateText(){var e;const{data:t,characterSet:r}=this.props,a=(e=t.attributes)===null||e===void 0?void 0:e.getText;let{getText:u}=this.props,f=t.startIndices,l;const x=r==="auto"&&new Set;if(a&&f){const{texts:w,characterCount:P}=wF({...ArrayBuffer.isView(a)?{value:a}:a,length:t.length,startIndices:f,characterSet:x});l=P,u=(M,{index:C})=>w[C]}else{const{iterable:w,objectInfo:P}=yf(t);f=[0],l=0;for(const M of w){P.index++;const C=Array.from(u(M,P)||"");x&&C.forEach(x.add,x),l+=C.length,f.push(l)}}this.setState({getText:u,startIndices:f,numInstances:l,characterSet:x||r})}transformParagraph(e,t){const{fontAtlasManager:r}=this.state,a=r.mapping,u=this.state.getText,{wordBreak:f,lineHeight:l,maxWidth:x}=this.props,w=u(e,t)||"";return bF(w,l,f,x*r.props.fontSize,a)}renderLayers(){const{startIndices:e,numInstances:t,getText:r,fontAtlasManager:{scale:a,texture:u,mapping:f},styleVersion:l}=this.state,{data:x,_dataDiff:w,getPosition:P,getColor:M,getSize:C,getAngle:V,getPixelOffset:Y,getBackgroundColor:J,getBorderColor:ce,getBorderWidth:pe,backgroundPadding:ve,background:he,billboard:Ee,fontSettings:Fe,outlineWidth:Ze,outlineColor:ht,sizeScale:_t,sizeUnits:lt,sizeMinPixels:Et,sizeMaxPixels:It,transitions:Ot,updateTriggers:zt}=this.props,Ut=this.getSubLayerClass("characters",s_),$i=this.getSubLayerClass("background",o_);return[he&&new $i({getFillColor:J,getLineColor:ce,getLineWidth:pe,padding:ve,getPosition:P,getSize:C,getAngle:V,getPixelOffset:Y,billboard:Ee,sizeScale:_t,sizeUnits:lt,sizeMinPixels:Et,sizeMaxPixels:It,transitions:Ot&&{getPosition:Ot.getPosition,getAngle:Ot.getAngle,getSize:Ot.getSize,getFillColor:Ot.getBackgroundColor,getLineColor:Ot.getBorderColor,getLineWidth:Ot.getBorderWidth,getPixelOffset:Ot.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:zt.getPosition,getAngle:zt.getAngle,getSize:zt.getSize,getFillColor:zt.getBackgroundColor,getLineColor:zt.getBorderColor,getLineWidth:zt.getBorderWidth,getPixelOffset:zt.getPixelOffset,getBoundingRect:{getText:zt.getText,getTextAnchor:zt.getTextAnchor,getAlignmentBaseline:zt.getAlignmentBaseline,styleVersion:l}}}),{data:x.attributes&&x.attributes.background?{length:x.length,attributes:x.attributes.background}:x,_dataDiff:w,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Ut({sdf:Fe.sdf,smoothing:Number.isFinite(Fe.smoothing)?Fe.smoothing:Ol.smoothing,outlineWidth:Ze/(Fe.radius||Ol.radius),outlineColor:ht,iconAtlas:u,iconMapping:f,getPosition:P,getColor:M,getSize:C,getAngle:V,getPixelOffset:Y,billboard:Ee,sizeScale:_t*a,sizeUnits:lt,sizeMinPixels:Et*a,sizeMaxPixels:It*a,transitions:Ot&&{getPosition:Ot.getPosition,getAngle:Ot.getAngle,getColor:Ot.getColor,getSize:Ot.getSize,getPixelOffset:Ot.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:zt.getText,getPosition:zt.getPosition,getAngle:zt.getAngle,getColor:zt.getColor,getSize:zt.getSize,getPixelOffset:zt.getPixelOffset,getIconOffsets:{getText:zt.getText,getTextAnchor:zt.getTextAnchor,getAlignmentBaseline:zt.getAlignmentBaseline,styleVersion:l}}}),{data:x,_dataDiff:w,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){AF(e)}}B(a_,"defaultProps",RF);B(a_,"layerName","TextLayer");const Pd={circle:{type:i_,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:xf,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:a_,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Id={type:n_,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},rg={type:r_,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function iu({type:i,props:e}){const t={};for(const r in e)t[r]=i.defaultProps[e[r]];return t}function dm(i,e){const{transitions:t,updateTriggers:r}=i.props,a={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const u in e){const f=e[u];let l=i.props[u];u.startsWith("get")&&(l=i.getSubLayerAccessor(l),a.updateTriggers[f]=r[u],t&&(a.transitions[f]=t[u])),a[f]=l}return a}function kF(i){if(Array.isArray(i))return i;switch(ai.assert(i.type,"GeoJSON does not have type"),i.type){case"Feature":return[i];case"FeatureCollection":return ai.assert(Array.isArray(i.features),"GeoJSON does not have features array"),i.features;default:return[{geometry:i}]}}function vv(i,e,t={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:a=0,endRow:u=i.length}=t;for(let f=a;f<u;f++){const l=i[f],{geometry:x}=l;if(x)if(x.type==="GeometryCollection"){ai.assert(Array.isArray(x.geometries),"GeoJSON does not have geometries array");const{geometries:w}=x;for(let P=0;P<w.length;P++){const M=w[P];bv(M,r,e,l,f)}}else bv(x,r,e,l,f)}return r}function bv(i,e,t,r,a){const{type:u,coordinates:f}=i,{pointFeatures:l,lineFeatures:x,polygonFeatures:w,polygonOutlineFeatures:P}=e;if(!zF(u,f)){ai.warn("".concat(u," coordinates are malformed"))();return}switch(u){case"Point":l.push(t({geometry:i},r,a));break;case"MultiPoint":f.forEach(M=>{l.push(t({geometry:{type:"Point",coordinates:M}},r,a))});break;case"LineString":x.push(t({geometry:i},r,a));break;case"MultiLineString":f.forEach(M=>{x.push(t({geometry:{type:"LineString",coordinates:M}},r,a))});break;case"Polygon":w.push(t({geometry:i},r,a)),f.forEach(M=>{P.push(t({geometry:{type:"LineString",coordinates:M}},r,a))});break;case"MultiPolygon":f.forEach(M=>{w.push(t({geometry:{type:"Polygon",coordinates:M}},r,a)),M.forEach(C=>{P.push(t({geometry:{type:"LineString",coordinates:C}},r,a))})});break}}const DF={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function zF(i,e){let t=DF[i];for(ai.assert(t,"Unknown GeoJSON type ".concat(i));e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function _w(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function pd(i){return i.geometry.coordinates}function OF(i,e){const t=_w(),{pointFeatures:r,lineFeatures:a,polygonFeatures:u,polygonOutlineFeatures:f}=i;return t.points.data=r,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=pd,t.lines.data=a,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=pd,t.polygons.data=u,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=pd,t.polygonsOutline.data=f,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=pd,t}function FF(i,e){const t=_w(),{points:r,lines:a,polygons:u}=i,f=uF(i,e);return t.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:f.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},t.lines.data={length:a.pathIndices.value.length-1,startIndices:a.pathIndices.value,attributes:{...a.attributes,getPath:a.positions,instancePickingColors:{size:3,value:f.lines}},properties:a.properties,numericProps:a.numericProps,featureIds:a.featureIds},t.lines._pathType="open",t.polygons.data={length:u.polygonIndices.value.length-1,startIndices:u.polygonIndices.value,attributes:{...u.attributes,getPolygon:u.positions,pickingColors:{size:3,value:f.polygons}},properties:u.properties,numericProps:u.numericProps,featureIds:u.featureIds},t.polygons._normalize=!1,u.triangles&&(t.polygons.data.attributes.indices=u.triangles.value),t.polygonsOutline.data={length:u.primitivePolygonIndices.value.length-1,startIndices:u.primitivePolygonIndices.value,attributes:{...u.attributes,getPath:u.positions,instancePickingColors:{size:3,value:f.polygons}},properties:u.properties,numericProps:u.numericProps,featureIds:u.featureIds},t.polygonsOutline._pathType="open",t}const BF=["points","linestrings","polygons"],NF={...iu(Pd.circle),...iu(Pd.icon),...iu(Pd.text),...iu(Id),...iu(rg),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:i=>i.properties.icon},getText:{type:"accessor",value:i=>i.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class l_ extends e_{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:r}=this.props,a=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:a}),a?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const r=FF(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:t}){const r=kF(e.data),a=this.getSubLayerRow.bind(this);let u={};const f={};if(Array.isArray(t.dataChanged)){const x=this.state.features;for(const w in x)u[w]=x[w].slice(),f[w]=[];for(const w of t.dataChanged){const P=vv(r,a,w);for(const M in x)f[M].push(aF({data:u[M],getIndex:C=>C.__source.index,dataRange:w,replace:P[M]}))}}else u=vv(r,a);const l=OF(u,f);this.setState({features:u,featuresDiff:f,layerProps:l})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:r,sourceLayer:a}=t;return t.featureType=BF.find(u=>a.id.startsWith("".concat(this.id,"-").concat(u,"-"))),r>=0&&a.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[r]),t}_updateAutoHighlight(e){const t="".concat(this.id,"-points-"),r=e.featureType==="points";for(const a of this.getSubLayers())a.id.startsWith(t)===r&&a.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:r}=this.state,a="polygons-fill",u=this.shouldRenderSubLayer(a,r.polygons.data)&&this.getSubLayerClass(a,rg.type);if(u){const f=dm(this,rg.props),l=e&&t;return l||delete f.getLineColor,f.updateTriggers.lineColors=l,new u(f,this.getSubLayerProps({id:a,updateTriggers:f.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:r}=this.state,a="polygons-stroke",u="linestrings",f=!e&&t&&this.shouldRenderSubLayer(a,r.polygonsOutline.data)&&this.getSubLayerClass(a,Id.type),l=this.shouldRenderSubLayer(u,r.lines.data)&&this.getSubLayerClass(u,Id.type);if(f||l){const x=dm(this,Id.props);return[f&&new f(x,this.getSubLayerProps({id:a,updateTriggers:x.updateTriggers}),r.polygonsOutline),l&&new l(x,this.getSubLayerProps({id:u,updateTriggers:x.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:r}=this.state;let{highlightedObjectIndex:a}=this.props;!r&&Number.isFinite(a)&&(a=t.points.data.findIndex(l=>l.__source.index===a));const u=new Set(e.split("+")),f=[];for(const l of u){const x="points-".concat(l),w=Pd[l],P=w&&this.shouldRenderSubLayer(x,t.points.data)&&this.getSubLayerClass(x,w.type);if(P){const M=dm(this,w.props);let C=t.points;if(l==="text"&&r){const{instancePickingColors:V,...Y}=C.data.attributes;C={...C,data:{...C.data,attributes:Y}}}f.push(new P(M,this.getSubLayerProps({id:x,updateTriggers:M.updateTriggers,highlightedObjectIndex:a}),C))}}return f}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),r=this._renderLineLayers(),a=this._renderPointLayers();return[!e&&t,r,a,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(r,a)=>{const{data:u,index:f}=a,l=lF(u,f);return e(l,a)}}}B(l_,"layerName","GeoJsonLayer");B(l_,"defaultProps",NF);const fm=512,UF=Math.PI/180;function VF({map:i,gl:e,deck:t}){if(i.__deck)return i.__deck;const r=t==null?void 0:t.props._customRender,a=t==null?void 0:t.props.onLoad,u=jF({...t==null?void 0:t.props,_customRender:()=>{i.triggerRepaint(),r==null||r("")}});let f;return(!t||t.props.gl===e)&&(Object.assign(u,{gl:e,width:null,height:null,touchAction:"unset",viewState:c_(i)}),t!=null&&t.isInitialized?wv(t,i):u.onLoad=()=>{a==null||a(),wv(f,i)}),t?(f=t,t.setProps(u),t.userData.isExternal=!0):(f=new Xg(u),i.on("remove",()=>{f.finalize(),i.__deck=null})),f.userData.mapboxLayers=new Set,i.__deck=f,i.on("render",()=>{f.isInitialized&&ZF(f,i)}),f}function wv(i,e){const t=()=>{i.isInitialized?XF(i,e):e.off("move",t)};e.on("move",t)}function jF(i){const e="useDevicePixels"in i?i.useDevicePixels:!0;return{...i,useDevicePixels:e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new $g({id:"mapbox"})]}}function GF(i,e){i.userData.mapboxLayers.add(e),u_(i)}function WF(i,e){i.userData.mapboxLayers.delete(e),u_(i)}function HF(i,e){u_(i)}function qF(i,e,t){let{currentViewport:r}=i.userData,a=!1;r||(r=yw(i,e,!0),i.userData.currentViewport=r,a=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:({layer:u})=>t.id===u.id,clearStack:a,clearCanvas:!1})}function c_(i){var e;const{lng:t,lat:r}=i.getCenter(),a={longitude:(t+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(e=i.getTerrain)!==null&&e!==void 0&&e.call(i)&&$F(i,a),a}function $F(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const r=i.transform.height,{longitude:a,latitude:u,pitch:f}=e,l=t.x*fm,x=(1-t.y)*fm,w=t.z*fm,P=Cu([a,u]),M=l-P[0],C=x-P[1],V=Math.sqrt(M*M+C*C),Y=f*UF,J=1.5*r,ce=J*Math.sin(Y)/V;e.zoom=Math.log2(ce);const pe=J*Math.cos(Y)/ce,ve=w-pe;e.position=[0,0,ve/wd(u)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function yw(i,e,t=!0){return new ja({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...c_(e),nearZMultiplier:t?.02:.1})}function ZF(i,e){const{mapboxLayers:t,isExternal:r}=i.userData;if(r){const a=Array.from(t,P=>P.id),f=gf(i.props.layers,Boolean).some(P=>P&&!a.includes(P.id));let l=i.getViewports();const x=l.findIndex(P=>P.id==="mapbox"),w=l.length>1||x<0;(f||w)&&(x>=0&&(l=l.slice(),l[x]=yw(i,e,!1)),i._drawLayers("mapbox-repaint",{viewports:l,layerFilter:P=>(!i.props.layerFilter||i.props.layerFilter(P))&&(P.viewport.id!=="mapbox"||!a.includes(P.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function XF(i,e){i.setProps({viewState:c_(e)}),i.needsRedraw({clearRedrawFlags:!0})}function u_(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const r=t.props.type,a=new r(t.props);e.push(a)}),i.setProps({layers:e})}class xw{constructor(e){if(B(this,"id",void 0),B(this,"type",void 0),B(this,"renderingMode",void 0),B(this,"map",void 0),B(this,"deck",void 0),B(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=VF({map:e,gl:t,deck:this.props.deck}),GF(this.deck,this)}onRemove(){this.deck&&WF(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&HF(this.deck)}render(){qF(this.deck,this.map,this)}}/*!
* v-mapbox v4.0.2
* (c) 2023 Vinayak Kulkarni
* @license MIT
*/function mr(i,e){const t=lu(i,e);if(!t)throw new Error(`Could not resolve ${i.description}`);return t}const Qn=Symbol("Map");Nn({name:"VControlAttribution",props:{options:{type:Object,default:()=>({compact:!1,customAttribution:"Map design by me"}),required:!1},position:{type:String,default:()=>"bottom-right",required:!1}},setup(i,{slots:e}){let t=mr(Qn);Un(()=>{r()});function r(){var f,l;const a={...i.options};e&&((f=e.default)!=null&&f.call(e))&&(a.customAttribution=(l=e.default)==null?void 0:l.call(e));const u=new _s.AttributionControl(a);t.value.addControl(u,i.position)}return()=>{var a;return[hS("div",(a=e.default)==null?void 0:a.call(e))]}}});Nn({name:"VControlFullscreen",props:{options:{type:Object,default:()=>({}),required:!0},position:{type:String,default:()=>"top-left",required:!1}},setup(i){let e=mr(Qn);Un(()=>{t()});function t(){const r=new _s.FullscreenControl(i.options);e.value.addControl(r,i.position)}}});const YF=["geolocate","error","outofmaxbounds","trackuserlocationstart","trackuserlocationend"];Nn({name:"VControlGeolocate",props:{options:{type:Object,default:()=>({}),required:!0},position:{type:String,default:()=>"top-left",required:!1}},setup(i,{emit:e}){let t=mr(Qn);Un(()=>{r()});function r(){const a=new _s.GeolocateControl(i.options);t.value.addControl(a,i.position),YF.forEach(u=>{a.on(u,()=>{e(u)})})}}});Nn({name:"VControlFullscreen",props:{options:{type:Object,default:()=>({}),required:!0},position:{type:String,default:()=>"top-left",required:!1}},setup(i){let e=mr(Qn);Un(()=>{t()});function t(){const r=new _s.NavigationControl(i.options);e.value.addControl(r,i.position)}}});Nn({name:"VControlFullscreen",props:{options:{type:Object,default:()=>({}),required:!0},position:{type:String,default:()=>"bottom-left",required:!1}},setup(i){let e=mr(Qn);Un(()=>{t()});function t(){const r=new _s.ScaleControl(i.options);e.value.addControl(r,i.position)}}});Nn({name:"VLayerDeckArc",props:{layerId:{type:String,default:"deck.gl-arc-layer",required:!0},data:{type:Object,required:!0},options:{type:Object,required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r=new xw({...i.options,id:i.layerId,data:i.data,type:t_});e.value.on("style.load",()=>{const u=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(u,200))};u()}),Jr(t,u=>{u&&a()}),Un(()=>{a()});function a(){e.value.addLayer(r,i.before)}}});Nn({name:"VLayerDeckGeojson",props:{layerId:{type:String,default:"deck.gl-geojson-layer",required:!0},data:{type:Object,required:!0},options:{type:Object,required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r=new xw({...i.options,id:i.layerId,data:i.data,type:l_});e.value.on("style.load",()=>{const u=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(u,200))};u()}),Jr(t,u=>{u&&a()}),Un(()=>{a()});function a(){e.value.addLayer(r,i.before)}}});Nn({name:"VLayerMapboxCanvas",props:{sourceId:{type:String,default:"maplibre.gl-canvas-source",required:!0},layerId:{type:String,default:"maplibre.gl-canvas-layer",required:!0},source:{type:Object,required:!0},layer:{type:Object,default:()=>({}),required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r={...i.layer,id:i.layerId,source:i.sourceId},a={type:"geojson",data:i.source};e.value.on("style.load",()=>{const f=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(f,200))};f()}),Jr(t,f=>{f&&u()}),Un(()=>{u()});function u(){e.value.addSource(i.sourceId,a),e.value.addLayer(r,i.before)}}});const h_=(i,e)=>{const t=i.__vccOpts||i;for(const[r,a]of e)t[r]=a;return t},KF=Nn({name:"VLayerMapboxGeojson",props:{sourceId:{type:String,default:"maplibre.gl-geojson-source",required:!0},layerId:{type:String,default:"maplibre.gl-geojson-layer",required:!0},source:{type:Object,required:!0},layer:{type:Object,default:()=>({}),required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r={...i.layer,id:i.layerId,source:i.sourceId};e.value.on("style.load",()=>{const u=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(u,200))};u()}),Jr(t,u=>{u&&a()}),Un(()=>{a()}),cf(()=>{e.value.getLayer(i.layerId)&&(e.value.removeLayer(i.layerId),e.value.removeSource(i.sourceId))});function a(){e.value.addSource(i.sourceId,i.source),e.value.addLayer(r,i.before)}}});function JF(i,e,t,r,a,u){return Fs(),wu("div",null,[bg(i.$slots,"default")])}const QF=h_(KF,[["render",JF]]);Nn({name:"VLayerMapboxImage",props:{sourceId:{type:String,default:"maplibre.gl-image-source",required:!0},layerId:{type:String,default:"maplibre.gl-image-layer",required:!0},source:{type:Object,required:!0},layer:{type:Object,default:()=>({}),required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r={...i.layer,id:i.layerId,source:i.sourceId};e.value.on("style.load",()=>{const u=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(u,200))};u()}),Jr(t,u=>{u&&a()}),Un(()=>{a()});function a(){e.value.addSource(i.sourceId,i.source),e.value.addLayer(r,i.before)}}});Nn({name:"VLayerMapboxRaster",props:{sourceId:{type:String,default:"maplibre.gl-raster-source",required:!0},layerId:{type:String,default:"maplibre.gl-raster-layer",required:!0},source:{type:Object,required:!0},layer:{type:Object,default:()=>({}),required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r={...i.layer,id:i.layerId,source:i.sourceId},a={type:"geojson",data:i.source};e.value.on("style.load",()=>{const f=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(f,200))};f()}),Jr(t,f=>{f&&u()}),Un(()=>{u()});function u(){e.value.addSource(i.sourceId,a),e.value.addLayer(r,i.before)}}});Nn({name:"VLayerMapboxVector",props:{sourceId:{type:String,default:"maplibre.gl-vector-source",required:!0},layerId:{type:String,default:"maplibre.gl-vector-layer",required:!0},source:{type:Object,required:!0},layer:{type:Object,default:()=>({}),required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r={...i.layer,id:i.layerId,source:i.sourceId};e.value.on("style.load",()=>{const u=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(u,200))};u()}),Jr(t,u=>{u&&a()}),Un(()=>{a()});function a(){e.value.addSource(i.sourceId,i.source),e.value.addLayer(r,i.before)}}});Nn({name:"VLayerMapboxVideo",props:{sourceId:{type:String,default:"maplibre.gl-video-source",required:!0},layerId:{type:String,default:"maplibre.gl-video-layer",required:!0},source:{type:Object,required:!0},layer:{type:Object,default:()=>({}),required:!0},before:{type:String,default:"",required:!1}},setup(i){let e=mr(Qn),t=Fn(!1);const r={...i.layer,id:i.layerId,source:i.sourceId};e.value.on("style.load",()=>{const u=()=>{e.value.isStyleLoaded()?t.value=!0:(t.value=!1,setTimeout(u,200))};u()}),Jr(t,u=>{u&&a()}),Un(()=>{a()});function a(){e.value.addSource(i.sourceId,i.source),e.value.addLayer(r,i.before)}}});const Tv=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel"],Ev=["dragstart","drag","dragend"],Sv=["click","mouseenter","mouseleave"],pm=["open","close"],eB=Nn({name:"VMap",props:{options:{type:Object,required:!0,default:()=>({container:"map"})}},emits:["loaded",...Tv],setup(i,{emit:e}){let t=i2({}),r=Fn(!1),a=Fn(Tv);Un(()=>{t.value=new _s.Map(i.options),r.value=!0,Qv(Qn,t),u()});function u(){a.value.forEach(f=>{t.value.on(f,l=>{switch(f){case"load":e("loaded",t.value);break;default:e(f,l);break}})})}}}),tB=["id"];function iB(i,e,t,r,a,u){var f;return Fs(),wu("div",{id:`${(f=i.$props.options)==null?void 0:f.container}`,class:"v-map-container"},[bg(i.$slots,"default")],8,tB)}const nB=h_(eB,[["render",iB]]),rB=Nn({name:"VPopup",props:{marker:{type:Object,default:()=>({}),required:!1},options:{type:Object,default:()=>({}),required:!0},coordinates:{type:Object,default:()=>({}),required:!0}},emits:["added","removed",...pm],setup(i,{emit:e}){let t=mr(Qn),r=new _s.Popup(i.options),a=Fn(!0);const u=Fn(null);t.value.on("style.load",()=>{const C=()=>{t.value.isStyleLoaded()?a.value=!0:(a.value=!1,setTimeout(C,200))};C()}),Un(()=>{a.value?(f(),l(),x(),P()):(w(),M())}),cf(()=>{w(),M()});function f(){r.setDOMContent(u.value)}function l(){r.setLngLat(i.coordinates)}function x(){i.marker?i.marker.setPopup(r):r.addTo(t.value),e("added",{popup:r})}function w(){r.remove(),e("removed")}function P(){pm.forEach(C=>{r.on(C,()=>{e(C)})})}function M(){pm.forEach(C=>{r.off(C,()=>{e(C)})})}return{content:u}}}),sB=["id"];function oB(i,e,t,r,a,u){return Fs(),wu("section",{id:`popup-${Date.now()}`,ref:"content"},[bg(i.$slots,"default")],8,sB)}const aB=h_(rB,[["render",oB]]);Nn({name:"VMarker",components:{VPopup:aB},props:{coordinates:{type:[Object,Array],default:()=>({}),required:!0},options:{type:Object,default:()=>({}),required:!1},popupOptions:{type:Object,default:()=>({}),required:!1},cursor:{type:String,default:"pointer",required:!1}},emits:["added","update:coordinates","removed",...Ev,...Sv],setup(i,{emit:e}){let t=mr(Qn),r=Fn({}),a=Fn(!0),u=Fn(!1),f=Fn(null);const l=V=>{f.value=V};Jr(r,V=>{"_map"in V?u.value=!0:u.value=!1}),Un(()=>{a.value?f.value!==null?(r.value=new _s.Marker({element:f.value,...i.options}),x(r.value),P(r.value),w(r.value),C(r.value)):(r.value=new _s.Marker(i.options),x(r.value),P(r.value),w(r.value),C(r.value)):M(r.value)}),cf(()=>{M(r.value)}),t.value.on("style.load",()=>{const V=()=>{t.value.isStyleLoaded()?a.value=!0:(a.value=!1,setTimeout(V,200))};V()});function x(V){V.setLngLat(i.coordinates)}function w(V){V.getElement().style.cursor=i.cursor||"default"}function P(V){V.addTo(t.value),e("added",{marker:V})}function M(V){u.value&&(V.remove(),e("removed"))}function C(V){let Y;Ev.forEach(J=>{V.on(J,ce=>{J==="dragend"&&(i.coordinates instanceof Array?Y=[ce.target._lngLat.lng,ce.target._lngLat.lat]:Y=ce.target._lngLat,e("update:coordinates",Y)),e(J,ce)})}),Sv.forEach(J=>{V.getElement().addEventListener(J,ce=>{e(J,ce)})})}return{isMarkerAvailable:u,marker:r,setSlotRef:l}}});const lB=Nn({name:"App",components:{VMap:nB,VLayerMapboxGeojson:QF},setup(){const i=sf({map:{container:"map",style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[79.0882,21.1458],zoom:4},ui:{loaded:!1,styleChanged:!1,tilesLoaded:!1}}),e=Fn({source:{type:"geojson",data:"https://maplibre.org/maplibre-gl-js-docs/assets/earthquakes.geojson"},circleLayer:{id:"earthquakes-heat",type:"heatmap",source:"earthquakes",maxzoom:9,paint:{"heatmap-weight":["interpolate",["linear"],["get","mag"],0,0,6,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,9,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,9,0]}},countLayer:{id:"cluster-count",type:"symbol",source:"earthquakes",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}},pointLayer:{id:"earthquakes-point",type:"circle",source:"earthquakes",minzoom:7,paint:{"circle-radius":["interpolate",["linear"],["zoom"],7,["interpolate",["linear"],["get","mag"],1,1,6,4],16,["interpolate",["linear"],["get","mag"],1,5,6,50]],"circle-color":["interpolate",["linear"],["get","mag"],1,"rgba(33,102,172,0)",2,"rgb(103,169,207)",3,"rgb(209,229,240)",4,"rgb(253,219,199)",5,"rgb(239,138,98)",6,"rgb(178,24,43)"],"circle-stroke-color":"white","circle-stroke-width":1,"circle-opacity":["interpolate",["linear"],["zoom"],7,0,8,1]}}}),t=vb(()=>i.ui.loaded||i.ui.styleChanged);return{state:i,cluster:e,loaded:t,onMapLoaded:a=>{["idle","moveend","touchend","style.load","sourcedata","sourcedataloading"].forEach(f=>{a.on(f,()=>{if(f==="sourcedata"||f==="sourcedataloading"){const l=()=>{a.areTilesLoaded()?i.ui.tilesLoaded=!0:(i.ui.tilesLoaded=!1,setTimeout(l,200))};l()}if(f==="style.load"){const l=()=>{a.isStyleLoaded()?i.ui.styleChanged=!0:(i.ui.styleChanged=!1,setTimeout(l,200))};l()}})}),i.ui.loaded=!0}}}});const cB=(i,e)=>{const t=i.__vccOpts||i;for(const[r,a]of e)t[r]=a;return t},uB={class:"w-screen h-screen"};function hB(i,e,t,r,a,u){const f=Wy("v-layer-mapbox-geojson"),l=Wy("v-map");return Fs(),wu("main",uB,[fr(l,{class:"w-full h-full",options:i.state.map,onLoaded:i.onMapLoaded},{default:Jv(()=>[i.loaded?(Fs(),wu(Kr,{key:0},[i.loaded?(Fs(),du(f,{key:0,source:i.cluster.source,"source-id":"earthquakes-0",layer:i.cluster.circleLayer,"layer-id":i.cluster.circleLayer.id},null,8,["source","layer","layer-id"])):Kh("",!0),i.loaded?(Fs(),du(f,{key:1,source:i.cluster.source,"source-id":"earthquakes-1",layer:i.cluster.countLayer,"layer-id":i.cluster.countLayer.id},null,8,["source","layer","layer-id"])):Kh("",!0),i.loaded?(Fs(),du(f,{key:2,source:i.cluster.source,"source-id":"earthquakes-2",layer:i.cluster.pointLayer,"layer-id":i.cluster.pointLayer.id},null,8,["source","layer","layer-id"])):Kh("",!0)],64)):Kh("",!0)]),_:1},8,["options","onLoaded"])])}const dB=cB(lB,[["render",hB]]);DS(dB).mount("#app");
